/*!
 * froala_editor v3.2.6 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2021 Froala Labs
 */

{"version":3,"file":"image_tui.js","sources":["../../../src/js/third_party/image_tui.js"],"sourcesContent":["import FE from '../index.js'\r\n\r\nObject.assign(FE.DEFAULTS, {\r\n  imageTUIOptions: {\r\n    includeUI: {\r\n      theme: {\r\n        // main icons\r\n        'menu.normalIcon.path': 'https://cdn.jsdelivr.net/npm/tui-image-editor@3.2.2/dist/svg/icon-d.svg',\r\n        'menu.activeIcon.path': 'https://cdn.jsdelivr.net/npm/tui-image-editor@3.2.2/dist/svg/icon-b.svg',\r\n        'menu.disabledIcon.path': 'https://cdn.jsdelivr.net/npm/tui-image-editor@3.2.2/dist/svg/icon-a.svg',\r\n        'menu.hoverIcon.path': 'https://cdn.jsdelivr.net/npm/tui-image-editor@3.2.2/dist/svg/icon-c.svg',\r\n\r\n        // submenu icons\r\n        'submenu.normalIcon.path': 'https://cdn.jsdelivr.net/npm/tui-image-editor@3.2.2/dist/svg/icon-d.svg',\r\n        'submenu.normalIcon.name': 'icon-d',\r\n        'submenu.activeIcon.path': 'https://cdn.jsdelivr.net/npm/tui-image-editor@3.2.2/dist/svg/icon-c.svg',\r\n        'submenu.activeIcon.name': 'icon-c'\r\n      },\r\n      initMenu: 'filter',\r\n      menuBarPosition: 'left'\r\n    }\r\n  },\r\n  tui: window.tui\r\n})\r\n\r\nFE.PLUGINS.imageTUI = function (editor) {\r\n  const $ = editor.$\r\n  let source = true\r\n  // const current_image\r\n\r\n  function _init() {\r\n    const body = editor.o_doc.body\r\n\r\n    const tuiContainer = editor.o_doc.createElement('div')\r\n    tuiContainer.setAttribute('id', 'tuiContainer')\r\n    tuiContainer.style.cssText = 'position: fixed; top: 0;left: 0;margin: 0;padding: 0;width: 100%;height: 100%;background: rgba(0,0,0,.5);z-index: 9998;display:none'\r\n    body.appendChild(tuiContainer)\r\n  }\r\n  function launch(instance,callFromImagePlugin,index) {\r\n    let current_image\r\n    let current_image_src\r\n    source = callFromImagePlugin\r\n    if (typeof editor.opts.tui === 'object') {\r\n      //const body = editor.o_doc.body\r\n      const tuiEditorContainerDiv = editor.o_doc.createElement('div')\r\n      tuiEditorContainerDiv.setAttribute('id', 'tuieditor')\r\n\r\n      const popupContainer = editor.o_doc.getElementById('tuiContainer')\r\n      popupContainer.appendChild(tuiEditorContainerDiv)\r\n      popupContainer.style.display = 'block'\r\n      if(callFromImagePlugin){\r\n        current_image=  instance.image.get() \r\n        current_image_src=current_image[0].src\r\n      }\r\n      else{\r\n        current_image= instance.filesManager.get()\r\n          current_image_src = current_image.src; //current_image[0].src\r\n      }\r\n      \r\n      const opts = editor.opts.imageTUIOptions\r\n      opts.includeUI.loadImage = {\r\n        path: current_image_src,\r\n        name: ' '\r\n      }\r\n      const tuiEditorObject = new editor.opts.tui.ImageEditor(editor.o_doc.querySelector('#tuieditor'), opts)\r\n\r\n      const canvasContainer = editor.o_doc.getElementById('tuieditor')\r\n      canvasContainer.style.minHeight = (300 + 290) + 'px'\r\n      canvasContainer.style.width = '94%'\r\n      canvasContainer.style.height = '94%'\r\n      canvasContainer.style.margin = 'auto'\r\n\r\n      $('.tui-image-editor-header-buttons').html(\r\n        '<button class=\"tui-editor-cancel-btn\" data-cmd=\"cancel_tui_image\">Cancel</button> <button class=\"tui-editor-save-btn\">Save</button>'\r\n      )\r\n\r\n      $('.tui-editor-cancel-btn')[0].addEventListener('click', function (e) {\r\n        destroyTuiEditor(popupContainer, instance)\r\n      })\r\n\r\n      $('.tui-editor-save-btn')[0].addEventListener('click',function (e) {\r\n        if(index != null){\r\n          saveTuiImage(tuiEditorObject, instance, current_image,callFromImagePlugin, index)  \r\n        }\r\n        else{\r\n          saveTuiImage(tuiEditorObject, instance, current_image,callFromImagePlugin)\r\n        }\r\n        destroyTuiEditor(popupContainer, instance)\r\n      })\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function destroyTuiEditor(container, instance) {\r\n    $('#tuieditor').remove()\r\n    container.style.display = 'none'\r\n    if (!source  && instance !== undefined) {\r\n      instance.filesManager.setChildWindowState(false)\r\n    }\r\n  }\r\n\r\n  function saveTuiImage(tuiEditorObject, instance, current_image,callFromImagePlugin, index) {\r\n    const savedImg = tuiEditorObject.toDataURL()\r\n    const binary = atob(savedImg.split(',')[1])\r\n    const array = []\r\n\r\n    for (let i = 0; i < binary.length; i++) {\r\n      array.push(binary.charCodeAt(i))\r\n    }\r\n    const upload_img = new Blob([new Uint8Array(array)], {\r\n      type: 'image/png'\r\n    })\r\n    \r\n    if (callFromImagePlugin) {\r\n    instance.image.edit(current_image)\r\n    instance.image.upload([upload_img])\r\n    }\r\n    else {\r\n      instance.filesManager.saveImage([upload_img])\r\n      if(index != null){\r\n        instance.filesManager.upload(upload_img,[upload_img],null,index)\r\n        instance.filesManager.getFileThumbnail(index, upload_img, true)\r\n      }\r\n      else {\r\n        instance.filesManager.upload(upload_img,[upload_img],null,current_image)\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    _init: _init,\r\n    launch: launch\r\n  }\r\n\r\n}\r\n\r\nFE.DefineIcon('imageTUI', {\r\n  NAME: 'sliders',\r\n  FA5NAME: 'sliders-h',\r\n  SVG_KEY: 'advancedImageEditor'\r\n})\r\n\r\nFE.RegisterCommand('imageTUI', {\r\n  title: 'Advanced Edit',\r\n  undo: false,\r\n  focus: false,\r\n  callback: function (cmd, val) {\r\n    this.imageTUI.launch(this,true)\r\n  },\r\n  plugin: 'imageTUI'\r\n})\r\n\r\n// Look for image plugin.\r\nif (!FE.PLUGINS.image) {\r\n  throw new Error('TUI image editor plugin requires image plugin.')\r\n}\r\n\r\nFE.DEFAULTS.imageEditButtons.push('imageTUI')"],"names":["Object","assign","FE","DEFAULTS","imageTUIOptions","includeUI","theme","initMenu","menuBarPosition","tui","window","PLUGINS","imageTUI","editor","$","source","_init","body","o_doc","tuiContainer","createElement","setAttribute","style","cssText","appendChild","launch","instance","callFromImagePlugin","index","current_image","current_image_src","opts","tuiEditorContainerDiv","popupContainer","getElementById","display","image","get","src","filesManager","loadImage","path","name","tuiEditorObject","ImageEditor","querySelector","canvasContainer","minHeight","width","height","margin","html","addEventListener","e","destroyTuiEditor","saveTuiImage","container","remove","undefined","setChildWindowState","savedImg","toDataURL","binary","atob","split","array","i","length","push","charCodeAt","upload_img","Blob","Uint8Array","type","edit","upload","saveImage","getFileThumbnail","DefineIcon","NAME","FA5NAME","SVG_KEY","RegisterCommand","title","undo","focus","callback","cmd","val","plugin","Error","imageEditButtons"],"mappings":"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"}