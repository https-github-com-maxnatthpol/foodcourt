/*!
 * froala_editor v3.2.6 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2021 Froala Labs
 */

{"version":3,"file":"image_manager.js","sources":["../../../src/js/plugins/image_manager.js"],"sourcesContent":["import FE from '../index.js'\r\n'use strict';\r\n\r\nObject.assign(FE.DEFAULTS, {\r\n  imageManagerLoadURL: 'https://i.froala.com/load-files',\r\n  imageManagerLoadMethod: 'get',\r\n  imageManagerLoadParams: {},\r\n  imageManagerPreloader: null,\r\n  imageManagerDeleteURL: '',\r\n  imageManagerDeleteMethod: 'post',\r\n  imageManagerDeleteParams: {},\r\n  imageManagerPageSize: 12,\r\n  imageManagerScrollOffset: 20,\r\n  imageManagerToggleTags: true\r\n})\r\n\r\nFE.PLUGINS.imageManager = function (editor) {\r\n\r\n  const $ = editor.$\r\n  let $modal\r\n  const modal_id = 'image_manager'\r\n\r\n  let $head\r\n  let $body\r\n  let $preloader\r\n  let $media_files\r\n  let $image_tags\r\n  let images\r\n  let page\r\n  let image_count\r\n  let loaded_images\r\n  let column_number\r\n\r\n  // Load errors.\r\n  const BAD_LINK = 10\r\n  const ERROR_DURING_LOAD = 11\r\n  const MISSING_LOAD_URL_OPTION = 12\r\n  const LOAD_BAD_RESPONSE = 13\r\n  const MISSING_IMG_THUMB = 14\r\n  const MISSING_IMG_URL = 15\r\n\r\n  // Delete errors\r\n  const ERROR_DURING_DELETE = 21\r\n  const MISSING_DELETE_URL_OPTION = 22\r\n\r\n  // Error Messages\r\n  const error_messages = {}\r\n  error_messages[BAD_LINK] = 'Image cannot be loaded from the passed link.'\r\n  error_messages[ERROR_DURING_LOAD] = 'Error during load images request.'\r\n  error_messages[MISSING_LOAD_URL_OPTION] = 'Missing imageManagerLoadURL option.'\r\n  error_messages[LOAD_BAD_RESPONSE] = 'Parsing load response failed.'\r\n  error_messages[MISSING_IMG_THUMB] = 'Missing image thumb.'\r\n  error_messages[MISSING_IMG_URL] = 'Missing image URL.'\r\n  error_messages[ERROR_DURING_DELETE] = 'Error during delete image request.'\r\n  error_messages[MISSING_DELETE_URL_OPTION] = 'Missing imageManagerDeleteURL option.'\r\n\r\n  /*\r\n   * Show the image manager.\r\n   */\r\n  function show() {\r\n\r\n    // Build the image manager.\r\n    if (!$modal) {\r\n\r\n      // Build head.\r\n      let head = `<button class=\"fr-command fr-btn fr-modal-more fr-not-available\" id=\"fr-modal-more-${editor.sid}\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"\"><path d=\"${FE.SVG.tags}\"/></svg></button><h4 data-text=\"true\">${editor.language.translate('Manage Images')}</h4></div>\r\n      <div class=\"fr-modal-tags\" id=\"fr-modal-tags\">`\r\n\r\n      // Preloader.\r\n      let body\r\n\r\n      if (editor.opts.imageManagerPreloader) {\r\n        body = `<img class=\"fr-preloader\" id=\"fr-preloader\" alt=\"${editor.language.translate('Loading')}..\" src=\"${editor.opts.imageManagerPreloader}\" style=\"display: none;\">`\r\n      }\r\n      else {\r\n        body = `<span class=\"fr-preloader\" id=\"fr-preloader\" style=\"display: none;\">${editor.language.translate('Loading')}</span>`\r\n      }\r\n\r\n      // Image list.\r\n      body += '<div class=\"fr-image-list\" id=\"fr-image-list\"></div>'\r\n\r\n      const modalHash = editor.modals.create(modal_id, head, body)\r\n      $modal = modalHash.$modal\r\n      $head = modalHash.$head\r\n      $body = modalHash.$body\r\n    }\r\n\r\n    // Set the current image (if modal is opened to replace an image).\r\n    $modal.data('current-image', editor.image.get())\r\n\r\n    // Show modal.\r\n    editor.modals.show(modal_id)\r\n\r\n    if (!$preloader) {\r\n      _delayedInit()\r\n    }\r\n\r\n    // Load images.\r\n    _loadImages()\r\n  }\r\n\r\n  /*\r\n   * Hide the image manager.\r\n   */\r\n  function hide() {\r\n\r\n    // Hide modal.\r\n    editor.modals.hide(modal_id)\r\n  }\r\n\r\n  /*\r\n   * Get the number of columns based on window width.\r\n   */\r\n  function _columnNumber() {\r\n    const window_width = $(window).outerWidth()\r\n\r\n    // Screen XS.\r\n    if (window_width < 768) {\r\n      return 2\r\n    }\r\n\r\n    // Screen SM and MD.\r\n    else if (window_width < 1200) {\r\n      return 3\r\n    }\r\n\r\n    // Screen LG.\r\n    else {\r\n      return 4\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Add the correct number of columns.\r\n   */\r\n  function _buildColumns() {\r\n    $media_files.empty()\r\n\r\n    for (let i = 0; i < column_number; i++) {\r\n      $media_files.append('<div class=\"fr-list-column\"></div>')\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Load images from server.\r\n   */\r\n  function _loadImages() {\r\n    $preloader.show()\r\n    $media_files.find('.fr-list-column').empty()\r\n\r\n    // If the images load URL is set.\r\n    if (editor.opts.imageManagerLoadURL) {\r\n\r\n      // Make request to get list of images\r\n      $(this).ajax({\r\n        url: editor.opts.imageManagerLoadURL,\r\n        method: editor.opts.imageManagerLoadMethod,\r\n        data: editor.opts.imageManagerLoadParams,\r\n        crossDomain: editor.opts.requestWithCORS,\r\n        withCredentials: editor.opts.requestWithCredentials,\r\n        headers: editor.opts.requestHeaders,\r\n        // Success\r\n        done: function(data, status, xhr) {\r\n          editor.events.trigger('imageManager.imagesLoaded', [data])\r\n          _processLoadedImages(data, xhr.response)\r\n          $preloader.hide()\r\n        },\r\n        // Failure\r\n        fail: function(xhr) {\r\n          _throwError(ERROR_DURING_LOAD, xhr.response || xhr.responseText)\r\n        }\r\n      })\r\n\r\n    }\r\n\r\n    // Throw missing imageManagerLoadURL option error.\r\n    else {\r\n      _throwError(MISSING_LOAD_URL_OPTION)\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Process loaded images.\r\n   */\r\n  function _processLoadedImages(imgs, response) {\r\n    try {\r\n      $media_files.find('.fr-list-column').empty()\r\n      page = 0\r\n      image_count = 0\r\n      loaded_images = 0\r\n      images = JSON.parse(imgs)\r\n\r\n      // Load files.\r\n      _infiniteScroll()\r\n    }\r\n\r\n    // Throw error while parsing the response.\r\n    catch (ex) {\r\n      _throwError(LOAD_BAD_RESPONSE, response)\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Load more images if necessary.\r\n   */\r\n  function _infiniteScroll() {\r\n\r\n    // If there aren't enough images in the modal or if the user scrolls down.\r\n    if (image_count < images.length &&\r\n      ($media_files.outerHeight() <= $body.outerHeight() + editor.opts.imageManagerScrollOffset ||\r\n        $body.scrollTop() + editor.opts.imageManagerScrollOffset > $media_files.outerHeight() - $body.outerHeight())) {\r\n\r\n      // Increase page number.\r\n      page++\r\n\r\n      // Load each image on this page.\r\n      for (let i = editor.opts.imageManagerPageSize * (page - 1); i < Math.min(images.length, editor.opts.imageManagerPageSize * page); i++) {\r\n        _loadImage(images[i])\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Load file.\r\n   */\r\n  function _loadImage(image) {\r\n    const img = new Image()\r\n    const $img_container = $(document.createElement('div')).attr('class', 'fr-image-container fr-empty fr-image-' + (loaded_images++)).attr('data-loading', editor.language.translate('Loading') + '..').attr('data-deleting', editor.language.translate('Deleting') + '..')\r\n\r\n    // After adding image empty container modal might change its height.\r\n    _resizeModal(false)\r\n\r\n    // Image has been loaded.\r\n    img.onload = function () {\r\n\r\n      // Update image container height.\r\n      $img_container.height(Math.floor($img_container.width() / img.width * img.height))\r\n\r\n      // Create image HTML.\r\n      const $img = $(document.createElement('img'))\r\n\r\n      // Use image thumb in image manager.\r\n      if (image.thumb) {\r\n\r\n        // Set image src attribute/\r\n        $img.attr('src', image.thumb)\r\n      }\r\n\r\n      // Image does not have thumb.\r\n      else {\r\n\r\n        // Throw missing image thumb error.\r\n        _throwError(MISSING_IMG_THUMB, image)\r\n\r\n        // Set image URL as src attribute.\r\n        if (image.url) {\r\n          $img.attr('src', image.url)\r\n        }\r\n\r\n        // Missing image URL.\r\n        else {\r\n\r\n          // Throw missing image url error.\r\n          _throwError(MISSING_IMG_URL, image)\r\n\r\n          // Don't go further if image does not have a src attribute.\r\n\r\n          return false\r\n        }\r\n      }\r\n\r\n      // Save image URL.\r\n      if (image.url) $img.attr('data-url', image.url)\r\n\r\n      // Image tags.\r\n      if (image.tag) {\r\n\r\n        // Show tags only if there are any.\r\n        $head.find('.fr-modal-more.fr-not-available').removeClass('fr-not-available')\r\n        $head.find('.fr-modal-tags').show()\r\n\r\n        // Image has more than one tag.\r\n        if (image.tag.indexOf(',') >= 0) {\r\n\r\n          // Add tags to the image manager tag list.\r\n          const tags = image.tag.split(',')\r\n\r\n          for (let i = 0; i < tags.length; i++) {\r\n\r\n            // Remove trailing spaces.\r\n            tags[i] = tags[i].trim()\r\n\r\n            // Add tag.\r\n            if ($image_tags.find(`a[title=\"${tags[i]}\"]`).length === 0) {\r\n              $image_tags.append(`<a role=\"button\" title=\"${tags[i]}\">${tags[i]}</a>`)\r\n            }\r\n          }\r\n\r\n          // Set img tag attribute.\r\n          $img.attr('data-tag', tags.join())\r\n        }\r\n\r\n        // Image has only one tag.\r\n        else {\r\n\r\n          // Add tag to the tag list.\r\n          if ($image_tags.find(`a[title=\"${image.tag.trim()}\"]`).length === 0) {\r\n            $image_tags.append(`<a role=\"button\" title=\"${image.tag.trim()}\">${image.tag.trim()}</a>`)\r\n          }\r\n\r\n          // Set img tag attribute.\r\n          $img.attr('data-tag', image.tag.trim())\r\n        }\r\n      }\r\n\r\n      // Image alt.\r\n      if (image.name) {\r\n        $img.attr('alt', image.name)\r\n      }\r\n\r\n      // Set image additional data.\r\n      for (const key in image) {\r\n        if (image.hasOwnProperty(key)) {\r\n          if (key !== 'thumb' && key !== 'url' && key !== 'tag') {\r\n            $img.attr(`data-${key}`, image[key])\r\n          }\r\n        }\r\n      }\r\n\r\n      // Add image and insert and delete buttons to the image container.\r\n      $img_container\r\n        .append($img)\r\n        .append($(editor.icon.create('imageManagerDelete')).addClass('fr-delete-img').attr('title', editor.language.translate('Delete')))\r\n        .append($(editor.icon.create('imageManagerInsert')).addClass('fr-insert-img').attr('title', editor.language.translate('Insert')))\r\n\r\n      // Show image only if it has selected tags.\r\n      $image_tags.find('.fr-selected-tag').each(function (index, tag) {\r\n        if (!_imageHasTag($img, tag.text)) {\r\n          $img_container.hide()\r\n        }\r\n      })\r\n\r\n      // After an image is loaded the modal may need to be resized.\r\n      $img.on('load', function () {\r\n\r\n        // Image container is no longer empty.\r\n        $img_container.removeClass('fr-empty')\r\n        $img_container.height('auto')\r\n\r\n        // Increase image counter.\r\n        image_count++\r\n\r\n        // A loded image may break the images order. Reorder them starting with this image.\r\n        const imgs = _getImages(parseInt($img.parent().attr('class').match(/fr-image-(\\d+)/)[1], 10) + 1)\r\n\r\n        // Reorder images.\r\n        _reorderImages(imgs)\r\n\r\n        // Image modal may need resizing.\r\n        _resizeModal(false)\r\n\r\n        // If this was the last image on page then we might need to load more.\r\n        if (image_count % editor.opts.imageManagerPageSize === 0) {\r\n          _infiniteScroll()\r\n        }\r\n      })\r\n\r\n      // Trigger imageLoaded event.\r\n      editor.events.trigger('imageManager.imageLoaded', [$img])\r\n    }\r\n\r\n    // Error while loading the image.\r\n    img.onerror = function () {\r\n      image_count++\r\n      $img_container.remove()\r\n\r\n      // Removing an image container may break image order.\r\n      const imgs = _getImages(parseInt($img_container.attr('class').match(/fr-image-(\\d+)/)[1], 10) + 1)\r\n\r\n      // Reorder images.\r\n      _reorderImages(imgs)\r\n\r\n      _throwError(BAD_LINK, image)\r\n\r\n      // If this was the last image on page then we might need to load more.\r\n      if (image_count % editor.opts.imageManagerPageSize === 0) {\r\n        _infiniteScroll()\r\n      }\r\n    }\r\n\r\n    // Set the image object's src.\r\n    img.src = image.thumb || image.url\r\n\r\n    // Add loaded or empty image to the media manager image list on the shortest column.\r\n    _shortestColumn().append($img_container)\r\n  }\r\n\r\n  /*\r\n   * Get the shortest image column.\r\n   */\r\n  function _shortestColumn() {\r\n    let $col\r\n    let min_height\r\n\r\n    $media_files.find('.fr-list-column').each(function (index, col) {\r\n      const $column = $(col)\r\n\r\n      // Assume that the first column is the shortest.\r\n      if (index === 0) {\r\n        min_height = $column.outerHeight()\r\n        $col = $column\r\n      }\r\n\r\n      // Check if another column is shorter.\r\n      else {\r\n        if ($column.outerHeight() < min_height) {\r\n          min_height = $column.outerHeight()\r\n          $col = $column\r\n        }\r\n      }\r\n    })\r\n\r\n    return $col\r\n  }\r\n\r\n  /*\r\n   * Get all images from the image manager.\r\n   */\r\n  function _getImages(from) {\r\n    if (from === undefined) from = 0\r\n    const get_images = []\r\n\r\n    for (let i = loaded_images - 1; i >= from; i--) {\r\n      const $image = $media_files.find(`.fr-image-${i}`)\r\n\r\n      if ($image.length) {\r\n        get_images.push($image)\r\n\r\n        // Add images here before deleting them so the on load callback is triggered.\r\n        $(document.createElement('div')).attr('id', 'fr-image-hidden-container').append($image)\r\n        $media_files.find(`.fr-image-${i}`).remove()\r\n      }\r\n    }\r\n\r\n    return get_images\r\n  }\r\n\r\n  /*\r\n   * Add images back into the image manager.\r\n   */\r\n  function _reorderImages(imgs) {\r\n    for (let i = imgs.length - 1; i >= 0; i--) {\r\n      _shortestColumn().append(imgs[i])\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Resize the media manager modal if height changes.\r\n   */\r\n  function _resizeModal(infinite_scroll) {\r\n    if (infinite_scroll === undefined) infinite_scroll = true\r\n\r\n    if (!$modal.isVisible()) return true\r\n\r\n    // If width changes, the number of columns may change.\r\n    const cols = _columnNumber()\r\n\r\n    if (cols !== column_number) {\r\n      column_number = cols\r\n\r\n      // Get all images.\r\n      const imgs = _getImages()\r\n\r\n      // Remove current columns and add new ones.\r\n      _buildColumns()\r\n\r\n      // Reorder images.\r\n      _reorderImages(imgs)\r\n    }\r\n\r\n    editor.modals.resize(modal_id)\r\n\r\n    // Load more photos when window is resized if necessary.\r\n    if (infinite_scroll) {\r\n      _infiniteScroll()\r\n    }\r\n  }\r\n\r\n  function _getImageAttrs($img) {\r\n    var name,\r\n      attrs = $img[0].attributes,\r\n      i = attrs.length,\r\n      img_attributes = {}\r\n\r\n    while (i--) {\r\n      if (attrs[i]) {\r\n        name = attrs[i].name\r\n\r\n        // https://github.com/froala-labs/froala-editor-js-2/issues/2870\r\n        // Include all attributes from the image manager except 'src'\r\n        if(name !== 'src') {\r\n          img_attributes[name] = attrs[i].value\r\n        }\r\n      }\r\n    }\r\n\r\n    return img_attributes\r\n  }\r\n\r\n  /*\r\n   * Insert image into the editor.\r\n   */\r\n  function _insertImage(e) {\r\n\r\n    // Image to insert.\r\n    const $img = $(e.currentTarget).siblings('img')\r\n\r\n    const inst = $modal.data('instance') || editor\r\n    const $current_image = $modal.data('current-image')\r\n\r\n    editor.modals.hide(modal_id)\r\n    inst.image.showProgressBar()\r\n\r\n    if (!$current_image) {\r\n\r\n      // Make sure we have focus.\r\n      inst.events.focus(true)\r\n      inst.selection.restore()\r\n\r\n      const rect = inst.position.getBoundingRect()\r\n\r\n      const left = rect.left + rect.width / 2 + $(editor.doc).scrollLeft()\r\n      const top = rect.top + rect.height + $(editor.doc).scrollTop()\r\n\r\n      // Show the image insert popup.\r\n      inst.popups.setContainer('image.insert', editor.$sc)\r\n      inst.popups.show('image.insert', left, top)\r\n    }\r\n    else {\r\n      $current_image.data('fr-old-src', $current_image.attr('src'))\r\n      $current_image.trigger('click')\r\n    }\r\n\r\n    inst.image.insert($img.data('url'), false, _getImageAttrs($img), $current_image)\r\n  }\r\n\r\n  /*\r\n   * Update tags.\r\n   */\r\n  function _updateTags() {\r\n    $modal.find('#fr-modal-tags > a').each(function () {\r\n\r\n      if ($modal.find(`#fr-image-list [data-tag*=\"${$(this).text()}\"]`).length === 0) {\r\n        $(this).removeClass('fr-selected-tag').hide()\r\n      }\r\n    })\r\n\r\n    _showImagesByTags()\r\n  }\r\n\r\n  /*\r\n   * Delete image.\r\n   */\r\n  function _deleteImage(e) {\r\n\r\n    // Image to delete.\r\n    const $img = $(e.currentTarget).siblings('img')\r\n\r\n    // Confirmation message.\r\n    const message = editor.language.translate('Are you sure? Image will be deleted.')\r\n\r\n    // Ask for confirmation.\r\n    if (confirm(message)) {\r\n\r\n      // If the images delete URL is set.\r\n      if (editor.opts.imageManagerDeleteURL) {\r\n\r\n        // Before delete image event.\r\n        if (editor.events.trigger('imageManager.beforeDeleteImage', [$img]) !== false) {\r\n          $img.parent().addClass('fr-image-deleting')\r\n\r\n          // Make request to delete image from server.\r\n          $(this).ajax({\r\n            method: editor.opts.imageManagerDeleteMethod,\r\n            url: editor.opts.imageManagerDeleteURL,\r\n            data: Object.assign(Object.assign({ src: $img.attr('src') }, _getImageAttrs($img)), editor.opts.imageManagerDeleteParams),\r\n            crossDomain: editor.opts.requestWithCORS,\r\n            withCredentials: editor.opts.requestWithCredentials,\r\n            headers: editor.opts.requestHeaders,\r\n            // Success function\r\n            done: function (data, status, xhr) {\r\n              editor.events.trigger('imageManager.imageDeleted', [data])\r\n\r\n              // A deleted image may break the images order. Reorder them starting with this image.\r\n              const imgs = _getImages(parseInt($img.parent().attr('class').match(/fr-image-(\\d+)/)[1], 10) + 1)\r\n\r\n              // Remove the image.\r\n              $img.parent().remove()\r\n\r\n              // Reorder images.\r\n              _reorderImages(imgs)\r\n\r\n              // Update tags.\r\n              _updateTags()\r\n\r\n              // Modal needs resizing.\r\n              _resizeModal(true)\r\n            },\r\n            // Failure function\r\n            fail: function (xhr) {\r\n              _throwError(ERROR_DURING_DELETE, xhr.response || xhr.responseText)\r\n            }\r\n          })\r\n\r\n        }\r\n      }\r\n\r\n      // Throw missing imageManagerDeleteURL option error.\r\n      else {\r\n        _throwError(MISSING_DELETE_URL_OPTION)\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Throw image manager errors.\r\n   */\r\n  function _throwError(code, response) {\r\n\r\n    // Load images error.\r\n    if (10 <= code && code < 20) {\r\n\r\n      // Hide preloader.\r\n      $preloader.hide()\r\n    }\r\n\r\n    // Delete image error.\r\n    else if (20 <= code && code < 30) {\r\n\r\n      // Remove deleting overlay.\r\n      $('.fr-image-deleting').removeClass('fr-image-deleting')\r\n    }\r\n\r\n    // Trigger error event.\r\n    editor.events.trigger('imageManager.error', [{\r\n      code: code,\r\n      message: error_messages[code]\r\n    }, response])\r\n  }\r\n\r\n  /*\r\n   * Toogle (show or hide) image tags.\r\n   */\r\n  function _toggleTags() {\r\n    const title_height = $head.find('.fr-modal-head-line').outerHeight()\r\n    const tags_height = $image_tags.outerHeight()\r\n\r\n    // Use .fr-show-tags.\r\n    $head.toggleClass('fr-show-tags')\r\n\r\n    if ($head.hasClass('fr-show-tags')) {\r\n\r\n      // Show tags by changing height to have transition.\r\n      $head.css('height', title_height + tags_height)\r\n      // Shift the body by the same amount as the head\r\n      $body.css('marginTop', title_height + tags_height)\r\n      $image_tags.find('a').css('opacity', 1)\r\n    }\r\n\r\n    else {\r\n\r\n      // Hide tags by changing height to have transition.\r\n      $head.css('height', title_height)\r\n      $body.css('marginTop', title_height)\r\n      $image_tags.find('a').css('opacity', 0)\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Show only images with selected tags.\r\n   */\r\n  function _showImagesByTags() {\r\n\r\n    // Get all selected tags.\r\n    const $tags = $image_tags.find('.fr-selected-tag')\r\n\r\n    // Show only images with selected tags.\r\n    if ($tags.length > 0) {\r\n\r\n      // Hide all images.\r\n      $media_files.find('img').parents().show()\r\n\r\n      // Show only images with tag.\r\n      $tags.each(function (index, tag) {\r\n        $media_files.find('img').each(function (index, img) {\r\n          const $img = $(img)\r\n\r\n          if (!_imageHasTag($img, tag.text)) {\r\n            $img.parent().hide()\r\n          }\r\n        })\r\n      })\r\n    }\r\n\r\n    // There are no more tags selected. Show all images.\r\n    else {\r\n      $media_files.find('img').parents().show()\r\n    }\r\n\r\n    // Rearrange images.\r\n    const imgs = _getImages()\r\n\r\n    // Reorder images.\r\n    _reorderImages(imgs)\r\n\r\n    // Load more images if necessary.\r\n    _infiniteScroll()\r\n  }\r\n\r\n  /*\r\n   * Select an image tag from the list.\r\n   */\r\n  function _selectTag(e) {\r\n    e.preventDefault()\r\n\r\n    // Toggle current tags class.\r\n    const $tag = $(e.currentTarget)\r\n    $tag.toggleClass('fr-selected-tag')\r\n\r\n    // Toggle selected tags.\r\n    if (editor.opts.imageManagerToggleTags) $tag.siblings('a').removeClass('fr-selected-tag')\r\n\r\n    // Change displayed images.\r\n    _showImagesByTags()\r\n  }\r\n\r\n  /*\r\n   * Method to check if an image has a specific tag.\r\n   */\r\n  function _imageHasTag($image, tag) {\r\n    const tags = ($image.attr('data-tag') || '').split(',')\r\n\r\n    for (let i = 0; i < tags.length; i++) {\r\n      if (tags[i] === tag) {\r\n        return true\r\n      }\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  function _delayedInit() {\r\n    $preloader = $modal.find('#fr-preloader')\r\n    $media_files = $modal.find('#fr-image-list')\r\n    $image_tags = $modal.find('#fr-modal-tags')\r\n\r\n    // Columns.\r\n    column_number = _columnNumber()\r\n    _buildColumns()\r\n\r\n    // Set height for title (we need this for show tags transition).\r\n    $head.css('height', $head.find('.fr-modal-head-line').outerHeight())\r\n\r\n    // Resize media manager modal on window resize.\r\n    editor.events.$on($(editor.o_win), 'resize', function () {\r\n\r\n      // Window resize with image manager opened.\r\n      if (images) {\r\n        _resizeModal(true)\r\n      }\r\n\r\n      // iOS window resize is triggered when modal first opens (no images loaded).\r\n      else {\r\n        _resizeModal(false)\r\n      }\r\n    })\r\n\r\n    // Insert image.\r\n    editor.events.bindClick($media_files, '.fr-insert-img', _insertImage)\r\n\r\n    // Delete image.\r\n    editor.events.bindClick($media_files, '.fr-delete-img', _deleteImage)\r\n\r\n    // Delete and insert buttons for mobile.\r\n    if (editor.helpers.isMobile()) {\r\n\r\n      // Show image buttons on mobile.\r\n      editor.events.bindClick($media_files, 'div.fr-image-container', function (e) {\r\n        $modal.find('.fr-mobile-selected').removeClass('fr-mobile-selected')\r\n        $(e.currentTarget).addClass('fr-mobile-selected')\r\n      })\r\n\r\n      // Hide image buttons if we click outside it.\r\n      $modal.on(editor._mousedown, function () {\r\n        $modal.find('.fr-mobile-selected').removeClass('fr-mobile-selected')\r\n      })\r\n    }\r\n\r\n    // Make sure we don't trigger blur.\r\n    $modal.on(editor._mousedown + ' ' + editor._mouseup, function (e) {\r\n      e.stopPropagation()\r\n    })\r\n\r\n    // Mouse down on anything.\r\n    $modal.on(editor._mousedown, '*', function () {\r\n      editor.events.disableBlur()\r\n    })\r\n\r\n    // Infinite scroll\r\n    $body.on('scroll', _infiniteScroll)\r\n\r\n    // Click on image tags button.\r\n    editor.events.bindClick($modal, `button#fr-modal-more-${editor.sid}`, _toggleTags)\r\n\r\n    // Select an image tag.\r\n    editor.events.bindClick($image_tags, 'a', _selectTag)\r\n  }\r\n\r\n  /*\r\n   * Init media manager.\r\n   */\r\n  function _init() {\r\n    if (!editor.$wp && editor.el.tagName !== 'IMG') return false\r\n  }\r\n\r\n  return {\r\n    require: ['image'],\r\n    _init: _init,\r\n    show: show,\r\n    hide: hide\r\n  }\r\n}\r\n\r\nif (!FE.PLUGINS.image) {\r\n  throw new Error('Image manager plugin requires image plugin.')\r\n}\r\n\r\nFE.DEFAULTS.imageInsertButtons.push('imageManager')\r\n\r\nFE.RegisterCommand('imageManager', {\r\n  title: 'Browse',\r\n  undo: false,\r\n  focus: false,\r\n  modal: true,\r\n  callback: function () {\r\n    this.imageManager.show()\r\n  },\r\n  plugin: 'imageManager'\r\n})\r\n\r\n// Add the font size icon.\r\nFE.DefineIcon('imageManager', {\r\n  NAME: 'folder',\r\n  SVG_KEY: 'imageManager'\r\n})\r\n\r\n// Add the font size icon.\r\nFE.DefineIcon('imageManagerInsert', {\r\n  NAME: 'plus',\r\n  SVG_KEY: 'add'\r\n})\r\n\r\n// Add the font size icon.\r\nFE.DefineIcon('imageManagerDelete', {\r\n  NAME: 'trash',\r\n  SVG_KEY: 'remove'\r\n})\r\n"],"names":["Object","assign","FE","DEFAULTS","imageManagerLoadURL","imageManagerLoadMethod","imageManagerLoadParams","imageManagerPreloader","imageManagerDeleteURL","imageManagerDeleteMethod","imageManagerDeleteParams","imageManagerPageSize","imageManagerScrollOffset","imageManagerToggleTags","PLUGINS","imageManager","editor","$","$modal","modal_id","$head","$body","$preloader","$media_files","$image_tags","images","page","image_count","loaded_images","column_number","BAD_LINK","ERROR_DURING_LOAD","MISSING_LOAD_URL_OPTION","LOAD_BAD_RESPONSE","MISSING_IMG_THUMB","MISSING_IMG_URL","ERROR_DURING_DELETE","MISSING_DELETE_URL_OPTION","error_messages","show","head","sid","SVG","tags","language","translate","body","opts","modalHash","modals","create","data","image","get","_delayedInit","_loadImages","hide","_columnNumber","window_width","window","outerWidth","_buildColumns","empty","i","append","find","ajax","url","method","crossDomain","requestWithCORS","withCredentials","requestWithCredentials","headers","requestHeaders","done","status","xhr","events","trigger","_processLoadedImages","response","fail","_throwError","responseText","imgs","JSON","parse","_infiniteScroll","ex","length","outerHeight","scrollTop","Math","min","_loadImage","img","Image","$img_container","document","createElement","attr","_resizeModal","onload","height","floor","width","$img","thumb","tag","removeClass","indexOf","split","trim","join","name","key","hasOwnProperty","icon","addClass","each","index","_imageHasTag","text","on","_getImages","parseInt","parent","match","_reorderImages","onerror","remove","src","_shortestColumn","$col","min_height","col","$column","from","undefined","get_images","$image","push","infinite_scroll","isVisible","cols","resize","_getImageAttrs","attrs","attributes","img_attributes","value","_insertImage","e","currentTarget","siblings","inst","$current_image","showProgressBar","focus","selection","restore","rect","position","getBoundingRect","left","doc","scrollLeft","top","popups","setContainer","$sc","insert","_updateTags","_showImagesByTags","_deleteImage","message","confirm","code","_toggleTags","title_height","tags_height","toggleClass","hasClass","css","$tags","parents","_selectTag","preventDefault","$tag","$on","o_win","bindClick","helpers","isMobile","_mousedown","_mouseup","stopPropagation","disableBlur","_init","$wp","el","tagName","require","Error","imageInsertButtons","RegisterCommand","title","undo","modal","callback","plugin","DefineIcon","NAME","SVG_KEY"],"mappings":"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"}