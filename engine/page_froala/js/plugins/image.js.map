/*!
 * froala_editor v3.2.6 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2021 Froala Labs
 */

{"version":3,"file":"image.js","sources":["../../../src/js/plugins/image.js"],"sourcesContent":["import FE from '../index.js'\r\n'use strict';\r\n\r\nObject.assign(FE.POPUP_TEMPLATES, {\r\n  'image.insert': '[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]',\r\n  'image.edit': '[_BUTTONS_]',\r\n  'image.alt': '[_BUTTONS_][_ALT_LAYER_]',\r\n  'image.size': '[_BUTTONS_][_SIZE_LAYER_]'\r\n})\r\n\r\nObject.assign(FE.DEFAULTS, {\r\n  imageInsertButtons: ['imageBack', '|', 'imageUpload', 'imageByURL'],\r\n  imageEditButtons: ['imageReplace', 'imageAlign', 'imageCaption', 'imageRemove', 'imageLink', 'linkOpen', 'linkEdit', 'linkRemove', '-', 'imageDisplay', 'imageStyle', 'imageAlt', 'imageSize'],\r\n  imageAltButtons: ['imageBack', '|'],\r\n  imageSizeButtons: ['imageBack', '|'],\r\n  imageUpload: true,\r\n  imageUploadURL: null,\r\n  imageCORSProxy: 'https://cors-anywhere.froala.com',\r\n  imageUploadRemoteUrls: true,\r\n  imageUploadParam: 'file',\r\n  imageUploadParams: {},\r\n  imageUploadToS3: false,\r\n  imageUploadToAzure: false,\r\n  imageUploadMethod: 'POST',\r\n  imageMaxSize: 10 * 1024 * 1024,\r\n  imageAllowedTypes: ['jpeg', 'jpg', 'png', 'gif', 'webp'],\r\n  imageResize: true,\r\n  imageResizeWithPercent: false,\r\n  imageRoundPercent: false,\r\n  imageDefaultWidth: 300,\r\n  imageDefaultAlign: 'center',\r\n  imageDefaultDisplay: 'block',\r\n  imageSplitHTML: false,\r\n  imageStyles: {\r\n    'fr-rounded': 'Rounded',\r\n    'fr-bordered': 'Bordered',\r\n    'fr-shadow': 'Shadow'\r\n  },\r\n  imageMove: true,\r\n  imageMultipleStyles: true,\r\n  imageTextNear: true,\r\n  imagePaste: true,\r\n  imagePasteProcess: false,\r\n  imageMinWidth: 16,\r\n  imageOutputSize: false,\r\n  imageDefaultMargin: 5,\r\n  imageAddNewLine: false\r\n})\r\n\r\nFE.PLUGINS.image = function (editor) {\r\n  const { $ } = editor\r\n  const DEFAULT_IMAGE_UPLOAD_URL = 'https://i.froala.com/upload'\r\n\r\n  let $current_image\r\n  let $image_resizer\r\n  let $handler\r\n  let $overlay\r\n  let mousedown = false\r\n\r\n  const BAD_LINK = 1\r\n  const MISSING_LINK = 2\r\n  const ERROR_DURING_UPLOAD = 3\r\n  const BAD_RESPONSE = 4\r\n  const MAX_SIZE_EXCEEDED = 5\r\n  const BAD_FILE_TYPE = 6\r\n  const NO_CORS_IE = 7\r\n  const CORRUPTED_IMAGE = 8\r\n\r\n  const error_messages = {}\r\n  error_messages[BAD_LINK] = 'Image cannot be loaded from the passed link.',\r\n  error_messages[MISSING_LINK] = 'No link in upload response.',\r\n  error_messages[ERROR_DURING_UPLOAD] = 'Error during file upload.',\r\n  error_messages[BAD_RESPONSE] = 'Parsing response failed.',\r\n  error_messages[MAX_SIZE_EXCEEDED] = 'File is too large.',\r\n  error_messages[BAD_FILE_TYPE] = 'Image file type is invalid.',\r\n  error_messages[NO_CORS_IE] = 'Files can be uploaded only to same domain in IE 8 and IE 9.'\r\n  error_messages[CORRUPTED_IMAGE] = 'Image file is corrupted.'\r\n\r\n  /**\r\n   * Refresh the image insert popup.\r\n   */\r\n\r\n  function _refreshInsertPopup() {\r\n    const $popup = editor.popups.get('image.insert')\r\n\r\n    const $url_input = $popup.find('.fr-image-by-url-layer input')\r\n    $url_input.val('')\r\n\r\n    if ($current_image) {\r\n      $url_input.val($current_image.attr('src'))\r\n    }\r\n\r\n    $url_input.trigger('change')\r\n  }\r\n\r\n  /**\r\n   * Show the image upload popup.\r\n   */\r\n\r\n  function showInsertPopup() {\r\n    const $btn = editor.$tb.find('.fr-command[data-cmd=\"insertImage\"]')\r\n    let $popup = editor.popups.get('image.insert')\r\n    if (!$popup) $popup = _initInsertPopup()\r\n    hideProgressBar()\r\n    if (!$popup.hasClass('fr-active')) {\r\n      editor.popups.refresh('image.insert')\r\n      editor.popups.setContainer('image.insert', editor.$tb)\r\n\r\n      if ($btn.isVisible()) {\r\n        const { left, top } = editor.button.getPosition($btn)\r\n        editor.popups.show('image.insert', left, top, $btn.outerHeight())\r\n      }\r\n      else {\r\n        editor.position.forSelection($popup)\r\n        editor.popups.show('image.insert')\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show the image edit popup.\r\n   */\r\n\r\n  function _showEditPopup() {\r\n    let $popup = editor.popups.get('image.edit')\r\n\r\n    if (!$popup) $popup = _initEditPopup()\r\n\r\n    if ($popup) {\r\n      let $el = getEl()\r\n\r\n      if (hasCaption()) {\r\n        $el = $el.find('.fr-img-wrap')\r\n      }\r\n\r\n      editor.popups.setContainer('image.edit', editor.$sc)\r\n      editor.popups.refresh('image.edit')\r\n      let left = $el.offset().left + $el.outerWidth() / 2\r\n      const top = $el.offset().top + $el.outerHeight()\r\n\r\n      // Enhancement 2950\r\n      if ($current_image.hasClass('fr-uploading')) {\r\n        showProgressBar()\r\n      }\r\n      else {\r\n        editor.popups.show('image.edit', left, top, $el.outerHeight(), true)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Hide image upload popup.\r\n   */\r\n\r\n  function _hideInsertPopup() {\r\n    hideProgressBar()\r\n  }\r\n\r\n  /**\r\n   * Convert style to classes.\r\n   */\r\n  function _convertStyleToClasses($img) {\r\n    if ($img.parents('.fr-img-caption').length > 0) {\r\n      $img = $img.parents('.fr-img-caption').first()\r\n    }\r\n\r\n    if (!$img.hasClass('fr-dii') && !$img.hasClass('fr-dib')) {\r\n      $img.addClass(`fr-fi${getAlign($img)[0]}`)\r\n      $img.addClass(`fr-di${getDisplay($img)[0]}`)\r\n\r\n      // Reset inline style.\r\n      $img.css('margin', '')\r\n      $img.css('float', '')\r\n      $img.css('display', '')\r\n      $img.css('z-index', '')\r\n      $img.css('position', '')\r\n      $img.css('overflow', '')\r\n      $img.css('vertical-align', '')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Convert classes to style.\r\n   */\r\n  function _convertClassesToStyle($img) {\r\n    if ($img.parents('.fr-img-caption').length > 0) {\r\n      $img = $img.parents('.fr-img-caption').first()\r\n    }\r\n\r\n    const d = $img.hasClass('fr-dib') ? 'block' : $img.hasClass('fr-dii') ? 'inline' : null\r\n    const a = $img.hasClass('fr-fil') ? 'left' : $img.hasClass('fr-fir') ? 'right' : getAlign($img)\r\n\r\n    _setStyle($img, d, a)\r\n\r\n    $img.removeClass('fr-dib fr-dii fr-fir fr-fil')\r\n  }\r\n\r\n  /**\r\n   * Refresh the image list.\r\n   */\r\n  function _refreshImageList() {\r\n    const images = editor.el.tagName == 'IMG' ? [editor.el] : editor.el.querySelectorAll('img')\r\n\r\n    for (let i = 0; i < images.length; i++) {\r\n      const $img = $(images[i])\r\n\r\n      if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\r\n        if (editor.opts.imageDefaultAlign || editor.opts.imageDefaultDisplay) {\r\n          _convertStyleToClasses($img)\r\n        }\r\n\r\n        // Do not allow text near image.\r\n        if (!editor.opts.imageTextNear) {\r\n          if ($img.parents('.fr-img-caption').length > 0) {\r\n            $img.parents('.fr-img-caption').first().removeClass('fr-dii').addClass('fr-dib')\r\n          }\r\n          else {\r\n            $img.removeClass('fr-dii').addClass('fr-dib')\r\n          }\r\n        }\r\n      }\r\n      else if (!editor.opts.htmlUntouched && !editor.opts.useClasses) {\r\n        if (editor.opts.imageDefaultAlign || editor.opts.imageDefaultDisplay) {\r\n          _convertClassesToStyle($img)\r\n        }\r\n      }\r\n\r\n      if (editor.opts.iframe) {\r\n        $img.on('load', editor.size.syncIframe)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Keep images in sync when content changed.\r\n   */\r\n  let images\r\n\r\n  function _syncImages(loaded) {\r\n\r\n    if (typeof loaded === 'undefined') loaded = true\r\n\r\n    // Get current images.\r\n    const c_images = Array.prototype.slice.call(editor.el.querySelectorAll('img'))\r\n\r\n    // Current images src.\r\n    const image_srcs = []\r\n    let i\r\n\r\n    for (i = 0; i < c_images.length; i++) {\r\n      image_srcs.push(c_images[i].getAttribute('src'))\r\n\r\n      $(c_images[i]).toggleClass('fr-draggable', editor.opts.imageMove)\r\n\r\n      if (c_images[i].getAttribute('class') === '') c_images[i].removeAttribute('class')\r\n\r\n      if (c_images[i].getAttribute('style') === '') c_images[i].removeAttribute('style')\r\n\r\n      if (c_images[i].parentNode && c_images[i].parentNode.parentNode && editor.node.hasClass(c_images[i].parentNode.parentNode, 'fr-img-caption')) {\r\n        const p_node = c_images[i].parentNode.parentNode\r\n\r\n        if (!editor.browser.mozilla) {\r\n          p_node.setAttribute('contenteditable', false)\r\n        }\r\n\r\n        p_node.setAttribute('draggable', false)\r\n        p_node.classList.add('fr-draggable')\r\n\r\n        const n_node = c_images[i].nextSibling\r\n\r\n        if (n_node && !editor.browser.mozilla) {\r\n          n_node.setAttribute('contenteditable', true)\r\n        }\r\n      }\r\n    }\r\n\r\n    // Loop previous images and check their src.\r\n    if (images) {\r\n      for (i = 0; i < images.length; i++) {\r\n        if (image_srcs.indexOf(images[i].getAttribute('src')) < 0) {\r\n          editor.events.trigger('image.removed', [$(images[i])])\r\n        }\r\n      }\r\n    }\r\n\r\n    // Loop new images and see which were not int the old ones.\r\n    if (images && loaded) {\r\n      const old_images_srcs = []\r\n\r\n      for (i = 0; i < images.length; i++) {\r\n        old_images_srcs.push(images[i].getAttribute('src'))\r\n      }\r\n\r\n      for (i = 0; i < c_images.length; i++) {\r\n        if (old_images_srcs.indexOf(c_images[i].getAttribute('src')) < 0) {\r\n          editor.events.trigger('image.loaded', [$(c_images[i])])\r\n        }\r\n      }\r\n    }\r\n\r\n    // Current images are the old ones.\r\n    images = c_images\r\n  }\r\n\r\n  /**\r\n   * Reposition resizer.\r\n   */\r\n\r\n  function _repositionResizer() {\r\n    if (!$image_resizer) _initImageResizer()\r\n\r\n    if (!$current_image) return false\r\n\r\n    const $container = editor.$wp || editor.$sc\r\n\r\n    $container.append($image_resizer)\r\n    $image_resizer.data('instance', editor)\r\n\r\n    let wrap_correction_top = $container.scrollTop() - (($container.css('position') != 'static' ? $container.offset().top : 0))\r\n    let wrap_correction_left = $container.scrollLeft() - (($container.css('position') != 'static' ? $container.offset().left : 0))\r\n\r\n    wrap_correction_left -= editor.helpers.getPX($container.css('border-left-width'))\r\n    wrap_correction_top -= editor.helpers.getPX($container.css('border-top-width'))\r\n\r\n    if (editor.$el.is('img') && editor.$sc.is('body')) {\r\n      wrap_correction_top = 0\r\n      wrap_correction_left = 0\r\n    }\r\n\r\n    let $el = getEl()\r\n\r\n    if (hasCaption()) {\r\n      $el = $el.find('.fr-img-wrap')\r\n    }\r\n\r\n    let iframePaddingTop = 0\r\n    let iframePaddingLeft = 0\r\n    if (editor.opts.iframe) {\r\n      iframePaddingTop = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-top'))\r\n      iframePaddingLeft = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-left'))\r\n    }\r\n\r\n    $image_resizer\r\n      .css('top', (editor.opts.iframe ? $el.offset().top + iframePaddingTop : $el.offset().top + wrap_correction_top) - 1)\r\n      .css('left', (editor.opts.iframe ? $el.offset().left + iframePaddingLeft : $el.offset().left + wrap_correction_left) - 1)\r\n      .css('width', $el.get(0).getBoundingClientRect().width)\r\n      .css('height', $el.get(0).getBoundingClientRect().height)\r\n      .addClass('fr-active')\r\n  }\r\n\r\n  /**\r\n   * Create resize handler.\r\n   */\r\n\r\n  function _getHandler(pos) {\r\n\r\n    return `<div class=\"fr-handler fr-h${pos}\"></div>`\r\n  }\r\n\r\n  /**\r\n   * Set the image with\r\n   */\r\n  function _setWidth(width) {\r\n    if (hasCaption()) {\r\n      $current_image.parents('.fr-img-caption').css('width', width)\r\n    }\r\n    else {\r\n      $current_image.css('width', width)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mouse down to start resize.\r\n   */\r\n  function _handlerMousedown(e) {\r\n    // Check if resizer belongs to current instance.\r\n    if (!editor.core.sameInstance($image_resizer)) return true\r\n\r\n    e.preventDefault()\r\n    e.stopPropagation()\r\n\r\n    if (editor.$el.find('img.fr-error').left) return false\r\n\r\n    if (!editor.undo.canDo()) editor.undo.saveStep()\r\n\r\n    // Get offset.\r\n    let start_x = e.pageX || e.originalEvent.touches[0].pageX\r\n\r\n    // Only on mousedown. This function could be called from keydown on accessibility.\r\n    if (e.type == 'mousedown') {\r\n      // See if the entire editor is inside iframe to adjust starting offset.\r\n      const oel = editor.$oel.get(0)\r\n      const doc = oel.ownerDocument\r\n      const win = doc.defaultView || doc.parentWindow\r\n      let editor_inside_iframe = false\r\n\r\n      try {\r\n        editor_inside_iframe = (win.location != win.parent.location && !(win.$ && win.$.FE))\r\n      } catch (ex) { }\r\n\r\n      if (editor_inside_iframe && win.frameElement) {\r\n        start_x += editor.helpers.getPX($(win.frameElement).offset().left) + win.frameElement.clientLeft\r\n      }\r\n    }\r\n\r\n    $handler = $(this)\r\n    $handler.data('start-x', start_x)\r\n    $handler.data('start-width', $current_image.width())\r\n    $handler.data('start-height', $current_image.height())\r\n\r\n    // Set current width.\r\n    let width = $current_image.width()\r\n\r\n    // Update width value if resizing with percent.\r\n    if (editor.opts.imageResizeWithPercent) {\r\n      const p_node = $current_image.parentsUntil(editor.$el, editor.html.blockTagsQuery()).get(0) || editor.el\r\n      width = (width / $(p_node).outerWidth() * 100).toFixed(2) + '%'\r\n    }\r\n\r\n    // Set the image width.\r\n    _setWidth(width)\r\n\r\n    $overlay.show()\r\n\r\n    editor.popups.hideAll()\r\n\r\n    _unmarkExit()\r\n  }\r\n\r\n  /**\r\n   * Do resize.\r\n   */\r\n  function _handlerMousemove(e) {\r\n    // Check if resizer belongs to current instance.\r\n    if (!editor.core.sameInstance($image_resizer)) return true\r\n    let real_image_size\r\n\r\n    if ($handler && $current_image) {\r\n      e.preventDefault()\r\n\r\n      if (editor.$el.find('img.fr-error').left) return false\r\n\r\n      const c_x = e.pageX || (e.originalEvent.touches ? e.originalEvent.touches[0].pageX : null)\r\n\r\n      if (!c_x) return false\r\n\r\n      const s_x = $handler.data('start-x')\r\n      let diff_x = c_x - s_x\r\n      let width = $handler.data('start-width')\r\n\r\n      if ($handler.hasClass('fr-hnw') || $handler.hasClass('fr-hsw')) {\r\n        diff_x = 0 - diff_x\r\n      }\r\n\r\n      if (editor.opts.imageResizeWithPercent) {\r\n        const p_node = $current_image.parentsUntil(editor.$el, editor.html.blockTagsQuery()).get(0) || editor.el\r\n        width = ((width + diff_x) / $(p_node).outerWidth() * 100).toFixed(2)\r\n\r\n        if (editor.opts.imageRoundPercent) width = Math.round(width)\r\n\r\n        // Set the image width.\r\n        _setWidth(`${width}%`)\r\n\r\n        // Get the real image width after resize.\r\n        if (hasCaption()) {\r\n          real_image_size = (editor.helpers.getPX($current_image.parents('.fr-img-caption').css('width')) / $(p_node).outerWidth() * 100).toFixed(2)\r\n        }\r\n        else {\r\n          real_image_size = (editor.helpers.getPX($current_image.css('width')) / $(p_node).outerWidth() * 100).toFixed(2)\r\n        }\r\n\r\n        // If the width is not contained within editor use the real image size.\r\n        if (real_image_size !== width && !editor.opts.imageRoundPercent) {\r\n          _setWidth(`${real_image_size}%`)\r\n        }\r\n\r\n        $current_image.css('height', '').removeAttr('height')\r\n      }\r\n      else {\r\n        if (width + diff_x >= editor.opts.imageMinWidth) {\r\n          // Set width for image parent node as well.\r\n          _setWidth(width + diff_x)\r\n\r\n          // Get the real image width after resize.\r\n          if (hasCaption()) {\r\n            real_image_size = editor.helpers.getPX($current_image.parents('.fr-img-caption').css('width'))\r\n          }\r\n          else {\r\n            real_image_size = editor.helpers.getPX($current_image.css('width'))\r\n          }\r\n        }\r\n\r\n        // If the width is not contained within editor use the real image size.\r\n        if (real_image_size !== width + diff_x) {\r\n          _setWidth(real_image_size)\r\n        }\r\n\r\n        // https://github.com/froala/wysiwyg-editor/issues/1963.\r\n        if (($current_image.attr('style') || '').match(/(^height:)|(; *height:)/) || $current_image.attr('height')) {\r\n          $current_image.css('height', $handler.data('start-height') * $current_image.width() / $handler.data('start-width'))\r\n          $current_image.removeAttr('height')\r\n        }\r\n      }\r\n\r\n      _repositionResizer()\r\n\r\n      editor.events.trigger('image.resize', [get()])\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop resize.\r\n   */\r\n\r\n  function _handlerMouseup(e) {\r\n\r\n    // Check if resizer belongs to current instance.\r\n    if (!editor.core.sameInstance($image_resizer)) return true\r\n\r\n    if ($handler && $current_image) {\r\n      if (e) e.stopPropagation()\r\n\r\n      if (editor.$el.find('img.fr-error').left) return false\r\n\r\n      $handler = null\r\n      $overlay.hide()\r\n      _repositionResizer()\r\n      _showEditPopup()\r\n\r\n      editor.undo.saveStep()\r\n\r\n      editor.events.trigger('image.resizeEnd', [get()])\r\n    }\r\n    else{ //https://github.com/froala-labs/froala-editor-js-2/issues/1916\r\n      $image_resizer.removeClass('fr-active')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Throw an image error.\r\n   */\r\n\r\n  function _throwError(code, response, $img) {\r\n    editor.edit.on()\r\n\r\n    if ($current_image) $current_image.addClass('fr-error')\r\n    // https://github.com/froala/wysiwyg-editor/issues/3407\r\n    if (error_messages[code]) {\r\n      _showErrorMessage(editor.language.translate(error_messages[code]))\r\n    }\r\n    else {\r\n      _showErrorMessage(editor.language.translate('Something went wrong. Please try again.'))\r\n    }\r\n\r\n    // Remove image if it exists.\r\n    if (!$current_image && $img) remove($img)\r\n\r\n    editor.events.trigger('image.error', [{\r\n      code: code,\r\n      message: error_messages[code]\r\n    },\r\n    response,\r\n    $img\r\n    ])\r\n  }\r\n\r\n  /**\r\n   * Init the image edit popup.\r\n   */\r\n\r\n  function _initEditPopup(delayed) {\r\n    if (delayed) {\r\n      if (editor.$wp) {\r\n        editor.events.$on(editor.$wp, 'scroll.image-edit', function () {\r\n          if ($current_image && editor.popups.isVisible('image.edit')) {\r\n            editor.events.disableBlur()\r\n            _showEditPopup()\r\n          }\r\n        })\r\n      }\r\n\r\n      return true\r\n    }\r\n\r\n    // Image buttons.\r\n    let image_buttons = ''\r\n\r\n    if (editor.opts.imageEditButtons.length > 0) {\r\n\r\n      image_buttons += `<div class=\"fr-buttons\"> \r\n        ${editor.button.buildList(editor.opts.imageEditButtons)}\r\n        </div>`\r\n\r\n      const template = {\r\n        buttons: image_buttons\r\n      }\r\n\r\n      const $popup = editor.popups.create('image.edit', template)\r\n\r\n      return $popup\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * Show progress bar.\r\n   */\r\n\r\n  function showProgressBar(no_message) {\r\n    let $popup = editor.popups.get('image.insert')\r\n\r\n    if (!$popup) $popup = _initInsertPopup()\r\n\r\n    $popup.find('.fr-layer.fr-active').removeClass('fr-active').addClass('fr-pactive')\r\n    $popup.find('.fr-image-progress-bar-layer').addClass('fr-active')\r\n    $popup.find('.fr-buttons').hide()\r\n\r\n    if ($current_image) {\r\n      const $el = getEl()\r\n\r\n      editor.popups.setContainer('image.insert', editor.$sc)\r\n      const left = $el.offset().left\r\n      const top = $el.offset().top + $el.height()\r\n\r\n      editor.popups.show('image.insert', left, top, $el.outerHeight())\r\n    }\r\n\r\n    if (typeof no_message == 'undefined') {\r\n      _setProgressMessage(editor.language.translate('Uploading'), 0)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Hide progress bar.\r\n   */\r\n  function hideProgressBar(dismiss) {\r\n    const $popup = editor.popups.get('image.insert')\r\n\r\n    if ($popup) {\r\n      $popup.find('.fr-layer.fr-pactive').addClass('fr-active').removeClass('fr-pactive')\r\n      $popup.find('.fr-image-progress-bar-layer').removeClass('fr-active')\r\n      $popup.find('.fr-buttons').show()\r\n\r\n      // Dismiss error message.\r\n      if (dismiss || editor.$el.find('img.fr-error').length) {\r\n        editor.events.focus()\r\n\r\n        if (editor.$el.find('img.fr-error').length) {\r\n          editor.$el.find('img.fr-error').remove()\r\n          editor.undo.saveStep()\r\n          editor.undo.run()\r\n          editor.undo.dropRedo()\r\n        }\r\n\r\n        if (!editor.$wp && $current_image) {\r\n          const $img = $current_image\r\n          _exitEdit(true)\r\n          editor.selection.setAfter($img.get(0))\r\n          editor.selection.restore()\r\n        }\r\n        editor.popups.hide('image.insert')\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set a progress message.\r\n   */\r\n\r\n  function _setProgressMessage(message, progress) {\r\n    const $popup = editor.popups.get('image.insert')\r\n\r\n    if ($popup) {\r\n      const $layer = $popup.find('.fr-image-progress-bar-layer')\r\n      $layer.find('h3').text(message + (progress ? ` ${progress}%` : ''))\r\n\r\n      $layer.removeClass('fr-error')\r\n\r\n      if (progress) {\r\n        $layer.find('div').removeClass('fr-indeterminate')\r\n        $layer.find('div > span').css('width', `${progress}%`)\r\n      }\r\n      else {\r\n        $layer.find('div').addClass('fr-indeterminate')\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show error message to the user.\r\n   */\r\n\r\n  function _showErrorMessage(message) {\r\n    showProgressBar()\r\n    const $popup = editor.popups.get('image.insert')\r\n    const $layer = $popup.find('.fr-image-progress-bar-layer')\r\n    $layer.addClass('fr-error')\r\n    const $message_header = $layer.find('h3')\r\n    $message_header.text(message)\r\n    editor.events.disableBlur()\r\n    $message_header.focus()\r\n  }\r\n\r\n  /**\r\n   * Insert image using URL callback.\r\n   */\r\n\r\n  function insertByURL() {\r\n    const $popup = editor.popups.get('image.insert')\r\n    const $input = $popup.find('.fr-image-by-url-layer input')\r\n\r\n    if ($input.val().length > 0) {\r\n      showProgressBar()\r\n      _setProgressMessage(editor.language.translate('Loading image'))\r\n\r\n      const img_url = $input.val().trim()\r\n\r\n      // Upload images if we should upload them.\r\n      if (editor.opts.imageUploadRemoteUrls && editor.opts.imageCORSProxy && editor.opts.imageUpload) {\r\n        const xhr = new XMLHttpRequest()\r\n        xhr.onload = function () {\r\n\r\n          if (this.status == 200) {\r\n\r\n            upload([new Blob([this.response], {\r\n              type: this.response.type || 'image/png'\r\n            })], $current_image)\r\n          }\r\n          else {\r\n            _throwError(BAD_LINK)\r\n          }\r\n        }\r\n\r\n        // If image couldn't be uploaded, insert as it is.\r\n        xhr.onerror = function () {\r\n          insert(img_url, true, [], $current_image)\r\n        }\r\n\r\n        xhr.open('GET', `${editor.opts.imageCORSProxy}/${img_url}`, true)\r\n        xhr.responseType = 'blob'\r\n\r\n        xhr.send()\r\n      }\r\n      else {\r\n        insert(img_url, true, [], $current_image)\r\n      }\r\n\r\n      $input.val('')\r\n      $input.blur()\r\n    }\r\n  }\r\n\r\n  function _editImg($img) {\r\n    _edit.call($img.get(0))\r\n  }\r\n\r\n  function _loadedCallback() {\r\n    const $img = $(this)\r\n\r\n    editor.popups.hide('image.insert')\r\n\r\n    $img.removeClass('fr-uploading')\r\n\r\n    // Select the image.\r\n    if ($img.next().is('br')) {\r\n      $img.next().remove()\r\n    }\r\n\r\n    _editImg($img)\r\n\r\n    editor.events.trigger('image.loaded', [$img])\r\n  }\r\n\r\n  /**\r\n   * Insert image into the editor.\r\n   */\r\n\r\n  function insert(link, sanitize, data, $existing_img, response) {\r\n\r\n    if ($existing_img && typeof $existing_img === 'string') {\r\n      $existing_img = editor.$($existing_img)\r\n    }\r\n\r\n    editor.edit.off()\r\n    _setProgressMessage(editor.language.translate('Loading image'))\r\n\r\n    if (sanitize) link = editor.helpers.sanitizeURL(link)\r\n\r\n    const image = new Image()\r\n\r\n    image.onload = function () {\r\n      let $img\r\n      let attr\r\n\r\n      if ($existing_img) {\r\n        if (!editor.undo.canDo() && !$existing_img.hasClass('fr-uploading')) editor.undo.saveStep()\r\n\r\n        let old_src = $existing_img.data('fr-old-src')\r\n\r\n        if ($existing_img.data('fr-image-pasted')) {\r\n          old_src = null\r\n        }\r\n\r\n        if (editor.$wp) {\r\n\r\n          // Clone existing image.\r\n          $img = $existing_img.clone()\r\n            .removeData('fr-old-src')\r\n            .removeClass('fr-uploading')\r\n            .removeAttr('data-fr-image-pasted')\r\n\r\n          // Remove load event.\r\n          $img.off('load')\r\n\r\n          // Set new SRC.\r\n          if (old_src) $existing_img.attr('src', old_src)\r\n\r\n          // Replace existing image with its clone.\r\n          $existing_img.replaceWith($img)\r\n\r\n        }\r\n        else {\r\n          $img = $existing_img\r\n        }\r\n\r\n        // Remove old data.\r\n        const atts = $img.get(0).attributes\r\n\r\n        for (let i = 0; i < atts.length; i++) {\r\n          const att = atts[i]\r\n\r\n          if (att.nodeName.indexOf('data-') === 0) {\r\n            $img.removeAttr(att.nodeName)\r\n          }\r\n          // https://github.com/froala-labs/froala-editor-js-2/issues/2870\r\n          // Remove any other property, if it is existing with new image also.\r\n\r\n          else if(data && data.hasOwnProperty(att.nodeName)) {\r\n            $img.removeAttr(att.nodeName)\r\n          }\r\n        }\r\n\r\n        // Set new data.\r\n        if (typeof data != 'undefined') {\r\n          for (attr in data) {\r\n            if (data.hasOwnProperty(attr)) {\r\n              if (attr != 'link') {\r\n                // https://github.com/froala-labs/froala-editor-js-2/issues/2870\r\n                $img.attr(`${attr}`, data[attr])\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        $img.on('load', _loadedCallback)\r\n        $img.attr('src', link)\r\n        editor.edit.on()\r\n        _syncImages(false)\r\n        editor.undo.saveStep()\r\n\r\n        // Cursor will not appear if we don't make blur.\r\n        editor.events.disableBlur()\r\n        editor.$el.blur()\r\n        editor.events.trigger(old_src ? 'image.replaced' : 'image.inserted', [$img, response])\r\n      }\r\n      else {\r\n        $img = _addImage(link, data, _loadedCallback)\r\n        _syncImages(false)\r\n        editor.undo.saveStep()\r\n\r\n        // Cursor will not appear if we don't make blur.\r\n        editor.events.disableBlur()\r\n        editor.$el.blur()\r\n        editor.events.trigger('image.inserted', [$img, response])\r\n      }\r\n    }\r\n\r\n    image.onerror = function () {\r\n      _throwError(BAD_LINK)\r\n    }\r\n\r\n    showProgressBar(editor.language.translate('Loading image'))\r\n\r\n    image.src = link\r\n  }\r\n\r\n  /**\r\n   * Parse image response.\r\n   */\r\n\r\n  function _parseResponse(response) {\r\n    try {\r\n      if (editor.events.trigger('image.uploaded', [response], true) === false) {\r\n        editor.edit.on()\r\n\r\n        return false\r\n      }\r\n      const resp = JSON.parse(response)\r\n\r\n      if (resp.link) {\r\n\r\n        return resp\r\n      }\r\n      else {\r\n\r\n        // No link in upload request.\r\n        _throwError(MISSING_LINK, response)\r\n\r\n        return false\r\n      }\r\n    } catch (ex) {\r\n\r\n      // Bad response.\r\n      _throwError(BAD_RESPONSE, response)\r\n\r\n      return false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Parse image response.\r\n   */\r\n\r\n  function _parseXMLResponse(response) {\r\n    try {\r\n      const link = $(response).find('Location').text()\r\n      const key = $(response).find('Key').text()\r\n\r\n      if (editor.events.trigger('image.uploadedToS3', [link, key, response], true) === false) {\r\n        editor.edit.on()\r\n\r\n        return false\r\n      }\r\n\r\n      return link\r\n    } catch (ex) {\r\n\r\n      // Bad response.\r\n      _throwError(BAD_RESPONSE, response)\r\n\r\n      return false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Image was uploaded to the server and we have a response.\r\n   */\r\n\r\n  function _imageUploaded($img, url, key) {\r\n    _setProgressMessage(editor.language.translate('Loading image'))\r\n    const { status } = this\r\n    const { response } = this\r\n    const { responseXML } = this\r\n    const { responseText } = this\r\n\r\n    try {\r\n      if (editor.opts.imageUploadToS3 || editor.opts.imageUploadToAzure) {\r\n        if (status == 201) {\r\n          let link\r\n          if(editor.opts.imageUploadToAzure) {\r\n            if (editor.events.trigger('image.uploadedToAzure', [this.responseURL, key, response], true) === false) {\r\n              editor.edit.on()\r\n              return false\r\n            }\r\n            link = url\r\n          } else {\r\n            link = _parseXMLResponse(responseXML)\r\n          }\r\n\r\n          if (link) {\r\n            insert(link, false, [], $img, response || responseXML)\r\n          }\r\n        }\r\n        else {\r\n          _throwError(BAD_RESPONSE, response || responseXML, $img)\r\n        }\r\n      }\r\n      else {\r\n        if (status >= 200 && status < 300) {\r\n          const resp = _parseResponse(responseText)\r\n\r\n          if (resp) {\r\n            insert(resp.link, false, resp, $img, response || responseText)\r\n          }\r\n        }\r\n        else {\r\n          _throwError(ERROR_DURING_UPLOAD, response || responseText, $img)\r\n        }\r\n      }\r\n    } catch (ex) {\r\n\r\n      // Bad response.\r\n      _throwError(BAD_RESPONSE, response || responseText, $img)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Image upload error.\r\n   */\r\n\r\n  function _imageUploadError() {\r\n    _throwError(BAD_RESPONSE, this.response || this.responseText || this.responseXML)\r\n  }\r\n\r\n  /**\r\n   * Image upload progress.\r\n   */\r\n\r\n  function _imageUploadProgress(e) {\r\n    if (e.lengthComputable) {\r\n      const complete = (e.loaded / e.total * 100 | 0)\r\n      _setProgressMessage(editor.language.translate('Uploading'), complete)\r\n    }\r\n  }\r\n\r\n  function _addImage(link, data, loadCallback) {\r\n\r\n    // Build image data string.\r\n    let data_str = ''\r\n    let attr\r\n    const $img = $(document.createElement('img')).attr('src', link)\r\n\r\n    if (data && typeof data != 'undefined') {\r\n      for (attr in data) {\r\n        if (data.hasOwnProperty(attr)) {\r\n          if (attr != 'link') {\r\n            data_str += ` data-${attr}=\"${data[attr]}\"`\r\n            // https://github.com/froala-labs/froala-editor-js-2/issues/2649\r\n            $img.attr(`${attr}`, data[attr])\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let width = editor.opts.imageDefaultWidth\r\n\r\n    if (width && width != 'auto') {\r\n      width = (editor.opts.imageResizeWithPercent ? '100%' : `${width}px`)\r\n    }\r\n\r\n    // Create image object and set the load event.\r\n    $img.attr('style', (width ? `width: ${width};` : ''))\r\n    _setStyle($img, editor.opts.imageDefaultDisplay, editor.opts.imageDefaultAlign)\r\n\r\n    $img.on('load', loadCallback)\r\n\r\n    // Image might be corrupted. Continue upload flow.\r\n    $img.on('error', loadCallback)\r\n\r\n    // Make sure we have focus.\r\n    // Call the event.\r\n    editor.edit.on()\r\n    editor.events.focus(true)\r\n    editor.selection.restore()\r\n    editor.undo.saveStep()\r\n\r\n    // Insert marker and then replace it with the image.\r\n    if (editor.opts.imageSplitHTML) {\r\n      editor.markers.split()\r\n    }\r\n    else {\r\n      editor.markers.insert()\r\n    }\r\n\r\n    editor.html.wrap()\r\n    const $marker = editor.$el.find('.fr-marker')\r\n\r\n    if ($marker.length) {\r\n\r\n      // Do not insert image in HR.\r\n      if ($marker.parent().is('hr')) {\r\n        $marker.parent().after($marker)\r\n      }\r\n\r\n      // Do not insert image inside emoticon.\r\n      if (editor.node.isLastSibling($marker) && $marker.parent().hasClass('fr-deletable')) {\r\n\r\n        $marker.insertAfter($marker.parent())\r\n      }\r\n\r\n      $marker.replaceWith($img)\r\n    }\r\n    else {\r\n      editor.$el.append($img)\r\n    }\r\n\r\n    editor.selection.clear()\r\n\r\n    return $img\r\n  }\r\n\r\n  /**\r\n   * Image upload aborted.\r\n   */\r\n  function _imageUploadAborted() {\r\n    editor.edit.on()\r\n    hideProgressBar(true)\r\n  }\r\n\r\n  /**\r\n   * Start the uploading process.\r\n   */\r\n  function _startUpload(xhr, form_data, image, $image_placeholder, url, key) {\r\n    function _sendRequest() {\r\n      const $img = $(this)\r\n      $img.off('load')\r\n      $img.addClass('fr-uploading')\r\n\r\n      if ($img.next().is('br')) {\r\n        $img.next().remove()\r\n      }\r\n\r\n      editor.placeholder.refresh()\r\n\r\n      // Select the image.\r\n      _editImg($img)\r\n      _repositionResizer()\r\n      showProgressBar()\r\n      editor.edit.off()\r\n\r\n      // Set upload events.\r\n      xhr.onload = function () {\r\n        _imageUploaded.call(xhr, $img, url, key)\r\n      }\r\n      xhr.onerror = _imageUploadError\r\n      xhr.upload.onprogress = _imageUploadProgress\r\n      xhr.onabort = _imageUploadAborted\r\n\r\n      // Set abort event.\r\n      $($img.off('abortUpload')).on('abortUpload', function () {\r\n        if (xhr.readyState != 4) {\r\n          xhr.abort()\r\n\r\n          if (!$image_placeholder) {\r\n            $img.remove()\r\n          }\r\n          else {\r\n            $image_placeholder.attr('src', $image_placeholder.data('fr-old-src'))\r\n            $image_placeholder.removeClass('fr-uploading')\r\n          }\r\n          _exitEdit(true)\r\n        }\r\n      })\r\n\r\n      // Send data.\r\n      xhr.send(editor.opts.imageUploadToAzure ? image : form_data)\r\n    }\r\n\r\n    const reader = new FileReader()\r\n\r\n    reader.onload = function () {\r\n      let link = reader.result\r\n\r\n      if (reader.result.indexOf('svg+xml') < 0) {\r\n\r\n        // Convert image to local blob.\r\n        const binary = atob(reader.result.split(',')[1])\r\n        const array = []\r\n\r\n        for (let i = 0; i < binary.length; i++) {\r\n          array.push(binary.charCodeAt(i))\r\n        }\r\n\r\n        // Get local image link.\r\n        link = window.URL.createObjectURL(new Blob([new Uint8Array(array)], {\r\n          type: 'image/jpeg'\r\n        }))\r\n      }\r\n\r\n      // No image.\r\n      if (!$image_placeholder) {\r\n        _addImage(link, null, _sendRequest)\r\n      }\r\n      else {\r\n        $image_placeholder.on('load', _sendRequest)\r\n\r\n        // Image might be corrupted.\r\n        $image_placeholder.on('error', function () {\r\n          _sendRequest()\r\n          $(this).off('error')\r\n        })\r\n\r\n        editor.edit.on()\r\n        editor.undo.saveStep()\r\n        $image_placeholder.data('fr-old-src', $image_placeholder.attr('src'))\r\n        $image_placeholder.attr('src', link)\r\n      }\r\n    }\r\n\r\n    reader.readAsDataURL(image)\r\n  }\r\n\r\n  function _browserUpload(image, $image_placeholder) {\r\n    const reader = new FileReader()\r\n\r\n    reader.onload = function () {\r\n      let link = reader.result\r\n\r\n      if (reader.result.indexOf('svg+xml') < 0) {\r\n\r\n        // Convert image to local blob.\r\n        const binary = atob(reader.result.split(',')[1])\r\n        const array = []\r\n\r\n        for (let i = 0; i < binary.length; i++) {\r\n          array.push(binary.charCodeAt(i))\r\n        }\r\n\r\n        // Get local image link.\r\n        link = window.URL.createObjectURL(new Blob([new Uint8Array(array)], {\r\n          type: image.type\r\n        }))\r\n\r\n        // If the $image_placeholder exists, set the data property 'fr-old-src' to identify/trigger the replace\r\n        if ($image_placeholder) {\r\n          $image_placeholder.data('fr-old-src', $image_placeholder.attr('src'))\r\n        }\r\n\r\n        editor.image.insert(link, false, null, $image_placeholder)\r\n      }\r\n    }\r\n\r\n    showProgressBar()\r\n\r\n    reader.readAsDataURL(image)\r\n  }\r\n\r\n  /**\r\n   * Do image upload.\r\n   */\r\n\r\n  function upload(images, $image_placeholder) {\r\n\r\n    // Make sure we have what to upload.\r\n    if (typeof images != 'undefined' && images.length > 0) {\r\n\r\n      // Check if we should cancel the image upload.\r\n      if (editor.events.trigger('image.beforeUpload', [images, $image_placeholder]) === false) {\r\n\r\n        return false\r\n      }\r\n      const image = images[0]\r\n\r\n      // Upload as blob for testing purposes.\r\n      if ((editor.opts.imageUploadURL === null || editor.opts.imageUploadURL == DEFAULT_IMAGE_UPLOAD_URL) && !editor.opts.imageUploadToS3 && !editor.opts.imageUploadToAzure) {\r\n        _browserUpload(image, $image_placeholder || $current_image)\r\n\r\n        return false\r\n      }\r\n\r\n      // Check if there is image name set.\r\n      if (!image.name) {\r\n        image.name = (new Date()).getTime() + '.' + (image.type || 'image/jpeg').replace(/image\\//g, '')\r\n      }\r\n\r\n      // Check image max size.\r\n      if (image.size > editor.opts.imageMaxSize) {\r\n        _throwError(MAX_SIZE_EXCEEDED)\r\n\r\n        return false\r\n      }\r\n\r\n      // Check image types.\r\n      if (editor.opts.imageAllowedTypes.indexOf(image.type.replace(/image\\//g, '')) < 0) {\r\n        _throwError(BAD_FILE_TYPE)\r\n\r\n        return false\r\n      }\r\n\r\n      // Create form Data.\r\n      let form_data\r\n\r\n      if (editor.drag_support.formdata) {\r\n        form_data = editor.drag_support.formdata ? new FormData() : null\r\n      }\r\n\r\n      // Prepare form data for request.\r\n      if (form_data) {\r\n        let key\r\n\r\n        // Upload to S3.\r\n        if (editor.opts.imageUploadToS3 !== false) {\r\n          form_data.append('key', editor.opts.imageUploadToS3.keyStart + (new Date()).getTime() + '-' + (image.name || 'untitled'))\r\n          form_data.append('success_action_status', '201')\r\n          form_data.append('X-Requested-With', 'xhr')\r\n          form_data.append('Content-Type', image.type)\r\n\r\n          for (key in editor.opts.imageUploadToS3.params) {\r\n            if (editor.opts.imageUploadToS3.params.hasOwnProperty(key)) {\r\n              form_data.append(key, editor.opts.imageUploadToS3.params[key])\r\n            }\r\n          }\r\n        }\r\n\r\n        // Add upload params.\r\n        for (key in editor.opts.imageUploadParams) {\r\n          if (editor.opts.imageUploadParams.hasOwnProperty(key)) {\r\n            form_data.append(key, editor.opts.imageUploadParams[key])\r\n          }\r\n        }\r\n\r\n        // Set the image in the request.\r\n        form_data.append(editor.opts.imageUploadParam, image, image.name)\r\n\r\n        // Create XHR request.\r\n        let url = editor.opts.imageUploadURL\r\n        let imageURL\r\n        let azureKey\r\n        let imageUploadMethod = editor.opts.imageUploadMethod\r\n        if (editor.opts.imageUploadToS3) {\r\n          if (editor.opts.imageUploadToS3.uploadURL) {\r\n            url = editor.opts.imageUploadToS3.uploadURL\r\n          }\r\n          else {\r\n            url = `https://${editor.opts.imageUploadToS3.region}.amazonaws.com/${editor.opts.imageUploadToS3.bucket}`\r\n          }\r\n        }\r\n        if (editor.opts.imageUploadToAzure) {\r\n          if (editor.opts.imageUploadToAzure.uploadURL) {\r\n            url = `${editor.opts.imageUploadToAzure.uploadURL}/${image.name}`\r\n          } else {\r\n            url = encodeURI(`https://${editor.opts.imageUploadToAzure.account}.blob.core.windows.net/${editor.opts.imageUploadToAzure.container}/${image.name}`)\r\n          }\r\n          imageURL = url\r\n          if (editor.opts.imageUploadToAzure.SASToken) {\r\n            url +=  editor.opts.imageUploadToAzure.SASToken\r\n          }\r\n          imageUploadMethod = 'PUT'\r\n        }\r\n        const xhr = editor.core.getXHR(url, imageUploadMethod)\r\n        if (editor.opts.imageUploadToAzure) {\r\n          let uploadDate = new Date().toUTCString()\r\n          if (!editor.opts.imageUploadToAzure.SASToken && editor.opts.imageUploadToAzure.accessKey) {\r\n            let azureAccount = editor.opts.imageUploadToAzure.account\r\n            let azureContainer = editor.opts.imageUploadToAzure.container\r\n            if(editor.opts.imageUploadToAzure.uploadURL) {\r\n              let urls = editor.opts.imageUploadToAzure.uploadURL.split('/')\r\n              azureContainer = urls.pop()\r\n              azureAccount = urls.pop().split('.')[0]\r\n            }\r\n            let headerResource = `x-ms-blob-type:BlockBlob\\nx-ms-date:${uploadDate}\\nx-ms-version:2019-07-07`\r\n            let urlResource = encodeURI('/' + azureAccount + '/' + azureContainer + '/' + image.name)\r\n            let stringToSign = imageUploadMethod + '\\n\\n\\n' + image.size + '\\n\\n' + image.type + '\\n\\n\\n\\n\\n\\n\\n' + headerResource + '\\n' + urlResource\r\n            let signatureBytes = editor.cryptoJSPlugin.cryptoJS.HmacSHA256(stringToSign, editor.cryptoJSPlugin.cryptoJS.enc.Base64.parse(editor.opts.imageUploadToAzure.accessKey))\r\n            let signature = signatureBytes.toString(editor.cryptoJSPlugin.cryptoJS.enc.Base64)\r\n            let authHeader = 'SharedKey ' + azureAccount + ':' + signature\r\n            azureKey = signature\r\n            xhr.setRequestHeader(\"Authorization\", authHeader)\r\n          }\r\n          xhr.setRequestHeader(\"x-ms-version\", \"2019-07-07\")\r\n          xhr.setRequestHeader(\"x-ms-date\", uploadDate)\r\n          xhr.setRequestHeader(\"Content-Type\", image.type)\r\n          xhr.setRequestHeader(\"x-ms-blob-type\", \"BlockBlob\")\r\n          for (key in editor.opts.imageUploadParams) {\r\n            if (editor.opts.imageUploadParams.hasOwnProperty(key)) {\r\n              xhr.setRequestHeader(key, editor.opts.imageUploadParams[key])\r\n            }\r\n          }\r\n          for (key in editor.opts.imageUploadToAzure.params) {\r\n            if (editor.opts.imageUploadToAzure.params.hasOwnProperty(key)) {\r\n              xhr.setRequestHeader(key, editor.opts.imageUploadToAzure.params[key])\r\n            }\r\n          }\r\n        }\r\n        _startUpload(xhr, form_data, image, $image_placeholder || $current_image, imageURL, azureKey)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Image drop inside the upload zone.\r\n   */\r\n\r\n  function _bindInsertEvents($popup) {\r\n\r\n    // Drag over the dropable area.\r\n    editor.events.$on($popup, 'dragover dragenter', '.fr-image-upload-layer', function (e) {\r\n    $(this).addClass('fr-drop')\r\n\r\n    if (editor.browser.msie || editor.browser.edge) {\r\n      e.preventDefault()\r\n    }\r\n\r\n      return false\r\n    }, true)\r\n\r\n    // Drag end.\r\n    editor.events.$on($popup, 'dragleave dragend', '.fr-image-upload-layer', function (e) {\r\n      $(this).removeClass('fr-drop')\r\n\r\n      if (editor.browser.msie || editor.browser.edge) {\r\n        e.preventDefault()\r\n      }\r\n\r\n      return false\r\n    }, true)\r\n\r\n    // Drop.\r\n    editor.events.$on($popup, 'drop', '.fr-image-upload-layer', function (e) {\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n      $(this).removeClass('fr-drop')\r\n      const dt = e.originalEvent.dataTransfer\r\n\r\n      if (dt && dt.files) {\r\n        const inst = $popup.data('instance') || editor\r\n        inst.events.disableBlur()\r\n        inst.image.upload(dt.files)\r\n        inst.events.enableBlur()\r\n      }\r\n    }, true)\r\n\r\n    if (editor.helpers.isIOS()) {\r\n      editor.events.$on($popup, 'touchstart', '.fr-image-upload-layer input[type=\"file\"]', function () {\r\n        $(this).trigger('click')\r\n      }, true)\r\n    }\r\n\r\n    editor.events.$on($popup, 'change', '.fr-image-upload-layer input[type=\"file\"]', function () {\r\n      if (this.files) {\r\n        const inst = $popup.data('instance') || editor\r\n\r\n        inst.events.disableBlur()\r\n        $popup.find('input:focus').blur()\r\n        inst.events.enableBlur()\r\n\r\n        inst.image.upload(this.files, $current_image)\r\n      }\r\n\r\n      // Else IE 9 case.\r\n      // Chrome fix.\r\n      $(this).val('')\r\n    }, true)\r\n  }\r\n\r\n  function _beforeElementDrop($el) {\r\n    if ($el.is('img') && $el.parents('.fr-img-caption').length > 0) {\r\n      return $el.parents('.fr-img-caption')\r\n    }\r\n  }\r\n\r\n  function _drop(e) {\r\n\r\n    // Check if we are dropping files.\r\n    const dt = e.originalEvent.dataTransfer\r\n\r\n    if (dt && dt.files && dt.files.length) {\r\n      const img = dt.files[0]\r\n\r\n      if (img && img.type && img.type.indexOf('image') !== -1 && editor.opts.imageAllowedTypes.indexOf(img.type.replace(/image\\//g, '')) >= 0) {\r\n        if (!editor.opts.imageUpload) {\r\n          e.preventDefault()\r\n          e.stopPropagation()\r\n\r\n          return false\r\n        }\r\n\r\n        editor.markers.remove()\r\n        editor.markers.insertAtPoint(e.originalEvent)\r\n\r\n        editor.$el.find('.fr-marker').replaceWith(FE.MARKERS)\r\n\r\n        if (editor.$el.find('.fr-marker').length === 0) {\r\n          editor.selection.setAtEnd(editor.el)\r\n        }\r\n\r\n        // Hide popups.\r\n        editor.popups.hideAll()\r\n\r\n        // Show the image insert popup.\r\n        let $popup = editor.popups.get('image.insert')\r\n\r\n        if (!$popup) $popup = _initInsertPopup()\r\n        editor.popups.setContainer('image.insert', editor.$sc)\r\n\r\n        let left = e.originalEvent.pageX\r\n        let top = e.originalEvent.pageY\r\n\r\n        if (editor.opts.iframe) {\r\n          const iframePaddingTop = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-top'))\r\n          const iframePaddingLeft = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-left'))\r\n          top += editor.$iframe.offset().top + iframePaddingTop\r\n          left += editor.$iframe.offset().left + iframePaddingLeft\r\n        }\r\n\r\n        editor.popups.show('image.insert', left, top)\r\n        showProgressBar()\r\n\r\n        // Dropped file is an image that we allow.\r\n        if (editor.opts.imageAllowedTypes.indexOf(img.type.replace(/image\\//g, '')) >= 0) {\r\n\r\n          // Image might be selected.\r\n          _exitEdit(true)\r\n\r\n          // Upload images.\r\n          upload(dt.files)\r\n        }\r\n        else {\r\n          _throwError(BAD_FILE_TYPE)\r\n        }\r\n\r\n        // Cancel anything else.\r\n        e.preventDefault()\r\n        e.stopPropagation()\r\n\r\n        return false\r\n      }\r\n    }\r\n  }\r\n\r\n  function _initEvents() {\r\n\r\n    // Mouse down on image. It might start move.\r\n    editor.events.$on(editor.$el, editor._mousedown, editor.el.tagName == 'IMG' ? null : 'img:not([contenteditable=\"false\"])', function (e) {\r\n      if ($(this).parents('contenteditable').not('.fr-element').not('.fr-img-caption').not('body').first().attr('contenteditable') == 'false') return true\r\n\r\n      if (!editor.helpers.isMobile()) editor.selection.clear()\r\n\r\n      mousedown = true\r\n\r\n      if (editor.popups.areVisible()) editor.events.disableBlur()\r\n\r\n      // Prevent the image resizing.\r\n      if (editor.browser.msie) {\r\n        editor.events.disableBlur()\r\n        editor.$el.attr('contenteditable', false)\r\n      }\r\n\r\n      if (!editor.draggable && e.type != 'touchstart') e.preventDefault()\r\n\r\n      e.stopPropagation()\r\n    })\r\n    editor.events.$on(editor.$el, editor._mousedown, '.fr-img-caption .fr-inner', function (e) {\r\n\r\n      if (!editor.core.hasFocus()) {\r\n        editor.events.focus()\r\n      }\r\n\r\n      e.stopPropagation()\r\n    })\r\n    editor.events.$on(editor.$el, 'paste', '.fr-img-caption .fr-inner', function (e) {\r\n\r\n      editor.toolbar.hide()\r\n   \r\n      e.stopPropagation()\r\n    })\r\n\r\n    // Mouse up on an image prevent move.\r\n    editor.events.$on(editor.$el, editor._mouseup, editor.el.tagName == 'IMG' ? null : 'img:not([contenteditable=\"false\"])', function (e) {\r\n      if ($(this).parents('contenteditable').not('.fr-element').not('.fr-img-caption').not('body').first().attr('contenteditable') == 'false') return true\r\n\r\n      if (mousedown) {\r\n        mousedown = false\r\n\r\n        // Remove moving class.\r\n        e.stopPropagation()\r\n\r\n        if (editor.browser.msie) {\r\n          editor.$el.attr('contenteditable', true)\r\n          editor.events.enableBlur()\r\n        }\r\n      }\r\n    })\r\n\r\n    // Show image popup when it was selected.\r\n    editor.events.on('keyup', function (e) {\r\n      if (e.shiftKey && editor.selection.text().replace(/\\n/g, '') === '' && editor.keys.isArrow(e.which)) {\r\n        const s_el = editor.selection.element()\r\n        const e_el = editor.selection.endElement()\r\n\r\n        if (s_el && s_el.tagName == 'IMG') {\r\n          _editImg($(s_el))\r\n        }\r\n        else if (e_el && e_el.tagName == 'IMG') {\r\n          _editImg($(e_el))\r\n        }\r\n      }\r\n    }, true)\r\n\r\n    // Drop inside the editor.\r\n    editor.events.on('drop', _drop)\r\n    editor.events.on('element.beforeDrop', _beforeElementDrop)\r\n\r\n    //https://github.com/froala-labs/froala-editor-js-2/issues/1916\r\n    editor.events.on('mousedown window.mousedown', _markExit)\r\n    editor.events.on('window.touchmove', _unmarkExit)\r\n\r\n    editor.events.on('mouseup window.mouseup', function () {\r\n      if ($current_image) {\r\n        _exitEdit()\r\n\r\n        return false\r\n      }\r\n\r\n      _unmarkExit()\r\n    })\r\n    editor.events.on('commands.mousedown', function ($btn) {\r\n      if ($btn.parents('.fr-toolbar').length > 0) {\r\n        _exitEdit()\r\n      }\r\n    })\r\n    editor.events.on('image.resizeEnd', function () {\r\n      if (editor.opts.iframe) {\r\n        editor.size.syncIframe()\r\n      }\r\n    })\r\n\r\n    editor.events.on('blur image.hideResizer commands.undo commands.redo element.dropped', function () {\r\n      mousedown = false\r\n      _exitEdit(true)\r\n    })\r\n\r\n    editor.events.on('modals.hide', function () {\r\n      if ($current_image) {\r\n        _selectImage()\r\n        editor.selection.clear()\r\n      }\r\n    })\r\n\r\n    editor.events.on('image.resizeEnd', function () {\r\n      if (editor.win.getSelection) {\r\n        _editImg($current_image)\r\n      }\r\n    })\r\n\r\n    // Add new line after image is inserted.\r\n    if (editor.opts.imageAddNewLine) {\r\n      editor.events.on('image.inserted', function ($img) {\r\n        let lastNode = $img.get(0)\r\n\r\n        // Ignore first BR after image.\r\n        if (lastNode.nextSibling && lastNode.nextSibling.tagName === 'BR') lastNode = lastNode.nextSibling;\r\n\r\n        // Look upper nodes.\r\n        while (lastNode && !editor.node.isElement(lastNode)) {\r\n          if (!editor.node.isLastSibling(lastNode)) {\r\n            lastNode = null;\r\n          }\r\n          else {\r\n            lastNode = lastNode.parentNode;\r\n          }\r\n        }\r\n\r\n        // If node is element, then image is last element.\r\n        if (editor.node.isElement(lastNode)) {\r\n\r\n          // ENTER_BR mode.\r\n          if (editor.opts.enter === FE.ENTER_BR) {\r\n            $img.after('<br>');\r\n          }\r\n          else {\r\n            let $parent = $(editor.node.blockParent($img.get(0)));\r\n\r\n            $parent.after(`<${editor.html.defaultTag()}><br></${editor.html.defaultTag()}>`);\r\n          }\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Init the image upload popup.\r\n   */\r\n\r\n  function _initInsertPopup(delayed) {\r\n    if (delayed) {\r\n      editor.popups.onRefresh('image.insert', _refreshInsertPopup)\r\n      editor.popups.onHide('image.insert', _hideInsertPopup)\r\n\r\n      return true\r\n    }\r\n\r\n    let active\r\n    let $popup\r\n\r\n    // Image buttons.\r\n    let image_buttons = ''\r\n\r\n    // https://github.com/froala/wysiwyg-editor/issues/2987\r\n\r\n    if (!editor.opts.imageUpload && editor.opts.imageInsertButtons.indexOf('imageUpload') !== -1) {\r\n      editor.opts.imageInsertButtons.splice(editor.opts.imageInsertButtons.indexOf('imageUpload'), 1)\r\n    }\r\n\r\n    const buttonList = editor.button.buildList(editor.opts.imageInsertButtons)\r\n\r\n    if (buttonList !== '') {\r\n      image_buttons = `<div class=\"fr-buttons fr-tabs\">${buttonList}</div>`\r\n    }\r\n\r\n    const uploadIndex = editor.opts.imageInsertButtons.indexOf('imageUpload')\r\n    const urlIndex = editor.opts.imageInsertButtons.indexOf('imageByURL')\r\n\r\n    // Image upload layer.\r\n    let upload_layer = ''\r\n\r\n    if (uploadIndex >= 0) {\r\n      active = ' fr-active'\r\n\r\n      if (urlIndex >= 0 && uploadIndex > urlIndex) {\r\n        active = ''\r\n      }\r\n\r\n      upload_layer = `<div class=\"fr-image-upload-layer${active} fr-layer\" id=\"fr-image-upload-layer-${editor.id}\"><strong>${editor.language.translate('Drop image')}</strong><br>(${editor.language.translate('or click')})<div class=\"fr-form\"><input type=\"file\" accept=\"image/${editor.opts.imageAllowedTypes.join(', image/').toLowerCase()}\" tabIndex=\"-1\" aria-labelledby=\"fr-image-upload-layer-${editor.id}\" role=\"button\"></div></div>`\r\n    }\r\n\r\n    // Image by url layer.\r\n    let by_url_layer = ''\r\n\r\n    if (urlIndex >= 0) {\r\n      active = ' fr-active'\r\n\r\n      if (uploadIndex >= 0 && urlIndex > uploadIndex) {\r\n        active = ''\r\n      }\r\n\r\n      by_url_layer = `<div class=\"fr-image-by-url-layer${active} fr-layer\" id=\"fr-image-by-url-layer-${editor.id}\"><div class=\"fr-input-line\"><input id=\"fr-image-by-url-layer-text-${editor.id}\" type=\"text\" placeholder=\"http://\" tabIndex=\"1\" aria-required=\"true\"></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"imageInsertByURL\" tabIndex=\"2\" role=\"button\">${editor.language.translate('Insert')}</button></div></div>`\r\n    }\r\n\r\n    // Progress bar.\r\n    const progress_bar_layer = '<div class=\"fr-image-progress-bar-layer fr-layer\"><h3 tabIndex=\"-1\" class=\"fr-message\">Uploading</h3><div class=\"fr-loader\"><span class=\"fr-progress\"></span></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-dismiss\" data-cmd=\"imageDismissError\" tabIndex=\"2\" role=\"button\">OK</button></div></div>'\r\n\r\n    const template = {\r\n      buttons: image_buttons,\r\n      upload_layer: upload_layer,\r\n      by_url_layer: by_url_layer,\r\n      progress_bar: progress_bar_layer\r\n    }\r\n\r\n    // Set the template in the popup.\r\n    if (editor.opts.imageInsertButtons.length >= 1) {\r\n      $popup = editor.popups.create('image.insert', template)\r\n    }\r\n\r\n    if (editor.$wp) {\r\n      editor.events.$on(editor.$wp, 'scroll', function () {\r\n        if ($current_image && editor.popups.isVisible('image.insert')) {\r\n          replace()\r\n        }\r\n      })\r\n    }\r\n\r\n    _bindInsertEvents($popup)\r\n\r\n    return $popup\r\n  }\r\n\r\n\r\n  /**\r\n   * Refresh the ALT popup.\r\n   */\r\n\r\n  function _refreshAltPopup() {\r\n    if ($current_image) {\r\n      const $popup = editor.popups.get('image.alt')\r\n      $popup.find('input').val($current_image.attr('alt') || '').trigger('change')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show the ALT popup.\r\n   */\r\n\r\n  function showAltPopup() {\r\n    let $popup = editor.popups.get('image.alt')\r\n\r\n    if (!$popup) $popup = _initAltPopup()\r\n    hideProgressBar()\r\n    editor.popups.refresh('image.alt')\r\n    editor.popups.setContainer('image.alt', editor.$sc)\r\n\r\n    let $el = getEl()\r\n\r\n    if (hasCaption()) {\r\n      $el = $el.find('.fr-img-wrap')\r\n    }\r\n\r\n    let left = $el.offset().left + $el.outerWidth() / 2\r\n    const top = $el.offset().top + $el.outerHeight()\r\n\r\n    editor.popups.show('image.alt', left, top, $el.outerHeight(), true)\r\n  }\r\n\r\n  /**\r\n   * Init the image upload popup.\r\n   */\r\n\r\n  function _initAltPopup(delayed) {\r\n    if (delayed) {\r\n      editor.popups.onRefresh('image.alt', _refreshAltPopup)\r\n\r\n      return true\r\n    }\r\n\r\n    // Image buttons.\r\n    let image_buttons = ''\r\n    image_buttons = `<div class=\"fr-buttons fr-tabs\">${editor.button.buildList(editor.opts.imageAltButtons)}</div>`\r\n\r\n    // Image by url layer.\r\n    let alt_layer = ''\r\n    alt_layer = `<div class=\"fr-image-alt-layer fr-layer fr-active\" id=\"fr-image-alt-layer-${editor.id}\"><div class=\"fr-input-line\"><input id=\"fr-image-alt-layer-text-${editor.id}\" type=\"text\" placeholder=\"${editor.language.translate('Alternative Text')}\" tabIndex=\"1\"></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"imageSetAlt\" tabIndex=\"2\" role=\"button\">${editor.language.translate('Update')}</button></div></div>`\r\n\r\n    const template = {\r\n      buttons: image_buttons,\r\n      alt_layer: alt_layer\r\n    }\r\n\r\n    // Set the template in the popup.\r\n    const $popup = editor.popups.create('image.alt', template)\r\n\r\n    if (editor.$wp) {\r\n      editor.events.$on(editor.$wp, 'scroll.image-alt', function () {\r\n        if ($current_image && editor.popups.isVisible('image.alt')) {\r\n          showAltPopup()\r\n        }\r\n      })\r\n    }\r\n\r\n    return $popup\r\n  }\r\n\r\n  /**\r\n   * Set ALT based on the values from the popup.\r\n   */\r\n\r\n  function setAlt(alt) {\r\n    if ($current_image) {\r\n      const $popup = editor.popups.get('image.alt')\r\n      $current_image.attr('alt', alt || $popup.find('input').val() || '')\r\n      $popup.find('input:focus').blur()\r\n      _editImg($current_image)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refresh the size popup.\r\n   */\r\n\r\n  // Issue 2845\r\n\r\n  function _refreshSizePopup() {\r\n    const $popup = editor.popups.get('image.size')\r\n    const $popup_height_val = $current_image.get(0).style.height ? $current_image.get(0).style.height : 'auto'\r\n    const $popup_width_val = $current_image.get(0).style.width ? $current_image.get(0).style.width : 'auto'\r\n    if ($current_image) {\r\n\r\n      if (hasCaption()) {\r\n        let $el = $current_image.parent()\r\n\r\n        if (!($el.get(0).style.width)) {\r\n          $el = $current_image.parent().parent()\r\n        }\r\n        $popup.find('input[name=\"width\"]').val($popup_width_val).trigger('change')\r\n        $popup.find('input[name=\"height\"]').val($popup_height_val).trigger('change')\r\n      }\r\n      else {\r\n        $popup.find('input[name=\"width\"]').val($popup_width_val).trigger('change')\r\n        $popup.find('input[name=\"height\"]').val($popup_height_val).trigger('change')\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show the size popup.\r\n   */\r\n\r\n  function showSizePopup() {\r\n    let $popup = editor.popups.get('image.size')\r\n\r\n    if (!$popup) $popup = _initSizePopup()\r\n    hideProgressBar()\r\n    editor.popups.refresh('image.size')\r\n    editor.popups.setContainer('image.size', editor.$sc)\r\n\r\n    let $el = getEl()\r\n\r\n    if (hasCaption()) {\r\n      $el = $el.find('.fr-img-wrap')\r\n    }\r\n\r\n    let left = $el.offset().left + $el.outerWidth() / 2\r\n    const top = $el.offset().top + $el.outerHeight()\r\n\r\n    editor.popups.show('image.size', left, top, $el.outerHeight(), true)\r\n  }\r\n\r\n  /**\r\n   * Init the image upload popup.\r\n   */\r\n\r\n  function _initSizePopup(delayed) {\r\n    if (delayed) {\r\n      editor.popups.onRefresh('image.size', _refreshSizePopup)\r\n\r\n      return true\r\n    }\r\n\r\n    // Image buttons.\r\n    let image_buttons = ''\r\n    image_buttons = `<div class=\"fr-buttons fr-tabs\">${editor.button.buildList(editor.opts.imageSizeButtons)}</div>`\r\n\r\n    // Size layer.\r\n    let size_layer = ''\r\n    size_layer = `<div class=\"fr-image-size-layer fr-layer fr-active\" id=\"fr-image-size-layer-${editor.id}\"><div class=\"fr-image-group\"><div class=\"fr-input-line\"><input id=\"fr-image-size-layer-width-'${editor.id}\" type=\"text\" name=\"width\" placeholder=\"${editor.language.translate('Width')}\" tabIndex=\"1\"></div><div class=\"fr-input-line\"><input id=\"fr-image-size-layer-height${editor.id}\" type=\"text\" name=\"height\" placeholder=\"${editor.language.translate('Height')}\" tabIndex=\"1\"></div></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"imageSetSize\" tabIndex=\"2\" role=\"button\">${editor.language.translate('Update')}</button></div></div>`\r\n\r\n    const template = {\r\n      buttons: image_buttons,\r\n      size_layer: size_layer\r\n    }\r\n\r\n    // Set the template in the popup.\r\n    const $popup = editor.popups.create('image.size', template)\r\n\r\n    if (editor.$wp) {\r\n      editor.events.$on(editor.$wp, 'scroll.image-size', function () {\r\n        if ($current_image && editor.popups.isVisible('image.size')) {\r\n          showSizePopup()\r\n        }\r\n      })\r\n    }\r\n\r\n    return $popup\r\n  }\r\n\r\n  /**\r\n   * Set size based on the current image size.\r\n   */\r\n\r\n  function setSize(width, height) {\r\n    if ($current_image) {\r\n      const $popup = editor.popups.get('image.size')\r\n      width = width || $popup.find('input[name=\"width\"]').val() || ''\r\n      height = height || $popup.find('input[name=\"height\"]').val() || ''\r\n      const regex = /^[\\d]+((px)|%)*$/g\r\n\r\n      $current_image.removeAttr('width').removeAttr('height')\r\n\r\n      if (width.match(regex)) $current_image.css('width', width)\r\n      else $current_image.css('width', '')\r\n\r\n      if (height.match(regex)) $current_image.css('height', height)\r\n      else $current_image.css('height', '')\r\n\r\n      if (hasCaption()) {\r\n        $current_image.parents('.fr-img-caption').removeAttr('width').removeAttr('height')\r\n\r\n        if (width.match(regex)) $current_image.parents('.fr-img-caption').css('width', width)\r\n        else $current_image.parents('.fr-img-caption').css('width', '')\r\n\r\n        if (height.match(regex)) $current_image.parents('.fr-img-caption').css('height', height)\r\n        else $current_image.parents('.fr-img-caption').css('height', '')\r\n      }\r\n\r\n      if ($popup) $popup.find('input:focus').blur()\r\n      _editImg($current_image)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show the image upload layer.\r\n   */\r\n\r\n  function showLayer(name) {\r\n    const $popup = editor.popups.get('image.insert')\r\n\r\n    let left\r\n    let top\r\n\r\n    // Click on the button from the toolbar without image selected.\r\n    if (!$current_image && !editor.opts.toolbarInline) {\r\n      const $btn = editor.$tb.find('.fr-command[data-cmd=\"insertImage\"]')\r\n      left = $btn.offset().left\r\n      top = $btn.offset().top + (editor.opts.toolbarBottom ? 10 : $btn.outerHeight() - 10)\r\n    }\r\n\r\n    // Image is selected.\r\n    else if ($current_image) {\r\n\r\n      let $el = getEl()\r\n\r\n      if (hasCaption()) {\r\n        $el = $el.find('.fr-img-wrap')\r\n      }\r\n\r\n      // Set the top to the bottom of the image.\r\n      top = $el.offset().top + $el.outerHeight()\r\n      left = $el.offset().left\r\n    }\r\n\r\n    // Image is selected and we are in inline mode.\r\n    if (!$current_image && editor.opts.toolbarInline) {\r\n\r\n      // Set top to the popup top.\r\n      top = $popup.offset().top - editor.helpers.getPX($popup.css('margin-top'))\r\n\r\n      // If the popup is above apply height correction.\r\n      if ($popup.hasClass('fr-above')) {\r\n        top += $popup.outerHeight()\r\n      }\r\n    }\r\n\r\n    // Show the new layer.\r\n    $popup.find('.fr-layer').removeClass('fr-active')\r\n    $popup.find(`.fr-${name}-layer`).addClass('fr-active')\r\n\r\n    editor.popups.show('image.insert', left, top, ($current_image ? $current_image.outerHeight() : 0))\r\n    editor.accessibility.focusPopup($popup)\r\n  }\r\n\r\n  /**\r\n   * Refresh the upload image button.\r\n   */\r\n\r\n  function refreshUploadButton($btn) {\r\n    const $popup = editor.popups.get('image.insert')\r\n    if ($popup && $popup.find('.fr-image-upload-layer').hasClass('fr-active')) {\r\n      $btn.addClass('fr-active').attr('aria-pressed', true)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refresh the insert by url button.\r\n   */\r\n\r\n  function refreshByURLButton($btn) {\r\n    const $popup = editor.popups.get('image.insert')\r\n    if ($popup && $popup.find('.fr-image-by-url-layer').hasClass('fr-active')) {\r\n      $btn.addClass('fr-active').attr('aria-pressed', true)\r\n    }\r\n  }\r\n\r\n  function _resizeImage(e, initPageX, direction, step) {\r\n    e.pageX = initPageX\r\n    _handlerMousedown.call(this, e)\r\n    e.pageX = e.pageX + direction * Math.floor(Math.pow(1.1, step))\r\n    _handlerMousemove.call(this, e)\r\n    _handlerMouseup.call(this, e)\r\n\r\n    return ++step\r\n  }\r\n\r\n  /**\r\n   * Init image resizer.\r\n   */\r\n  function _initImageResizer() {\r\n    let doc\r\n\r\n    // No shared image resizer.\r\n    if (!editor.shared.$image_resizer) {\r\n\r\n      // Create shared image resizer.\r\n      editor.shared.$image_resizer = $(document.createElement('div')).attr('class', 'fr-image-resizer')\r\n      $image_resizer = editor.shared.$image_resizer\r\n\r\n      // Bind mousedown event shared.\r\n      editor.events.$on($image_resizer, 'mousedown', function (e) {\r\n        e.stopPropagation()\r\n      }, true)\r\n\r\n      // Image resize is enabled.\r\n      if (editor.opts.imageResize) {\r\n        $image_resizer.append(_getHandler('nw') + _getHandler('ne') + _getHandler('sw') + _getHandler('se'))\r\n\r\n        // Add image resizer overlay and set it.\r\n        editor.shared.$img_overlay = $(document.createElement('div')).attr('class', 'fr-image-overlay')\r\n        $overlay = editor.shared.$img_overlay\r\n        doc = $image_resizer.get(0).ownerDocument\r\n        $(doc).find('body').first().append($overlay)\r\n      }\r\n    }\r\n    else {\r\n      $image_resizer = editor.shared.$image_resizer\r\n      $overlay = editor.shared.$img_overlay\r\n\r\n      editor.events.on('destroy', function () {\r\n        $('body').first().append($image_resizer.removeClass('fr-active'))\r\n      }, true)\r\n    }\r\n\r\n    // Shared destroy.\r\n    editor.events.on('shared.destroy', function () {\r\n      $image_resizer.html('').removeData().remove()\r\n      $image_resizer = null\r\n\r\n      if (editor.opts.imageResize) {\r\n        $overlay.remove()\r\n        $overlay = null\r\n      }\r\n    }, true)\r\n\r\n    // Window resize. Exit from edit.\r\n    if (!editor.helpers.isMobile()) {\r\n      editor.events.$on($(editor.o_win), 'resize', function () {\r\n        if ($current_image && !$current_image.hasClass('fr-uploading')) {\r\n          _exitEdit(true)\r\n        }\r\n        else if ($current_image) {\r\n          _repositionResizer()\r\n          replace()\r\n          showProgressBar(false)\r\n        }\r\n      })\r\n    }\r\n\r\n    // Image resize is enabled.\r\n    if (editor.opts.imageResize) {\r\n      doc = $image_resizer.get(0).ownerDocument\r\n      editor.events.$on($image_resizer, editor._mousedown, '.fr-handler', _handlerMousedown)\r\n      editor.events.$on($(doc), editor._mousemove, _handlerMousemove)\r\n      editor.events.$on($(doc.defaultView || doc.parentWindow), editor._mouseup, _handlerMouseup)\r\n      editor.events.$on($overlay, 'mouseleave', _handlerMouseup)\r\n\r\n      // Accessibility.\r\n\r\n      // Used for keys holing.\r\n      let step = 1\r\n      let prevKey = null\r\n      let prevTimestamp = 0\r\n\r\n      // Keydown event.\r\n      editor.events.on('keydown', function (e) {\r\n        if ($current_image) {\r\n          const ctrlKey = navigator.userAgent.indexOf('Mac OS X') != -1 ? e.metaKey : e.ctrlKey\r\n          const keycode = e.which\r\n\r\n          if (keycode !== prevKey || e.timeStamp - prevTimestamp > 200) {\r\n            step = 1\r\n\r\n            // Reset step. Known browser issue: Keyup does not trigger when ctrl is pressed.\r\n          }\r\n\r\n          // Increase image size.\r\n          if ((keycode == FE.KEYCODE.EQUALS || (editor.browser.mozilla && keycode == FE.KEYCODE.FF_EQUALS)) && ctrlKey && !e.altKey) {\r\n            step = _resizeImage.call(this, e, 1, 1, step)\r\n          }\r\n\r\n          // Decrease image size.\r\n          else if ((keycode == FE.KEYCODE.HYPHEN || (editor.browser.mozilla && keycode == FE.KEYCODE.FF_HYPHEN)) && ctrlKey && !e.altKey) {\r\n            step = _resizeImage.call(this, e, 2, -1, step)\r\n          }\r\n          else if (!editor.keys.ctrlKey(e) && keycode == FE.KEYCODE.ENTER) {\r\n            $current_image.before('<br>')\r\n            _editImg($current_image)\r\n          }\r\n\r\n          // Save key code.\r\n          prevKey = keycode\r\n\r\n          // Save timestamp.\r\n          prevTimestamp = e.timeStamp\r\n        }\r\n      }, true)\r\n\r\n      // Reset the step on key up event.\r\n      editor.events.on('keyup', function () {\r\n        step = 1\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove the current image.\r\n   */\r\n  function remove($img) {\r\n    $img = $img || getEl()\r\n\r\n    if ($img) {\r\n      if (editor.events.trigger('image.beforeRemove', [$img]) !== false) {\r\n        editor.popups.hideAll()\r\n        _selectImage()\r\n        _exitEdit(true)\r\n\r\n        if (!editor.undo.canDo()) editor.undo.saveStep()\r\n\r\n        if ($img.get(0) == editor.el) {\r\n          $img.removeAttr('src')\r\n        }\r\n        else {\r\n          if ($img.get(0).parentNode && $img.get(0).parentNode.tagName == 'A') {\r\n            editor.selection.setBefore($img.get(0).parentNode) || editor.selection.setAfter($img.get(0).parentNode) || $img.parent().after(FE.MARKERS)\r\n            $($img.get(0).parentNode).remove()\r\n          }\r\n          else {\r\n            editor.selection.setBefore($img.get(0)) || editor.selection.setAfter($img.get(0)) || $img.after(FE.MARKERS)\r\n            $img.remove()\r\n          }\r\n\r\n          editor.html.fillEmptyBlocks()\r\n          editor.selection.restore()\r\n        }\r\n\r\n        editor.undo.saveStep()\r\n      }\r\n    }\r\n  }\r\n\r\n  function _editorKeydownHandler(e) {\r\n    const key_code = e.which\r\n\r\n    if ($current_image && (key_code == FE.KEYCODE.BACKSPACE || key_code == FE.KEYCODE.DELETE)) {\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n      remove()\r\n\r\n      return false\r\n    }\r\n    else if ($current_image && key_code == FE.KEYCODE.ESC) {\r\n      const $img = $current_image\r\n      _exitEdit(true)\r\n      editor.selection.setAfter($img.get(0))\r\n      editor.selection.restore()\r\n      e.preventDefault()\r\n\r\n      return false\r\n    }\r\n\r\n    // Move cursor if left and right arrows are used.\r\n    else if ($current_image && (key_code == FE.KEYCODE.ARROW_LEFT || key_code == FE.KEYCODE.ARROW_RIGHT)) {\r\n      const img = $current_image.get(0)\r\n      _exitEdit(true)\r\n\r\n      if (key_code == FE.KEYCODE.ARROW_LEFT) {\r\n        editor.selection.setBefore(img)\r\n      }\r\n      else {\r\n        editor.selection.setAfter(img)\r\n      }\r\n\r\n      editor.selection.restore()\r\n      e.preventDefault()\r\n\r\n      return false\r\n    }\r\n    else if ($current_image && key_code === FE.KEYCODE.TAB) {\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n      _exitEdit(true)\r\n\r\n      return false\r\n    }\r\n    else if ($current_image && key_code != FE.KEYCODE.F10 && !editor.keys.isBrowserAction(e)) {\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n\r\n      return false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Do some cleanup on images.\r\n   */\r\n  function _cleanOnGet(el) {\r\n\r\n    // Tag is image.\r\n    if (el && el.tagName == 'IMG') {\r\n\r\n      // Remove element if it has class fr-uploading or fr-error.\r\n      if (editor.node.hasClass(el, 'fr-uploading') || editor.node.hasClass(el, 'fr-error')) {\r\n        el.parentNode.removeChild(el)\r\n      }\r\n\r\n      // Remove class if it is draggable.\r\n      else if (editor.node.hasClass(el, 'fr-draggable')) {\r\n        el.classList.remove('fr-draggable')\r\n      }\r\n\r\n      if (el.parentNode && el.parentNode.parentNode && editor.node.hasClass(el.parentNode.parentNode, 'fr-img-caption')) {\r\n        const p_node = el.parentNode.parentNode\r\n        p_node.removeAttribute('contenteditable')\r\n        p_node.removeAttribute('draggable')\r\n        p_node.classList.remove('fr-draggable')\r\n\r\n        const n_node = el.nextSibling\r\n\r\n        if (n_node) {\r\n          n_node.removeAttribute('contenteditable')\r\n        }\r\n      }\r\n    }\r\n\r\n    // Look for inner nodes that might be in a similar case.\r\n    else if (el && el.nodeType == Node.ELEMENT_NODE) {\r\n      const imgs = el.querySelectorAll('img.fr-uploading, img.fr-error, img.fr-draggable')\r\n\r\n      for (let i = 0; i < imgs.length; i++) {\r\n        _cleanOnGet(imgs[i])\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialization.\r\n   */\r\n  function _init() {\r\n    _initEvents()\r\n\r\n    // Init on image.\r\n    if (editor.el.tagName == 'IMG') {\r\n      editor.$el.addClass('fr-view')\r\n    }\r\n\r\n    editor.events.$on(editor.$el, editor.helpers.isMobile() && !editor.helpers.isWindowsPhone() ? 'touchend' : 'click', editor.el.tagName == 'IMG' ? null : 'img:not([contenteditable=\"false\"])', _edit)\r\n\r\n    if (editor.helpers.isMobile()) {\r\n      editor.events.$on(editor.$el, 'touchstart', editor.el.tagName == 'IMG' ? null : 'img:not([contenteditable=\"false\"])', function () {\r\n        touchScroll = false\r\n      })\r\n\r\n      editor.events.$on(editor.$el, 'touchmove', function () {\r\n        touchScroll = true\r\n      })\r\n    }\r\n\r\n    if (editor.$wp) {\r\n      editor.events.on('window.keydown keydown', _editorKeydownHandler, true)\r\n\r\n      editor.events.on('keyup', function (e) {\r\n        if ($current_image && e.which == FE.KEYCODE.ENTER) {\r\n\r\n          return false\r\n        }\r\n      }, true)\r\n\r\n      // Prevent typing in image caption DOM structure.\r\n      editor.events.$on(editor.$el, 'keydown', function () {\r\n        let el = editor.selection.element()\r\n\r\n        // Parent node of the current element.\r\n        if (el.nodeType === Node.TEXT_NODE || (el.tagName == 'BR' && editor.node.isLastSibling(el))) {\r\n          el = el.parentNode\r\n        }\r\n\r\n        if (!editor.node.hasClass(el, 'fr-inner')) {\r\n          if (!editor.node.hasClass(el, 'fr-img-caption')) {\r\n            el = $(el).parents('.fr-img-caption').get(0)\r\n          }\r\n\r\n          // Check if we are in image caption.\r\n          if (editor.node.hasClass(el, 'fr-img-caption')) {\r\n            $(el).after(FE.INVISIBLE_SPACE + FE.MARKERS);\r\n            editor.selection.restore();\r\n          }\r\n        }\r\n      })\r\n    }\r\n    else {\r\n      editor.events.$on(editor.$win, 'keydown', _editorKeydownHandler)\r\n    }\r\n\r\n    // ESC from accessibility.\r\n    editor.events.on('toolbar.esc', function () {\r\n      if ($current_image) {\r\n        if (editor.$wp) {\r\n          editor.events.disableBlur()\r\n          editor.events.focus()\r\n        }\r\n        else {\r\n          const $img = $current_image\r\n          _exitEdit(true)\r\n          editor.selection.setAfter($img.get(0))\r\n          editor.selection.restore()\r\n        }\r\n\r\n        return false\r\n      }\r\n    }, true)\r\n\r\n    // focusEditor from accessibility.\r\n    editor.events.on('toolbar.focusEditor', function () {\r\n      if ($current_image) {\r\n\r\n        return false\r\n      }\r\n    }, true)\r\n\r\n    // Copy/cut image.\r\n    editor.events.on('window.cut window.copy', function (e) {\r\n      // Do copy only if image.edit popups is visible and not focused.\r\n      if ($current_image && editor.popups.isVisible('image.edit') && !editor.popups.get('image.edit').find(':focus').length) {\r\n\r\n        const $el = getEl()\r\n\r\n        if (hasCaption()) {\r\n          $el.before(FE.START_MARKER)\r\n          $el.after(FE.END_MARKER)\r\n          editor.selection.restore()\r\n          editor.paste.saveCopiedText($el.get(0).outerHTML, $el.text())\r\n        }\r\n        else {\r\n          _selectImage()\r\n          editor.paste.saveCopiedText($current_image.get(0).outerHTML, $current_image.attr('alt'))\r\n        }\r\n\r\n        if (e.type == 'copy') {\r\n          setTimeout(function () {\r\n            _editImg($current_image)\r\n          })\r\n        }\r\n        else {\r\n          _exitEdit(true)\r\n          editor.undo.saveStep()\r\n          setTimeout(function () {\r\n            editor.undo.saveStep()\r\n          }, 0)\r\n        }\r\n      }\r\n    }, true)\r\n\r\n    // Fix IE copy not working when selection is collapsed.\r\n    if (editor.browser.msie) {\r\n      editor.events.on('keydown', function (e) {\r\n        // Selection is collapsed and we have an image.\r\n        if (!(editor.selection.isCollapsed() && $current_image)) return true\r\n\r\n        const key_code = e.which\r\n\r\n        // Copy.\r\n        if (key_code == FE.KEYCODE.C && editor.keys.ctrlKey(e)) {\r\n          editor.events.trigger('window.copy')\r\n        }\r\n\r\n        // Cut.\r\n        else if (key_code == FE.KEYCODE.X && editor.keys.ctrlKey(e)) {\r\n          editor.events.trigger('window.cut')\r\n        }\r\n      })\r\n    }\r\n\r\n    // Do not leave page while uploading.\r\n    editor.events.$on($(editor.o_win), 'keydown', function (e) {\r\n      const key_code = e.which\r\n\r\n      if ($current_image && key_code == FE.KEYCODE.BACKSPACE) {\r\n        e.preventDefault()\r\n\r\n        return false\r\n      }\r\n    })\r\n\r\n    // Check if image is uploading to abort it.\r\n    editor.events.$on(editor.$win, 'keydown', function (e) {\r\n      const key_code = e.which\r\n\r\n      if ($current_image && $current_image.hasClass('fr-uploading') && key_code == FE.KEYCODE.ESC) {\r\n        $current_image.trigger('abortUpload')\r\n      }\r\n    })\r\n\r\n    editor.events.on('destroy', function () {\r\n      if ($current_image && $current_image.hasClass('fr-uploading')) {\r\n        $current_image.trigger('abortUpload')\r\n      }\r\n    })\r\n\r\n    editor.events.on('paste.before', _clipboardPaste)\r\n    editor.events.on('paste.beforeCleanup', _clipboardPasteCleanup)\r\n    editor.events.on('paste.after', _uploadPastedImages)\r\n    editor.events.on('html.set', _refreshImageList)\r\n    editor.events.on('html.inserted', _refreshImageList)\r\n    _refreshImageList()\r\n\r\n    editor.events.on('destroy', function () {\r\n      images = []\r\n    })\r\n\r\n    // Remove any fr-uploading / fr-error images.\r\n    editor.events.on('html.processGet', _cleanOnGet)\r\n\r\n    if (editor.opts.imageOutputSize) {\r\n      let imgs\r\n\r\n      editor.events.on('html.beforeGet', function () {\r\n        imgs = editor.el.querySelectorAll('img')\r\n        for (let i = 0; i < imgs.length; i++) {\r\n          const width = imgs[i].style.width || $(imgs[i]).width()\r\n          const height = imgs[i].style.height || $(imgs[i]).height()\r\n\r\n          if (width) imgs[i].setAttribute('width', (`${width}`).replace(/px/, ''))\r\n\r\n          if (height) imgs[i].setAttribute('height', (`${height}`).replace(/px/, ''))\r\n        }\r\n      })\r\n    }\r\n\r\n    if (editor.opts.iframe) {\r\n      editor.events.on('image.loaded', editor.size.syncIframe)\r\n    }\r\n\r\n    if (editor.$wp) {\r\n      _syncImages()\r\n      editor.events.on('contentChanged', _syncImages)\r\n    }\r\n\r\n    editor.events.$on($(editor.o_win), 'orientationchange.image', function () {\r\n      setTimeout(function () {\r\n        if ($current_image) {\r\n          _editImg($current_image)\r\n        }\r\n      }, 100)\r\n    })\r\n\r\n    _initEditPopup(true)\r\n    _initInsertPopup(true)\r\n    _initSizePopup(true)\r\n    _initAltPopup(true)\r\n\r\n    editor.events.on('node.remove', function ($node) {\r\n      if ($node.get(0).tagName == 'IMG') {\r\n        remove($node)\r\n\r\n        return false\r\n      }\r\n    })\r\n  }\r\n\r\n  function _processPastedImage(img) {\r\n    if (editor.events.trigger('image.beforePasteUpload', [img]) === false) {\r\n\r\n      return false\r\n    }\r\n\r\n    // Show the progress bar.\r\n    $current_image = $(img)\r\n    _repositionResizer()\r\n    _showEditPopup()\r\n    replace()\r\n    showProgressBar()\r\n\r\n    $current_image.on('load', function () {\r\n      let loadEvents = []\r\n\r\n      _repositionResizer()\r\n      // https://github.com/froala/wysiwyg-editor/issues/3407\r\n      if ($(editor.popups.get('image.insert').get(0)).find('div.fr-active.fr-error').length < 1) {\r\n        showProgressBar()\r\n      }\r\n\r\n      // https://github.com/froala-labs/froala-editor-js-2/issues/1866\r\n      $(this).data('events').find(function(event) {\r\n        if (event[0] === 'load') {\r\n          loadEvents.push(event)\r\n        }\r\n      })\r\n      \r\n      // turn off the event if it is registered only once\r\n      loadEvents.length <= 1 && $(this).off('load')\r\n    })\r\n\r\n    const splitSrc = $(img).attr('src').split(',')\r\n\r\n    // Convert image to blob.\r\n    const binary = atob(splitSrc[1])\r\n    const array = []\r\n\r\n    for (let i = 0; i < binary.length; i++) {\r\n      array.push(binary.charCodeAt(i))\r\n    }\r\n\r\n    const upload_img = new Blob([new Uint8Array(array)], {\r\n      type: splitSrc[0].replace(/data\\:/g, '').replace(/;base64/g, '')\r\n    })\r\n\r\n    upload([upload_img], $current_image)\r\n  }\r\n\r\n  function _uploadPastedImages() {\r\n    if (!editor.opts.imagePaste) {\r\n      editor.$el.find('img[data-fr-image-pasted]').remove()\r\n    }\r\n    else {\r\n\r\n      // Safari won't work https://bugs.webkit.org/show_bug.cgi?id=49141\r\n      editor.$el.find('img[data-fr-image-pasted]').each(function (index, img) {\r\n        if (editor.opts.imagePasteProcess) {\r\n          let width = editor.opts.imageDefaultWidth\r\n\r\n          if (width && width != 'auto') {\r\n            width = width + (editor.opts.imageResizeWithPercent ? '%' : 'px')\r\n          }\r\n          $(img)\r\n            .css('width', width)\r\n            .removeClass('fr-dii fr-dib fr-fir fr-fil')\r\n\r\n          _setStyle($(img), editor.opts.imageDefaultDisplay, editor.opts.imageDefaultAlign)\r\n        }\r\n\r\n        // Data images.\r\n        if (img.src.indexOf('data:') === 0) {\r\n          _processPastedImage(img)\r\n        }\r\n\r\n        // New way Safari is pasting images.\r\n        else if (img.src.indexOf('blob:') === 0 || (img.src.indexOf('http') === 0 && editor.opts.imageUploadRemoteUrls && editor.opts.imageCORSProxy)) {\r\n          const _img = new Image()\r\n          _img.crossOrigin = 'Anonymous'\r\n          _img.onload = function () {\r\n            // Create canvas.\r\n            const canvas = editor.o_doc.createElement('CANVAS')\r\n            const context = canvas.getContext('2d')\r\n\r\n            // Set height.\r\n            canvas.height = this.naturalHeight\r\n            canvas.width = this.naturalWidth\r\n\r\n            // Draw image.\r\n            context.drawImage(this, 0, 0)\r\n\r\n            // pushing the execution at end of the stack\r\n            setTimeout(function () {\r\n              _processPastedImage(img)\r\n            }, 0)\r\n\r\n            let imgExt\r\n\r\n            if (this.naturalWidth > 2000 || this.naturalHeight > 1500) {\r\n              imgExt = 'jpeg' // if images are too large\r\n            }\r\n            else {\r\n              imgExt = 'png'\r\n            }\r\n\r\n            // Update image and process it.\r\n            img.src = canvas.toDataURL(`image/${imgExt}`)\r\n\r\n          }\r\n\r\n          _img.src = (img.src.indexOf('blob:') === 0 ? '' : (`${editor.opts.imageCORSProxy}/`)) + img.src\r\n        }\r\n\r\n        // Images without http (Safari ones.).\r\n        else if (img.src.indexOf('http') !== 0 || img.src.indexOf('https://mail.google.com/mail') === 0) {\r\n          editor.selection.save()\r\n          $(img).remove()\r\n          editor.selection.restore()\r\n        }\r\n        else {\r\n          $(img).removeAttr('data-fr-image-pasted')\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  function _clipboardImageLoaded(e) {\r\n    const result = e.target.result\r\n\r\n    // Default width.\r\n    let width = editor.opts.imageDefaultWidth\r\n\r\n    if (width && width != 'auto') {\r\n      width = width + (editor.opts.imageResizeWithPercent ? '%' : 'px')\r\n    }\r\n\r\n    editor.undo.saveStep()\r\n\r\n    editor.html.insert(`<img data-fr-image-pasted=\"true\" src=\"${result}\"${(width ? ` style=\"width: ${width};\"` : '')}>`)\r\n\r\n    const $img = editor.$el.find('img[data-fr-image-pasted=\"true\"]')\r\n\r\n    if ($img) {\r\n      _setStyle($img, editor.opts.imageDefaultDisplay, editor.opts.imageDefaultAlign)\r\n    }\r\n\r\n    editor.events.trigger('paste.after')\r\n  }\r\n\r\n  function _processsClipboardPaste(file) {\r\n    const reader = new FileReader()\r\n    reader.onload = _clipboardImageLoaded\r\n    reader.readAsDataURL(file)\r\n  }\r\n\r\n  function _clipboardPaste(e) {\r\n    if (e && e.clipboardData && e.clipboardData.items) {\r\n\r\n      let file = null\r\n\r\n      if (!((e.clipboardData.types && [].indexOf.call(e.clipboardData.types, 'text/rtf') != -1) || e.clipboardData.getData('text/rtf'))) {\r\n        for (let i = 0; i < e.clipboardData.items.length; i++) {\r\n          file = e.clipboardData.items[i].getAsFile()\r\n\r\n          if (file) {\r\n            break\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        file = e.clipboardData.items[0].getAsFile()\r\n      }\r\n\r\n      if (file) {\r\n        _processsClipboardPaste(file)\r\n\r\n        return false\r\n      }\r\n    }\r\n  }\r\n\r\n  function _clipboardPasteCleanup(clipboard_html) {\r\n    clipboard_html = clipboard_html.replace(/<img /gi, '<img data-fr-image-pasted=\"true\" ')\r\n\r\n    return clipboard_html\r\n  }\r\n\r\n  /**\r\n   * Start edit.\r\n   */\r\n  let touchScroll\r\n\r\n  function _edit(e) {\r\n    if ($(this).parents('[contenteditable]').not('.fr-element').not('.fr-img-caption').not('body').first().attr('contenteditable') == 'false') return true\r\n\r\n    if (e && e.type == 'touchend' && touchScroll) {\r\n\r\n      return true\r\n    }\r\n\r\n    if (e && editor.edit.isDisabled()) {\r\n      e.stopPropagation()\r\n      e.preventDefault()\r\n\r\n      return false\r\n    }\r\n\r\n    // Hide resizer for other instances.\r\n    for (let i = 0; i < FE.INSTANCES.length; i++) {\r\n      if (FE.INSTANCES[i] != editor) {\r\n        FE.INSTANCES[i].events.trigger('image.hideResizer')\r\n      }\r\n    }\r\n\r\n    editor.toolbar.disable()\r\n\r\n    if (e) {\r\n      e.stopPropagation()\r\n      e.preventDefault()\r\n    }\r\n\r\n    // Hide keyboard.\r\n    if (editor.helpers.isMobile()) {\r\n      editor.events.disableBlur()\r\n      editor.$el.blur()\r\n      editor.events.enableBlur()\r\n    }\r\n\r\n    if (editor.opts.iframe) {\r\n      editor.size.syncIframe()\r\n    }\r\n\r\n    // Store current image.\r\n    $current_image = $(this)\r\n\r\n    // Select image.\r\n    _selectImage()\r\n\r\n    // Reposition resizer.\r\n    _repositionResizer()\r\n    _showEditPopup()\r\n\r\n    // Issue 2801\r\n    if (editor.browser.msie) {\r\n      if (editor.popups.areVisible()) {\r\n        editor.events.disableBlur()\r\n      }\r\n\r\n      if (editor.win.getSelection) {\r\n        editor.win.getSelection().removeAllRanges()\r\n        editor.win.getSelection().addRange(editor.doc.createRange())\r\n      }\r\n    }\r\n    else {\r\n      editor.selection.clear()\r\n    }\r\n\r\n    // Fix for image remaining selected.\r\n    if (editor.helpers.isIOS()) {\r\n      editor.events.disableBlur()\r\n      editor.$el.blur()\r\n    }\r\n\r\n    // Refresh buttons.\r\n    editor.button.bulkRefresh()\r\n    editor.events.trigger('video.hideResizer')\r\n  }\r\n\r\n  /**\r\n   * Exit edit.\r\n   */\r\n\r\n  function _exitEdit(force_exit) {\r\n    if ($current_image && (_canExit() || force_exit === true)) {\r\n      editor.toolbar.enable()\r\n      $image_resizer.removeClass('fr-active')\r\n      editor.popups.hideAll();\r\n      $current_image = null\r\n      _unmarkExit()\r\n\r\n      $handler = null\r\n\r\n      if ($overlay) {\r\n        $overlay.hide()\r\n      }\r\n    }\r\n  }\r\n\r\n  let img_exit_flag = false\r\n\r\n  function _markExit() {\r\n    img_exit_flag = true\r\n  }\r\n\r\n  function _unmarkExit() {\r\n    img_exit_flag = false\r\n  }\r\n\r\n  function _canExit() {\r\n\r\n    return img_exit_flag\r\n  }\r\n\r\n  /**\r\n   * Set style for image.\r\n   */\r\n  function _setStyle($img, _display, _align) {\r\n\r\n    if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\r\n      $img.removeClass('fr-fil fr-fir fr-dib fr-dii')\r\n\r\n      if (_align) {\r\n        $img.addClass(`fr-fi${_align[0]}`)\r\n      }\r\n\r\n      if (_display) {\r\n        $img.addClass(`fr-di${_display[0]}`)\r\n      }\r\n    }\r\n    else {\r\n      if (_display == 'inline') {\r\n        $img.css({\r\n          display: 'inline-block',\r\n          verticalAlign: 'bottom',\r\n          margin: editor.opts.imageDefaultMargin\r\n        })\r\n\r\n        if (_align == 'center') {\r\n          $img.css({\r\n            'float': 'none',\r\n            marginBottom: '',\r\n            marginTop: '',\r\n            maxWidth: `calc(100% - ${(2 * editor.opts.imageDefaultMargin)}px)`,\r\n            textAlign: 'center'\r\n          })\r\n        }\r\n        else if (_align == 'left') {\r\n          $img.css({\r\n            'float': 'left',\r\n            marginLeft: 0,\r\n            maxWidth: `calc(100% - ${editor.opts.imageDefaultMargin}px)`,\r\n            textAlign: 'left'\r\n          })\r\n        }\r\n        else {\r\n          $img.css({\r\n            'float': 'right',\r\n            marginRight: 0,\r\n            maxWidth: `calc(100% - ${editor.opts.imageDefaultMargin}px)`,\r\n            textAlign: 'right'\r\n          })\r\n        }\r\n      }\r\n      else if (_display == 'block') {\r\n        $img.css({\r\n          display: 'block',\r\n          'float': 'none',\r\n          verticalAlign: 'top',\r\n          margin: `${editor.opts.imageDefaultMargin}px auto`,\r\n          textAlign: 'center'\r\n        })\r\n\r\n        if (_align == 'left') {\r\n          $img.css({\r\n            marginLeft: 0,\r\n            textAlign: 'left'\r\n          })\r\n        }\r\n        else if (_align == 'right') {\r\n          $img.css({\r\n            marginRight: 0,\r\n            textAlign: 'right'\r\n          })\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Align image.\r\n   */\r\n  function align(val) {\r\n    const $el = getEl()\r\n\r\n    $el.removeClass('fr-fir fr-fil')\r\n\r\n    // Easy case. Use classes.\r\n    if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\r\n      if (val == 'left') {\r\n        $el.addClass('fr-fil')\r\n      }\r\n      else if (val == 'right') {\r\n        $el.addClass('fr-fir')\r\n      }\r\n    }\r\n    else {\r\n      _setStyle($el, getDisplay(), val)\r\n    }\r\n\r\n    _selectImage()\r\n    _repositionResizer()\r\n    _showEditPopup()\r\n    editor.selection.clear()\r\n  }\r\n\r\n  /**\r\n   * Get image alignment.\r\n   */\r\n  function getAlign($img) {\r\n    if (typeof $img == 'undefined') $img = getEl()\r\n\r\n    if ($img) {\r\n\r\n      // Image has left class.\r\n      if ($img.hasClass('fr-fil')) {\r\n\r\n        return 'left'\r\n      }\r\n\r\n      // Image has right class.\r\n      else if ($img.hasClass('fr-fir')) {\r\n\r\n        return 'right'\r\n      }\r\n\r\n      // Image has display class set.\r\n      else if ($img.hasClass('fr-dib') || $img.hasClass('fr-dii')) {\r\n\r\n        return 'center'\r\n      }\r\n      else {\r\n        // Set float to none.\r\n        const flt = $img.css('float')\r\n\r\n        $img.css('float', 'none')\r\n\r\n        // Image has display block.\r\n        if ($img.css('display') == 'block') {\r\n\r\n          // Set float to the initial value.\r\n          $img.css('float', '')\r\n\r\n          if ($img.css('float') != flt) $img.css('float', flt)\r\n\r\n          // Margin left is 0.\r\n          // Margin right is auto.\r\n          if (parseInt($img.css('margin-left'), 10) === 0) {\r\n\r\n            return 'left'\r\n          }\r\n\r\n          // Margin left is auto.\r\n          // Margin right is 0.\r\n          else if (parseInt($img.css('margin-right'), 10) === 0) {\r\n\r\n            return 'right'\r\n          }\r\n        }\r\n\r\n        // Display inline.\r\n        else {\r\n\r\n          // Set float.\r\n          $img.css('float', '')\r\n\r\n          if ($img.css('float') != flt) $img.css('float', flt)\r\n\r\n          // Float left.\r\n          if ($img.css('float') == 'left') {\r\n\r\n            return 'left'\r\n          }\r\n\r\n          // Float right.\r\n          else if ($img.css('float') == 'right') {\r\n\r\n            return 'right'\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return 'center'\r\n  }\r\n\r\n  /**\r\n   * Get image display.\r\n   */\r\n  function getDisplay($img) {\r\n    if (typeof $img == 'undefined') $img = getEl()\r\n\r\n    // Set float to none.\r\n    const flt = $img.css('float')\r\n    $img.css('float', 'none')\r\n\r\n    // Image has display block.\r\n    if ($img.css('display') == 'block') {\r\n\r\n      // Set float to the initial value.\r\n      $img.css('float', '')\r\n\r\n      if ($img.css('float') != flt) $img.css('float', flt)\r\n\r\n      return 'block'\r\n    }\r\n\r\n    // Display inline.\r\n    else {\r\n\r\n      // Set float.\r\n      $img.css('float', '')\r\n\r\n      if ($img.css('float') != flt) $img.css('float', flt)\r\n\r\n      return 'inline'\r\n    }\r\n\r\n    return 'inline'\r\n  }\r\n\r\n  /**\r\n   * Refresh the align icon.\r\n   */\r\n  function refreshAlign($btn) {\r\n    if ($current_image) {\r\n      $btn.find('> *').first().replaceWith(editor.icon.create(`image-align-${getAlign()}`))\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refresh the align option from the dropdown.\r\n   */\r\n\r\n  function refreshAlignOnShow($btn, $dropdown) {\r\n    if ($current_image) {\r\n      $dropdown.find(`.fr-command[data-param1=\"${getAlign()}\"]`).addClass('fr-active').attr('aria-selected', true)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Align image.\r\n   */\r\n\r\n  function display(val) {\r\n    const $el = getEl()\r\n\r\n    $el.removeClass('fr-dii fr-dib')\r\n\r\n    // Easy case. Use classes.\r\n    if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\r\n      if (val == 'inline') {\r\n        $el.addClass('fr-dii')\r\n      }\r\n      else if (val == 'block') {\r\n        $el.addClass('fr-dib')\r\n      }\r\n    }\r\n    else {\r\n      _setStyle($el, val, getAlign())\r\n    }\r\n\r\n    _selectImage()\r\n    _repositionResizer()\r\n    _showEditPopup()\r\n    editor.selection.clear()\r\n  }\r\n\r\n  /**\r\n   * Refresh the image display selected option.\r\n   */\r\n\r\n  function refreshDisplayOnShow($btn, $dropdown) {\r\n    if ($current_image) {\r\n      $dropdown.find(`.fr-command[data-param1=\"${getDisplay()}\"]`).addClass('fr-active').attr('aria-selected', true)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show the replace popup.\r\n   */\r\n\r\n  function replace() {\r\n    let $popup = editor.popups.get('image.insert')\r\n\r\n    if (!$popup) $popup = _initInsertPopup()\r\n\r\n    if (!editor.popups.isVisible('image.insert')) {\r\n      hideProgressBar()\r\n      editor.popups.refresh('image.insert')\r\n      editor.popups.setContainer('image.insert', editor.$sc)\r\n    }\r\n\r\n    let $el = getEl()\r\n\r\n    if (hasCaption()) {\r\n      $el = $el.find('.fr-img-wrap')\r\n    }\r\n\r\n    let left = $el.offset().left + $el.outerWidth() / 2\r\n    const top = $el.offset().top + $el.outerHeight()\r\n\r\n    editor.popups.show('image.insert', left, top, $el.outerHeight(true), true)\r\n  }\r\n\r\n  /**\r\n   * Place selection around current image.\r\n   */\r\n  function _selectImage() {\r\n    if ($current_image) {\r\n      editor.events.disableBlur()\r\n      editor.selection.clear()\r\n      const range = editor.doc.createRange()\r\n      range.selectNode($current_image.get(0))\r\n\r\n      // Collapse range in IE.\r\n      if (editor.browser.msie) range.collapse(true)\r\n\r\n      const selection = editor.selection.get()\r\n      selection.addRange(range)\r\n      editor.events.enableBlur()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get back to the image main popup.\r\n   */\r\n  function back() {\r\n    if ($current_image) {\r\n      editor.events.disableBlur()\r\n      $('.fr-popup input:focus').blur()\r\n      _editImg($current_image)\r\n    }\r\n    else {\r\n      editor.events.disableBlur()\r\n      editor.selection.restore()\r\n      editor.events.enableBlur()\r\n\r\n      editor.popups.hide('image.insert')\r\n      editor.toolbar.showInline()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the current image.\r\n   */\r\n\r\n  function get() {\r\n\r\n    return $current_image\r\n  }\r\n\r\n  function getEl() {\r\n    return hasCaption() ? $current_image.parents('.fr-img-caption').first() : $current_image\r\n  }\r\n\r\n  /**\r\n   * Apply specific style.\r\n   */\r\n\r\n  function applyStyle(val, imageStyles, multipleStyles) {\r\n    if (typeof imageStyles == 'undefined') imageStyles = editor.opts.imageStyles\r\n\r\n    if (typeof multipleStyles == 'undefined') multipleStyles = editor.opts.imageMultipleStyles\r\n\r\n    if (!$current_image) return false\r\n\r\n    const $img = getEl()\r\n\r\n    // Remove multiple styles.\r\n    if (!multipleStyles) {\r\n      const styles = Object.keys(imageStyles)\r\n      styles.splice(styles.indexOf(val), 1)\r\n      $img.removeClass(styles.join(' '))\r\n    }\r\n\r\n    if (typeof imageStyles[val] == 'object') {\r\n      $img.removeAttr('style')\r\n      $img.css(imageStyles[val].style)\r\n    }\r\n    else {\r\n      $img.toggleClass(val)\r\n    }\r\n\r\n    _editImg($current_image)\r\n  }\r\n\r\n  function hasCaption() {\r\n    if ($current_image) {\r\n      return $current_image.parents('.fr-img-caption').length > 0\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  function toggleCaption() {\r\n    let $el\r\n\r\n    if ($current_image && !hasCaption()) {\r\n      $el = $current_image\r\n\r\n      // Check if there is a link wrapping the image.\r\n      if ($current_image.parent().is('a')) {\r\n        $el = $current_image.parent()\r\n      }\r\n\r\n      // code start https://github.com/froala-labs/froala-editor-js-2/issues/1864\r\n\r\n      // check the li placement\r\n      var $listParent = $current_image.parents('ul') && $current_image.parents('ul').length > 0 ? $current_image.parents('ul') : $current_image.parents('ol') && $current_image.parents('ol').length > 0 ? $current_image.parents('ol'): [];\r\n      if ($listParent.length > 0) {\r\n        var totLi = $listParent.find('li').length,\r\n          $currLi = $current_image.parents('li'),\r\n          $newLi = document.createElement(\"li\");;\r\n        \r\n        if ((totLi - 1) === $currLi.index()) { // if li placement last then add one extra li\r\n          $listParent.append($newLi);\r\n          $newLi.innerHTML = '&nbsp;';\r\n        }\r\n      }\r\n\r\n      let splitAttrs\r\n      let oldWidth\r\n\r\n      if ($el.attr('style')) {\r\n        splitAttrs = $el.attr('style').split(':')\r\n        oldWidth = splitAttrs.indexOf('width') > -1 ? splitAttrs[splitAttrs.indexOf('width') + 1].replace(';', '') : ''\r\n      } else if ($el.attr('width')) {\r\n        oldWidth = $el.attr('width');\r\n      }\r\n      \r\n      // Issue 2861\r\n      const current_width = editor.opts.imageResizeWithPercent ? (oldWidth.indexOf('px') > -1 ? null : oldWidth) || '100%' : $current_image.width() + 'px'\r\n\r\n      // https://github.com/froala-labs/froala-editor-js-2/issues/1864\r\n      $el.wrap('<div class=\"fr-img-space-wrap\"><span ' + (!editor.browser.mozilla ? 'contenteditable=\"false\"' : '') + 'class=\"fr-img-caption ' + $current_image.attr('class') + '\" style=\"' + (!editor.opts.useClasses ? $el.attr('style') : '') + '\" draggable=\"false\"></span><p class=\"fr-img-space-wrap2\">&nbsp;</p></div>')\r\n      $el.wrap('<span class=\"fr-img-wrap\"></span>')\r\n      $current_image.after(`<span class=\"fr-inner\"${(!editor.browser.mozilla ? ' contenteditable=\"true\"' : '')}>${FE.START_MARKER}${editor.language.translate('Image Caption')}${FE.END_MARKER}</span>`)\r\n      //$current_image.removeAttr('class').removeAttr('style').removeAttr('width')\r\n\r\n      $current_image.parents('.fr-img-caption').css('width', current_width);\r\n      let imgLengthCaption = $current_image.parents('.fr-img-space-wrap').length;\r\n      if (imgLengthCaption > 1) {\r\n        unwrap(document.querySelector('.fr-img-space-wrap'));\r\n        unwrap(document.querySelector('.fr-img-space-wrap2'));\r\n      }\r\n      _exitEdit(true)\r\n\r\n      editor.selection.restore()\r\n    }\r\n    else {\r\n      $el = getEl()\r\n      $current_image.insertBefore($el);\r\n\r\n      if ($el[0].querySelector('a') !== null) {\r\n        let newTag = $el[0].querySelector('a');\r\n        \r\n        var ancorTag = document.createElement(\"a\");\r\n        for (var att, i = 0, atts = newTag.attributes, n = atts.length; i < n; i++) {\r\n          att = atts[i];\r\n          ancorTag.setAttribute(att.nodeName, att.nodeValue);\r\n        }\r\n        $current_image.wrap(ancorTag);\r\n      }\r\n      \r\n      $current_image\r\n        .attr('class', $el.attr('class').replace('fr-img-caption', ''))\r\n        .attr('style', $el.attr('style'))\r\n      $el.remove()\r\n      let imgElementLength = $current_image.parents('.fr-img-space-wrap').length;\r\n      if (imgElementLength > 1) {\r\n        unwrap(document.querySelector('.fr-img-space-wrap'));\r\n        unwrap(document.querySelector('.fr-img-space-wrap2'));\r\n      }\r\n      _editImg($current_image)\r\n    }\r\n  }\r\n\r\n  //return removed second wraping div\r\n  function unwrap(wrapper) {\r\n    // place childNodes in document fragment\r\n    var docFrag = document.createDocumentFragment();\r\n    while (wrapper.firstChild) {\r\n      var child = wrapper.removeChild(wrapper.firstChild);\r\n      docFrag.appendChild(child);\r\n    }\r\n\r\n    // replace wrapper with document fragment\r\n    wrapper.parentNode.replaceChild(docFrag, wrapper);\r\n  }\r\n\r\n  return {\r\n    _init: _init,\r\n    showInsertPopup: showInsertPopup,\r\n    showLayer: showLayer,\r\n    refreshUploadButton: refreshUploadButton,\r\n    refreshByURLButton: refreshByURLButton,\r\n    upload: upload,\r\n    insertByURL: insertByURL,\r\n    align: align,\r\n    refreshAlign: refreshAlign,\r\n    refreshAlignOnShow: refreshAlignOnShow,\r\n    display: display,\r\n    refreshDisplayOnShow: refreshDisplayOnShow,\r\n    replace: replace,\r\n    back: back,\r\n    get: get,\r\n    getEl: getEl,\r\n    insert: insert,\r\n    showProgressBar: showProgressBar,\r\n    remove: remove,\r\n    hideProgressBar: hideProgressBar,\r\n    applyStyle: applyStyle,\r\n    showAltPopup: showAltPopup,\r\n    showSizePopup: showSizePopup,\r\n    setAlt: setAlt,\r\n    setSize: setSize,\r\n    toggleCaption: toggleCaption,\r\n    hasCaption: hasCaption,\r\n    exitEdit: _exitEdit,\r\n    edit: _editImg\r\n  }\r\n}\r\n\r\n// Insert image button.\r\nFE.DefineIcon('insertImage', {\r\n  NAME: 'image',\r\n  SVG_KEY: 'insertImage'\r\n})\r\nFE.RegisterShortcut(FE.KEYCODE.P, 'insertImage', null, 'P')\r\nFE.RegisterCommand('insertImage', {\r\n  title: 'Insert Image',\r\n  undo: false,\r\n  focus: true,\r\n  refreshAfterCallback: false,\r\n  popup: true,\r\n  callback: function () {\r\n    if (!this.popups.isVisible('image.insert')) {\r\n      this.image.showInsertPopup()\r\n    }\r\n    else {\r\n      if (this.$el.find('.fr-marker').length) {\r\n        this.events.disableBlur()\r\n        this.selection.restore()\r\n      }\r\n      this.popups.hide('image.insert')\r\n    }\r\n  },\r\n  plugin: 'image'\r\n})\r\n\r\n// Image upload button inside the insert image popup.\r\nFE.DefineIcon('imageUpload', {\r\n  NAME: 'upload',\r\n  SVG_KEY: 'upload'\r\n})\r\nFE.RegisterCommand('imageUpload', {\r\n  title: 'Upload Image',\r\n  undo: false,\r\n  focus: false,\r\n  toggle: true,\r\n  callback: function () {\r\n    this.image.showLayer('image-upload')\r\n  },\r\n  refresh: function ($btn) {\r\n    this.image.refreshUploadButton($btn)\r\n  }\r\n})\r\n\r\n// Image by URL button inside the insert image popup.\r\nFE.DefineIcon('imageByURL', {\r\n  NAME: 'link',\r\n  SVG_KEY: 'insertLink'\r\n})\r\nFE.RegisterCommand('imageByURL', {\r\n  title: 'By URL',\r\n  undo: false,\r\n  focus: false,\r\n  toggle: true,\r\n  callback: function () {\r\n    this.image.showLayer('image-by-url')\r\n  },\r\n  refresh: function ($btn) {\r\n    this.image.refreshByURLButton($btn)\r\n  }\r\n})\r\n\r\n// Insert image button inside the insert by URL layer.\r\nFE.RegisterCommand('imageInsertByURL', {\r\n  title: 'Insert Image',\r\n  undo: true,\r\n  refreshAfterCallback: false,\r\n  callback: function () {\r\n    this.image.insertByURL()\r\n  },\r\n  refresh: function ($btn) {\r\n    const $current_image = this.image.get()\r\n\r\n    if (!$current_image) {\r\n      $btn.text(this.language.translate('Insert'))\r\n    }\r\n    else {\r\n      $btn.text(this.language.translate('Replace'))\r\n    }\r\n  }\r\n})\r\n\r\n// Image display.\r\nFE.DefineIcon('imageDisplay', {\r\n  NAME: 'star',\r\n  SVG_KEY: 'imageDisplay'\r\n})\r\nFE.RegisterCommand('imageDisplay', {\r\n  title: 'Display',\r\n  type: 'dropdown',\r\n  options: {\r\n    inline: 'Inline',\r\n    block: 'Break Text'\r\n  },\r\n  callback: function (cmd, val) {\r\n    this.image.display(val)\r\n  },\r\n  refresh: function ($btn) {\r\n    if (!this.opts.imageTextNear) $btn.addClass('fr-hidden')\r\n  },\r\n  refreshOnShow: function ($btn, $dropdown) {\r\n    this.image.refreshDisplayOnShow($btn, $dropdown)\r\n  }\r\n})\r\n\r\n// Image align.\r\nFE.DefineIcon('image-align', {\r\n  NAME: 'align-left',\r\n  SVG_KEY: 'alignLeft'\r\n})\r\nFE.DefineIcon('image-align-left', {\r\n  NAME: 'align-left',\r\n  SVG_KEY: 'alignLeft'\r\n})\r\nFE.DefineIcon('image-align-right', {\r\n  NAME: 'align-right',\r\n  SVG_KEY: 'alignRight'\r\n})\r\nFE.DefineIcon('image-align-center', {\r\n  NAME: 'align-justify',\r\n  SVG_KEY: 'alignCenter'\r\n})\r\n\r\nFE.DefineIcon('imageAlign', {\r\n  NAME: 'align-justify',\r\n  SVG_KEY: 'alignJustify'\r\n})\r\nFE.RegisterCommand('imageAlign', {\r\n  type: 'dropdown',\r\n  title: 'Align',\r\n  options: {\r\n    left: 'Align Left',\r\n    center: 'None',\r\n    right: 'Align Right'\r\n  },\r\n  html: function () {\r\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\r\n    const { options } = FE.COMMANDS.imageAlign\r\n\r\n    for (const val in options) {\r\n      if (options.hasOwnProperty(val)) {\r\n        c += `<li role=\"presentation\"><a class=\"fr-command fr-title\" tabIndex=\"-1\" role=\"option\" data-cmd=\"imageAlign\" data-param1=\"${val}\" title=\"${this.language.translate(options[val])}\">${this.icon.create(`image-align-${val}`)}<span class=\"fr-sr-only\">${this.language.translate(options[val])}</span></a></li>`\r\n      }\r\n    }\r\n    c += '</ul>'\r\n\r\n    return c\r\n  },\r\n  callback: function (cmd, val) {\r\n    this.image.align(val)\r\n  },\r\n  refresh: function ($btn) {\r\n    this.image.refreshAlign($btn)\r\n  },\r\n  refreshOnShow: function ($btn, $dropdown) {\r\n    this.image.refreshAlignOnShow($btn, $dropdown)\r\n  }\r\n})\r\n\r\n// Image replace.\r\nFE.DefineIcon('imageReplace', {\r\n  NAME: 'exchange',\r\n  FA5NAME: 'exchange-alt',\r\n  SVG_KEY: 'replaceImage'\r\n})\r\nFE.RegisterCommand('imageReplace', {\r\n  title: 'Replace',\r\n  undo: false,\r\n  focus: false,\r\n  popup: true,\r\n  refreshAfterCallback: false,\r\n  callback: function () {\r\n    this.image.replace()\r\n  }\r\n})\r\n\r\n// Image remove.\r\nFE.DefineIcon('imageRemove', {\r\n  NAME: 'trash',\r\n  SVG_KEY: 'remove'\r\n})\r\nFE.RegisterCommand('imageRemove', {\r\n  title: 'Remove',\r\n  callback: function () {\r\n    this.image.remove()\r\n  }\r\n})\r\n\r\n// Image back.\r\nFE.DefineIcon('imageBack', {\r\n  NAME: 'arrow-left',\r\n  SVG_KEY: 'back'\r\n})\r\nFE.RegisterCommand('imageBack', {\r\n  title: 'Back',\r\n  undo: false,\r\n  focus: false,\r\n  back: true,\r\n  callback: function () {\r\n    this.image.back()\r\n  },\r\n  refresh: function ($btn) {\r\n    const { $ } = this\r\n    const $current_image = this.image.get()\r\n\r\n    if (!$current_image && !this.opts.toolbarInline) {\r\n      $btn.addClass('fr-hidden')\r\n      $btn.next('.fr-separator').addClass('fr-hidden')\r\n    }\r\n    else {\r\n      $btn.removeClass('fr-hidden')\r\n      $btn.next('.fr-separator').removeClass('fr-hidden')\r\n    }\r\n  }\r\n})\r\n\r\nFE.RegisterCommand('imageDismissError', {\r\n  title: 'OK',\r\n  undo: false,\r\n  callback: function () {\r\n    this.image.hideProgressBar(true)\r\n  }\r\n})\r\n\r\n// Image styles.\r\nFE.DefineIcon('imageStyle', {\r\n  NAME: 'magic',\r\n  SVG_KEY: 'imageClass'\r\n})\r\nFE.RegisterCommand('imageStyle', {\r\n  title: 'Style',\r\n  type: 'dropdown',\r\n  html: function () {\r\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\r\n    const options = this.opts.imageStyles\r\n\r\n    for (const cls in options) {\r\n      if (options.hasOwnProperty(cls)) {\r\n        let val = options[cls]\r\n\r\n        if (typeof val == 'object') val = val.title\r\n\r\n        c += `<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"imageStyle\" data-param1=\"${cls}\">${this.language.translate(val)}</a></li>`\r\n      }\r\n    }\r\n    c += '</ul>'\r\n\r\n    return c\r\n  },\r\n  callback: function (cmd, val) {\r\n    this.image.applyStyle(val)\r\n  },\r\n  refreshOnShow: function ($btn, $dropdown) {\r\n    const { $ } = this\r\n    const $current_image = this.image.getEl()\r\n\r\n    if ($current_image) {\r\n      $dropdown.find('.fr-command').each(function () {\r\n        const cls = $(this).data('param1')\r\n        const active = $current_image.hasClass(cls)\r\n        $(this).toggleClass('fr-active', active).attr('aria-selected', active)\r\n      })\r\n    }\r\n  }\r\n})\r\n\r\n// Image alt.\r\nFE.DefineIcon('imageAlt', {\r\n  NAME: 'info',\r\n  SVG_KEY: 'imageAltText'\r\n})\r\nFE.RegisterCommand('imageAlt', {\r\n  undo: false,\r\n  focus: false,\r\n  popup: true,\r\n  title: 'Alternative Text',\r\n  callback: function () {\r\n    this.image.showAltPopup()\r\n  }\r\n})\r\n\r\nFE.RegisterCommand('imageSetAlt', {\r\n  undo: true,\r\n  focus: false,\r\n  title: 'Update',\r\n  refreshAfterCallback: false,\r\n  callback: function () {\r\n    this.image.setAlt()\r\n  }\r\n})\r\n\r\n// Image size.\r\nFE.DefineIcon('imageSize', {\r\n  NAME: 'arrows-alt',\r\n  SVG_KEY: 'imageSize'\r\n})\r\nFE.RegisterCommand('imageSize', {\r\n  undo: false,\r\n  focus: false,\r\n  popup: true,\r\n  title: 'Change Size',\r\n  callback: function () {\r\n    this.image.showSizePopup()\r\n  }\r\n})\r\n\r\nFE.RegisterCommand('imageSetSize', {\r\n  undo: true,\r\n  focus: false,\r\n  title: 'Update',\r\n  refreshAfterCallback: false,\r\n  callback: function () {\r\n    this.image.setSize()\r\n  }\r\n})\r\n\r\nFE.DefineIcon('imageCaption', {\r\n  NAME: 'commenting',\r\n  FA5NAME: 'comment-alt',\r\n  SVG_KEY: 'imageCaption'\r\n})\r\n\r\nFE.RegisterCommand('imageCaption', {\r\n  undo: true,\r\n  focus: false,\r\n  title: 'Image Caption',\r\n  refreshAfterCallback: true,\r\n  callback: function () {\r\n    this.image.toggleCaption();\r\n  },\r\n  refresh: function ($btn) {\r\n    if (this.image.get()) {\r\n      $btn.toggleClass('fr-active', this.image.hasCaption())\r\n    }\r\n  }\r\n})\r\n"],"names":["Object","assign","FE","POPUP_TEMPLATES","DEFAULTS","imageInsertButtons","imageEditButtons","imageAltButtons","imageSizeButtons","imageUpload","imageUploadURL","imageCORSProxy","imageUploadRemoteUrls","imageUploadParam","imageUploadParams","imageUploadToS3","imageUploadToAzure","imageUploadMethod","imageMaxSize","imageAllowedTypes","imageResize","imageResizeWithPercent","imageRoundPercent","imageDefaultWidth","imageDefaultAlign","imageDefaultDisplay","imageSplitHTML","imageStyles","imageMove","imageMultipleStyles","imageTextNear","imagePaste","imagePasteProcess","imageMinWidth","imageOutputSize","imageDefaultMargin","imageAddNewLine","PLUGINS","image","editor","$","DEFAULT_IMAGE_UPLOAD_URL","$current_image","$image_resizer","$handler","$overlay","mousedown","BAD_LINK","MISSING_LINK","ERROR_DURING_UPLOAD","BAD_RESPONSE","MAX_SIZE_EXCEEDED","BAD_FILE_TYPE","NO_CORS_IE","CORRUPTED_IMAGE","error_messages","_refreshInsertPopup","$popup","popups","get","$url_input","find","val","attr","trigger","showInsertPopup","$btn","$tb","_initInsertPopup","hideProgressBar","hasClass","refresh","setContainer","isVisible","button","getPosition","left","top","show","outerHeight","position","forSelection","_showEditPopup","_initEditPopup","$el","getEl","hasCaption","$sc","offset","outerWidth","showProgressBar","_hideInsertPopup","_convertStyleToClasses","$img","parents","length","first","addClass","getAlign","getDisplay","css","_convertClassesToStyle","d","a","_setStyle","removeClass","_refreshImageList","images","el","tagName","querySelectorAll","i","opts","htmlUntouched","useClasses","iframe","on","size","syncIframe","_syncImages","loaded","c_images","Array","prototype","slice","call","image_srcs","push","getAttribute","toggleClass","removeAttribute","parentNode","node","p_node","browser","mozilla","setAttribute","classList","add","n_node","nextSibling","indexOf","events","old_images_srcs","_repositionResizer","_initImageResizer","$container","$wp","append","data","wrap_correction_top","scrollTop","wrap_correction_left","scrollLeft","helpers","getPX","is","iframePaddingTop","iframePaddingLeft","getBoundingClientRect","width","height","_getHandler","pos","_setWidth","_handlerMousedown","e","core","sameInstance","preventDefault","stopPropagation","undo","canDo","saveStep","start_x","pageX","originalEvent","touches","type","oel","$oel","doc","ownerDocument","win","defaultView","parentWindow","editor_inside_iframe","location","parent","ex","frameElement","clientLeft","parentsUntil","html","blockTagsQuery","toFixed","hideAll","_unmarkExit","_handlerMousemove","real_image_size","c_x","s_x","diff_x","Math","round","removeAttr","match","_handlerMouseup","hide","_throwError","code","response","edit","_showErrorMessage","language","translate","remove","message","delayed","$on","disableBlur","image_buttons","buildList","template","buttons","create","no_message","_setProgressMessage","dismiss","focus","run","dropRedo","_exitEdit","selection","setAfter","restore","progress","$layer","text","$message_header","insertByURL","$input","img_url","trim","xhr","XMLHttpRequest","onload","status","upload","Blob","onerror","insert","open","responseType","send","blur","_editImg","_edit","_loadedCallback","next","link","sanitize","$existing_img","off","sanitizeURL","Image","old_src","clone","removeData","replaceWith","atts","attributes","att","nodeName","hasOwnProperty","_addImage","src","_parseResponse","resp","JSON","parse","_parseXMLResponse","key","_imageUploaded","url","responseXML","responseText","responseURL","_imageUploadError","_imageUploadProgress","lengthComputable","complete","total","loadCallback","data_str","document","createElement","markers","split","wrap","$marker","after","isLastSibling","insertAfter","clear","_imageUploadAborted","_startUpload","form_data","$image_placeholder","_sendRequest","placeholder","onprogress","onabort","readyState","abort","reader","FileReader","result","binary","atob","array","charCodeAt","window","URL","createObjectURL","Uint8Array","readAsDataURL","_browserUpload","name","Date","getTime","replace","drag_support","formdata","FormData","keyStart","params","imageURL","azureKey","uploadURL","region","bucket","encodeURI","account","container","SASToken","getXHR","uploadDate","toUTCString","accessKey","azureAccount","azureContainer","urls","pop","headerResource","urlResource","stringToSign","signatureBytes","cryptoJSPlugin","cryptoJS","HmacSHA256","enc","Base64","signature","toString","authHeader","setRequestHeader","_bindInsertEvents","msie","edge","dt","dataTransfer","files","inst","enableBlur","isIOS","_beforeElementDrop","_drop","img","insertAtPoint","MARKERS","setAtEnd","pageY","$iframe","_initEvents","_mousedown","not","isMobile","areVisible","draggable","hasFocus","toolbar","_mouseup","shiftKey","keys","isArrow","which","s_el","element","e_el","endElement","_markExit","_selectImage","getSelection","lastNode","isElement","enter","ENTER_BR","$parent","blockParent","defaultTag","onRefresh","onHide","active","splice","buttonList","uploadIndex","urlIndex","upload_layer","id","join","toLowerCase","by_url_layer","progress_bar_layer","progress_bar","_refreshAltPopup","showAltPopup","_initAltPopup","alt_layer","setAlt","alt","_refreshSizePopup","$popup_height_val","style","$popup_width_val","showSizePopup","_initSizePopup","size_layer","setSize","regex","showLayer","toolbarInline","toolbarBottom","accessibility","focusPopup","refreshUploadButton","refreshByURLButton","_resizeImage","initPageX","direction","step","floor","pow","shared","$img_overlay","o_win","_mousemove","prevKey","prevTimestamp","ctrlKey","navigator","userAgent","metaKey","keycode","timeStamp","KEYCODE","EQUALS","FF_EQUALS","altKey","HYPHEN","FF_HYPHEN","ENTER","before","setBefore","fillEmptyBlocks","_editorKeydownHandler","key_code","BACKSPACE","DELETE","ESC","ARROW_LEFT","ARROW_RIGHT","TAB","F10","isBrowserAction","_cleanOnGet","removeChild","nodeType","Node","ELEMENT_NODE","imgs","_init","isWindowsPhone","touchScroll","TEXT_NODE","INVISIBLE_SPACE","$win","START_MARKER","END_MARKER","paste","saveCopiedText","outerHTML","setTimeout","isCollapsed","C","X","_clipboardPaste","_clipboardPasteCleanup","_uploadPastedImages","$node","_processPastedImage","loadEvents","event","splitSrc","upload_img","each","index","_img","crossOrigin","canvas","o_doc","context","getContext","naturalHeight","naturalWidth","drawImage","imgExt","toDataURL","save","_clipboardImageLoaded","target","_processsClipboardPaste","file","clipboardData","items","types","getData","getAsFile","clipboard_html","isDisabled","INSTANCES","disable","removeAllRanges","addRange","createRange","bulkRefresh","force_exit","_canExit","enable","img_exit_flag","_display","_align","display","verticalAlign","margin","marginBottom","marginTop","maxWidth","textAlign","marginLeft","marginRight","align","flt","parseInt","refreshAlign","icon","refreshAlignOnShow","$dropdown","refreshDisplayOnShow","range","selectNode","collapse","back","showInline","applyStyle","multipleStyles","styles","toggleCaption","$listParent","totLi","$currLi","$newLi","innerHTML","splitAttrs","oldWidth","current_width","imgLengthCaption","unwrap","querySelector","insertBefore","newTag","ancorTag","n","nodeValue","imgElementLength","wrapper","docFrag","createDocumentFragment","firstChild","child","appendChild","replaceChild","exitEdit","DefineIcon","NAME","SVG_KEY","RegisterShortcut","P","RegisterCommand","title","refreshAfterCallback","popup","callback","plugin","toggle","options","inline","block","cmd","refreshOnShow","center","right","c","COMMANDS","imageAlign","FA5NAME","cls"],"mappings":"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"}