/*!
 * froala_editor v3.2.6 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2021 Froala Labs
 */

{"version":3,"file":"word_paste.js","sources":["../../../src/js/plugins/word_paste.js"],"sourcesContent":["import FE from '../index.js'\r\n\r\nObject.assign(FE.DEFAULTS, {\r\n  wordDeniedTags: [],\r\n  wordDeniedAttrs: [],\r\n  wordAllowedStyleProps: ['font-family', 'font-size', 'background', 'color', 'width', 'text-align', 'vertical-align', 'background-color', 'padding', 'margin', 'height', 'margin-top', 'margin-left', 'margin-right', 'margin-bottom', 'text-decoration', 'font-weight', 'font-style', 'text-indent', 'border', 'border-.*', 'line-height', 'list-style-type'],\r\n  wordPasteModal: true,\r\n  wordPasteKeepFormatting: true\r\n})\r\n\r\nFE.PLUGINS.wordPaste = function (editor) {\r\n  const $ = editor.$\r\n\r\n  let $modal\r\n  const modal_id = 'word_paste'\r\n  let clipboard_html\r\n  const _v_shapes_map = {}\r\n\r\n  /*\r\n   * Init Word Paste.\r\n   */\r\n  function _init() {\r\n    editor.events.on('paste.wordPaste', function (html) {\r\n      clipboard_html = html\r\n\r\n      if (editor.opts.wordPasteModal) {\r\n        _showModal()\r\n      }\r\n      else {\r\n        clean(editor.opts.wordPasteKeepFormatting)\r\n      }\r\n\r\n      return false\r\n    })\r\n  }\r\n\r\n  /*\r\n   * Build html body.\r\n   */\r\n  function _buildModalBody() {\r\n\r\n    // Begin body.\r\n    let body = '<div class=\"fr-word-paste-modal\" style=\"padding: 20px 20px 10px 20px;\">'\r\n    body += '<p style=\"text-align: left;\">' + editor.language.translate('The pasted content is coming from a Microsoft Word document. Do you want to keep the format or clean it up?') + '</p>'\r\n    body += '<div style=\"text-align: right; margin-top: 50px;\"><button class=\"fr-remove-word fr-command\">' + editor.language.translate('Clean') + '</button> <button class=\"fr-keep-word fr-command\">' + editor.language.translate('Keep') + '</button></div>'\r\n\r\n    // End body.\r\n    body += '</div>'\r\n\r\n    return body\r\n  }\r\n\r\n  /*\r\n   * Show modal.\r\n   */\r\n  function _showModal() {\r\n    if (!$modal) {\r\n      const head = '<h4><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 74.95 73.23\" style=\"height: 25px; vertical-align: text-bottom; margin-right: 5px; display: inline-block\"><defs><style>.a{fill:#2a5699;}.b{fill:#fff;}</style></defs><path class=\"a\" d=\"M615.15,827.22h5.09V834c9.11.05,18.21-.09,27.32.05a2.93,2.93,0,0,1,3.29,3.25c.14,16.77,0,33.56.09,50.33-.09,1.72.17,3.63-.83,5.15-1.24.89-2.85.78-4.3.84-8.52,0-17,0-25.56,0v6.81h-5.32c-13-2.37-26-4.54-38.94-6.81q0-29.8,0-59.59c13.05-2.28,26.11-4.5,39.17-6.83Z\" transform=\"translate(-575.97 -827.22)\"/><path class=\"b\" d=\"M620.24,836.59h28.1v54.49h-28.1v-6.81h22.14v-3.41H620.24v-4.26h22.14V873.2H620.24v-4.26h22.14v-3.41H620.24v-4.26h22.14v-3.41H620.24v-4.26h22.14v-3.41H620.24V846h22.14v-3.41H620.24Zm-26.67,15c1.62-.09,3.24-.16,4.85-.25,1.13,5.75,2.29,11.49,3.52,17.21,1-5.91,2-11.8,3.06-17.7,1.7-.06,3.41-.15,5.1-.26-1.92,8.25-3.61,16.57-5.71,24.77-1.42.74-3.55,0-5.24.09-1.13-5.64-2.45-11.24-3.47-16.9-1,5.5-2.29,10.95-3.43,16.42q-2.45-.13-4.92-.3c-1.41-7.49-3.07-14.93-4.39-22.44l4.38-.18c.88,5.42,1.87,10.82,2.64,16.25,1.2-5.57,2.43-11.14,3.62-16.71Z\" transform=\"translate(-575.97 -827.22)\"/></svg> ' + editor.language.translate('Word Paste Detected') + '</h4>'\r\n      const body = _buildModalBody()\r\n\r\n      const modalHash = editor.modals.create(modal_id, head, body)\r\n\r\n      const $body = modalHash.$body\r\n      $modal = modalHash.$modal\r\n\r\n      modalHash.$modal.addClass('fr-middle')\r\n\r\n      editor.events.bindClick($body, 'button.fr-remove-word', function () {\r\n        const inst = $modal.data('instance') || editor\r\n        inst.wordPaste.clean()\r\n      })\r\n\r\n      editor.events.bindClick($body, 'button.fr-keep-word', function () {\r\n        const inst = $modal.data('instance') || editor\r\n\r\n        inst.wordPaste.clean(true)\r\n      })\r\n\r\n      // Resize help modal on window resize.\r\n      editor.events.$on($(editor.o_win), 'resize', function () {\r\n        editor.modals.resize(modal_id)\r\n      })\r\n    }\r\n\r\n    // Show modal.\r\n    editor.modals.show(modal_id)\r\n\r\n    // Modal may not fit window size.\r\n    editor.modals.resize(modal_id)\r\n  }\r\n\r\n  /*\r\n   * Hide modal.\r\n   */\r\n  function _hideModal() {\r\n    editor.modals.hide(modal_id)\r\n  }\r\n\r\n  /*\r\n   * Word paste cleanup.\r\n   */\r\n  function clean(keep_formatting) {\r\n    const wordAllowedStylePropsBackup = editor.opts.wordAllowedStyleProps\r\n\r\n    if (!keep_formatting) {\r\n      editor.opts.wordAllowedStyleProps = []\r\n    }\r\n\r\n    // Firefox paste.\r\n    if (clipboard_html.indexOf('<colgroup>') === 0) {\r\n      clipboard_html = '<table>' + clipboard_html + '</table>'\r\n    }\r\n\r\n    // Replace spaces.\r\n    clipboard_html = clipboard_html.replace(/<span[\\n\\r ]*style='mso-spacerun:yes'>([\\r\\n\\u00a0 ]*)<\\/span>/g, function (str, match) {\r\n      let spaces = ''\r\n      let i = 0\r\n\r\n      while (i++ < match.length) {\r\n        spaces += '&nbsp;'\r\n      }\r\n\r\n      return spaces\r\n    })\r\n\r\n    \r\n    clipboard_html = _wordClean(clipboard_html, editor.paste.getRtfClipboard())\r\n    \r\n   \r\n\r\n    // Remove unwanted spaces.\r\n    const div = editor.doc.createElement('DIV')\r\n    div.innerHTML = clipboard_html\r\n    editor.html.cleanBlankSpaces(div)\r\n    clipboard_html = div.innerHTML\r\n\r\n    clipboard_html = editor.paste.cleanEmptyTagsAndDivs(clipboard_html)\r\n\r\n    // Remove invisible space.\r\n    clipboard_html = clipboard_html.replace(/\\u200b/g, '')\r\n\r\n    _hideModal()\r\n\r\n    // Clean the processed clipboard_html.\r\n    editor.paste.clean(clipboard_html, true, true)\r\n\r\n    editor.opts.wordAllowedStyleProps = wordAllowedStylePropsBackup\r\n  }\r\n\r\n  /**\r\n   * Remove a node. IE conpatible.\r\n   */\r\n  function _removeNode(node) {\r\n\r\n    const parent = node.parentNode\r\n\r\n    if (!parent) {\r\n\r\n      return\r\n    }\r\n\r\n    node.parentNode.removeChild(node)\r\n  }\r\n\r\n  /*\r\n   * Depth-first search traversing of the DOM.\r\n   */\r\n  function _traverse(node, callback) {\r\n\r\n    // Process node.\r\n    if (!callback(node)) {\r\n\r\n      return\r\n    }\r\n\r\n    // Expand node. Take its first child.\r\n    let child = node.firstChild\r\n\r\n    // While all childs are traversed.\r\n    while (child) {\r\n\r\n      // Store the current child.\r\n      const current_child = child\r\n\r\n      // Store the previous child.\r\n      const previous_child = child.previousSibling\r\n\r\n      // Take next child.\r\n      child = child.nextSibling\r\n\r\n      // Expand the current child.\r\n      _traverse(current_child, callback)\r\n\r\n\r\n      // An unwrap was made. Need to calculate again the next child.\r\n      if ((!current_child.previousSibling && !current_child.nextSibling && !current_child.parentNode) && child && (previous_child !== child.previousSibling) && child.parentNode) {\r\n        if (previous_child) {\r\n          child = previous_child.nextSibling\r\n        }\r\n        else {\r\n          child = node.firstChild\r\n        }\r\n      }\r\n\r\n      // A list was created. Need to calculate again the next child.\r\n      else if ((!current_child.previousSibling && !current_child.nextSibling && !current_child.parentNode) && child && (!child.previousSibling && !child.nextSibling && !child.parentNode)) {\r\n        if (previous_child) {\r\n          if (previous_child.nextSibling) {\r\n            child = previous_child.nextSibling.nextSibling\r\n          }\r\n          else {\r\n            child = null\r\n          }\r\n        }\r\n        else {\r\n          if (node.firstChild) {\r\n            child = node.firstChild.nextSibling\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Check if a node is a list. TODO: use Regex.\r\n   */\r\n  function _isList(node) {\r\n    // Check if it has mso-list:l in its style attribute.\r\n    if (!(node.getAttribute('style') && /mso-list:[\\s]*l/gi.test(node.getAttribute('style').replace(/\\n/gi, '')))) {\r\n\r\n      return false\r\n    }\r\n\r\n    // Using try-catch to skip undefined checking.\r\n    try {\r\n      // Check mso-list.\r\n      if (!node.querySelector('[style=\"mso-list:Ignore\"]')) {\r\n        if (node.outerHTML && node.outerHTML.indexOf('<!--[if !supportLists]-->') >= 0) {\r\n          return true;\r\n        }\r\n        return false\r\n      }\r\n    }\r\n    catch (e) {\r\n\r\n      return false\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  /*\r\n   * Get list level based on level attribute from node style.\r\n   */\r\n  function _getListLevel(node) {\r\n\r\n    return node.getAttribute('style').replace(/\\n/gi, '').replace(/.*level([0-9]+?).*/gi, '$1')\r\n  }\r\n\r\n  /*\r\n   * Get list content.\r\n   */\r\n  function _getListContent(node, head_style_hash) {\r\n\r\n    const cloned_node = node.cloneNode(true)\r\n\r\n    // Some lists might be wrapped in a link. So we need to unwrap.\r\n    // if (cloned_node.firstElementChild && cloned_node.firstElementChild.tagName === 'A') {\r\n    //   cloned_node = cloned_node.firstElementChild\r\n    // }\r\n\r\n    // Heading list.\r\n    if (['H1', 'H2', 'H3', 'H4', 'H5', 'H6'].indexOf(node.tagName) !== -1) {\r\n      const heading = document.createElement(node.tagName.toLowerCase())\r\n      heading.setAttribute('style', node.getAttribute('style'))\r\n      heading.innerHTML = cloned_node.innerHTML\r\n      cloned_node.innerHTML = heading.outerHTML\r\n    }\r\n\r\n    // Clean node recursively.\r\n    _traverse(cloned_node, function (node) {\r\n      if (node.nodeType == Node.COMMENT_NODE && (editor.browser.msie || editor.browser.safari || editor.browser.edge)) {\r\n        try {\r\n          if (node.data === '[if !supportLists]') {\r\n            node = node.nextSibling;\r\n\r\n            while (node && node.nodeType !== Node.COMMENT_NODE) {\r\n              var tmp = node.nextSibling;\r\n              node.parentNode.removeChild(node);\r\n              node = tmp;\r\n            }\r\n\r\n            if (node && node.nodeType == Node.COMMENT_NODE) {\r\n              node.parentNode.removeChild(node);\r\n            }\r\n          }\r\n        }\r\n        catch (ex) {\r\n\r\n        }\r\n      }\r\n      \r\n      if (node.nodeType === Node.ELEMENT_NODE) {\r\n\r\n        // Skip the first child which is an mso-list:Ignore node.\r\n\r\n        // 1854 For handling extra characters \r\n        if (node.getAttribute('style') === 'mso-list:\\nIgnore')\r\n          node.setAttribute(\"style\",\"mso-list:Ignore\")\r\n\r\n        if (node.getAttribute('style') === 'mso-list:Ignore') {\r\n          node.parentNode.removeChild(node)\r\n        }\r\n        node.setAttribute('style', _getAllowedListStyles(node));\r\n        _cleanElement(node, head_style_hash)\r\n      }\r\n\r\n      return true\r\n    })\r\n\r\n    // Take content.\r\n    let content = cloned_node.innerHTML\r\n\r\n    // Replace comments.\r\n    content = content.replace(/<!--[\\s\\S]*?-->/gi, '')\r\n\r\n    return content\r\n  }\r\n\r\n  /*\r\n   * Build ol/ul list.\r\n   */\r\n  function _buildList(node, head_style_hash, level,prev_margin) {\r\n\r\n    // Check ol/ul.\r\n    \r\n    const order_regex = /[0-9a-zA-Z]./gi\r\n    let is_ordered = false\r\n    let prev_order;\r\n    let previous_element_sibling\r\n\r\n    let browser = navigator.userAgent.toLowerCase();\r\n    \r\n    if (browser.indexOf('safari') != -1) { \r\n      if (browser.indexOf('chrome') > -1) {\r\n        browser = 1 // Chrome\r\n      } \r\n      else {\r\n        browser = 'safari' // Safari\r\n      }\r\n    }\r\n    \r\n    if(node.innerHTML.includes('mso-list:\\nIgnore'))\r\n    {\r\n      node.innerHTML=node.innerHTML.replace(/mso-list:\\nIgnore/gi,'mso-list:Ignore')\r\n    }\r\n    \r\n    let list_type_node = node.querySelector('span[style=\"mso-list:Ignore\"]');\r\n    \r\n    //this is added to check the browser is safari as we are not getting html same as chrome\r\n    if(list_type_node == null && browser == 'safari'){\r\n      list_type_node = node.querySelector('span[lang=\"PT-BR\"]');\r\n    }\r\n    \r\n    let contents;\r\n    let listObj;\r\n    let list_tag;\r\n    let listStyle;\r\n    let startIndexUpperAlpha= 64;\r\n    let startIndexLowerAlpha=96;\r\n\r\n    // Checking the list is ordered or unordered\r\n \r\n    if (list_type_node) {\r\n      is_ordered = is_ordered || order_regex.test(list_type_node.textContent);\r\n    }\r\n    \r\n    let listType\r\n    if(list_type_node!== null)\r\n      listType = list_type_node.textContent.trim().split('.')[0];\r\n\r\n    // Get the list type\r\n    // const list_tag = is_ordered ? 'ol' : 'ul'\r\n    if (is_ordered == true) {\r\n      listType = list_type_node.textContent.trim().split('.')[0];\r\n\r\n      if (listType == '1') {\r\n        listStyle = 'decimal;'\r\n      }\r\n      else if (listType == 'i') {\r\n        listStyle = 'lower-roman;'\r\n      }\r\n      else if (listType == 'I') {\r\n        listStyle = 'upper-roman;'\r\n      }\r\n      else if (listType == 'o') {\r\n        listStyle = 'circle;'\r\n      }\r\n      //https://github.com/froala-labs/froala-editor-js-2/issues/1887\r\n      // to check the bullet lists\r\n      else if(!listType.match(/^v$/)) {\r\n        if(listType.match(/^[a-z]$/) || listType.match(/^[a-z]\\)$/)){\r\n          listStyle = 'lower-alpha;'\r\n        }\r\n        else if(listType.match(/^[A-Z]$/) || listType.match(/^[A-Z]\\)$/)){\r\n          listStyle = 'upper-alpha;'\r\n        }\r\n      }\r\n\r\n      listStyle = 'list-style-type: ' + listStyle;\r\n      list_tag = 'ol'\r\n    }\r\n    else {\r\n      if(list_type_node!=null)\r\n        listType = list_type_node.textContent.trim().split('.')[0];\r\n\r\n      if(listType=='§')\r\n      {\r\n        listStyle='square;'\r\n      }\r\n      else if(listType== \"·\")\r\n      {\r\n        listStyle='disc;'\r\n      }\r\n\r\n      listStyle = 'list-style-type: ' + listStyle;\r\n      list_tag = 'ul';\r\n    }\r\n\r\n    // creating new list\r\n    let classType = ''\r\n    // https://github.com/froala-labs/froala-editor-js-2/issues/1860\r\n    if(list_type_node != undefined && list_type_node.textContent != undefined && !isNaN(parseInt(list_type_node.textContent.trim().split('.')[1], 10))){\r\n      classType = ' class=\"decimal_type\" '\r\n    }\r\n    let s \r\n\r\n    // https://github.com/froala-labs/froala-editor-js-2/issues/1887\r\n    const next_level = _getListLevel(node);\r\n    let margin = node.style.marginLeft\r\n    let size\r\n    if(margin.includes('in')){\r\n      size = 'in'\r\n      margin = parseFloat(margin) - 0.5\r\n    }\r\n    else if(margin.includes('pt')){\r\n      size = 'px'\r\n      margin = parseFloat(margin) - 10\r\n    }\r\n\r\n    if(next_level==1){\r\n\r\n      s = listStyle ? '<' + list_tag + ' style = \"' + listStyle +'; margin-left:'+ margin+ size + ';\">' : '<' + list_tag  +' style=\"margin-left:'+margin+size+';\"'+ '>';\r\n\r\n      // https://github.com/froala-labs/froala-editor-js-2/issues/1887\r\n      if(listStyle == 'list-style-type: upper-alpha;'){\r\n        let index= listType.charCodeAt(0) - startIndexUpperAlpha;\r\n        s = listStyle ? '<' + list_tag + classType +' start=\"'+index+'\"' + ' style = \"' + listStyle +' margin-left:'+ margin+ size + ';\">' : '<' + list_tag  + '>';\r\n      }\r\n      else if(listStyle == 'list-style-type: lower-alpha;'){  \r\n        let index= listType.charCodeAt(0) - startIndexLowerAlpha;\r\n        s = listStyle ? '<' + list_tag +  classType+' start=\"'+index+'\"' + ' style = \"' + listStyle +'margin-left:'+ margin+ size + ';\">' : '<' + list_tag  + '>'; \r\n      }\r\n      else{\r\n        s = listStyle ? '<' + list_tag +  classType + ' style = \"' + listStyle +';margin-left:'+ margin+ size + ';\">' : '<' + list_tag  +' style=\"margin-left:'+margin+size+';\"'+ '>';\r\n      }\r\n    }\r\n    else{\r\n      // https://github.com/froala-labs/froala-editor-js-2/issues/1887\r\n      if(listStyle == 'list-style-type: upper-alpha;'){\r\n        let index= listType.charCodeAt(0) - startIndexUpperAlpha;\r\n        s = listStyle ? '<' + list_tag + classType + ' style = \"' + listStyle + ' start=\"'+index+'\">' : '<' + list_tag  + '>';\r\n      }\r\n      else if(listStyle == 'list-style-type: lower-alpha;'){  \r\n        let index= listType.charCodeAt(0) - startIndexLowerAlpha;\r\n        s = listStyle ? '<' + list_tag +  classType + ' style = \"' + listStyle + ' start=\"'+index+'\">' : '<' + list_tag  + '>'; \r\n      }\r\n      else{\r\n        s = listStyle ? '<' + list_tag +  classType + ' style = \"' + listStyle + '\">' : '<' + list_tag  + '>';\r\n      }\r\n    }\r\n\r\n    let tagClosedFlag = false\r\n    while (node) {\r\n      // Stop at first sibling that is not a list.\r\n      if (!_isList(node)) {\r\n\r\n        // Skip bookmarks.\r\n        if (node.outerHTML && node.outerHTML.indexOf('mso-bookmark') > 0 && (node.textContent || '').length == 0) {\r\n          node = node.nextElementSibling;\r\n          continue\r\n        }\r\n\r\n        break\r\n      }\r\n\r\n      // getting level of next node\r\n      const next_level = _getListLevel(node);\r\n\r\n      // Set the level if it's the first level or use the same\r\n      level = level || next_level;\r\n\r\n      // Create new list if next node level is greater than current one\r\n      if (next_level > level) {\r\n        listObj = _buildList(node, head_style_hash, next_level, node.style.marginLeft);\r\n        s += listObj.el.outerHTML;\r\n\r\n        // Getting the subsequent node after creating new list\r\n        node = listObj.currentNode;\r\n        // Need to start over to check if next node might be on same level\r\n        continue;\r\n      }\r\n      else if (next_level < level) {\r\n        // Lower level found. Current list is done.\r\n        break\r\n      }\r\n      else {\r\n\r\n        // Checked list tag if levels are same.(https://github.com/froala/wysiwyg-editor/issues/3088)\r\n        // Checking the order of next element.\r\n        if (node.firstElementChild && node.firstElementChild.firstElementChild && node.firstElementChild.firstElementChild.firstChild) {\r\n          order_regex.lastIndex = 0\r\n        }\r\n\r\n        // Checking the order of current element.\r\n        if (previous_element_sibling && previous_element_sibling.firstElementChild && previous_element_sibling.firstElementChild.firstElementChild && previous_element_sibling.firstElementChild.firstElementChild.firstChild) {\r\n          order_regex.lastIndex = 0\r\n          prev_order = order_regex.test(previous_element_sibling.firstElementChild.firstElementChild.firstChild.data || (previous_element_sibling.firstElementChild.firstElementChild.firstChild.firstChild && previous_element_sibling.firstElementChild.firstElementChild.firstChild.firstChild.data) || '')\r\n        }\r\n        // If levels are same,we are comparing the order of the next element.\r\n        // If the order is same it will append the element in existing list else will create a new list.\r\n\r\n        // https://github.com/froala-labs/froala-editor-js-2/issues/1861\r\n        // Added condition for ul and ol lists to differentiate the behavior of the list with different type of lists.\r\n        let isMarginEqual = false\r\n        if(!prev_margin && !node.style.marginLeft || (prev_margin && node.style.marginLeft && prev_margin === node.style.marginLeft)){\r\n          isMarginEqual = true\r\n        }\r\n        prev_margin = node.style.marginLeft\r\n\r\n        if (isMarginEqual || prev_order === undefined) {\r\n          contents = _getListContent(node, head_style_hash)\r\n          // https://github.com/froala-labs/froala-editor-js-2/issues/1860\r\n          if(node.nextSibling.innerText != undefined && node.nextSibling.innerText != undefined && !s.includes('class=\"decimal_type\"')){\r\n            if(!isNaN(parseInt(node.nextSibling.innerText.trim().split('.')[1], 10))){\r\n              s = s.substring(3, 0) + ' class=\"decimal_type\"' + s.substring(3, s.length)\r\n            }\r\n          }\r\n\r\n          s += '<li>' + contents + '</li>'\r\n        }\r\n        else {\r\n          // https://github.com/froala-labs/froala-editor-js-2/issues/1861\r\n          if(next_level==1){\r\n            s += '</' + list_tag + '>'\r\n            tagClosedFlag =true\r\n            previous_element_sibling = null\r\n          }\r\n          listObj = _buildList(node, head_style_hash, next_level,node.style.marginLeft)\r\n          s += listObj.el.outerHTML\r\n          node = listObj.currentNode\r\n        }\r\n      }\r\n\r\n      // Storing the next sibling in temporary variable\r\n      let tmp = node && node.nextElementSibling;\r\n\r\n      // Check if node is there get the previous element sibling\r\n      if (tmp) {\r\n        previous_element_sibling = tmp.previousElementSibling\r\n      }\r\n\r\n      // https://github.com/froala-labs/froala-editor-js-2/issues/1854\r\n      if (node && !_isList(node)) {\r\n        // Skip bookmarks.\r\n        if (node.outerHTML && node.outerHTML.indexOf('mso-bookmark') > 0 && (node.textContent || '').length == 0) {\r\n          node = node.nextElementSibling;\r\n          continue\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      // Remove the used node\r\n      node && node.parentNode && node.parentNode.removeChild(node)\r\n\r\n      // Restore the next sibling to node\r\n      node = tmp\r\n\r\n    }\r\n\r\n    // Finish list\r\n    // https://github.com/froala-labs/froala-editor-js-2/issues/1861\r\n    if(!tagClosedFlag)\r\n      s += '</' + list_tag + '>'\r\n\r\n    // Convert string to node element.\r\n    const div = document.createElement('div')\r\n    div.innerHTML = s\r\n    const element = div\r\n\r\n    // Returning list element and current node\r\n    return {\r\n      el: element,\r\n      currentNode: node\r\n    }\r\n  }\r\n\r\n  function _getAllowedListStyles(node) {\r\n    let styles = ''\r\n    let allowedStyles = ['line-height', 'font-family', 'font-size', 'color', 'background']\r\n    let parentStyles = node.getAttribute('style')\r\n\r\n    if (parentStyles) {\r\n      allowedStyles.forEach(function (style) {\r\n        //https://github.com/froala-labs/froala-editor-js-2/issues/1852\r\n        let foundVal = parentStyles.match(new RegExp(style + ':.*(;|)'))\r\n\r\n        if (foundVal) {\r\n          styles += foundVal[0] + ';'\r\n        }\r\n      })\r\n    }\r\n\r\n    return styles\r\n\r\n  }\r\n\r\n  /*\r\n   * Change tag name of an element.\r\n   */\r\n  function _changeTagName(old_node, tag_name) {\r\n\r\n    const new_node = document.createElement(tag_name)\r\n\r\n    for (let i = 0; i < old_node.attributes.length; i++) {\r\n      const attribute = old_node.attributes[i].name\r\n      new_node.setAttribute(attribute, old_node.getAttribute(attribute))\r\n    }\r\n\r\n    new_node.innerHTML = old_node.innerHTML\r\n\r\n    old_node.parentNode.replaceChild(new_node, old_node)\r\n\r\n    return new_node\r\n  }\r\n\r\n  /*\r\n   * Clean tr element.\r\n   */\r\n  function _cleanTr(tr, head_style_hash) {\r\n\r\n    // Clean tr attributes.\r\n    editor.node.clearAttributes(tr)\r\n\r\n    // Get first child.\r\n    let child = tr.firstElementChild\r\n\r\n    // Total table width.\r\n    let total_width = 0\r\n\r\n    // Tell if at least one child has a missing width.\r\n    let missing_width = false\r\n\r\n    // Width attribute.\r\n    let width_attr = null\r\n\r\n    // Clean td childs and calculate total table width.\r\n    while (child) {\r\n\r\n      // Cleanup w: tags.\r\n      if (child.firstElementChild && child.firstElementChild.tagName.indexOf('W:') !== -1) {\r\n        child.innerHTML = child.firstElementChild.innerHTML\r\n      }\r\n\r\n      // Add width to total.\r\n      width_attr = child.getAttribute('width')\r\n\r\n      if (!width_attr && !missing_width) {\r\n        missing_width = true\r\n      }\r\n      total_width += parseInt(width_attr, 10)\r\n\r\n      // Replace to <br> childs that are empty or &nbsp.\r\n      if (!child.firstChild || (child.firstChild && child.firstChild.data === FE.UNICODE_NBSP)) {\r\n        if (child.firstChild) {\r\n          _removeNode(child.firstChild)\r\n        }\r\n        child.innerHTML = '<br>'\r\n      }\r\n\r\n      let td_child = child.firstElementChild\r\n\r\n      // If child has more than one children, it means that every child has its own alignment.\r\n      const has_single_child = child.children.length === 1\r\n\r\n      // Change p to span or div and clean alignment on every element child.\r\n      while (td_child) {\r\n\r\n        if (td_child.tagName === 'P' && !_isList(td_child)) {\r\n          // Set alignment to td parent.\r\n          if (has_single_child) {\r\n            _cleanAlignment(td_child)\r\n          }\r\n        }\r\n\r\n        // Move to next element sibling.\r\n        td_child = td_child.nextElementSibling\r\n      }\r\n\r\n      // Add styles from head.\r\n      if (head_style_hash) {\r\n\r\n        // Style from .xl classes.\r\n        // Get class from child.\r\n        let class_attr = child.getAttribute('class')\r\n\r\n        if (class_attr) {\r\n          class_attr = _normalizeAttribute(class_attr)\r\n\r\n          // Match xl class.\r\n          const class_matches = class_attr.match(/xl[0-9]+/gi)\r\n\r\n          if (class_matches) {\r\n            const xl_class = class_matches[0]\r\n            const dot_xl_class = '.' + xl_class\r\n\r\n            if (head_style_hash[dot_xl_class]) {\r\n              _appendStyle(child, head_style_hash[dot_xl_class])\r\n            }\r\n          }\r\n        }\r\n\r\n        // Style from td.\r\n        if (head_style_hash.td) {\r\n          _appendStyle(child, head_style_hash.td)\r\n        }\r\n      }\r\n\r\n      let style = child.getAttribute('style')\r\n\r\n      if (style) {\r\n        style = _normalizeAttribute(style)\r\n\r\n        // Add semicolon, if it is missing, to the end of current style.\r\n        if (style && style.slice(-1) !== ';') {\r\n          style += ';'\r\n        }\r\n      }\r\n\r\n      // Store valign attribute.\r\n      let valign = child.getAttribute('valign')\r\n\r\n      if (!valign && style) {\r\n        const valign_matches = style.match(/vertical-align:.+?[; \"]{1,1}/gi)\r\n\r\n        if (valign_matches) {\r\n          valign = valign_matches[valign_matches.length - 1].replace(/vertical-align:(.+?)[; \"]{1,1}/gi, '$1')\r\n        }\r\n      }\r\n\r\n      // Store text-align style attribute.\r\n      let halign = null\r\n\r\n      if (style) {\r\n        const halign_matches = style.match(/text-align:.+?[; \"]{1,1}/gi)\r\n\r\n        if (halign_matches) {\r\n          halign = halign_matches[halign_matches.length - 1].replace(/text-align:(.+?)[; \"]{1,1}/gi, '$1')\r\n        }\r\n\r\n        if (halign === 'general') {\r\n          halign = null\r\n        }\r\n      }\r\n\r\n      // Store background color style attribute.\r\n      let background_color = null\r\n\r\n      if (style) {\r\n        const background_matches = style.match(/background:.+?[; \"]{1,1}/gi)\r\n\r\n        if (background_matches) {\r\n          background_color = background_matches[background_matches.length - 1].replace(/background:(.+?)[; \"]{1,1}/gi, '$1')\r\n        }\r\n      }\r\n\r\n      // Store colspan.\r\n      const colspan = child.getAttribute('colspan')\r\n\r\n      // Store rowspan.\r\n      const rowspan = child.getAttribute('rowspan')\r\n\r\n      // Restore colspan.\r\n      if (colspan) {\r\n        child.setAttribute('colspan', colspan)\r\n      }\r\n\r\n      // Restore rowspan.\r\n      if (rowspan) {\r\n        child.setAttribute('rowspan', rowspan)\r\n      }\r\n\r\n      // Add valign to style.\r\n      if (valign) {\r\n        child.style['vertical-align'] = valign\r\n      }\r\n\r\n      // Add horizontal align to style.\r\n      if (halign) {\r\n        child.style['text-align'] = halign\r\n      }\r\n\r\n      // Add background color to style.\r\n      if (background_color) {\r\n        child.style['background-color'] = background_color\r\n      }\r\n\r\n      // Set the width again.\r\n      if (width_attr) {\r\n        child.setAttribute('width', width_attr)\r\n      }\r\n\r\n      // Move to next sibling.\r\n      child = child.nextElementSibling\r\n\r\n    }\r\n\r\n    // Get first child again.\r\n    child = tr.firstElementChild\r\n\r\n    // Set the width in percentage to every child.\r\n    while (child) {\r\n      width_attr = child.getAttribute('width')\r\n\r\n      if (missing_width) {\r\n\r\n        // Remove width.\r\n        child.removeAttribute('width')\r\n      }\r\n      else {\r\n\r\n        // Set the width considering that every child has equal widths.\r\n        child.setAttribute('width', (parseInt(width_attr, 10) * 100) / total_width + '%')\r\n      }\r\n\r\n      // Move to next sibling.\r\n      child = child.nextElementSibling\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Clean align attribute.\r\n   */\r\n  function _cleanAlignment(el) {\r\n\r\n    const align = el.getAttribute('align')\r\n\r\n    if (align) {\r\n      el.style['text-align'] = align\r\n      el.removeAttribute('align')\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Clean up atribute.\r\n   */\r\n  function _normalizeAttribute(attribute) {\r\n\r\n    return attribute.replace(/\\n|\\r|\\n\\r|&quot;/g, '')\r\n  }\r\n\r\n  /*\r\n   * Append style to element.\r\n   */\r\n  function _appendStyle(el, style, last) {\r\n\r\n    if (!style) {\r\n      return\r\n    }\r\n\r\n    // Get current element style.\r\n    let old_style = el.getAttribute('style')\r\n\r\n    // Add semicolon, if it is missing, to the end of current style.\r\n    if (old_style && old_style.slice(-1) !== ';') {\r\n      old_style += ';'\r\n    }\r\n\r\n    // Add semicolon, if it is missing, to the end of current style.\r\n    if (style && style.slice(-1) !== ';') {\r\n      style += ';'\r\n    }\r\n\r\n    // Remove newlines.\r\n    style = style.replace(/\\n/gi, '')\r\n\r\n    // Append at the begining or at the end.\r\n    let new_style = null\r\n\r\n    if (last) {\r\n      new_style = (old_style || '') + style\r\n    }\r\n    else {\r\n      new_style = style + (old_style || '')\r\n    }\r\n    el.setAttribute('style', new_style)\r\n  }\r\n\r\n  /*\r\n   * Delete duplicate attributes found on style. Keep the last one.\r\n   */\r\n  function _cleanStyleDuplicates(el) {\r\n    let style = el.getAttribute('style')\r\n\r\n    if (!style) {\r\n\r\n      return\r\n    }\r\n\r\n    style = _normalizeAttribute(style)\r\n\r\n    // Add semicolon, if it is missing, to the end of style.\r\n    if (style && style.slice(-1) !== ';') {\r\n      style += ';'\r\n    }\r\n\r\n    // Get styles: attr:value\r\n    const style_list = style.match(/(^|\\S+?):.+?;{1,1}/gi)\r\n\r\n    if (!style_list) {\r\n      return\r\n    }\r\n\r\n    // Key = attribute. Value = attribute's value. Duplicate keys will be overrided.\r\n    const style_hash = {}\r\n\r\n    for (let i = 0; i < style_list.length; i++) {\r\n      const style_list_item = style_list[i]\r\n\r\n      const splited_style = style_list_item.split(':')\r\n\r\n      if (splited_style.length !== 2) {\r\n        continue\r\n      }\r\n\r\n      // Add style to hash without text-align on span.\r\n      if (!(splited_style[0] === 'text-align' && el.tagName === 'SPAN')) {\r\n        style_hash[splited_style[0]] = splited_style[1]\r\n      }\r\n    }\r\n\r\n    // Create the new style without duplicates.\r\n    let new_style = ''\r\n\r\n    for (const attr in style_hash) {\r\n      if (style_hash.hasOwnProperty(attr)) {\r\n\r\n        // Change font-size form pt to px\r\n        if (attr === 'font-size' && style_hash[attr].slice(-3) === 'pt;') {\r\n          let number = null\r\n\r\n          try {\r\n            number = parseFloat(style_hash[attr].slice(0, -3), 10)\r\n          }\r\n          catch (e) {\r\n            number = null\r\n          }\r\n\r\n          if (number) {\r\n            number = Math.round(1.33 * number)\r\n            style_hash[attr] = number + 'px;'\r\n          }\r\n        }\r\n\r\n        new_style += attr + ':' + style_hash[attr]\r\n      }\r\n    }\r\n\r\n    if (new_style) {\r\n      el.setAttribute('style', new_style)\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Convert a hex string to base64.\r\n   */\r\n  function _hexToBase64(hex) {\r\n    const hexa_chars = hex.match(/[0-9a-f]{2}/gi)\r\n\r\n    const dec_chars = []\r\n\r\n    for (let i = 0; i < hexa_chars.length; i++) {\r\n      dec_chars.push(String.fromCharCode(parseInt(hexa_chars[i], 16)))\r\n    }\r\n\r\n    const dec = dec_chars.join('')\r\n\r\n    return btoa(dec)\r\n  }\r\n\r\n  let _rtf_map = null\r\n\r\n  function _getRtfData(rtf, letter, p_type) {\r\n    const imgs = rtf.split(p_type)\r\n\r\n    for (let i = 1; i < imgs.length; i++) {\r\n      let img_data = imgs[i]\r\n\r\n      img_data = img_data.split('shplid')\r\n\r\n      if (img_data.length > 1) {\r\n\r\n        img_data = img_data[1]\r\n\r\n        let id = ''\r\n        let t = 0\r\n\r\n        while (t < img_data.length) {\r\n          if (img_data[t] === '\\\\' || img_data[t] === '{' || img_data[t] === ' ' || img_data[t] === '\\r' || img_data[t] === '\\n') {\r\n            break\r\n          }\r\n\r\n          id += img_data[t]\r\n\r\n          t++\r\n        }\r\n\r\n        const bliptab_split = img_data.split('bliptag')\r\n\r\n        if (bliptab_split && bliptab_split.length < 2) {\r\n\r\n          continue\r\n        }\r\n\r\n        let image_type = null\r\n\r\n        if (bliptab_split[0].indexOf('pngblip') !== -1) {\r\n          image_type = 'image/png'\r\n        }\r\n        else if (bliptab_split[0].indexOf('jpegblip') !== -1) {\r\n          image_type = 'image/jpeg'\r\n        }\r\n\r\n        if (!image_type) {\r\n\r\n          continue\r\n        }\r\n\r\n        const bracket_split = bliptab_split[1].split('}')\r\n\r\n        if (bracket_split && bracket_split.length < 2) {\r\n\r\n          continue\r\n        }\r\n\r\n        let space_split\r\n\r\n        if (bracket_split.length > 2 && bracket_split[0].indexOf('blipuid') !== -1) {\r\n          space_split = bracket_split[1].split(' ')\r\n        }\r\n        else {\r\n          space_split = bracket_split[0].split(' ')\r\n\r\n          if (space_split && space_split.length < 2) {\r\n\r\n            continue\r\n          }\r\n\r\n          space_split.shift()\r\n        }\r\n\r\n        const image_hex = space_split.join('')\r\n\r\n        _rtf_map[letter + id] = {\r\n          image_hex: image_hex,\r\n          image_type: image_type\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  function _buildRtfMap(rtf) {\r\n    _rtf_map = {}\r\n\r\n    _getRtfData(rtf, 'i', '\\\\shppict')\r\n    _getRtfData(rtf, 's', '\\\\shp{')\r\n  }\r\n\r\n  /*\r\n   * Clean HTML Image.\r\n   */\r\n  function _cleanImage(el, rtf) {\r\n\r\n    if (!rtf) {\r\n\r\n      return\r\n    }\r\n\r\n    // vshapes_tag will identify the image in rtf.\r\n    let vshapes_tag\r\n\r\n    // Image case.\r\n    if (el.tagName === 'IMG') {\r\n      // Get src.\r\n      const src = el.getAttribute('src')\r\n\r\n      if (!src || src.indexOf('file://') === -1) {\r\n        return\r\n      }\r\n\r\n      else if (src.indexOf('file://') === 0) {\r\n        if (editor.helpers.isURL(el.getAttribute('alt'))) {\r\n          el.setAttribute('src', el.getAttribute('alt'))\r\n\r\n          return\r\n        }\r\n      }\r\n\r\n      // vshapes_tag will identify the image in rtf.\r\n      vshapes_tag = _v_shapes_map[el.getAttribute('v:shapes')]\r\n\r\n      if (!vshapes_tag) {\r\n        vshapes_tag = el.getAttribute('v:shapes')\r\n        // Disregard formulas.\r\n        if (el.parentNode && el.parentNode.parentNode && el.parentNode.parentNode.innerHTML.indexOf('msEquation') >= 0) {\r\n          vshapes_tag = null\r\n        }\r\n      }\r\n\r\n    }\r\n    else {\r\n      vshapes_tag = el.parentNode.getAttribute('o:spid')\r\n    }\r\n\r\n    el.removeAttribute('height')\r\n\r\n    if (!vshapes_tag) {\r\n\r\n      return\r\n    }\r\n\r\n    _buildRtfMap(rtf)\r\n\r\n    const img_data = _rtf_map[vshapes_tag.substring(7)]\r\n\r\n    if (img_data) {\r\n\r\n      // Convert image hex to base64.\r\n      const image_base64 = _hexToBase64(img_data.image_hex)\r\n\r\n      // Build data uri.\r\n      const data_uri = 'data:' + img_data.image_type + ';base64,' + image_base64\r\n\r\n      if (el.tagName === 'IMG') {\r\n        el.src = data_uri\r\n        el.setAttribute('data-fr-image-pasted', true)\r\n      }\r\n      else {\r\n        $(el.parentNode).before('<img data-fr-image-pasted=\"true\" src=\"' + data_uri + '\" style=\"' + el.parentNode.getAttribute('style') + '\">').remove()\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Clean element.\r\n   */\r\n  function _cleanElement(el, head_style_hash) {\r\n\r\n    const tag_name = el.tagName\r\n    const tag_name_lower_case = tag_name.toLowerCase()\r\n\r\n    // Check if we need to change a tag. Tags should be changed only from parent.\r\n    if (el.firstElementChild) {\r\n\r\n      // Change i to em.\r\n      if (el.firstElementChild.tagName === 'I') {\r\n        _changeTagName(el.firstElementChild, 'em')\r\n\r\n        // Change b to strong.\r\n      }\r\n      else if (el.firstElementChild.tagName === 'B') {\r\n        _changeTagName(el.firstElementChild, 'strong')\r\n      }\r\n    }\r\n\r\n    // Remove no needed tags.\r\n    const word_tags = ['SCRIPT', 'APPLET', 'EMBED', 'NOFRAMES', 'NOSCRIPT']\r\n\r\n    if (word_tags.indexOf(tag_name) !== -1) {\r\n      _removeNode(el)\r\n\r\n      return false\r\n    }\r\n\r\n    // Check single spaces.\r\n    // if (tag_name === 'O:P' && el.innerHTML === '&nbsp') {\r\n    //   el.innerHTML = FE.INVISIBLE_SPACE\r\n    // }\r\n\r\n    // Remove tags but keep content.\r\n    const ignore_tags = ['META', 'LINK', 'XML', 'ST1:', 'O:', 'W:', 'FONT']\r\n\r\n    for (let i = 0; i < ignore_tags.length; i++) {\r\n      if (tag_name.indexOf(ignore_tags[i]) !== -1) {\r\n        if (el.innerHTML) {\r\n          el.outerHTML = el.innerHTML\r\n          _removeNode(el)\r\n\r\n          return false\r\n        }\r\n        else {\r\n\r\n          // Remove if does not have content.\r\n          _removeNode(el)\r\n\r\n          return false\r\n        }\r\n      }\r\n    }\r\n\r\n    // Add class style from head.\r\n    if (tag_name !== 'TD') {\r\n\r\n      let class_attr = el.getAttribute('class') || 'MsoNormal'\r\n\r\n      if (head_style_hash && class_attr) {\r\n        class_attr = _normalizeAttribute(class_attr)\r\n        const class_contents = class_attr.split(' ')\r\n\r\n        // All classes.\r\n        for (let i = 0; i < class_contents.length; i++) {\r\n          const class_content = class_contents[i]\r\n\r\n          // Create style attributes list.\r\n          const style_attrs = []\r\n\r\n          // Only classes.\r\n          let style_attr = '.' + class_content\r\n          style_attrs.push(style_attr)\r\n\r\n          // Classes under tag.\r\n          style_attr = tag_name_lower_case + style_attr\r\n          style_attrs.push(style_attr)\r\n\r\n          for (let j = 0; j < style_attrs.length; j++) {\r\n            if (head_style_hash[style_attrs[j]]) {\r\n              _appendStyle(el, head_style_hash[style_attrs[j]])\r\n            }\r\n          }\r\n        }\r\n\r\n        el.removeAttribute('class')\r\n      }\r\n\r\n      // Add tag style from head.\r\n      if (head_style_hash && head_style_hash[tag_name_lower_case]) {\r\n        _appendStyle(el, head_style_hash[tag_name_lower_case])\r\n      }\r\n    }\r\n\r\n    // Wrap paragraphs inner html in a span.\r\n    const paragraph_tag_list = ['P', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'PRE']\r\n\r\n    if (paragraph_tag_list.indexOf(tag_name) !== -1) {\r\n\r\n      // Set style from head.\r\n      const el_class = el.getAttribute('class')\r\n\r\n      if (el_class) {\r\n        if (head_style_hash && head_style_hash[tag_name.toLowerCase() + '.' + el_class]) {\r\n          _appendStyle(el, head_style_hash[tag_name.toLowerCase() + '.' + el_class])\r\n        }\r\n\r\n        // Remove mso values from class.\r\n        if (el_class.toLowerCase().indexOf('mso') !== -1) {\r\n          let cleaned_class = _normalizeAttribute(el_class)\r\n          cleaned_class = cleaned_class.replace(/[0-9a-z-_]*mso[0-9a-z-_]*/gi, '')\r\n\r\n          if (cleaned_class) {\r\n            el.setAttribute('class', cleaned_class)\r\n          }\r\n          else {\r\n            el.removeAttribute('class')\r\n          }\r\n        }\r\n      }\r\n\r\n      // keep only text-align in style.\r\n      const paragraph_style = el.getAttribute('style')\r\n\r\n      if (paragraph_style) {\r\n        const paragraph_style_matches = paragraph_style.match(/text-align:.+?[; \"]{1,1}/gi)\r\n\r\n        if (paragraph_style_matches) {\r\n          paragraph_style_matches[paragraph_style_matches.length - 1].replace(/(text-align:.+?[; \"]{1,1})/gi, '$1')\r\n        }\r\n      }\r\n\r\n      _cleanAlignment(el)\r\n    }\r\n\r\n    // Clean tr.\r\n    if (tag_name === 'TR') {\r\n      _cleanTr(el, head_style_hash)\r\n    }\r\n\r\n    // Clean empty links.\r\n    if (tag_name === 'A' && !el.attributes.getNamedItem('href') && !el.attributes.getNamedItem('name') && el.innerHTML) {\r\n      el.outerHTML = el.innerHTML\r\n    }\r\n\r\n    // https://github.com/froala/wysiwyg-editor/issues/3272\r\n    if (tag_name == 'A' &&  el.getAttribute('href') && el.querySelector('img')) {\r\n      // removing empty span tags\r\n      let spanTags = el.querySelectorAll('span')\r\n\r\n      for (let i = 0; i < spanTags.length; i++) {\r\n\r\n        if (!spanTags[i].innerText) {\r\n          spanTags[i].outerHTML = spanTags[i].innerHTML\r\n        }\r\n      }\r\n    }\r\n\r\n    // Keep empty TH and TD.\r\n    if ((tag_name === 'TD' || tag_name === 'TH') && !el.innerHTML) {\r\n      el.innerHTML = '<br>'\r\n    }\r\n\r\n    // Clean table.\r\n    if (tag_name === 'TABLE') {\r\n      el.style.width = el.style.width\r\n    }\r\n\r\n    // Remove lang attribute.\r\n    if (el.getAttribute('lang')) {\r\n      el.removeAttribute('lang')\r\n    }\r\n\r\n    // Remove mso values from style.\r\n    if (el.getAttribute('style') && el.getAttribute('style').toLowerCase().indexOf('mso') !== -1) {\r\n      let cleaned_style = _normalizeAttribute(el.getAttribute('style'))\r\n      cleaned_style = cleaned_style.replace(/[0-9a-z-_]*mso[0-9a-z-_]*:.+?(;{1,1}|$)/gi, '')\r\n\r\n      if (cleaned_style) {\r\n        el.setAttribute('style', cleaned_style)\r\n      }\r\n      else {\r\n        el.removeAttribute('style')\r\n      }\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  /*\r\n   * Parse styles from head and return them into a hash.\r\n   */\r\n  function _parseHeadStyle(head) {\r\n\r\n    const head_style_hash = {}\r\n\r\n    const head_styles = head.getElementsByTagName('style')\r\n\r\n    if (head_styles.length) {\r\n      const head_style = head_styles[0]\r\n\r\n      // Match styles.\r\n      const style_list = head_style.innerHTML.match(/[\\S ]+\\s+{[\\s\\S]+?}/gi)\r\n\r\n      if (style_list) {\r\n        for (let i = 0; i < style_list.length; i++) {\r\n          const style = style_list[i]\r\n\r\n          // Get style attributes.\r\n          let style_attrs = style.replace(/([\\S ]+\\s+){[\\s\\S]+?}/gi, '$1')\r\n\r\n          // Get style definitions.\r\n          let style_definitions = style.replace(/[\\S ]+\\s+{([\\s\\S]+?)}/gi, '$1')\r\n\r\n          // Trim whitespaces.\r\n          style_attrs = style_attrs.replace(/^[\\s]|[\\s]$/gm, '')\r\n          style_definitions = style_definitions.replace(/^[\\s]|[\\s]$/gm, '')\r\n\r\n          // Trim new lines.\r\n          style_attrs = style_attrs.replace(/\\n|\\r|\\n\\r/g, '')\r\n          style_definitions = style_definitions.replace(/\\n|\\r|\\n\\r/g, '')\r\n\r\n          const style_attrs_array = style_attrs.split(', ')\r\n\r\n          // Add every attribute to hash.\r\n          for (let j = 0; j < style_attrs_array.length; j++) {\r\n            head_style_hash[style_attrs_array[j]] = style_definitions\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return head_style_hash\r\n  }\r\n\r\n  /**\r\n   * Create a map with the ID for images.\r\n   */\r\n  function _getVShapes(html) {\r\n    const splits = html.split('v:shape')\r\n\r\n    for (let i = 1; i < splits.length; i++) {\r\n      const split = splits[i]\r\n      let id = split.split(' id=\"')[1]\r\n\r\n      if (id && id.length > 1) {\r\n        id = id.split('\"')[0]\r\n\r\n        let oid = split.split(' o:spid=\"')[1]\r\n\r\n        if (oid && oid.length > 1) {\r\n          oid = oid.split('\"')[0]\r\n\r\n          _v_shapes_map[id] = oid\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Clean HTML that was pasted from Word.\r\n   */\r\n  function _wordClean(html, rtf) {\r\n    // Remove junk from outside html.\r\n    if (html.indexOf('<html') >= 0) {\r\n      html = html.replace(/[.\\s\\S\\w\\W<>]*(<html[^>]*>[.\\s\\S\\w\\W<>]*<\\/html>)[.\\s\\S\\w\\W<>]*/i, '$1')\r\n    }\r\n\r\n    // Get the vshapes for images.\r\n    _getVShapes(html)\r\n\r\n    // Convert string into document.\r\n    const parser = new DOMParser()\r\n    const word_doc = parser.parseFromString(html, 'text/html')\r\n\r\n    const head = word_doc.head\r\n    const body = word_doc.body\r\n    // Create style attrs hash.\r\n    const head_style_hash = _parseHeadStyle(head)\r\n\r\n    // Remove text nodes that do not contain non-whitespace characters and has new lines in them.\r\n    _traverse(body, function (node) {\r\n      if (node.nodeType === Node.TEXT_NODE && /\\n|\\u00a0|\\r/.test(node.data)) {\r\n\r\n        // https://github.com/froala/wysiwyg-editor/issues/3298\r\n        // https://github.com/froala/wysiwyg-editor/issues/3327\r\n        // if has no breaking space keep it\r\n        // 2nd condition to check no break spaces\r\n        if (!/\\S| /.test(node.data) && !/[\\u00a0]+/.test(node.data)) {\r\n          // Keep single &nbsp\r\n          if (node.data === FE.UNICODE_NBSP) {\r\n            node.data = '\\u200b'\r\n\r\n            return true\r\n          }\r\n\r\n          if (node.data.length === 1 && node.data.charCodeAt(0) === 10) {\r\n            node.data = ' '\r\n\r\n            return true\r\n          }\r\n\r\n          _removeNode(node)\r\n\r\n          return false\r\n        }\r\n\r\n        // Remove newlines.\r\n        else {\r\n          node.data = node.data.replace(/\\n|\\r/gi, ' ')\r\n        }\r\n      }\r\n\r\n      return true\r\n    })\r\n\r\n    // Process images.\r\n    _traverse(body, function (node) {\r\n\r\n      // Element node.\r\n      if (node.nodeType === Node.ELEMENT_NODE && (node.tagName === 'V:IMAGEDATA' || node.tagName === 'IMG')) {\r\n        _cleanImage(node, rtf)\r\n      }\r\n\r\n      return true\r\n    })\r\n\r\n    // Process lists.\r\n    const lists = body.querySelectorAll('ul > ul, ul > ol, ol > ul, ol > ol')\r\n\r\n    for (let i = lists.length - 1; i >= 0; i--) {\r\n      if (lists[i].previousElementSibling && lists[i].previousElementSibling.tagName === 'LI') {\r\n        lists[i].previousElementSibling.appendChild(lists[i])\r\n      }\r\n    }\r\n\r\n    // Clean the body.\r\n    _traverse(body, function (node) {\r\n\r\n      // Text node.\r\n      if (node.nodeType === Node.TEXT_NODE) {\r\n\r\n        // https://github.com/froala/wysiwyg-editor/issues/1364.\r\n        node.data = node.data.replace(/<br>(\\n|\\r)/gi, '<br>')\r\n\r\n        return false\r\n      }\r\n\r\n      // Element node.\r\n      else if (node.nodeType === Node.ELEMENT_NODE) {\r\n        // List found.\r\n        if (_isList(node)) {\r\n          // Keep the parent node and previous sibling because the node could be deleted in the list building.\r\n          const parent_node = node.parentNode\r\n          const previous_sibling = node.previousSibling\r\n\r\n          // Get list element.\r\n          const list_element = _buildList(node, head_style_hash).el\r\n\r\n          // Find the element to insert the new list before it.\r\n          let before_element = null\r\n\r\n          // Current node was not the first.\r\n          if (previous_sibling) {\r\n            before_element = previous_sibling.nextSibling\r\n          }\r\n          else {\r\n            before_element = parent_node.firstChild\r\n          }\r\n\r\n          // Insert before.\r\n          if (before_element) {\r\n            parent_node.insertBefore(list_element, before_element)\r\n          }\r\n\r\n          // Push to the end.\r\n          else {\r\n            parent_node.appendChild(list_element)\r\n          }\r\n\r\n          return false\r\n        }\r\n        else {\r\n\r\n          if (node.tagName === 'FONT' && head_style_hash['.' + node.getAttribute('class')]) {\r\n            node = _changeTagName(node, 'span')\r\n          }\r\n\r\n          return _cleanElement(node, head_style_hash)\r\n        }\r\n      }\r\n\r\n      // Comment node.\r\n      else if (node.nodeType === Node.COMMENT_NODE) {\r\n\r\n        // removing the extra line breaks in comments\r\n        if (node.data.indexOf('[if !supportLineBreakNewLine]') > -1) {\r\n          var nextNode = node.nextSibling;\r\n\r\n          while (nextNode) {\r\n            nextNode = node.nextSibling;\r\n            nextNode && _removeNode(nextNode);\r\n\r\n            if (nextNode.data && nextNode.data.indexOf('[endif]') > -1) {\r\n              nextNode = null;\r\n            }\r\n          }\r\n        }\r\n\r\n        //https://github.com/froala-labs/froala-editor-js-2/issues/1859\r\n        if (node.data.indexOf('[if supportFields]') > -1) {\r\n          if(node.data.indexOf('FORMCHECKBOX')>-1){\r\n                 let checkbox = document.createElement('input'); \r\n                     checkbox.type = \"checkbox\"; \r\n                     node.parentNode.insertBefore(checkbox, node.nextSibling);\r\n          }\r\n        }\r\n        _removeNode(node)\r\n\r\n        return false\r\n      }\r\n\r\n      return true\r\n    })\r\n\r\n    // Remove empty tags and clean duplicate styles.\r\n    _traverse(body, function (node) {\r\n\r\n      // Element node.\r\n      if (node.nodeType === Node.ELEMENT_NODE) {\r\n\r\n        const tag_name = node.tagName\r\n\r\n        // Empty. Skip br tag.\r\n        // https://github.com/froala-labs/froala-editor-js-2/issues/1859\r\n        if (!node.innerHTML && ['BR', 'IMG', 'INPUT'].indexOf(tag_name) === -1) {\r\n          let parent = node.parentNode\r\n\r\n          // Remove recursively.\r\n          while (parent) {\r\n            _removeNode(node)\r\n            node = parent\r\n\r\n            // Stop when non-empty element is found.\r\n            if (node.innerHTML) {\r\n              break\r\n            }\r\n            parent = node.parentNode\r\n          }\r\n\r\n          return false\r\n        }\r\n        else {\r\n          _cleanStyleDuplicates(node)\r\n        }\r\n      }\r\n\r\n      return true\r\n    })\r\n\r\n    // https://github.com/froala/wysiwyg-editor/issues/3098, Remove empty anchor tags\r\n    _traverse(body, function (node) {\r\n\r\n      // remove anchor tag if it doesn't have url\r\n      if (node && node.nodeName === 'A' && node.href === '') {\r\n\r\n        // replace parent a tag with its child nodes\r\n        const fragment = document.createDocumentFragment()\r\n\r\n        while (node.firstChild) {\r\n          fragment.appendChild(node.firstChild)\r\n        }\r\n        node.parentNode.replaceChild(fragment, node)\r\n      }\r\n\r\n      return true\r\n    })\r\n\r\n    // Converd document to string.\r\n    let word_doc_string = body.outerHTML\r\n\r\n    // Clean HTML.\r\n    const htmlAllowedStylePropsCopy = editor.opts.htmlAllowedStyleProps\r\n    editor.opts.htmlAllowedStyleProps = editor.opts.wordAllowedStyleProps\r\n\r\n    word_doc_string = editor.clean.html(word_doc_string, editor.opts.wordDeniedTags, editor.opts.wordDeniedAttrs, false)\r\n\r\n    editor.opts.htmlAllowedStyleProps = htmlAllowedStylePropsCopy\r\n\r\n    return word_doc_string\r\n  }\r\n\r\n  return {\r\n    _init: _init,\r\n    clean: clean,\r\n    _wordClean: _wordClean\r\n  }\r\n}\r\n\r\n"],"names":["Object","assign","FE","DEFAULTS","wordDeniedTags","wordDeniedAttrs","wordAllowedStyleProps","wordPasteModal","wordPasteKeepFormatting","PLUGINS","wordPaste","editor","$","$modal","modal_id","clipboard_html","_v_shapes_map","_init","events","on","html","opts","_showModal","clean","_buildModalBody","body","language","translate","head","modalHash","modals","create","$body","addClass","bindClick","inst","data","$on","o_win","resize","show","_hideModal","hide","keep_formatting","wordAllowedStylePropsBackup","indexOf","replace","str","match","spaces","i","length","_wordClean","paste","getRtfClipboard","div","doc","createElement","innerHTML","cleanBlankSpaces","cleanEmptyTagsAndDivs","_removeNode","node","parent","parentNode","removeChild","_traverse","callback","child","firstChild","current_child","previous_child","previousSibling","nextSibling","_isList","getAttribute","test","querySelector","outerHTML","e","_getListLevel","_getListContent","head_style_hash","cloned_node","cloneNode","tagName","heading","document","toLowerCase","setAttribute","nodeType","Node","COMMENT_NODE","browser","msie","safari","edge","tmp","ex","ELEMENT_NODE","_getAllowedListStyles","_cleanElement","content","_buildList","level","prev_margin","order_regex","is_ordered","prev_order","previous_element_sibling","navigator","userAgent","includes","list_type_node","contents","listObj","list_tag","listStyle","startIndexUpperAlpha","startIndexLowerAlpha","textContent","listType","trim","split","classType","undefined","isNaN","parseInt","s","next_level","margin","style","marginLeft","size","parseFloat","index","charCodeAt","tagClosedFlag","nextElementSibling","el","currentNode","firstElementChild","lastIndex","isMarginEqual","innerText","substring","previousElementSibling","element","styles","allowedStyles","parentStyles","forEach","foundVal","RegExp","_changeTagName","old_node","tag_name","new_node","attributes","attribute","name","replaceChild","_cleanTr","tr","clearAttributes","total_width","missing_width","width_attr","UNICODE_NBSP","td_child","has_single_child","children","_cleanAlignment","class_attr","_normalizeAttribute","class_matches","xl_class","dot_xl_class","_appendStyle","td","slice","valign","valign_matches","halign","halign_matches","background_color","background_matches","colspan","rowspan","removeAttribute","align","last","old_style","new_style","_cleanStyleDuplicates","style_list","style_hash","style_list_item","splited_style","attr","hasOwnProperty","number","Math","round","_hexToBase64","hex","hexa_chars","dec_chars","push","String","fromCharCode","dec","join","btoa","_rtf_map","_getRtfData","rtf","letter","p_type","imgs","img_data","id","t","bliptab_split","image_type","bracket_split","space_split","shift","image_hex","_buildRtfMap","_cleanImage","vshapes_tag","src","helpers","isURL","image_base64","data_uri","before","remove","tag_name_lower_case","word_tags","ignore_tags","class_contents","class_content","style_attrs","style_attr","j","paragraph_tag_list","el_class","cleaned_class","paragraph_style","paragraph_style_matches","getNamedItem","spanTags","querySelectorAll","width","cleaned_style","_parseHeadStyle","head_styles","getElementsByTagName","head_style","style_definitions","style_attrs_array","_getVShapes","splits","oid","parser","DOMParser","word_doc","parseFromString","TEXT_NODE","lists","appendChild","parent_node","previous_sibling","list_element","before_element","insertBefore","nextNode","checkbox","type","nodeName","href","fragment","createDocumentFragment","word_doc_string","htmlAllowedStylePropsCopy","htmlAllowedStyleProps"],"mappings":"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"}