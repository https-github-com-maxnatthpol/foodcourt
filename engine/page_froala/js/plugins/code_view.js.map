/*!
 * froala_editor v3.2.6 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2021 Froala Labs
 */

{"version":3,"file":"code_view.js","sources":["../../../src/js/plugins/code_view.js"],"sourcesContent":["import FE from '../index.js'\r\n'use strict';\r\n\r\n// Extend defaults.\r\nObject.assign(FE.DEFAULTS, {\r\n  codeMirror: window.CodeMirror,\r\n  codeMirrorOptions: {\r\n    lineNumbers: true,\r\n    tabMode: 'indent',\r\n    indentWithTabs: true,\r\n    lineWrapping: true,\r\n    mode: 'text/html',\r\n    tabSize: 2\r\n  },\r\n  codeBeautifierOptions: {\r\n    end_with_newline: true,\r\n    indent_inner_html: true,\r\n    extra_liners: ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'pre', 'ul', 'ol', 'table', 'dl'],\r\n    brace_style: 'expand',\r\n    indent_char: '\\t',\r\n    indent_size: 1,\r\n    wrap_line_length: 0\r\n  },\r\n  codeViewKeepActiveButtons: ['fullscreen']\r\n})\r\n\r\nFE.PLUGINS.codeView = function (editor) {\r\n  const { $ } = editor\r\n  let $html_area\r\n  let code_mirror\r\n\r\n  /**\r\n   * Check if code view is enabled.\r\n   */\r\n  const isActive = () => editor.$box.hasClass('fr-code-view')\r\n\r\n  function get() {\r\n    if (code_mirror) {\r\n      return code_mirror.getValue()\r\n    }\r\n    else {\r\n      return $html_area.val()\r\n    }\r\n  }\r\n\r\n  function refresh() {\r\n    if (isActive()) {\r\n      if (code_mirror) {\r\n        code_mirror.setSize(null, editor.opts.height ? editor.opts.height : 'auto')\r\n      }\r\n\r\n      if (editor.opts.heightMin || editor.opts.height) {\r\n        editor.$box.find('.CodeMirror-scroll, .CodeMirror-gutters').css('min-height', editor.opts.heightMin || editor.opts.height);\r\n        $html_area.css('height', editor.opts.height);\r\n      }\r\n      else {\r\n        editor.$box.find('.CodeMirror-scroll, .CodeMirror-gutters').css('min-height', '')\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get back to edit mode.\r\n   */\r\n  function _showText($btn) {\r\n    const html = get()\r\n\r\n    // Code mirror enabled.\r\n    editor.html.set(html)\r\n\r\n    // Blur the element.\r\n    editor.$el.blur()\r\n\r\n    // Toolbar no longer disabled.\r\n    editor.$tb.find('.fr-btn-grp > .fr-command, .fr-more-toolbar > .fr-command, .fr-btn-grp > .fr-btn-wrap > .fr-command, .fr-more-toolbar > .fr-btn-wrap > .fr-command').not($btn).removeClass('fr-disabled').attr('aria-disabled', false)\r\n    \r\n    $btn.removeClass('fr-active').attr('aria-pressed', false)\r\n\r\n    editor.selection.setAtStart(editor.el)\r\n    editor.selection.restore()\r\n    editor.placeholder.refresh()\r\n\r\n    editor.undo.saveStep()\r\n  }\r\n\r\n  let _can_focus = false\r\n\r\n  function _blur() {\r\n    if (isActive()) {\r\n      editor.events.trigger('blur')\r\n    }\r\n  }\r\n\r\n  function _focus() {\r\n    if (isActive() && _can_focus) {\r\n      editor.events.trigger('focus')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get to code mode.\r\n   */\r\n  function _showHTML($btn) {\r\n    if (!$html_area) {\r\n      _initArea()\r\n\r\n      // Enable code mirror.\r\n      if (!code_mirror && editor.opts.codeMirror) {\r\n        code_mirror = editor.opts.codeMirror.fromTextArea($html_area.get(0), editor.opts.codeMirrorOptions)\r\n\r\n        code_mirror.on('blur', _blur)\r\n        code_mirror.on('focus', _focus)\r\n      }\r\n      else {\r\n        editor.events.$on($html_area, 'keydown keyup change input', function () {\r\n          if (!editor.opts.height) {\r\n            this.rows = 1\r\n\r\n            // Textarea has no content anymore.\r\n            if (this.value.length === 0) {\r\n              this.style.height = 'auto'\r\n            }\r\n\r\n            else {\r\n              this.style.height = `${this.scrollHeight}px`\r\n            }\r\n          }\r\n          else {\r\n            this.removeAttribute('rows')\r\n          }\r\n        })\r\n\r\n        editor.events.$on($html_area, 'blur', _blur)\r\n        editor.events.$on($html_area, 'focus', _focus)\r\n      }\r\n    }\r\n\r\n    editor.undo.saveStep()\r\n\r\n    // Clean white tags but ignore selection.\r\n    editor.html.cleanEmptyTags()\r\n    editor.html.cleanWhiteTags(true)\r\n\r\n    // Blur the element.\r\n    if (editor.core.hasFocus()) {\r\n      if (!editor.core.isEmpty()) {\r\n        editor.selection.save()\r\n        editor.$el.find('.fr-marker[data-type=\"true\"]').first().replaceWith('<span class=\"fr-tmp fr-sm\">F</span>')\r\n        editor.$el.find('.fr-marker[data-type=\"false\"]').last().replaceWith('<span class=\"fr-tmp fr-em\">F</span>')\r\n      }\r\n    }\r\n\r\n    // Get HTML.\r\n    let html = editor.html.get(false, true)\r\n    editor.$el.find('span.fr-tmp').remove()\r\n\r\n    editor.$box.toggleClass('fr-code-view', true)\r\n\r\n    let was_focused = false\r\n\r\n    if (editor.core.hasFocus()) {\r\n      was_focused = true\r\n      editor.events.disableBlur()\r\n      editor.$el.blur()\r\n    }\r\n\r\n    html = html.replace(/<span class=\"fr-tmp fr-sm\">F<\\/span>/, 'FROALA-SM')\r\n    html = html.replace(/<span class=\"fr-tmp fr-em\">F<\\/span>/, 'FROALA-EM')\r\n\r\n    // Beautify HTML.\r\n    if (editor.codeBeautifier && !html.includes('fr-embedly')) {\r\n      html = editor.codeBeautifier.run(html, editor.opts.codeBeautifierOptions)\r\n    }\r\n\r\n    let s_index\r\n    let e_index\r\n\r\n    // Code mirror is enabled.\r\n    if (code_mirror) {\r\n      s_index = html.indexOf('FROALA-SM')\r\n      e_index = html.indexOf('FROALA-EM')\r\n\r\n      if (s_index > e_index) {\r\n        s_index = e_index\r\n      }\r\n      else {\r\n        e_index = e_index - 9\r\n      }\r\n\r\n      html = html.replace(/FROALA-SM/g, '').replace(/FROALA-EM/g, '')\r\n      const s_line = html.substring(0, s_index).length - html.substring(0, s_index).replace(/\\n/g, '').length\r\n      const e_line = html.substring(0, e_index).length - html.substring(0, e_index).replace(/\\n/g, '').length\r\n\r\n      s_index = html.substring(0, s_index).length - html.substring(0, html.substring(0, s_index).lastIndexOf('\\n') + 1).length\r\n      e_index = html.substring(0, e_index).length - html.substring(0, html.substring(0, e_index).lastIndexOf('\\n') + 1).length\r\n\r\n      code_mirror.setSize(null, editor.opts.height ? editor.opts.height : 'auto')\r\n\r\n      if (editor.opts.heightMin) editor.$box.find('.CodeMirror-scroll').css('min-height', editor.opts.heightMin)\r\n      code_mirror.setValue(html)\r\n      _can_focus = !was_focused\r\n      code_mirror.focus()\r\n      _can_focus = true\r\n      code_mirror.setSelection({ line: s_line, ch: s_index }, { line: e_line, ch: e_index })\r\n      code_mirror.refresh()\r\n      code_mirror.clearHistory()\r\n    }\r\n\r\n    // No code mirror.\r\n    else {\r\n      s_index = html.indexOf('FROALA-SM')\r\n      e_index = html.indexOf('FROALA-EM') - 9\r\n\r\n      if (editor.opts.heightMin) {\r\n        $html_area.css('min-height', editor.opts.heightMin)\r\n      }\r\n\r\n      if (editor.opts.height) {\r\n        $html_area.css('height', editor.opts.height)\r\n      }\r\n\r\n      if (editor.opts.heightMax) {\r\n        $html_area.css('max-height', editor.opts.height || editor.opts.heightMax)\r\n      }\r\n\r\n      $html_area.val(html.replace(/FROALA-SM/g, '').replace(/FROALA-EM/g, '')).trigger('change')\r\n\r\n      const scroll_top = $(editor.o_doc).scrollTop()\r\n      _can_focus = !was_focused\r\n      $html_area.focus()\r\n      _can_focus = true\r\n      $html_area.get(0).setSelectionRange(s_index, e_index)\r\n      $(editor.o_doc).scrollTop(scroll_top)\r\n    }\r\n\r\n    // Disable buttons.\r\n    editor.$tb.find('.fr-btn-grp > .fr-command, .fr-more-toolbar > .fr-command, .fr-btn-grp > .fr-btn-wrap > .fr-command, .fr-more-toolbar > .fr-btn-wrap > .fr-command').not($btn).filter(function () {\r\n      return editor.opts.codeViewKeepActiveButtons.indexOf($(this).data('cmd')) < 0\r\n    }).addClass('fr-disabled').attr('aria-disabled', true)\r\n    $btn.addClass('fr-active').attr('aria-pressed', true)\r\n\r\n    if (!editor.helpers.isMobile() && editor.opts.toolbarInline) {\r\n      editor.toolbar.hide()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle the code view.\r\n   */\r\n  function toggle(val) {\r\n    if (typeof val == 'undefined') val = !isActive()\r\n\r\n    const $btn = editor.$tb.find('.fr-command[data-cmd=\"html\"]')\r\n\r\n    if (!val) {\r\n      editor.$box.toggleClass('fr-code-view', false)\r\n      _showText($btn)\r\n\r\n      // https://github.com/froala-labs/froala-editor-js-2/issues/2036\r\n      // fire codeView.update event when switching to html view\r\n      editor.events.trigger('codeView.update')\r\n    }\r\n    else {\r\n      editor.popups.hideAll()\r\n      _showHTML($btn)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Destroy.\r\n   */\r\n  function _destroy() {\r\n    if (isActive()) {\r\n      toggle(false)\r\n    }\r\n\r\n    if (code_mirror) code_mirror.toTextArea()\r\n    $html_area.val('').removeData().remove()\r\n    $html_area = null\r\n\r\n    if ($back_button) {\r\n      $back_button.remove()\r\n      $back_button = null\r\n    }\r\n  }\r\n\r\n  function _refreshToolbar() {\r\n\r\n    const $btn = editor.$tb.find('.fr-command[data-cmd=\"html\"]')\r\n\r\n    if (!isActive()) {\r\n      editor.$tb.find('.fr-btn-grp > .fr-command, .fr-more-toolbar > .fr-command').not($btn).removeClass('fr-disabled').attr('aria-disabled', false)\r\n      $btn.removeClass('fr-active').attr('aria-pressed', false)\r\n    }\r\n    else {\r\n      editor.$tb.find('.fr-btn-grp > .fr-command, .fr-more-toolbar > .fr-command').not($btn).filter(function () {\r\n        return editor.opts.codeViewKeepActiveButtons.indexOf($(this).data('cmd')) < 0\r\n      }).addClass('fr-disabled').attr('aria-disabled', false)\r\n      $btn.addClass('fr-active').attr('aria-pressed', false)\r\n    }\r\n  }\r\n\r\n  function _initArea() {\r\n\r\n    // Add the coding textarea to the wrapper.\r\n    $html_area = $('<textarea class=\"fr-code\" tabIndex=\"-1\">')\r\n    editor.$wp.append($html_area)\r\n\r\n    $html_area.attr('dir', editor.opts.direction)\r\n\r\n    // Exit code view button for inline toolbar.\r\n    if (!editor.$box.hasClass('fr-basic')) {\r\n      $back_button = $(`<a data-cmd=\"html\" title=\"Code View\" class=\"fr-command fr-btn html-switch${(editor.helpers.isMobile() ? '' : ' fr-desktop')}\" role=\"button\" tabIndex=\"-1\"><i class=\"fa fa-code\"></i></button>`)\r\n      editor.$box.append($back_button)\r\n\r\n      editor.events.bindClick(editor.$box, 'a.html-switch', function () {\r\n        editor.events.trigger('commands.before', ['html'])\r\n\r\n        toggle(false)\r\n\r\n        editor.events.trigger('commands.after', ['html'])\r\n      })\r\n    }\r\n\r\n    const cancel = function () {\r\n      return !isActive()\r\n    }\r\n\r\n    // Disable refresh of the buttons while enabled.\r\n    editor.events.on('buttons.refresh', cancel)\r\n    editor.events.on('copy', cancel, true)\r\n    editor.events.on('cut', cancel, true)\r\n    editor.events.on('paste', cancel, true)\r\n\r\n    editor.events.on('destroy', _destroy, true)\r\n\r\n    editor.events.on('html.set', function () {\r\n      if (isActive()) toggle(true)\r\n    })\r\n\r\n    editor.events.on('codeView.update', refresh)\r\n    \r\n    editor.events.on('codeView.toggle', function () {\r\n      if (editor.$box.hasClass('fr-code-view')) {\r\n        toggle()\r\n      }\r\n    })\r\n\r\n    editor.events.on('form.submit', function () {\r\n      if (isActive()) {\r\n\r\n        // Code mirror enabled.\r\n        editor.html.set(get())\r\n\r\n        editor.events.trigger('contentChanged', [], true)\r\n      }\r\n    }, true)\r\n  }\r\n\r\n  /**\r\n   * Initialize.\r\n   */\r\n  let $back_button\r\n\r\n  function _init() {\r\n\r\n    // https://github.com/froala-labs/froala-editor-js-2/issues/672\r\n\r\n    editor.events.on('focus', function () {\r\n\r\n      if (editor.opts.toolbarContainer) {\r\n        _refreshToolbar()\r\n      }\r\n    })\r\n\r\n    if (!editor.$wp) return false\r\n  }\r\n\r\n  return {\r\n    _init: _init,\r\n    toggle: toggle,\r\n    isActive: isActive,\r\n    get: get\r\n  }\r\n}\r\n\r\nFE.RegisterCommand('html', {\r\n  title: 'Code View',\r\n  undo: false,\r\n  focus: false,\r\n  forcedRefresh: true,\r\n  toggle: true,\r\n  callback: function () {\r\n    this.codeView.toggle()\r\n  },\r\n  plugin: 'codeView'\r\n})\r\n\r\nFE.DefineIcon('html', {\r\n  NAME: 'code',\r\n  SVG_KEY: 'codeView'\r\n})\r\n"],"names":["Object","assign","FE","DEFAULTS","codeMirror","window","CodeMirror","codeMirrorOptions","lineNumbers","tabMode","indentWithTabs","lineWrapping","mode","tabSize","codeBeautifierOptions","end_with_newline","indent_inner_html","extra_liners","brace_style","indent_char","indent_size","wrap_line_length","codeViewKeepActiveButtons","PLUGINS","codeView","editor","$","$html_area","code_mirror","isActive","$box","hasClass","get","getValue","val","refresh","setSize","opts","height","heightMin","find","css","_showText","$btn","html","set","$el","blur","$tb","not","removeClass","attr","selection","setAtStart","el","restore","placeholder","undo","saveStep","_can_focus","_blur","events","trigger","_focus","_showHTML","_initArea","fromTextArea","on","$on","rows","value","length","style","scrollHeight","removeAttribute","cleanEmptyTags","cleanWhiteTags","core","hasFocus","isEmpty","save","first","replaceWith","last","remove","toggleClass","was_focused","disableBlur","replace","codeBeautifier","includes","run","s_index","e_index","indexOf","s_line","substring","e_line","lastIndexOf","setValue","focus","setSelection","line","ch","clearHistory","heightMax","scroll_top","o_doc","scrollTop","setSelectionRange","filter","data","addClass","helpers","isMobile","toolbarInline","toolbar","hide","toggle","popups","hideAll","_destroy","toTextArea","removeData","$back_button","_refreshToolbar","$wp","append","direction","bindClick","cancel","_init","toolbarContainer","RegisterCommand","title","forcedRefresh","callback","plugin","DefineIcon","NAME","SVG_KEY"],"mappings":";;;;;;;;EAIAA,MAAM,CAACC,MAAP,CAAcC,EAAE,CAACC,QAAjB,EAA2B;EACzBC,EAAAA,UAAU,EAAEC,MAAM,CAACC,UADM;EAEzBC,EAAAA,iBAAiB,EAAE;EACjBC,IAAAA,WAAW,EAAE,IADI;EAEjBC,IAAAA,OAAO,EAAE,QAFQ;EAGjBC,IAAAA,cAAc,EAAE,IAHC;EAIjBC,IAAAA,YAAY,EAAE,IAJG;EAKjBC,IAAAA,IAAI,EAAE,WALW;EAMjBC,IAAAA,OAAO,EAAE;EANQ,GAFM;EAUzBC,EAAAA,qBAAqB,EAAE;EACrBC,IAAAA,gBAAgB,EAAE,IADG;EAErBC,IAAAA,iBAAiB,EAAE,IAFE;EAGrBC,IAAAA,YAAY,EAAE,CAAC,GAAD,EAAM,IAAN,EAAY,IAAZ,EAAkB,IAAlB,EAAwB,IAAxB,EAA8B,IAA9B,EAAoC,IAApC,EAA0C,YAA1C,EAAwD,KAAxD,EAA+D,IAA/D,EAAqE,IAArE,EAA2E,OAA3E,EAAoF,IAApF,CAHO;EAIrBC,IAAAA,WAAW,EAAE,QAJQ;EAKrBC,IAAAA,WAAW,EAAE,IALQ;EAMrBC,IAAAA,WAAW,EAAE,CANQ;EAOrBC,IAAAA,gBAAgB,EAAE;EAPG,GAVE;EAmBzBC,EAAAA,yBAAyB,EAAE,CAAC,YAAD;EAnBF,CAA3B;;EAsBApB,EAAE,CAACqB,OAAH,CAAWC,QAAX,GAAsB,UAAUC,MAAV,EAAkB;EAAA,MAC9BC,CAD8B,GACxBD,MADwB,CAC9BC,CAD8B;EAEtC,MAAIC,UAAJ;EACA,MAAIC,WAAJ;EAEA;EACF;EACA;;EACE,MAAMC,QAAQ,GAAG,SAAXA,QAAW;EAAA,WAAMJ,MAAM,CAACK,IAAP,CAAYC,QAAZ,CAAqB,cAArB,CAAN;EAAA,GAAjB;;EAEA,WAASC,GAAT,GAAe;EACb,QAAIJ,WAAJ,EAAiB;EACf,aAAOA,WAAW,CAACK,QAAZ,EAAP;EACD,KAFD,MAGK;EACH,aAAON,UAAU,CAACO,GAAX,EAAP;EACD;EACF;;EAED,WAASC,OAAT,GAAmB;EACjB,QAAIN,QAAQ,EAAZ,EAAgB;EACd,UAAID,WAAJ,EAAiB;EACfA,QAAAA,WAAW,CAACQ,OAAZ,CAAoB,IAApB,EAA0BX,MAAM,CAACY,IAAP,CAAYC,MAAZ,GAAqBb,MAAM,CAACY,IAAP,CAAYC,MAAjC,GAA0C,MAApE;EACD;;EAED,UAAIb,MAAM,CAACY,IAAP,CAAYE,SAAZ,IAAyBd,MAAM,CAACY,IAAP,CAAYC,MAAzC,EAAiD;EAC/Cb,QAAAA,MAAM,CAACK,IAAP,CAAYU,IAAZ,CAAiB,yCAAjB,EAA4DC,GAA5D,CAAgE,YAAhE,EAA8EhB,MAAM,CAACY,IAAP,CAAYE,SAAZ,IAAyBd,MAAM,CAACY,IAAP,CAAYC,MAAnH;EACAX,QAAAA,UAAU,CAACc,GAAX,CAAe,QAAf,EAAyBhB,MAAM,CAACY,IAAP,CAAYC,MAArC;EACD,OAHD,MAIK;EACHb,QAAAA,MAAM,CAACK,IAAP,CAAYU,IAAZ,CAAiB,yCAAjB,EAA4DC,GAA5D,CAAgE,YAAhE,EAA8E,EAA9E;EACD;EACF;EACF;EAED;EACF;EACA;;;EACE,WAASC,SAAT,CAAmBC,IAAnB,EAAyB;EACvB,QAAMC,IAAI,GAAGZ,GAAG,EAAhB,CADuB;;EAIvBP,IAAAA,MAAM,CAACmB,IAAP,CAAYC,GAAZ,CAAgBD,IAAhB,EAJuB;;EAOvBnB,IAAAA,MAAM,CAACqB,GAAP,CAAWC,IAAX,GAPuB;;EAUvBtB,IAAAA,MAAM,CAACuB,GAAP,CAAWR,IAAX,CAAgB,oJAAhB,EAAsKS,GAAtK,CAA0KN,IAA1K,EAAgLO,WAAhL,CAA4L,aAA5L,EAA2MC,IAA3M,CAAgN,eAAhN,EAAiO,KAAjO;EAEAR,IAAAA,IAAI,CAACO,WAAL,CAAiB,WAAjB,EAA8BC,IAA9B,CAAmC,cAAnC,EAAmD,KAAnD;EAEA1B,IAAAA,MAAM,CAAC2B,SAAP,CAAiBC,UAAjB,CAA4B5B,MAAM,CAAC6B,EAAnC;EACA7B,IAAAA,MAAM,CAAC2B,SAAP,CAAiBG,OAAjB;EACA9B,IAAAA,MAAM,CAAC+B,WAAP,CAAmBrB,OAAnB;EAEAV,IAAAA,MAAM,CAACgC,IAAP,CAAYC,QAAZ;EACD;;EAED,MAAIC,UAAU,GAAG,KAAjB;;EAEA,WAASC,KAAT,GAAiB;EACf,QAAI/B,QAAQ,EAAZ,EAAgB;EACdJ,MAAAA,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsB,MAAtB;EACD;EACF;;EAED,WAASC,MAAT,GAAkB;EAChB,QAAIlC,QAAQ,MAAM8B,UAAlB,EAA8B;EAC5BlC,MAAAA,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsB,OAAtB;EACD;EACF;EAED;EACF;EACA;;;EACE,WAASE,SAAT,CAAmBrB,IAAnB,EAAyB;EACvB,QAAI,CAAChB,UAAL,EAAiB;EACfsC,MAAAA,SAAS,GADM;;;EAIf,UAAI,CAACrC,WAAD,IAAgBH,MAAM,CAACY,IAAP,CAAYjC,UAAhC,EAA4C;EAC1CwB,QAAAA,WAAW,GAAGH,MAAM,CAACY,IAAP,CAAYjC,UAAZ,CAAuB8D,YAAvB,CAAoCvC,UAAU,CAACK,GAAX,CAAe,CAAf,CAApC,EAAuDP,MAAM,CAACY,IAAP,CAAY9B,iBAAnE,CAAd;EAEAqB,QAAAA,WAAW,CAACuC,EAAZ,CAAe,MAAf,EAAuBP,KAAvB;EACAhC,QAAAA,WAAW,CAACuC,EAAZ,CAAe,OAAf,EAAwBJ,MAAxB;EACD,OALD,MAMK;EACHtC,QAAAA,MAAM,CAACoC,MAAP,CAAcO,GAAd,CAAkBzC,UAAlB,EAA8B,4BAA9B,EAA4D,YAAY;EACtE,cAAI,CAACF,MAAM,CAACY,IAAP,CAAYC,MAAjB,EAAyB;EACvB,iBAAK+B,IAAL,GAAY,CAAZ,CADuB;;EAIvB,gBAAI,KAAKC,KAAL,CAAWC,MAAX,KAAsB,CAA1B,EAA6B;EAC3B,mBAAKC,KAAL,CAAWlC,MAAX,GAAoB,MAApB;EACD,aAFD,MAIK;EACH,mBAAKkC,KAAL,CAAWlC,MAAX,aAAuB,KAAKmC,YAA5B;EACD;EACF,WAXD,MAYK;EACH,iBAAKC,eAAL,CAAqB,MAArB;EACD;EACF,SAhBD;EAkBAjD,QAAAA,MAAM,CAACoC,MAAP,CAAcO,GAAd,CAAkBzC,UAAlB,EAA8B,MAA9B,EAAsCiC,KAAtC;EACAnC,QAAAA,MAAM,CAACoC,MAAP,CAAcO,GAAd,CAAkBzC,UAAlB,EAA8B,OAA9B,EAAuCoC,MAAvC;EACD;EACF;;EAEDtC,IAAAA,MAAM,CAACgC,IAAP,CAAYC,QAAZ,GAnCuB;;EAsCvBjC,IAAAA,MAAM,CAACmB,IAAP,CAAY+B,cAAZ;EACAlD,IAAAA,MAAM,CAACmB,IAAP,CAAYgC,cAAZ,CAA2B,IAA3B,EAvCuB;;EA0CvB,QAAInD,MAAM,CAACoD,IAAP,CAAYC,QAAZ,EAAJ,EAA4B;EAC1B,UAAI,CAACrD,MAAM,CAACoD,IAAP,CAAYE,OAAZ,EAAL,EAA4B;EAC1BtD,QAAAA,MAAM,CAAC2B,SAAP,CAAiB4B,IAAjB;EACAvD,QAAAA,MAAM,CAACqB,GAAP,CAAWN,IAAX,CAAgB,8BAAhB,EAAgDyC,KAAhD,GAAwDC,WAAxD,CAAoE,qCAApE;EACAzD,QAAAA,MAAM,CAACqB,GAAP,CAAWN,IAAX,CAAgB,+BAAhB,EAAiD2C,IAAjD,GAAwDD,WAAxD,CAAoE,qCAApE;EACD;EACF,KAhDsB;;;EAmDvB,QAAItC,IAAI,GAAGnB,MAAM,CAACmB,IAAP,CAAYZ,GAAZ,CAAgB,KAAhB,EAAuB,IAAvB,CAAX;EACAP,IAAAA,MAAM,CAACqB,GAAP,CAAWN,IAAX,CAAgB,aAAhB,EAA+B4C,MAA/B;EAEA3D,IAAAA,MAAM,CAACK,IAAP,CAAYuD,WAAZ,CAAwB,cAAxB,EAAwC,IAAxC;EAEA,QAAIC,WAAW,GAAG,KAAlB;;EAEA,QAAI7D,MAAM,CAACoD,IAAP,CAAYC,QAAZ,EAAJ,EAA4B;EAC1BQ,MAAAA,WAAW,GAAG,IAAd;EACA7D,MAAAA,MAAM,CAACoC,MAAP,CAAc0B,WAAd;EACA9D,MAAAA,MAAM,CAACqB,GAAP,CAAWC,IAAX;EACD;;EAEDH,IAAAA,IAAI,GAAGA,IAAI,CAAC4C,OAAL,CAAa,sCAAb,EAAqD,WAArD,CAAP;EACA5C,IAAAA,IAAI,GAAGA,IAAI,CAAC4C,OAAL,CAAa,sCAAb,EAAqD,WAArD,CAAP,CAjEuB;;EAoEvB,QAAI/D,MAAM,CAACgE,cAAP,IAAyB,CAAC7C,IAAI,CAAC8C,QAAL,CAAc,YAAd,CAA9B,EAA2D;EACzD9C,MAAAA,IAAI,GAAGnB,MAAM,CAACgE,cAAP,CAAsBE,GAAtB,CAA0B/C,IAA1B,EAAgCnB,MAAM,CAACY,IAAP,CAAYvB,qBAA5C,CAAP;EACD;;EAED,QAAI8E,OAAJ;EACA,QAAIC,OAAJ,CAzEuB;;EA4EvB,QAAIjE,WAAJ,EAAiB;EACfgE,MAAAA,OAAO,GAAGhD,IAAI,CAACkD,OAAL,CAAa,WAAb,CAAV;EACAD,MAAAA,OAAO,GAAGjD,IAAI,CAACkD,OAAL,CAAa,WAAb,CAAV;;EAEA,UAAIF,OAAO,GAAGC,OAAd,EAAuB;EACrBD,QAAAA,OAAO,GAAGC,OAAV;EACD,OAFD,MAGK;EACHA,QAAAA,OAAO,GAAGA,OAAO,GAAG,CAApB;EACD;;EAEDjD,MAAAA,IAAI,GAAGA,IAAI,CAAC4C,OAAL,CAAa,YAAb,EAA2B,EAA3B,EAA+BA,OAA/B,CAAuC,YAAvC,EAAqD,EAArD,CAAP;EACA,UAAMO,MAAM,GAAGnD,IAAI,CAACoD,SAAL,CAAe,CAAf,EAAkBJ,OAAlB,EAA2BrB,MAA3B,GAAoC3B,IAAI,CAACoD,SAAL,CAAe,CAAf,EAAkBJ,OAAlB,EAA2BJ,OAA3B,CAAmC,KAAnC,EAA0C,EAA1C,EAA8CjB,MAAjG;EACA,UAAM0B,MAAM,GAAGrD,IAAI,CAACoD,SAAL,CAAe,CAAf,EAAkBH,OAAlB,EAA2BtB,MAA3B,GAAoC3B,IAAI,CAACoD,SAAL,CAAe,CAAf,EAAkBH,OAAlB,EAA2BL,OAA3B,CAAmC,KAAnC,EAA0C,EAA1C,EAA8CjB,MAAjG;EAEAqB,MAAAA,OAAO,GAAGhD,IAAI,CAACoD,SAAL,CAAe,CAAf,EAAkBJ,OAAlB,EAA2BrB,MAA3B,GAAoC3B,IAAI,CAACoD,SAAL,CAAe,CAAf,EAAkBpD,IAAI,CAACoD,SAAL,CAAe,CAAf,EAAkBJ,OAAlB,EAA2BM,WAA3B,CAAuC,IAAvC,IAA+C,CAAjE,EAAoE3B,MAAlH;EACAsB,MAAAA,OAAO,GAAGjD,IAAI,CAACoD,SAAL,CAAe,CAAf,EAAkBH,OAAlB,EAA2BtB,MAA3B,GAAoC3B,IAAI,CAACoD,SAAL,CAAe,CAAf,EAAkBpD,IAAI,CAACoD,SAAL,CAAe,CAAf,EAAkBH,OAAlB,EAA2BK,WAA3B,CAAuC,IAAvC,IAA+C,CAAjE,EAAoE3B,MAAlH;EAEA3C,MAAAA,WAAW,CAACQ,OAAZ,CAAoB,IAApB,EAA0BX,MAAM,CAACY,IAAP,CAAYC,MAAZ,GAAqBb,MAAM,CAACY,IAAP,CAAYC,MAAjC,GAA0C,MAApE;EAEA,UAAIb,MAAM,CAACY,IAAP,CAAYE,SAAhB,EAA2Bd,MAAM,CAACK,IAAP,CAAYU,IAAZ,CAAiB,oBAAjB,EAAuCC,GAAvC,CAA2C,YAA3C,EAAyDhB,MAAM,CAACY,IAAP,CAAYE,SAArE;EAC3BX,MAAAA,WAAW,CAACuE,QAAZ,CAAqBvD,IAArB;EACAe,MAAAA,UAAU,GAAG,CAAC2B,WAAd;EACA1D,MAAAA,WAAW,CAACwE,KAAZ;EACAzC,MAAAA,UAAU,GAAG,IAAb;EACA/B,MAAAA,WAAW,CAACyE,YAAZ,CAAyB;EAAEC,QAAAA,IAAI,EAAEP,MAAR;EAAgBQ,QAAAA,EAAE,EAAEX;EAApB,OAAzB,EAAwD;EAAEU,QAAAA,IAAI,EAAEL,MAAR;EAAgBM,QAAAA,EAAE,EAAEV;EAApB,OAAxD;EACAjE,MAAAA,WAAW,CAACO,OAAZ;EACAP,MAAAA,WAAW,CAAC4E,YAAZ;EACD,KA5BD;EAAA,SA+BK;EACHZ,QAAAA,OAAO,GAAGhD,IAAI,CAACkD,OAAL,CAAa,WAAb,CAAV;EACAD,QAAAA,OAAO,GAAGjD,IAAI,CAACkD,OAAL,CAAa,WAAb,IAA4B,CAAtC;;EAEA,YAAIrE,MAAM,CAACY,IAAP,CAAYE,SAAhB,EAA2B;EACzBZ,UAAAA,UAAU,CAACc,GAAX,CAAe,YAAf,EAA6BhB,MAAM,CAACY,IAAP,CAAYE,SAAzC;EACD;;EAED,YAAId,MAAM,CAACY,IAAP,CAAYC,MAAhB,EAAwB;EACtBX,UAAAA,UAAU,CAACc,GAAX,CAAe,QAAf,EAAyBhB,MAAM,CAACY,IAAP,CAAYC,MAArC;EACD;;EAED,YAAIb,MAAM,CAACY,IAAP,CAAYoE,SAAhB,EAA2B;EACzB9E,UAAAA,UAAU,CAACc,GAAX,CAAe,YAAf,EAA6BhB,MAAM,CAACY,IAAP,CAAYC,MAAZ,IAAsBb,MAAM,CAACY,IAAP,CAAYoE,SAA/D;EACD;;EAED9E,QAAAA,UAAU,CAACO,GAAX,CAAeU,IAAI,CAAC4C,OAAL,CAAa,YAAb,EAA2B,EAA3B,EAA+BA,OAA/B,CAAuC,YAAvC,EAAqD,EAArD,CAAf,EAAyE1B,OAAzE,CAAiF,QAAjF;EAEA,YAAM4C,UAAU,GAAGhF,CAAC,CAACD,MAAM,CAACkF,KAAR,CAAD,CAAgBC,SAAhB,EAAnB;EACAjD,QAAAA,UAAU,GAAG,CAAC2B,WAAd;EACA3D,QAAAA,UAAU,CAACyE,KAAX;EACAzC,QAAAA,UAAU,GAAG,IAAb;EACAhC,QAAAA,UAAU,CAACK,GAAX,CAAe,CAAf,EAAkB6E,iBAAlB,CAAoCjB,OAApC,EAA6CC,OAA7C;EACAnE,QAAAA,CAAC,CAACD,MAAM,CAACkF,KAAR,CAAD,CAAgBC,SAAhB,CAA0BF,UAA1B;EACD,OAnIsB;;;EAsIvBjF,IAAAA,MAAM,CAACuB,GAAP,CAAWR,IAAX,CAAgB,oJAAhB,EAAsKS,GAAtK,CAA0KN,IAA1K,EAAgLmE,MAAhL,CAAuL,YAAY;EACjM,aAAOrF,MAAM,CAACY,IAAP,CAAYf,yBAAZ,CAAsCwE,OAAtC,CAA8CpE,CAAC,CAAC,IAAD,CAAD,CAAQqF,IAAR,CAAa,KAAb,CAA9C,IAAqE,CAA5E;EACD,KAFD,EAEGC,QAFH,CAEY,aAFZ,EAE2B7D,IAF3B,CAEgC,eAFhC,EAEiD,IAFjD;EAGAR,IAAAA,IAAI,CAACqE,QAAL,CAAc,WAAd,EAA2B7D,IAA3B,CAAgC,cAAhC,EAAgD,IAAhD;;EAEA,QAAI,CAAC1B,MAAM,CAACwF,OAAP,CAAeC,QAAf,EAAD,IAA8BzF,MAAM,CAACY,IAAP,CAAY8E,aAA9C,EAA6D;EAC3D1F,MAAAA,MAAM,CAAC2F,OAAP,CAAeC,IAAf;EACD;EACF;EAED;EACF;EACA;;;EACE,WAASC,MAAT,CAAgBpF,GAAhB,EAAqB;EACnB,QAAI,OAAOA,GAAP,IAAc,WAAlB,EAA+BA,GAAG,GAAG,CAACL,QAAQ,EAAf;EAE/B,QAAMc,IAAI,GAAGlB,MAAM,CAACuB,GAAP,CAAWR,IAAX,CAAgB,8BAAhB,CAAb;;EAEA,QAAI,CAACN,GAAL,EAAU;EACRT,MAAAA,MAAM,CAACK,IAAP,CAAYuD,WAAZ,CAAwB,cAAxB,EAAwC,KAAxC;;EACA3C,MAAAA,SAAS,CAACC,IAAD,CAAT,CAFQ;EAKR;;;EACAlB,MAAAA,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsB,iBAAtB;EACD,KAPD,MAQK;EACHrC,MAAAA,MAAM,CAAC8F,MAAP,CAAcC,OAAd;;EACAxD,MAAAA,SAAS,CAACrB,IAAD,CAAT;EACD;EACF;EAED;EACF;EACA;;;EACE,WAAS8E,QAAT,GAAoB;EAClB,QAAI5F,QAAQ,EAAZ,EAAgB;EACdyF,MAAAA,MAAM,CAAC,KAAD,CAAN;EACD;;EAED,QAAI1F,WAAJ,EAAiBA,WAAW,CAAC8F,UAAZ;EACjB/F,IAAAA,UAAU,CAACO,GAAX,CAAe,EAAf,EAAmByF,UAAnB,GAAgCvC,MAAhC;EACAzD,IAAAA,UAAU,GAAG,IAAb;;EAEA,QAAIiG,YAAJ,EAAkB;EAChBA,MAAAA,YAAY,CAACxC,MAAb;EACAwC,MAAAA,YAAY,GAAG,IAAf;EACD;EACF;;EAED,WAASC,eAAT,GAA2B;EAEzB,QAAMlF,IAAI,GAAGlB,MAAM,CAACuB,GAAP,CAAWR,IAAX,CAAgB,8BAAhB,CAAb;;EAEA,QAAI,CAACX,QAAQ,EAAb,EAAiB;EACfJ,MAAAA,MAAM,CAACuB,GAAP,CAAWR,IAAX,CAAgB,2DAAhB,EAA6ES,GAA7E,CAAiFN,IAAjF,EAAuFO,WAAvF,CAAmG,aAAnG,EAAkHC,IAAlH,CAAuH,eAAvH,EAAwI,KAAxI;EACAR,MAAAA,IAAI,CAACO,WAAL,CAAiB,WAAjB,EAA8BC,IAA9B,CAAmC,cAAnC,EAAmD,KAAnD;EACD,KAHD,MAIK;EACH1B,MAAAA,MAAM,CAACuB,GAAP,CAAWR,IAAX,CAAgB,2DAAhB,EAA6ES,GAA7E,CAAiFN,IAAjF,EAAuFmE,MAAvF,CAA8F,YAAY;EACxG,eAAOrF,MAAM,CAACY,IAAP,CAAYf,yBAAZ,CAAsCwE,OAAtC,CAA8CpE,CAAC,CAAC,IAAD,CAAD,CAAQqF,IAAR,CAAa,KAAb,CAA9C,IAAqE,CAA5E;EACD,OAFD,EAEGC,QAFH,CAEY,aAFZ,EAE2B7D,IAF3B,CAEgC,eAFhC,EAEiD,KAFjD;EAGAR,MAAAA,IAAI,CAACqE,QAAL,CAAc,WAAd,EAA2B7D,IAA3B,CAAgC,cAAhC,EAAgD,KAAhD;EACD;EACF;;EAED,WAASc,SAAT,GAAqB;EAEnB;EACAtC,IAAAA,UAAU,GAAGD,CAAC,CAAC,0CAAD,CAAd;EACAD,IAAAA,MAAM,CAACqG,GAAP,CAAWC,MAAX,CAAkBpG,UAAlB;EAEAA,IAAAA,UAAU,CAACwB,IAAX,CAAgB,KAAhB,EAAuB1B,MAAM,CAACY,IAAP,CAAY2F,SAAnC,EANmB;;EASnB,QAAI,CAACvG,MAAM,CAACK,IAAP,CAAYC,QAAZ,CAAqB,UAArB,CAAL,EAAuC;EACrC6F,MAAAA,YAAY,GAAGlG,CAAC,yFAA8ED,MAAM,CAACwF,OAAP,CAAeC,QAAf,KAA4B,EAA5B,GAAiC,aAA/G,8EAAhB;EACAzF,MAAAA,MAAM,CAACK,IAAP,CAAYiG,MAAZ,CAAmBH,YAAnB;EAEAnG,MAAAA,MAAM,CAACoC,MAAP,CAAcoE,SAAd,CAAwBxG,MAAM,CAACK,IAA/B,EAAqC,eAArC,EAAsD,YAAY;EAChEL,QAAAA,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsB,iBAAtB,EAAyC,CAAC,MAAD,CAAzC;EAEAwD,QAAAA,MAAM,CAAC,KAAD,CAAN;EAEA7F,QAAAA,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsB,gBAAtB,EAAwC,CAAC,MAAD,CAAxC;EACD,OAND;EAOD;;EAED,QAAMoE,MAAM,GAAG,SAATA,MAAS,GAAY;EACzB,aAAO,CAACrG,QAAQ,EAAhB;EACD,KAFD,CAtBmB;;;EA2BnBJ,IAAAA,MAAM,CAACoC,MAAP,CAAcM,EAAd,CAAiB,iBAAjB,EAAoC+D,MAApC;EACAzG,IAAAA,MAAM,CAACoC,MAAP,CAAcM,EAAd,CAAiB,MAAjB,EAAyB+D,MAAzB,EAAiC,IAAjC;EACAzG,IAAAA,MAAM,CAACoC,MAAP,CAAcM,EAAd,CAAiB,KAAjB,EAAwB+D,MAAxB,EAAgC,IAAhC;EACAzG,IAAAA,MAAM,CAACoC,MAAP,CAAcM,EAAd,CAAiB,OAAjB,EAA0B+D,MAA1B,EAAkC,IAAlC;EAEAzG,IAAAA,MAAM,CAACoC,MAAP,CAAcM,EAAd,CAAiB,SAAjB,EAA4BsD,QAA5B,EAAsC,IAAtC;EAEAhG,IAAAA,MAAM,CAACoC,MAAP,CAAcM,EAAd,CAAiB,UAAjB,EAA6B,YAAY;EACvC,UAAItC,QAAQ,EAAZ,EAAgByF,MAAM,CAAC,IAAD,CAAN;EACjB,KAFD;EAIA7F,IAAAA,MAAM,CAACoC,MAAP,CAAcM,EAAd,CAAiB,iBAAjB,EAAoChC,OAApC;EAEAV,IAAAA,MAAM,CAACoC,MAAP,CAAcM,EAAd,CAAiB,iBAAjB,EAAoC,YAAY;EAC9C,UAAI1C,MAAM,CAACK,IAAP,CAAYC,QAAZ,CAAqB,cAArB,CAAJ,EAA0C;EACxCuF,QAAAA,MAAM;EACP;EACF,KAJD;EAMA7F,IAAAA,MAAM,CAACoC,MAAP,CAAcM,EAAd,CAAiB,aAAjB,EAAgC,YAAY;EAC1C,UAAItC,QAAQ,EAAZ,EAAgB;EAEd;EACAJ,QAAAA,MAAM,CAACmB,IAAP,CAAYC,GAAZ,CAAgBb,GAAG,EAAnB;EAEAP,QAAAA,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsB,gBAAtB,EAAwC,EAAxC,EAA4C,IAA5C;EACD;EACF,KARD,EAQG,IARH;EASD;EAED;EACF;EACA;;;EACE,MAAI8D,YAAJ;;EAEA,WAASO,KAAT,GAAiB;EAEf;EAEA1G,IAAAA,MAAM,CAACoC,MAAP,CAAcM,EAAd,CAAiB,OAAjB,EAA0B,YAAY;EAEpC,UAAI1C,MAAM,CAACY,IAAP,CAAY+F,gBAAhB,EAAkC;EAChCP,QAAAA,eAAe;EAChB;EACF,KALD;EAOA,QAAI,CAACpG,MAAM,CAACqG,GAAZ,EAAiB,OAAO,KAAP;EAClB;;EAED,SAAO;EACLK,IAAAA,KAAK,EAAEA,KADF;EAELb,IAAAA,MAAM,EAAEA,MAFH;EAGLzF,IAAAA,QAAQ,EAAEA,QAHL;EAILG,IAAAA,GAAG,EAAEA;EAJA,GAAP;EAMD,CAtWD;;EAwWA9B,EAAE,CAACmI,eAAH,CAAmB,MAAnB,EAA2B;EACzBC,EAAAA,KAAK,EAAE,WADkB;EAEzB7E,EAAAA,IAAI,EAAE,KAFmB;EAGzB2C,EAAAA,KAAK,EAAE,KAHkB;EAIzBmC,EAAAA,aAAa,EAAE,IAJU;EAKzBjB,EAAAA,MAAM,EAAE,IALiB;EAMzBkB,EAAAA,QAAQ,EAAE,oBAAY;EACpB,SAAKhH,QAAL,CAAc8F,MAAd;EACD,GARwB;EASzBmB,EAAAA,MAAM,EAAE;EATiB,CAA3B;EAYAvI,EAAE,CAACwI,UAAH,CAAc,MAAd,EAAsB;EACpBC,EAAAA,IAAI,EAAE,MADc;EAEpBC,EAAAA,OAAO,EAAE;EAFW,CAAtB;;;;"}