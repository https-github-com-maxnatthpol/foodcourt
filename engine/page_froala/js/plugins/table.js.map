/*!
 * froala_editor v3.2.6 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2021 Froala Labs
 */

{"version":3,"file":"table.js","sources":["../../../src/js/plugins/table.js"],"sourcesContent":["import FE from '../index.js'\r\n'use strict';\r\n\r\nObject.assign(FE.POPUP_TEMPLATES, {\r\n  'table.insert': '[_BUTTONS_][_ROWS_COLUMNS_]',\r\n  'table.edit': '[_BUTTONS_]',\r\n  'table.colors': '[_BUTTONS_][_COLORS_][_CUSTOM_COLOR_]'\r\n})\r\n\r\n// Extend defaults.\r\nObject.assign(FE.DEFAULTS, {\r\n  tableInsertMaxSize: 10,\r\n  tableEditButtons: ['tableHeader', 'tableRemove', 'tableRows', 'tableColumns', 'tableStyle', '-', 'tableCells', 'tableCellBackground', 'tableCellVerticalAlign', 'tableCellHorizontalAlign', 'tableCellStyle'],\r\n  tableInsertButtons: ['tableBack', '|'],\r\n  tableResizer: true,\r\n  tableDefaultWidth: '100%',\r\n  tableResizerOffset: 5,\r\n  tableResizingLimit: 30,\r\n  tableColorsButtons: ['tableBack', '|'],\r\n  tableColors: [\r\n    '#61BD6D', '#1ABC9C', '#54ACD2', '#2C82C9', '#9365B8', '#475577', '#CCCCCC',\r\n    '#41A85F', '#00A885', '#3D8EB9', '#2969B0', '#553982', '#28324E', '#000000',\r\n    '#F7DA64', '#FBA026', '#EB6B56', '#E25041', '#A38F84', '#EFEFEF', '#FFFFFF',\r\n    '#FAC51C', '#F37934', '#D14841', '#B8312F', '#7C706B', '#D1D5D8', 'REMOVE'\r\n  ],\r\n  tableColorsStep: 7,\r\n  tableCellStyles: {\r\n    'fr-highlighted': 'Highlighted',\r\n    'fr-thick': 'Thick'\r\n  },\r\n  tableStyles: {\r\n    'fr-dashed-borders': 'Dashed Borders',\r\n    'fr-alternate-rows': 'Alternate Rows'\r\n  },\r\n  tableCellMultipleStyles: true,\r\n  tableMultipleStyles: true,\r\n  tableInsertHelper: true,\r\n  tableInsertHelperOffset: 15\r\n})\r\n\r\nFE.PLUGINS.table = function (editor) {\r\n  const { $ } = editor\r\n  let $resizer\r\n  let $insert_helper\r\n  let mouseDownCellFlag\r\n  let mouseDownFlag\r\n  let mouseDownCell\r\n  let mouseMoveTimer\r\n  let resizingFlag\r\n\r\n  /*\r\n   * Show the insert table popup.\r\n   */\r\n  function _showInsertPopup() {\r\n    const $btn = editor.$tb.find('.fr-command[data-cmd=\"insertTable\"]')\r\n     \r\n    let $popup = editor.popups.get('table.insert')\r\n\r\n    if (!$popup) $popup = _initInsertPopup()\r\n\r\n    if (!$popup.hasClass('fr-active')) {\r\n\r\n      // Insert table popup\r\n      editor.popups.refresh('table.insert')\r\n      editor.popups.setContainer('table.insert', editor.$tb)\r\n\r\n      // Insert table left and top position.\r\n      const { left, top } = editor.button.getPosition($btn)\r\n      editor.popups.show('table.insert', left, top, $btn.outerHeight())\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Show the table edit popup.\r\n   */\r\n  function _showEditPopup() {\r\n    // Set popup position.\r\n    const map = _tableMap()\r\n    if (map) {\r\n      let $popup = editor.popups.get('table.edit')\r\n\r\n      if (!$popup) $popup = _initEditPopup()\r\n\r\n      if ($popup) {\r\n        editor.popups.setContainer('table.edit', editor.$sc)\r\n        const offset = _selectionOffset(map)\r\n        let left = offset.left + (offset.right - offset.left) / 2\r\n        let top = offset.bottom\r\n\r\n        editor.popups.show('table.edit', left, top, offset.bottom - offset.top, true)\r\n\r\n        // Disable toolbar buttons only if there are more than one cells selected.\r\n        if (editor.edit.isDisabled()) {\r\n\r\n          // Disable toolbar.\r\n          if (selectedCells().length > 1) {\r\n            editor.toolbar.disable()\r\n          }\r\n\r\n          // Allow text selection.\r\n          editor.$el.removeClass('fr-no-selection')\r\n          editor.edit.on()\r\n\r\n          editor.button.bulkRefresh()\r\n\r\n          // https://github.com/froala/wysiwyg-editor/issues/1851.\r\n          // https://github.com/froala-labs/froala-editor-js-2/issues/314.\r\n          // https://github.com/froala/wysiwyg-editor/issues/1656.\r\n          // https://github.com/froala-labs/froala-editor-js-2/issues/294.\r\n\r\n          // Place selection in last selected table cell.\r\n          editor.selection.setAtEnd(editor.$el.find('.fr-selected-cell').last().get(0))\r\n          editor.selection.restore()\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Show the table colors popup.\r\n   */\r\n  function _showColorsPopup() {\r\n\r\n    // Set popup position.\r\n    const map = _tableMap()\r\n\r\n    if (map) {\r\n      let $popup = editor.popups.get('table.colors')\r\n\r\n      if (!$popup) $popup = _initColorsPopup()\r\n\r\n      editor.popups.setContainer('table.colors', editor.$sc)\r\n      const offset = _selectionOffset(map)\r\n      let left = (offset.left + offset.right) / 2\r\n      let top = offset.bottom\r\n\r\n      // Refresh selected color.\r\n      _refreshColor()\r\n\r\n      editor.popups.show('table.colors', left, top, offset.bottom - offset.top, true)\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Called on table edit popup hide.\r\n   */\r\n  function _hideEditPopup() {\r\n\r\n    // Enable toolbar.\r\n    if (selectedCells().length === 0) {\r\n      editor.toolbar.enable()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Init the insert table popup.\r\n   */\r\n  function _initInsertPopup(delayed) {\r\n    if (delayed) {\r\n      editor.popups.onHide('table.insert', function () {\r\n\r\n        // Clear previous cell selection.\r\n        editor.popups.get('table.insert').find('.fr-table-size .fr-select-table-size > span[data-row=\"1\"][data-col=\"1\"]').trigger('mouseover')\r\n      })\r\n\r\n      return true\r\n    }\r\n\r\n    // Table buttons.\r\n    let table_buttons = ''\r\n\r\n    if (editor.opts.tableInsertButtons.length > 0) {\r\n      table_buttons = `<div class=\"fr-buttons fr-tabs\">${editor.button.buildList(editor.opts.tableInsertButtons)}</div>`\r\n    }\r\n\r\n    const template = {\r\n      buttons: table_buttons,\r\n      rows_columns: _insertTableHtml()\r\n    }\r\n\r\n    const $popup = editor.popups.create('table.insert', template)\r\n\r\n    // Initialize insert table grid events.\r\n    editor.events.$on($popup, 'mouseover', '.fr-table-size .fr-select-table-size .fr-table-cell', function (e) {\r\n      _hoverCell($(e.currentTarget))\r\n    }, true)\r\n\r\n    _addAccessibility($popup)\r\n\r\n    return $popup\r\n  }\r\n\r\n  /*\r\n   * Hover table cell.\r\n   */\r\n  function _hoverCell($table_cell) {\r\n    let row = $table_cell.data('row')\r\n    if(row !== null) {\r\n      row = parseInt(row)\r\n    }\r\n\r\n    let col = $table_cell.data('col')\r\n    if(col !== null) {\r\n      col = parseInt(col)\r\n    }\r\n    \r\n    const $select_size = $table_cell.parent()\r\n\r\n    // Update size in title.\r\n    $select_size.siblings('.fr-table-size-info').html(`${row} &times; ${col}`)\r\n\r\n    // Remove hover and fr-active-item class from all cells.\r\n    $select_size.find('> span').removeClass('hover fr-active-item')\r\n\r\n    // Add hover class only to the correct cells.\r\n    for (let i = 1; i <= editor.opts.tableInsertMaxSize; i++) {\r\n      for (let j = 0; j <= editor.opts.tableInsertMaxSize; j++) {\r\n        const $cell = $select_size.find(`> span[data-row=\"${i}\"][data-col=\"${j}\"]`)\r\n\r\n        if (i <= row && j <= col) {\r\n          $cell.addClass('hover')\r\n        }\r\n        else if ((i <= row + 1 || (i <= 2 && !editor.helpers.isMobile()))) {\r\n          $cell.css('display', 'inline-block')\r\n        }\r\n        else if (i > 2 && !editor.helpers.isMobile()) {\r\n          $cell.css('display', 'none')\r\n        }\r\n      }\r\n    }\r\n\r\n    // Mark table cell as the active item.\r\n    $table_cell.addClass('fr-active-item')\r\n  }\r\n\r\n  /*\r\n   * The HTML for insert table grid.\r\n   */\r\n  function _insertTableHtml() {\r\n\r\n    // Grid html\r\n    let rows_columns = '<div class=\"fr-table-size\"><div class=\"fr-table-size-info\">1 &times; 1</div><div class=\"fr-select-table-size\">'\r\n\r\n    for (let i = 1; i <= editor.opts.tableInsertMaxSize; i++) {\r\n      for (let j = 1; j <= editor.opts.tableInsertMaxSize; j++) {\r\n        let display = 'inline-block'\r\n\r\n        // Display only first 2 rows.\r\n        if (i > 2 && !editor.helpers.isMobile()) {\r\n          display = 'none'\r\n        }\r\n\r\n        let cls = 'fr-table-cell '\r\n\r\n        if (i == 1 && j == 1) {\r\n          cls += ' hover'\r\n        }\r\n\r\n        rows_columns += `<span class=\"fr-command ${cls}\" tabIndex=\"-1\" data-cmd=\"tableInsert\" data-row=\"${i}\" data-col=\"${j}\" data-param1=\"${i}\" data-param2=\"${j}\" style=\"display: ${display};\" role=\"button\"><span></span><span class=\"fr-sr-only\">${i} &times; ${j}&nbsp;&nbsp;&nbsp;</span></span>`\r\n      }\r\n      rows_columns += '<div class=\"new-line\"></div>'\r\n    }\r\n\r\n    rows_columns += '</div></div>'\r\n\r\n    return rows_columns\r\n  }\r\n\r\n  /*\r\n   * Register keyboard events.\r\n   */\r\n  function _addAccessibility($popup) {\r\n\r\n    // Hover cell when table.insert cells are focused.\r\n    editor.events.$on($popup, 'focus', '[tabIndex]', function (e) {\r\n      const $focused_el = $(e.currentTarget)\r\n      _hoverCell($focused_el)\r\n    })\r\n\r\n    // Register popup event.\r\n    editor.events.on('popup.tab', function (e) {\r\n      const $focused_item = $(e.currentTarget)\r\n\r\n      // Skip if popup is not visible or focus is elsewere.\r\n      if (!editor.popups.isVisible('table.insert') || !$focused_item.is('span, a')) {\r\n        return true\r\n      }\r\n\r\n      const key_code = e.which\r\n      let status\r\n\r\n      if (FE.KEYCODE.ARROW_UP == key_code || FE.KEYCODE.ARROW_DOWN == key_code || FE.KEYCODE.ARROW_LEFT == key_code || FE.KEYCODE.ARROW_RIGHT == key_code) {\r\n        if ($focused_item.is('span.fr-table-cell')) {\r\n\r\n          // Get all current cells.\r\n          const $cells = $focused_item.parent().find('span.fr-table-cell')\r\n\r\n          // Get focused item position.\r\n          const index = $cells.index($focused_item)\r\n\r\n          // Get cell matrix dimensions.\r\n          const columns = editor.opts.tableInsertMaxSize\r\n\r\n          // Get focused item coordinates.\r\n          let column = index % columns\r\n          let line = Math.floor(index / columns)\r\n\r\n          // Calculate next coordinates. Go to the other opposite site of the matrix if there is no next adjacent element.\r\n          if (FE.KEYCODE.ARROW_UP == key_code) {\r\n            line = Math.max(0, line - 1)\r\n          }\r\n          else if (FE.KEYCODE.ARROW_DOWN == key_code) {\r\n            line = Math.min(editor.opts.tableInsertMaxSize - 1, line + 1)\r\n          }\r\n          else if (FE.KEYCODE.ARROW_LEFT == key_code) {\r\n            column = Math.max(0, column - 1)\r\n          }\r\n          else if (FE.KEYCODE.ARROW_RIGHT == key_code) {\r\n            column = Math.min(editor.opts.tableInsertMaxSize - 1, column + 1)\r\n          }\r\n\r\n          // Get the next element based on the new coordinates.\r\n          const nextIndex = line * columns + column\r\n          const $el = $($cells.get(nextIndex))\r\n\r\n          // Hover cell\r\n          _hoverCell($el)\r\n\r\n          // Focus.\r\n          editor.events.disableBlur()\r\n          $el.focus()\r\n\r\n          status = false\r\n        }\r\n      }\r\n\r\n      // ENTER or SPACE.\r\n      else if (FE.KEYCODE.ENTER == key_code) {\r\n\r\n        editor.button.exec($focused_item)\r\n        status = false\r\n      }\r\n\r\n      // Prevent propagation.\r\n      if (status === false) {\r\n        e.preventDefault()\r\n        e.stopPropagation()\r\n      }\r\n\r\n      return status\r\n    }, true)\r\n  }\r\n\r\n  /**\r\n   * Init the table edit popup.\r\n   */\r\n  function _initEditPopup(delayed) {\r\n    if (delayed) {\r\n      editor.popups.onHide('table.edit', _hideEditPopup)\r\n\r\n      return true\r\n    }\r\n\r\n    // Table buttons.\r\n    let table_buttons = ''\r\n\r\n    if (editor.opts.tableEditButtons.length > 0) {\r\n      table_buttons = `<div class=\"fr-buttons\">${editor.button.buildList(editor.opts.tableEditButtons)}</div>`\r\n\r\n      const template = {\r\n        buttons: table_buttons\r\n      }\r\n\r\n      const $popup = editor.popups.create('table.edit', template)\r\n\r\n      editor.events.$on(editor.$wp, 'scroll.table-edit', function () {\r\n        if (editor.popups.isVisible('table.edit')) {\r\n          _showEditPopup()\r\n        }\r\n      })\r\n\r\n      return $popup\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  /*\r\n   * Init the table cell background popup.\r\n   */\r\n  function _initColorsPopup() {\r\n\r\n    // Table colors buttons.\r\n    let table_buttons = ''\r\n\r\n    if (editor.opts.tableColorsButtons.length > 0) {\r\n      table_buttons = `<div class=\"fr-buttons fr-tabs\">${editor.button.buildList(editor.opts.tableColorsButtons)}</div>`\r\n    }\r\n\r\n    // Custom HEX.\r\n    let custom_color = ''\r\n\r\n    if (editor.opts.colorsHEXInput) {\r\n      custom_color = `<div class=\"fr-color-hex-layer fr-table-colors-hex-layer fr-active fr-layer\" id=\"fr-table-colors-hex-layer-${editor.id}\"><div class=\"fr-input-line\"><input maxlength=\"7\" id=\"fr-table-colors-hex-layer-text-${editor.id}\" type=\"text\" placeholder=\"${editor.language.translate('HEX Color')}\" tabIndex=\"1\" aria-required=\"true\"></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"tableCellBackgroundCustomColor\" tabIndex=\"2\" role=\"button\">${editor.language.translate('OK')}</button></div></div>`\r\n    }\r\n\r\n    const template = {\r\n      buttons: table_buttons,\r\n      colors: _colorsHTML(),\r\n      custom_color: custom_color\r\n    }\r\n\r\n    const $popup = editor.popups.create('table.colors', template)\r\n\r\n    editor.events.$on(editor.$wp, 'scroll.table-colors', function () {\r\n      if (editor.popups.isVisible('table.colors')) {\r\n        _showColorsPopup()\r\n      }\r\n    })\r\n\r\n    _addColorsAccessibility($popup)\r\n\r\n    return $popup\r\n  }\r\n\r\n  /*\r\n   * HTML for the table colors.\r\n   */\r\n  function _colorsHTML() {\r\n\r\n    // Create colors html.\r\n    let colors_html = '<div class=\"fr-color-set fr-table-colors\">'\r\n\r\n    // Add colors.\r\n    for (let i = 0; i < editor.opts.tableColors.length; i++) {\r\n      if (i !== 0 && i % editor.opts.tableColorsStep === 0) {\r\n        colors_html += '<br>'\r\n      }\r\n\r\n      if (editor.opts.tableColors[i] != 'REMOVE') {\r\n        colors_html += `<span class=\"fr-command\" style=\"background: ${editor.opts.tableColors[i]};\" tabIndex=\"-1\" role=\"button\" data-cmd=\"tableCellBackgroundColor\" data-param1=\"${editor.opts.tableColors[i]}\"><span class=\"fr-sr-only\">${editor.language.translate('Color')} ${editor.opts.tableColors[i]}&nbsp;&nbsp;&nbsp;</span></span>`\r\n      }\r\n\r\n      else {\r\n        colors_html += `<span class=\"fr-command\" data-cmd=\"tableCellBackgroundColor\" tabIndex=\"-1\" role=\"button\" data-param1=\"REMOVE\" title=\"${editor.language.translate('Clear Formatting')}\">${editor.icon.create('tableColorRemove')}<span class=\"fr-sr-only\">${editor.language.translate('Clear Formatting')}</span></span>`\r\n      }\r\n    }\r\n\r\n    colors_html += '</div>'\r\n\r\n    return colors_html\r\n  }\r\n\r\n  /*\r\n   * Set custom color\r\n   */\r\n  function customColor() {\r\n    const $popup = editor.popups.get('table.colors')\r\n    const $input = $popup.find('.fr-table-colors-hex-layer input')\r\n\r\n    if ($input.length) {\r\n      setBackground($input.val())\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Register keyboard events for colors.\r\n   */\r\n  function _addColorsAccessibility($popup) {\r\n\r\n    // Register popup event.\r\n    editor.events.on('popup.tab', function (e) {\r\n      const $focused_item = $(e.currentTarget)\r\n\r\n      // Skip if popup is not visible or focus is elsewere.\r\n      if (!editor.popups.isVisible('table.colors') || !$focused_item.is('span')) {\r\n        return true\r\n      }\r\n      const key_code = e.which\r\n      let status = true\r\n\r\n      // Tabbing.\r\n      if (FE.KEYCODE.TAB == key_code) {\r\n        const $tb = $popup.find('.fr-buttons')\r\n\r\n        // Focus back the popup's toolbar if exists.\r\n        status = !editor.accessibility.focusToolbar($tb, (e.shiftKey ? true : false))\r\n      }\r\n\r\n      // Arrows.\r\n      else if (FE.KEYCODE.ARROW_UP == key_code || FE.KEYCODE.ARROW_DOWN == key_code || FE.KEYCODE.ARROW_LEFT == key_code || FE.KEYCODE.ARROW_RIGHT == key_code) {\r\n\r\n        // Get all current colors.\r\n        const $colors = $focused_item.parent().find('span.fr-command')\r\n\r\n        // Get focused item position.\r\n        const index = $colors.index($focused_item)\r\n\r\n        // Get color matrix dimensions.\r\n        const columns = editor.opts.colorsStep\r\n        const lines = Math.floor($colors.length / columns)\r\n\r\n        // Get focused item coordinates.\r\n        const column = index % columns\r\n        const line = Math.floor(index / columns)\r\n\r\n        let nextIndex = line * columns + column\r\n        const dimension = lines * columns\r\n\r\n        // Calculate next index. Go to the other opposite site of the matrix if there is no next adjacent element.\r\n        // Up/Down: Traverse matrix lines.\r\n        // Left/Right: Traverse the matrix as it is a vector.\r\n        if (FE.KEYCODE.ARROW_UP == key_code) {\r\n          nextIndex = (((nextIndex - columns) % dimension) + dimension) % dimension // Javascript negative modulo bug.\r\n        }\r\n        else if (FE.KEYCODE.ARROW_DOWN == key_code) {\r\n          nextIndex = (nextIndex + columns) % dimension\r\n        }\r\n        else if (FE.KEYCODE.ARROW_LEFT == key_code) {\r\n          nextIndex = (((nextIndex - 1) % dimension) + dimension) % dimension // Javascript negative modulo bug.\r\n        }\r\n        else if (FE.KEYCODE.ARROW_RIGHT == key_code) {\r\n          nextIndex = (nextIndex + 1) % dimension\r\n        }\r\n\r\n        // Get the next element based on the new index.\r\n        const $el = $($colors.get(nextIndex))\r\n\r\n        // Focus.\r\n        editor.events.disableBlur()\r\n        $el.focus()\r\n\r\n        status = false\r\n      }\r\n\r\n      // ENTER or SPACE.\r\n      else if (FE.KEYCODE.ENTER == key_code) {\r\n\r\n        editor.button.exec($focused_item)\r\n        status = false\r\n      }\r\n\r\n      // Prevent propagation.\r\n      if (status === false) {\r\n        e.preventDefault()\r\n        e.stopPropagation()\r\n      }\r\n\r\n      return status\r\n    }, true)\r\n  }\r\n\r\n  /*\r\n   * Show the current selected color.\r\n   */\r\n  function _refreshColor() {\r\n    const $popup = editor.popups.get('table.colors')\r\n    const $cell = editor.$el.find('.fr-selected-cell').first()\r\n    const color = editor.helpers.RGBToHex($cell.css('background-color'))\r\n    const $input = $popup.find('.fr-table-colors-hex-layer input')\r\n\r\n    // Remove current color selection.\r\n    $popup.find('.fr-selected-color').removeClass('fr-selected-color fr-active-item')\r\n\r\n    // Find the selected color.\r\n    $popup.find(`span[data-param1=\"${color}\"]`).addClass('fr-selected-color fr-active-item')\r\n    $input.val(color).trigger('change')\r\n  }\r\n\r\n  /*\r\n   * Insert table method.\r\n   */\r\n  function insert(rows, cols) {\r\n\r\n    // Create table HTML.\r\n    let table = '<table ' + (!editor.opts.tableDefaultWidth ? '' : 'style=\"width: ' + editor.opts.tableDefaultWidth + ';\" ') + 'class=\"fr-inserted-table\"><tbody>'\r\n    const cell_width = 100 / cols\r\n    let i\r\n    let j\r\n\r\n    for (i = 0; i < rows; i++) {\r\n      table += '<tr>'\r\n\r\n      for (j = 0; j < cols; j++) {\r\n        table += '<td' + (!editor.opts.tableDefaultWidth ? '' : ' style=\"width: ' + cell_width.toFixed(4) + '%;\"') + '>'\r\n\r\n        if (i === 0 && j === 0) table += FE.MARKERS\r\n        table += '<br></td>'\r\n      }\r\n      table += '</tr>'\r\n    }\r\n    table += '</tbody></table>'\r\n\r\n    editor.html.insert(table)\r\n\r\n    // Update cursor position.\r\n    editor.selection.restore()\r\n\r\n    const $table = editor.$el.find('.fr-inserted-table')\r\n    $table.removeClass('fr-inserted-table')\r\n    editor.events.trigger('table.inserted', [$table.get(0)])\r\n  }\r\n\r\n  /*\r\n   * Delete table method.\r\n   */\r\n  function remove() {\r\n    if (selectedCells().length > 0) {\r\n      const $current_table = selectedTable()\r\n\r\n      // Update cursor position.\r\n      editor.selection.setBefore($current_table.get(0)) || editor.selection.setAfter($current_table.get(0))\r\n      editor.selection.restore()\r\n\r\n      // Hide table edit popup.\r\n      editor.popups.hide('table.edit')\r\n\r\n      // Delete table.\r\n      $current_table.remove()\r\n\r\n      // Enable toolbar.\r\n      editor.toolbar.enable()\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Add table header.\r\n   */\r\n  function addHeader() {\r\n    const $table = selectedTable()\r\n\r\n    // If there is a selection in the table and the table doesn't have a header already.\r\n    if ($table.length > 0 && $table.find('th').length === 0) {\r\n\r\n      // Create header HTML.\r\n      let thead = '<thead><tr>'\r\n\r\n      let i\r\n      let col = 0\r\n\r\n      // Get first row and count table columns.\r\n      $table.find('tr').first().find('> td').each(function () {\r\n        const $td = $(this)\r\n\r\n        col += parseInt($td.attr('colspan'), 10) || 1\r\n      })\r\n\r\n      // Add cells.\r\n      for (i = 0; i < col; i++) {\r\n        thead += '<th><br></th>'\r\n      }\r\n\r\n      thead += '</tr></thead>'\r\n\r\n      $table.prepend(thead)\r\n\r\n      // Reposition table edit popup.\r\n      _showEditPopup()\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Remove table header.\r\n   */\r\n  function removeHeader() {\r\n    const $current_table = selectedTable()\r\n    const $table_header = $current_table.find('thead')\r\n\r\n    // Table has a header.\r\n    if ($table_header.length > 0) {\r\n\r\n      // If table does not have any other rows then delete table.\r\n      if ($current_table.find('tbody tr').length === 0) {\r\n\r\n        // Remove table.\r\n        remove()\r\n      }\r\n\r\n      else {\r\n        $table_header.remove()\r\n\r\n        // Reposition table edit popup if there any more selected celss.\r\n        if (selectedCells().length > 0) {\r\n          _showEditPopup()\r\n        }\r\n        else {\r\n\r\n          // Hide popup.\r\n          editor.popups.hide('table.edit')\r\n\r\n          // Update cursor position.\r\n          //const td = $current_table.find('tbody tr:first td:first').get(0)\r\n          const td = $current_table.find('tbody tr').first().find('td').first().get(0)\r\n\r\n          if (td) {\r\n            editor.selection.setAtEnd(td)\r\n            editor.selection.restore()\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Insert row method.\r\n   */\r\n  function insertRow(position) {\r\n    const $table = selectedTable()\r\n\r\n    // We have selection in a table.\r\n    if ($table.length > 0) {\r\n\r\n      // Cannot insert row above the table header.\r\n      if (editor.$el.find('th.fr-selected-cell').length > 0 && position == 'above') {\r\n        return\r\n      }\r\n\r\n      else {\r\n        let i\r\n        let ref_row\r\n        let $ref_row\r\n\r\n        // Create a table map.\r\n        const map = _tableMap()\r\n\r\n        // Get selected cells from the table.\r\n        const selection = _currentSelection(map)\r\n\r\n        // Return if no selected cell\r\n        if(selection == null) {\r\n          return\r\n        }\r\n\r\n        // Reference row.\r\n        if (position == 'above') {\r\n          ref_row = selection.min_i\r\n        }\r\n        else {\r\n          ref_row = selection.max_i\r\n        }\r\n\r\n        // Create row HTML.\r\n        let tr = '<tr>'\r\n\r\n        // Add cells.\r\n        for (i = 0; i < map[ref_row].length; i++) {\r\n\r\n          // If cell has rowspan we should increase it.\r\n          if ((position == 'below' && ref_row < map.length - 1 && map[ref_row][i] == map[ref_row + 1][i]) ||\r\n            (position == 'above' && ref_row > 0 && map[ref_row][i] == map[ref_row - 1][i])) {\r\n\r\n            // Don't increase twice for colspan.\r\n            if (i === 0 || (i > 0 && map[ref_row][i] != map[ref_row][i - 1])) {\r\n              const $cell = $(map[ref_row][i])\r\n              $cell.attr('rowspan', parseInt($cell.attr('rowspan'), 10) + 1)\r\n            }\r\n\r\n          }\r\n          else {\r\n            let $refCell = $(map[ref_row][i])\r\n            tr += '<td style=\"' + $refCell.attr('style') + '\" ><br></td>'\r\n          }\r\n        }\r\n\r\n        // Close row tag.\r\n        tr += '</tr>'\r\n\r\n        // Current selection is in header. Should insert in table body\r\n        if (editor.$el.find('th.fr-selected-cell').length > 0 && position == 'below') {\r\n          $ref_row = $($table.find('tbody').not($table.find('> table tbody')))\r\n        }\r\n\r\n        // Selection is in body\r\n        else {\r\n          $ref_row = $($table.find('tr').not($table.find('> table tr')).get(ref_row));\r\n        }\r\n\r\n        // Insert new row.\r\n        if (position == 'below') {\r\n          if ($ref_row.attr('tagName') == 'TBODY') {\r\n            $ref_row.prepend(tr)\r\n          }\r\n          else {\r\n            if ($ref_row[0].parentNode) {\r\n              $ref_row[0].insertAdjacentHTML('afterend', tr)\r\n            }\r\n          }\r\n        }\r\n        else if (position == 'above') {\r\n          $ref_row.before(tr)\r\n\r\n          // Reposition table edit popup.\r\n          if (editor.popups.isVisible('table.edit')) {\r\n            _showEditPopup()\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Delete row method.\r\n   */\r\n  function deleteRow() {\r\n    const $table = selectedTable()\r\n\r\n    // We have selection in a table.\r\n    if ($table.length > 0) {\r\n      let i\r\n      let j\r\n      let $row\r\n\r\n      // Create a table map.\r\n      let map = _tableMap()\r\n\r\n      // Get selected cells from the table.\r\n      const selection = _currentSelection(map)\r\n\r\n      // Return if no selected cell\r\n      if(selection == null) {\r\n        return\r\n      }\r\n\r\n      // If all the rows are selected then delete the entire table.\r\n      if (selection.min_i === 0 && selection.max_i == map.length - 1) {\r\n        remove()\r\n\r\n      }\r\n      else {\r\n\r\n        // We should delete selected rows.\r\n        for (i = selection.max_i; i >= selection.min_i; i--) {\r\n          // $row = $($table.find('tr').not($table.find('table tr')).get(i))\r\n          // querySelectorAll is returning incorrect result for $table.find('table tr'), it should only return any nested table tr but it is return own tr's as well. \r\n          // therefore trying diff way to fetch the table's own rows\r\n          $row = $($table.find('tr').not($table.find('> table tr')).get(i));\r\n\r\n          // Go through the table map to check for rowspan on the row to delete.\r\n          for (j = 0; j < map[i].length; j++) {\r\n\r\n            // Don't do this twice if we have a colspan.\r\n            if (j === 0 || map[i][j] != map[i][j - 1]) {\r\n              const $cell = $(map[i][j])\r\n\r\n              // We should decrease rowspan.\r\n              if (parseInt($cell.attr('rowspan'), 10) > 1) {\r\n                const rowspan = parseInt($cell.attr('rowspan'), 10) - 1\r\n\r\n                if (rowspan == 1) {\r\n                  $cell.removeAttr('rowspan')\r\n                }\r\n                else {\r\n                  $cell.attr('rowspan', rowspan)\r\n                }\r\n              }\r\n\r\n              // We might need to move tds on the row below if we have a rowspan that starts here.\r\n              if (i < map.length - 1 && map[i][j] == map[i + 1][j] && (i === 0 || map[i][j] != map[i - 1][j])) {\r\n\r\n                // Move td to the row below.\r\n                const td = map[i][j]\r\n                let col = j\r\n\r\n                // Go back until we get the last element (we might have colspan).\r\n                while (col > 0 && map[i][col] == map[i][col - 1]) {\r\n                  col--\r\n                }\r\n\r\n                // Add td at the beginning of the row below.\r\n                if (col === 0) {\r\n                  // $($table.find('tr').not($table.find('table tr')).get(i + 1)).prepend(td)\r\n                  // querySelectorAll is returning incorrect result for $table.find('table tr'), it should only return any nested table tr but it is return own tr's as well. \r\n                  // therefore trying diff way to fetch the table's own rows\r\n                  $($table.find('tr').not($table.find('> table tr')).get(i + 1)).prepend(td);\r\n\r\n                }\r\n                else {\r\n                  if($(map[i+1][col-1])[0].parentNode) {\r\n                    $(map[i+1][col-1])[0].insertAdjacentElement('afterend', td)\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n          // Remove tbody or thead if there are no more rows.\r\n          const $row_parent = $row.parent()\r\n          $row.remove()\r\n\r\n          if ($row_parent.find('tr').length === 0) {\r\n            $row_parent.remove()\r\n          }\r\n\r\n          // Table has changed.\r\n          map = _tableMap($table)\r\n        }\r\n\r\n        _updateCellSpan(0, map.length - 1, 0, map[0].length - 1, $table)\r\n\r\n        // Update cursor position\r\n        if (selection.min_i > 0) {\r\n\r\n          // Place cursor in the row above selection.\r\n          editor.selection.setAtEnd(map[selection.min_i - 1][0])\r\n        }\r\n        else {\r\n\r\n          // Place cursor in the row below selection.\r\n          editor.selection.setAtEnd(map[0][0])\r\n        }\r\n        editor.selection.restore()\r\n\r\n        // Hide table edit popup.\r\n        editor.popups.hide('table.edit')\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Insert column method.\r\n   */\r\n  function insertColumn(position) {\r\n    const $table = selectedTable()\r\n\r\n    // We have selection in a table.\r\n    if ($table.length > 0) {\r\n\r\n      // Create a table map.\r\n      const map = _tableMap()\r\n\r\n      // Get selected cells from the table.\r\n      const selection = _currentSelection(map)\r\n\r\n      // Reference row.\r\n      let ref_col\r\n\r\n      if (position == 'before') {\r\n        ref_col = selection.min_j\r\n      }\r\n      else {\r\n        ref_col = selection.max_j\r\n      }\r\n\r\n      // Old and new column widths.\r\n      const old_width = 100 / map[0].length\r\n      const new_width = 100 / (map[0].length + 1)\r\n\r\n      // Go through all cells and get their initial (old) widths.\r\n      let $cell\r\n\r\n      $table.find('th, td').each(function () {\r\n        $cell = $(this)\r\n        $cell.data('old-width', $cell.outerWidth() / $table.outerWidth() * 100)\r\n      })\r\n\r\n      // Parse each row to insert a new td.\r\n      $table.find('tr').not($table.find('> table tr')).each(function (index) {\r\n        // Get the exact td index before / after which we have to add the new td.\r\n        // ref_col means the table column number, but this is not the same with the td number in a row.\r\n        // We might have colspan or rowspan greater than 1.\r\n        const $row = $(this)\r\n        let col_no = 0\r\n        let td_no = 0\r\n        let ref_td\r\n\r\n        // Start with the first td (td_no = 0) in the current row.\r\n        // Sum colspans (col_no) to see when we reach ref_col.\r\n        // Summing colspans we get the same number with the table column number.\r\n        while (col_no - 1 < ref_col) {\r\n\r\n          // Get current td.\r\n          ref_td = $row.find('> th, > td').get(td_no)\r\n\r\n          // There are no more tds in this row.\r\n          if (!ref_td) {\r\n            ref_td = null\r\n            break\r\n          }\r\n\r\n          // The current td is the same with the td from the table map.\r\n          if (ref_td == map[index][col_no]) {\r\n\r\n            // The current td might have colspan.\r\n            col_no += parseInt($(ref_td).attr('colspan'), 10) || 1\r\n\r\n            // Go to the next td on the current row.\r\n            td_no++\r\n          }\r\n\r\n          // If current td is not the same with the td from the table map.\r\n          // This means that this table cell (map[index][td_no]) has rowspan.\r\n          // There is at least one td less on this row due to rowspan (based on map[index][td_no] colspan value).\r\n          // We want to count this as a column as well.\r\n          else {\r\n            col_no += parseInt($(map[index][col_no]).attr('colspan'), 10) || 1\r\n\r\n            // ref_td is one td ahead. Get previous td if we want to insert column after.\r\n            if (position == 'after') {\r\n\r\n              // There is a rowspan and so ref_td is the first td, but it is not in the first column.\r\n              if (td_no === 0) {\r\n                ref_td = -1\r\n\r\n              }\r\n              else {\r\n                ref_td = $row.find('> th, > td').get(td_no - 1)\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        const $ref_td = $(ref_td)\r\n\r\n        // If the computed column number is higher than the reference number\r\n        // then on this row we have a colspan longer than the reference column.\r\n        // When adding a column after we should increase colspan on this row.\r\n        //\r\n        // If we want to add a column before, but the td on the reference column is\r\n        // the same with the previous one then we have a td with colspan that\r\n        // starts before the column reference number.\r\n        // When adding a column before we should increase colspan on this row.\r\n        if ((position == 'after' && col_no - 1 > ref_col) ||\r\n          (position == 'before' && ref_col > 0 && map[index][ref_col] == map[index][ref_col - 1])) {\r\n\r\n          // Don't increase twice for rowspan.\r\n          if (index === 0 || (index > 0 && map[index][ref_col] != map[index - 1][ref_col])) {\r\n            const colspan = parseInt($ref_td.attr('colspan'), 10) + 1\r\n\r\n            $ref_td.attr('colspan', colspan)\r\n\r\n            // Update this cell's width.\r\n            $ref_td.css('width', ($ref_td.data('old-width') * new_width / old_width + new_width).toFixed(4) + '%')\r\n            $ref_td.removeData('old-width')\r\n          }\r\n\r\n        }\r\n\r\n        else {\r\n\r\n          // Create HTML for a new cell.\r\n          let td\r\n\r\n          // Might be a td or a th.\r\n          if ($row.find('th').length > 0) {\r\n            td = `<th style=\"width: ${new_width.toFixed(4)}%;\"><br></th>`\r\n          }\r\n          else {\r\n            td = `<td style=\"width: ${new_width.toFixed(4)}%;\"><br></td>`\r\n          }\r\n\r\n          // Insert exactly at the beginning.\r\n          if (ref_td == -1) {\r\n            $row.prepend(td)\r\n\r\n            // Insert exactly at the end.\r\n          }\r\n          else if (ref_td == null) {\r\n            $row.append(td)\r\n\r\n            // Insert td on the current row.\r\n          }\r\n          else {\r\n            if (position == 'before') {\r\n              $ref_td.before(td)\r\n            }\r\n\r\n            else if (position == 'after') {\r\n              if($ref_td[0].parentNode) {\r\n                $ref_td[0].insertAdjacentHTML('afterend', td)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      })\r\n\r\n      // Parse each row to update cells' width.\r\n      $table.find('th, td').each(function () {\r\n        $cell = $(this)\r\n\r\n        // Update width and remove data.\r\n        if ($cell.data('old-width')) {\r\n          $cell.css('width', ($cell.data('old-width') * new_width / old_width).toFixed(4) + '%')\r\n          $cell.removeData('old-width')\r\n        }\r\n      })\r\n\r\n      // Reposition table edit popup.\r\n      if (editor.popups.isVisible('table.edit')) {\r\n        _showEditPopup()\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Delete column method.\r\n   */\r\n  function deleteColumn() {\r\n    const $table = selectedTable()\r\n\r\n    // We have selection in a table.\r\n    if ($table.length > 0) {\r\n      let i\r\n      let j\r\n      let $cell\r\n\r\n      // Create a table map.\r\n      const map = _tableMap()\r\n\r\n      // Get selected cells from the table.\r\n      const selection = _currentSelection(map)\r\n\r\n      // Return if no selected column\r\n      if(selection == null) {\r\n        return\r\n      }\r\n\r\n      // If all the rows are selected then delete the entire table.\r\n      if (selection.min_j === 0 && selection.max_j == map[0].length - 1) {\r\n        remove()\r\n      }\r\n      else {\r\n        // Old width of all the columns that remain afte the delete.\r\n        let old_width = 0\r\n\r\n        // Go through all cells and get their initial (old) widths.\r\n        for (i = 0; i < map.length; i++) {\r\n          for (j = 0; j < map[0].length; j++) {\r\n            $cell = $(map[i][j])\r\n\r\n            if (!$cell.hasClass('fr-selected-cell')) {\r\n              $cell.data('old-width', $cell.outerWidth() / $table.outerWidth() * 100)\r\n\r\n              if (j < selection.min_j || j > selection.max_j) {\r\n                old_width += $cell.outerWidth() / $table.outerWidth() * 100\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        old_width /= map.length\r\n\r\n        // We should delete selected columns.\r\n        for (j = selection.max_j; j >= selection.min_j; j--) {\r\n\r\n          // Go through the table map to check for colspan.\r\n          for (i = 0; i < map.length; i++) {\r\n\r\n            // Don't do this twice if we have a rowspan.\r\n            if (i === 0 || map[i][j] != map[i - 1][j]) {\r\n\r\n              // We should decrease colspan.\r\n              $cell = $(map[i][j])\r\n\r\n              if ((parseInt($cell.attr('colspan'), 10) || 1) > 1) {\r\n                const colspan = parseInt($cell.attr('colspan'), 10) - 1\r\n\r\n                if (colspan == 1) {\r\n                  $cell.removeAttr('colspan')\r\n                }\r\n                else {\r\n                  $cell.attr('colspan', colspan)\r\n                }\r\n\r\n                // Update cell width.\r\n                $cell.css('width', (($cell.data('old-width') - _columnWidth(j, map)) * 100 / old_width).toFixed(4) + '%')\r\n                $cell.removeData('old-width')\r\n\r\n                // If there is no colspan delete the cell.\r\n              }\r\n              else {\r\n\r\n                // We might need to delete the row too if it is empty.\r\n                const $row = $($cell.parent().get(0))\r\n\r\n                $cell.remove()\r\n\r\n                // Check if there are any more tds in the current row.\r\n                if ($row.find('> th, > td').length === 0) {\r\n\r\n                  // Check if it is okay to delete the tr.\r\n                  if ($row.prev().length === 0 || $row.next().length === 0 ||\r\n                    $row.prev().find('> th[rowspan], > td[rowspan]').length < $row.prev().find('> th, > td').length) {\r\n                    $row.remove()\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        _updateCellSpan(0, map.length - 1, 0, map[0].length - 1, $table)\r\n\r\n        // Update cursor position\r\n        if (selection.min_j > 0) {\r\n          // Place cursor in the column before selection.\r\n          editor.selection.setAtEnd(map[selection.min_i][selection.min_j - 1])\r\n        }\r\n        else {\r\n          // Place cursor in the column after selection.\r\n          editor.selection.setAtEnd(map[selection.min_i][0])\r\n        }\r\n        editor.selection.restore()\r\n\r\n        // Hide table edit popup.\r\n        editor.popups.hide('table.edit')\r\n\r\n        // Scale current cells' width after column has been deleted.\r\n        $table.find('th, td').each(function () {\r\n          $cell = $(this)\r\n\r\n          // Update width and remove data.\r\n          if ($cell.data('old-width')) {\r\n            $cell.css('width', ($cell.data('old-width') * 100 / old_width).toFixed(4) + '%')\r\n            $cell.removeData('old-width')\r\n          }\r\n        })\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Update or remove colspan attribute.\r\n   */\r\n  function _updateColspan(min_j, max_j, $table) {\r\n    let i\r\n    let j\r\n    let k\r\n    let first_span\r\n    let span\r\n    let decrease = 0\r\n\r\n    // Create a table map.\r\n    const map = _tableMap($table)\r\n\r\n    // A column might have been deleted.\r\n    max_j = Math.min(max_j, map[0].length - 1)\r\n\r\n    // If max_j and min_j are the same, then only one column is selected and colspan is preserved.\r\n    if (max_j > min_j) {\r\n      // Find out how much we should decrease colspan.\r\n      // Parsing only the first row is enough.\r\n      for (j = min_j; j <= max_j; j++) {\r\n\r\n        // This cell has colspan and has already been checked.\r\n        if (j > min_j && map[0][j] == map[0][j - 1]) {\r\n          continue\r\n        }\r\n\r\n        // Current cell colspan\r\n        first_span = Math.min(parseInt(map[0][j].getAttribute('colspan'), 10) || 1, max_j - min_j + 1)\r\n\r\n        // Cell has colspan between min_j and max_j.\r\n        /* j + 1 will never exceed the number of columns in a table.\r\n         * A colspan is detected before the last column and all next cells on that row are skipped.\r\n         */\r\n        if (first_span > 1 && map[0][j] == map[0][j + 1]) {\r\n\r\n          // The value we should decrease colspan with.\r\n          decrease = first_span - 1\r\n\r\n          // Check all columns on the current row.\r\n          // We found a colspan on the first row (i = 0), continue with second row (i = 1).\r\n          for (i = 1; i < map.length; i++) {\r\n\r\n            // This cell has rowspan and has already been checked.\r\n            if (map[i][j] == map[i - 1][j]) {\r\n              continue\r\n            }\r\n\r\n            // Look for a colspan on the same columns.\r\n            for (k = j; k < j + first_span; k++) {\r\n              span = parseInt(map[i][k].getAttribute('colspan'), 10) || 1\r\n\r\n              // There are other cells with colspan on this column.\r\n              /* k + 1 will never exceed the number of columns in a table.\r\n               * A colspan is detected before the last column and all next cells on that row are skipped.\r\n               */\r\n              if (span > 1 && map[i][k] == map[i][k + 1]) {\r\n                decrease = Math.min(decrease, span - 1)\r\n\r\n                // Skip colspan.\r\n                k += decrease\r\n              }\r\n              else {\r\n                decrease = Math.max(0, decrease - 1)\r\n\r\n                // Stop if decrease reaches 0.\r\n                if (!decrease) {\r\n                  break\r\n                }\r\n              }\r\n            }\r\n\r\n            // Stop looking on the next columns if decrease reaches 0.\r\n            if (!decrease) {\r\n              break\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update colspan attribute.\r\n    if (decrease) {\r\n      _decreaseCellSpan(map, decrease, 'colspan', 0, map.length - 1, min_j, max_j)\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Update or remove rowspan attribute.\r\n   */\r\n  function _updateRowspan(min_i, max_i, $table) {\r\n    let i\r\n    let j\r\n    let k\r\n    let first_span\r\n    let span\r\n    let decrease = 0\r\n\r\n    // Create a table map.\r\n    const map = _tableMap($table)\r\n\r\n    // A row might have been deleted.\r\n    max_i = Math.min(max_i, map.length - 1)\r\n\r\n    // If max_i and min_i are the same, then only one row is selected and rowspan is preserved.\r\n    if (max_i > min_i) {\r\n      // Find out how much we should decrease rowspan.\r\n      // Parsing only the first column is enough.\r\n      for (i = min_i; i <= max_i; i++) {\r\n\r\n        // This cell has rowspan and has already been checked.\r\n        if (i > min_i && map[i][0] == map[i - 1][0]) {\r\n          continue\r\n        }\r\n\r\n        // Current cell rowspan\r\n        first_span = Math.min(parseInt(map[i][0].getAttribute('rowspan'), 10) || 1, max_i - min_i + 1)\r\n\r\n        // Cell has rowspan between min_i and max_i.\r\n        /* i + 1 will never exceed the number of rows in a table.\r\n         * A rowspan is detected before the last row and all next cells on that column are skipped.\r\n         */\r\n        if (first_span > 1 && map[i][0] == map[i + 1][0]) {\r\n\r\n          // The value we should decrease rowspan with.\r\n          decrease = first_span - 1\r\n\r\n          // Check all columns on the current row.\r\n          // We found a rowspan on the first column (j = 0), continue with second column (j = 1).\r\n          for (j = 1; j < map[0].length; j++) {\r\n\r\n            // This cell has colspan and has already been checked.\r\n            if (map[i][j] == map[i][j - 1]) {\r\n              continue\r\n            }\r\n\r\n            // Look for a rowspan on the same rows.\r\n            for (k = i; k < i + first_span; k++) {\r\n              span = parseInt(map[k][j].getAttribute('rowspan'), 10) || 1\r\n\r\n              // There are other cells with rowspan on this row.\r\n              /* k + 1 will never exceed the number of rows in a table.\r\n               * A rowspan is detected before the last row and all next cells on that column are skipped.\r\n               */\r\n              if (span > 1 && map[k][j] == map[k + 1][j]) {\r\n                decrease = Math.min(decrease, span - 1)\r\n\r\n                // Skip rowspan.\r\n                k += decrease\r\n              }\r\n              else {\r\n                decrease = Math.max(0, decrease - 1)\r\n\r\n                // Stop if decrease reaches 0.\r\n                if (!decrease) {\r\n                  break\r\n                }\r\n              }\r\n            }\r\n\r\n            // Stop looking on the next columns if decrease reaches 0.\r\n            if (!decrease) {\r\n              break\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update rowspan attribute.\r\n    if (decrease) {\r\n      _decreaseCellSpan(map, decrease, 'rowspan', min_i, max_i, 0, map[0].length - 1)\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Decrease the colspan or rowspan with the amount specified.\r\n   */\r\n  function _decreaseCellSpan(map, decrease, span_type, min_i, max_i, min_j, max_j) {\r\n\r\n    // Update span attribute.\r\n    let i\r\n    let j\r\n    let span\r\n\r\n    // Go only through lines and columns that need to be updated.\r\n    for (i = min_i; i <= max_i; i++) {\r\n      for (j = min_j; j <= max_j; j++) {\r\n\r\n        // This cell has rowspan or colspan and has already been checked.\r\n        if ((i > min_i && map[i][j] == map[i - 1][j]) || (j > min_j && map[i][j] == map[i][j - 1])) {\r\n          continue\r\n        }\r\n\r\n        span = parseInt(map[i][j].getAttribute(span_type), 10) || 1\r\n\r\n        // Update cell span.\r\n        if (span > 1) {\r\n          if (span - decrease > 1) map[i][j].setAttribute(span_type, span - decrease)\r\n          else map[i][j].removeAttribute(span_type)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Update or remove colspan and rowspan attributes.\r\n   */\r\n  function _updateCellSpan(min_i, max_i, min_j, max_j, $table) {\r\n    _updateRowspan(min_i, max_i, $table)\r\n    _updateColspan(min_j, max_j, $table)\r\n  }\r\n\r\n  /*\r\n   * Merge selected cells method.\r\n   */\r\n  function mergeCells() {\r\n\r\n    // We have more than one cell selected in a table. Cannot merge td and th.\r\n    if (selectedCells().length > 1 && (editor.$el.find('th.fr-selected-cell').length === 0 || editor.$el.find('td.fr-selected-cell').length === 0)) {\r\n\r\n      _removeKeyboardSelectionHandlers()\r\n\r\n      // Create a table map.\r\n      const map = _tableMap()\r\n\r\n      // Get selected cells.\r\n      const selection = _currentSelection(map)\r\n\r\n      // Return if no selected cells\r\n      if(selection == null) {\r\n        return\r\n      }\r\n\r\n      let i\r\n      let $cell\r\n      const cells = editor.$el.find('.fr-selected-cell')\r\n      const $first_cell = $(cells[0])\r\n      const $first_row = $first_cell.parent()\r\n      const first_row_cells = $first_row.find('.fr-selected-cell')\r\n      const $current_table = $first_cell.closest('table')\r\n      let content = $first_cell.html()\r\n      let width = 0\r\n\r\n      // Update cell width.\r\n      for (i = 0; i < first_row_cells.length; i++) {\r\n        width += $(first_row_cells[i]).outerWidth()\r\n      }\r\n\r\n      // Width might exceed 100% due to cell borders.\r\n      $first_cell.css('width', Math.min(100, (width / $current_table.outerWidth() * 100)).toFixed(4) + '%')\r\n\r\n      // Set the colspan for the merged cells.\r\n      if (selection.min_j < selection.max_j) {\r\n        $first_cell.attr('colspan', selection.max_j - selection.min_j + 1)\r\n      }\r\n\r\n      // Set the rowspan for the merged cells.\r\n      if (selection.min_i < selection.max_i) {\r\n        $first_cell.attr('rowspan', selection.max_i - selection.min_i + 1)\r\n      }\r\n\r\n      // Go through all selected cells to merge their content.\r\n      for (i = 1; i < cells.length; i++) {\r\n        $cell = $(cells[i])\r\n\r\n        // If cell is empty, don't add only <br> tags.\r\n        if ($cell.html() != '<br>' && $cell.html() !== '') {\r\n          content += `<br>${$cell.html()}`\r\n        }\r\n\r\n        // Remove cell.\r\n        $cell.remove()\r\n      }\r\n\r\n      // Set the HTML content.\r\n      $first_cell.html(content)\r\n      editor.selection.setAtEnd($first_cell.get(0))\r\n      editor.selection.restore()\r\n\r\n      // Enable toolbar.\r\n      editor.toolbar.enable()\r\n\r\n      // Update rowspan before removing empty rows (otherwise table map is not correct).\r\n      _updateRowspan(selection.min_i, selection.max_i, $current_table)\r\n\r\n      // Merge is done, check if we have empty trs to clean.\r\n      const empty_trs = $current_table.find('tr:empty')\r\n\r\n      for (i = empty_trs.length - 1; i >= 0; i--) {\r\n        $(empty_trs[i]).remove()\r\n      }\r\n\r\n      // Update colspan after removing empty rows and updating rowspan.\r\n      _updateColspan(selection.min_j, selection.max_j, $current_table)\r\n\r\n      // Reposition table edit popup.\r\n      _showEditPopup()\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Split cell horizontally method.\r\n   */\r\n  function splitCellHorizontally() {\r\n\r\n    // We have only one cell selected in a table.\r\n    if (selectedCells().length == 1) {\r\n      const $selected_cell = editor.$el.find('.fr-selected-cell')\r\n      const $current_row = $selected_cell.parent()\r\n      const $current_table = $selected_cell.closest('table')\r\n      const current_rowspan = parseInt($selected_cell.attr('rowspan'), 10)\r\n\r\n      // Create a table map.\r\n      const map = _tableMap()\r\n      const cell_origin = _cellOrigin($selected_cell.get(0), map)\r\n\r\n      // Create new td.\r\n      const $new_td = $selected_cell.clone().html('<br>')\r\n\r\n      // Cell has rowspan.\r\n      if (current_rowspan > 1) {\r\n\r\n        // Split current cell's rowspan.\r\n        const new_rowspan = Math.ceil(current_rowspan / 2)\r\n\r\n        if (new_rowspan > 1) {\r\n          $selected_cell.attr('rowspan', new_rowspan)\r\n        }\r\n        else {\r\n          $selected_cell.removeAttr('rowspan')\r\n        }\r\n\r\n        // Update new td's rowspan.\r\n        if (current_rowspan - new_rowspan > 1) {\r\n          $new_td.attr('rowspan', current_rowspan - new_rowspan)\r\n        }\r\n        else {\r\n          $new_td.removeAttr('rowspan')\r\n        }\r\n\r\n        // Find where we should insert the new td.\r\n        const row = cell_origin.row + new_rowspan\r\n        let col = cell_origin.col === 0 ? cell_origin.col : cell_origin.col - 1\r\n\r\n        // Go back until we find a td on this row. We might have colspans and rowspans.\r\n        while (col >= 0 && (map[row][col] == map[row][col - 1] || (row > 0 && map[row][col] == map[row - 1][col]))) {\r\n          col--\r\n        }\r\n\r\n        if (col == -1) {\r\n\r\n          // We couldn't find a previous td on this row. Prepend the new td.\r\n          // $($current_table.find('tr').not($current_table.find('table tr')).get(row)).prepend($new_td)\r\n          // querySelectorAll is returning incorrect result for $table.find('table tr'), it should only return any nested table tr but it is return own tr's as well. \r\n          // therefore trying diff way to fetch the table's own rows\r\n          $($current_table.find('tr').not($current_table.find('> table tr')).get(row)).prepend($new_td);\r\n\r\n\r\n        }\r\n        else {\r\n          if($(map[row][col])[0].parentNode) {\r\n            $(map[row][col])[0].insertAdjacentElement('afterend', $new_td[0])\r\n          }\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // Add new row bellow with only one cell.\r\n        const $row = $(document.createElement('tr')).append($new_td)\r\n        let i\r\n\r\n        // Increase rowspan for all cells on the current row.\r\n        for (i = 0; i < map[0].length; i++) {\r\n\r\n          // Don't do this twice if we have a colspan.\r\n          if (i === 0 || map[cell_origin.row][i] != map[cell_origin.row][i - 1]) {\r\n            const $cell = $(map[cell_origin.row][i])\r\n\r\n            if (!$cell.is($selected_cell)) {\r\n              $cell.attr('rowspan', (parseInt($cell.attr('rowspan'), 10) || 1) + 1)\r\n            }\r\n          }\r\n        }\r\n\r\n        if($current_row[0].parentNode) {\r\n          $current_row[0].insertAdjacentElement('afterend', $row[0])\r\n        }\r\n      }\r\n\r\n      // Remove selection\r\n      _removeSelection()\r\n\r\n      // Hide table edit popup.\r\n      editor.popups.hide('table.edit')\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Split cell vertically method.\r\n   */\r\n  function splitCellVertically() {\r\n\r\n    // We have only one cell selected in a table.\r\n    if (selectedCells().length == 1) {\r\n      const $selected_cell = editor.$el.find('.fr-selected-cell')\r\n      const current_colspan = parseInt($selected_cell.attr('colspan'), 10) || 1\r\n      const parent_width = $selected_cell.parent().outerWidth()\r\n      let width = $selected_cell.outerWidth()\r\n\r\n      // Create new td.\r\n      const $new_td = $selected_cell.clone().html('<br>')\r\n\r\n      // Create a table map.\r\n      const map = _tableMap()\r\n      const cell_origin = _cellOrigin($selected_cell.get(0), map)\r\n\r\n      if (current_colspan > 1) {\r\n\r\n        // Split current colspan.\r\n        const new_colspan = Math.ceil(current_colspan / 2)\r\n\r\n        width = _columnsWidth(cell_origin.col, cell_origin.col + new_colspan - 1, map) / parent_width * 100\r\n        const new_width = _columnsWidth(cell_origin.col + new_colspan, cell_origin.col + current_colspan - 1, map) / parent_width * 100\r\n\r\n        // Update colspan for current cell.\r\n        if (new_colspan > 1) {\r\n          $selected_cell.attr('colspan', new_colspan)\r\n        }\r\n        else {\r\n          $selected_cell.removeAttr('colspan')\r\n        }\r\n\r\n        // Update new td's colspan.\r\n        if (current_colspan - new_colspan > 1) {\r\n          $new_td.attr('colspan', current_colspan - new_colspan)\r\n        }\r\n        else {\r\n          $new_td.removeAttr('colspan')\r\n        }\r\n\r\n        // Update cell width.\r\n        $selected_cell.css('width', width.toFixed(4) + '%')\r\n        $new_td.css('width', new_width.toFixed(4) + '%')\r\n\r\n        // Increase colspan for all cells on the current column.\r\n      }\r\n      else {\r\n        let i\r\n\r\n        for (i = 0; i < map.length; i++) {\r\n\r\n          // Don't do this twice if we have a rowspan.\r\n          if (i === 0 || map[i][cell_origin.col] != map[i - 1][cell_origin.col]) {\r\n            const $cell = $(map[i][cell_origin.col])\r\n\r\n            if (!$cell.is($selected_cell)) {\r\n              const colspan = (parseInt($cell.attr('colspan'), 10) || 1) + 1\r\n              $cell.attr('colspan', colspan)\r\n            }\r\n          }\r\n        }\r\n\r\n        // Update cell width.\r\n        width = width / parent_width * 100 / 2\r\n\r\n        $selected_cell.css('width', `${width.toFixed(4)}%`)\r\n        $new_td.css('width', `${width.toFixed(4)}%`)\r\n      }\r\n\r\n      // Add a new td after the current one.\r\n      if($selected_cell[0].parentNode) {\r\n        $selected_cell[0].insertAdjacentElement('afterend', $new_td[0])\r\n      }\r\n\r\n      // Remove selection\r\n      _removeSelection()\r\n\r\n      // Hide table edit popup.\r\n      editor.popups.hide('table.edit')\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Set background color to selected cells.\r\n   */\r\n  function setBackground(color) {\r\n    const $selected_cells = editor.$el.find('.fr-selected-cell')\r\n\r\n    // Set background  color.\r\n    if (color != 'REMOVE') {\r\n      $selected_cells.css('background-color', editor.helpers.HEXtoRGB(color))\r\n    }\r\n\r\n    // Remove background color.\r\n    else {\r\n      $selected_cells.css('background-color', '')\r\n    }\r\n\r\n    _showEditPopup()\r\n  }\r\n\r\n  /*\r\n   * Set vertical align to selected cells.\r\n   */\r\n  function verticalAlign(val) {\r\n    editor.$el.find('.fr-selected-cell').css('vertical-align', val)\r\n  }\r\n\r\n  /*\r\n   * Apply horizontal alignment to selected cells.\r\n   */\r\n  function horizontalAlign(val) {\r\n    editor.$el.find('.fr-selected-cell').css('text-align', val)\r\n  }\r\n\r\n  /**\r\n   * Apply specific style to selected table or selected cells.\r\n   * val              class to apply.\r\n   * obj              table or selected cells.\r\n   * multiple_styles  editor.opts.tableStyles or editor.opts.tableCellStyles.\r\n   * style            editor.opts.tableStyles or editor.opts.tableCellStyles\r\n   */\r\n  function applyStyle(val, obj, multiple_styles, styles) {\r\n    if (obj.length > 0) {\r\n\r\n      // Remove multiple styles.\r\n      if (!multiple_styles) {\r\n        const classes = Object.keys(styles)\r\n        classes.splice(classes.indexOf(val), 1)\r\n        obj.removeClass(classes.join(' '))\r\n      }\r\n\r\n      obj.toggleClass(val)\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Create a table map.\r\n   */\r\n  function _tableMap($table) {\r\n    $table = $table || null\r\n\r\n    const map = []\r\n\r\n    if ($table == null && selectedCells().length > 0) {\r\n      $table = selectedTable()\r\n    }\r\n\r\n    if ($table) {\r\n      $table.findVisible('tr').not($table.find('> table tr')).each(function (row, tr) {\r\n        const $tr = $(tr)\r\n\r\n        let c_index = 0\r\n        $tr.find('> th, > td').each(function (col, td) {\r\n          const $td = $(td)\r\n          const cspan = parseInt($td.attr('colspan'), 10) || 1\r\n          const rspan = parseInt($td.attr('rowspan'), 10) || 1\r\n\r\n          for (let i = row; i < row + rspan; i++) {\r\n            for (let j = c_index; j < c_index + cspan; j++) {\r\n              if (!map[i]) map[i] = []\r\n\r\n              if (!map[i][j]) {\r\n                map[i][j] = td\r\n              }\r\n              else {\r\n                c_index++\r\n              }\r\n            }\r\n          }\r\n\r\n          c_index += cspan\r\n        })\r\n      })\r\n    }\r\n\r\n    return map\r\n  }\r\n\r\n  /*\r\n   * Get the i, j coordinates of a cell in the table map.\r\n   * These are the coordinates where the cell starts.\r\n   */\r\n  function _cellOrigin(td, map) {\r\n    for (let i = 0; i < map.length; i++) {\r\n      for (let j = 0; j < map[i].length; j++) {\r\n        if (map[i][j] == td) {\r\n          return {\r\n            row: i,\r\n            col: j\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Get the i, j coordinates where a cell ends in the table map.\r\n   */\r\n  function _cellEnds(origin_i, origin_j, map) {\r\n    let max_i = origin_i + 1\r\n    let max_j = origin_j + 1\r\n\r\n    // Compute max_i\r\n    while (max_i < map.length) {\r\n      if (map[max_i][origin_j] != map[origin_i][origin_j]) {\r\n        max_i--\r\n        break\r\n      }\r\n\r\n      max_i++\r\n    }\r\n\r\n    if (max_i == map.length) {\r\n      max_i--\r\n    }\r\n\r\n    // Compute max_j\r\n    while (max_j < map[origin_i].length) {\r\n      if (map[origin_i][max_j] != map[origin_i][origin_j]) {\r\n        max_j--\r\n        break\r\n      }\r\n\r\n      max_j++\r\n    }\r\n\r\n    if (max_j == map[origin_i].length) {\r\n      max_j--\r\n    }\r\n\r\n    return {\r\n      row: max_i,\r\n      col: max_j\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Remove handler classes that are used to select table cells with keyboard.\r\n   */\r\n  function _removeKeyboardSelectionHandlers() {\r\n    if (editor.el.querySelector('.fr-cell-fixed')) {\r\n      editor.el.querySelector('.fr-cell-fixed').classList.remove('fr-cell-fixed')\r\n    }\r\n\r\n    if (editor.el.querySelector('.fr-cell-handler')) {\r\n      editor.el.querySelector('.fr-cell-handler').classList.remove('fr-cell-handler')\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Remove selection from cells.\r\n   */\r\n  function _removeSelection() {\r\n    const cells = editor.$el.find('.fr-selected-cell')\r\n\r\n    if (cells.length > 0) {\r\n\r\n      // Remove selection.\r\n      cells.each(function () {\r\n        const $cell = $(this)\r\n\r\n        $cell.removeClass('fr-selected-cell')\r\n\r\n        if ($cell.attr('class') === '') {\r\n          $cell.removeAttr('class')\r\n        }\r\n      })\r\n    }\r\n\r\n    _removeKeyboardSelectionHandlers()\r\n  }\r\n\r\n  /*\r\n   * Clear selection to prevent Firefox cell selection.\r\n   */\r\n  function _clearSelection() {\r\n    editor.events.disableBlur()\r\n    editor.selection.clear()\r\n\r\n    // Prevent text selection while selecting multiple cells.\r\n    // Happens in Chrome.\r\n    editor.$el.addClass('fr-no-selection')\r\n\r\n    // Cursor will not appear if we don't make blur.\r\n    editor.$el.blur()\r\n    editor.events.enableBlur()\r\n  }\r\n\r\n  /*\r\n   * Get current selected cells coordintates.\r\n   */\r\n  function _currentSelection(map) {\r\n    const cells = editor.$el.find('.fr-selected-cell')\r\n    if (cells.length > 0) {\r\n      let min_i = map.length\r\n      let max_i = 0\r\n      let min_j = map[0].length\r\n      let max_j = 0\r\n      let i\r\n\r\n      for (i = 0; i < cells.length; i++) {\r\n        const cellOrigin = _cellOrigin(cells[i], map)\r\n        const cellEnd = _cellEnds(cellOrigin.row, cellOrigin.col, map)\r\n\r\n        min_i = Math.min(cellOrigin.row, min_i)\r\n        max_i = Math.max(cellEnd.row, max_i)\r\n        min_j = Math.min(cellOrigin.col, min_j)\r\n        max_j = Math.max(cellEnd.col, max_j)\r\n      }\r\n\r\n      return {\r\n        min_i: min_i,\r\n        max_i: max_i,\r\n        min_j: min_j,\r\n        max_j: max_j\r\n      }\r\n    }\r\n    else {\r\n      return null\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Minimum and maximum coordinates for the selection in the table map.\r\n   */\r\n  function _selectionLimits(min_i, max_i, min_j, max_j, map) {\r\n    let first_i = min_i\r\n    let last_i = max_i\r\n    let first_j = min_j\r\n    let last_j = max_j\r\n    let i\r\n    let j\r\n    let cellOrigin\r\n    let cellEnd\r\n\r\n    // Go through first and last columns.\r\n    for (i = first_i; i <= last_i; i++) {\r\n\r\n      // First column.\r\n      if ((parseInt($(map[i][first_j]).attr('rowspan'), 10) || 1) > 1 ||\r\n        (parseInt($(map[i][first_j]).attr('colspan'), 10) || 1) > 1) {\r\n        cellOrigin = _cellOrigin(map[i][first_j], map)\r\n        cellEnd = _cellEnds(cellOrigin.row, cellOrigin.col, map)\r\n\r\n        first_i = Math.min(cellOrigin.row, first_i)\r\n        last_i = Math.max(cellEnd.row, last_i)\r\n        first_j = Math.min(cellOrigin.col, first_j)\r\n        last_j = Math.max(cellEnd.col, last_j)\r\n      }\r\n\r\n      // Last column.\r\n      if ((parseInt($(map[i][last_j]).attr('rowspan'), 10) || 1) > 1 ||\r\n        (parseInt($(map[i][last_j]).attr('colspan'), 10) || 1) > 1) {\r\n        cellOrigin = _cellOrigin(map[i][last_j], map)\r\n        cellEnd = _cellEnds(cellOrigin.row, cellOrigin.col, map)\r\n\r\n        first_i = Math.min(cellOrigin.row, first_i)\r\n        last_i = Math.max(cellEnd.row, last_i)\r\n        first_j = Math.min(cellOrigin.col, first_j)\r\n        last_j = Math.max(cellEnd.col, last_j)\r\n      }\r\n    }\r\n\r\n    // Go through first and last rows.\r\n    for (j = first_j; j <= last_j; j++) {\r\n\r\n      // First row.\r\n      if ((parseInt($(map[first_i][j]).attr('rowspan'), 10) || 1) > 1 ||\r\n        (parseInt($(map[first_i][j]).attr('colspan'), 10) || 1) > 1) {\r\n        cellOrigin = _cellOrigin(map[first_i][j], map)\r\n        cellEnd = _cellEnds(cellOrigin.row, cellOrigin.col, map)\r\n\r\n        first_i = Math.min(cellOrigin.row, first_i)\r\n        last_i = Math.max(cellEnd.row, last_i)\r\n        first_j = Math.min(cellOrigin.col, first_j)\r\n        last_j = Math.max(cellEnd.col, last_j)\r\n      }\r\n\r\n      // Last column.\r\n      if ((parseInt($(map[last_i][j]).attr('rowspan'), 10) || 1) > 1 ||\r\n        (parseInt($(map[last_i][j]).attr('colspan'), 10) || 1) > 1) {\r\n        cellOrigin = _cellOrigin(map[last_i][j], map)\r\n        cellEnd = _cellEnds(cellOrigin.row, cellOrigin.col, map)\r\n\r\n        first_i = Math.min(cellOrigin.row, first_i)\r\n        last_i = Math.max(cellEnd.row, last_i)\r\n        first_j = Math.min(cellOrigin.col, first_j)\r\n        last_j = Math.max(cellEnd.col, last_j)\r\n      }\r\n    }\r\n\r\n    if (first_i == min_i && last_i == max_i && first_j == min_j && last_j == max_j) {\r\n      return {\r\n        min_i: min_i,\r\n        max_i: max_i,\r\n        min_j: min_j,\r\n        max_j: max_j\r\n      }\r\n\r\n    }\r\n    else {\r\n      return _selectionLimits(first_i, last_i, first_j, last_j, map)\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Get the left and right offset position for the current selection.\r\n   */\r\n  function _selectionOffset(map) {\r\n    const selection = _currentSelection(map)\r\n\r\n    // Return if no selected item\r\n    if(selection == null) {\r\n      return\r\n    }\r\n    \r\n    // Top left cell.\r\n    const $tl = $(map[selection.min_i][selection.min_j])\r\n\r\n    // Top right cell.\r\n    const $tr = $(map[selection.min_i][selection.max_j])\r\n\r\n    // Bottom left cell.\r\n    const $bl = $(map[selection.max_i][selection.min_j])\r\n\r\n    const left = $tl.length && $tl.offset().left\r\n    const right = $tr.length && $tr.offset().left + $tr.outerWidth()\r\n    const top = $tl.length && $tl.offset().top\r\n    const bottom = $bl.length && $bl.offset().top + $bl.outerHeight()\r\n\r\n    return {\r\n      left: left,\r\n      right: right,\r\n      top: top,\r\n      bottom: bottom\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Select table cells.\r\n   * firstCell is either the top left corner or the fr-cell-fixed corner of the selection.\r\n   * lastCell is either the bottom right corner ot the fr-cell-handler of the selection.\r\n   */\r\n  function selectCells(firstCell, lastCell) {\r\n\r\n    // If the first and last cells are the same then just select it.\r\n    if ($(firstCell).is(lastCell)) {\r\n\r\n      // Remove previous selection.\r\n      _removeSelection()\r\n\r\n      $(firstCell).addClass('fr-selected-cell')\r\n    }\r\n\r\n    // Select multiple cells.\r\n    else {\r\n      // Prevent Firefox cell selection.\r\n      _clearSelection()\r\n\r\n      // Turn editor toolbar off.\r\n      editor.edit.off()\r\n\r\n      // Create a table map.\r\n      const map = _tableMap()\r\n\r\n      // Get first and last cell's i and j map coordinates.\r\n      const firstCellOrigin = _cellOrigin(firstCell, map)\r\n      const lastCellOrigin = _cellOrigin(lastCell, map)\r\n\r\n      // Some cells between these coordinates might have colspan or rowspan.\r\n      // The selected area exceeds first and last cells' coordinates.\r\n      const limits = _selectionLimits(Math.min(firstCellOrigin.row, lastCellOrigin.row),\r\n        Math.max(firstCellOrigin.row, lastCellOrigin.row),\r\n        Math.min(firstCellOrigin.col, lastCellOrigin.col),\r\n        Math.max(firstCellOrigin.col, lastCellOrigin.col),\r\n        map)\r\n\r\n      // Remove previous selection.\r\n      _removeSelection()\r\n\r\n      // We always need to set the selection handler classes as user may use keyboard to select at anytime.\r\n      firstCell.classList.add('fr-cell-fixed')\r\n      lastCell.classList.add('fr-cell-handler')\r\n\r\n      // Select all cells between the first and last cell.\r\n      for (let i = limits.min_i; i <= limits.max_i; i++) {\r\n        for (let j = limits.min_j; j <= limits.max_j; j++) {\r\n\r\n          // Skip the cell if it's parent table is different from first clicked cell's parent table\r\n          if (!$(firstCell).closest('table').is($(map[i][j]).closest('table'))) continue\r\n          $(map[i][j]).addClass('fr-selected-cell')\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Get the cell under the mouse cursor.\r\n   */\r\n  function _getCellUnder(e) {\r\n    let cell = null\r\n    const $target = $(e.target)\r\n\r\n    if (e.target.tagName == 'TD' || e.target.tagName == 'TH') {\r\n      cell = e.target\r\n    }\r\n    //https://github.com/froala-labs/froala-editor-js-2/issues/1779\r\n    else if ($target.closest('th', $target.closest('thead')[0]).length > 0) {\r\n      cell = $target.closest('th', $target.closest('thead')[0]).get(0)\r\n    }\r\n    else if ($target.closest('td', $target.closest('tr')[0]).length > 0) {\r\n      cell = $target.closest('td', $target.closest('tr')[0]).get(0)\r\n    }\r\n    \r\n\r\n    // Cell should reside inside editor.\r\n    if (editor.$el.html.toString().search(cell) === -1) return null\r\n\r\n    return cell\r\n  }\r\n\r\n  /*\r\n   * Stop table cell editing and allow text editing.\r\n   */\r\n  function _stopEdit() {\r\n\r\n    // Clear previous selection.\r\n    _removeSelection()\r\n\r\n    // Hide table edit popup.\r\n    editor.popups.hide('table.edit')\r\n  }\r\n\r\n  /*\r\n   * Mark that mouse is down.\r\n   */\r\n  function _mouseDown(e) {\r\n    const cell = _getCellUnder(e)\r\n\r\n    if ($(cell).parents('[contenteditable]').not('.fr-element').not('.fr-img-caption').not('body').first().attr('contenteditable') == 'false') return true\r\n\r\n    // Stop table editing if user clicks outside the table.\r\n    if (selectedCells().length > 0 && !cell) {\r\n      _stopEdit()\r\n    }\r\n\r\n    // Only do mouseDown if the editor is not disabled by user.\r\n    if (!editor.edit.isDisabled() || editor.popups.isVisible('table.edit')) {\r\n\r\n      // On left click.\r\n      if (e.which == 1 && !(e.which == 1 && editor.helpers.isMac() && e.ctrlKey)) {\r\n        mouseDownFlag = true\r\n\r\n        // User clicked on a table cell.\r\n        if (cell) {\r\n\r\n          // We always have to clear previous selection except when using shift key to select multiple cells.\r\n          if (selectedCells().length > 0 && !e.shiftKey) {\r\n            _stopEdit()\r\n          }\r\n\r\n          e.stopPropagation()\r\n\r\n          editor.events.trigger('image.hideResizer')\r\n          editor.events.trigger('video.hideResizer')\r\n\r\n          // Keep record of left mouse click being down\r\n          mouseDownCellFlag = true\r\n\r\n          const tag_name = cell.tagName.toLowerCase()\r\n\r\n          // Select multiple cells using Shift key\r\n          if (e.shiftKey && editor.$el.find(`${tag_name}.fr-selected-cell`).length > 0) {\r\n\r\n            // Cells must be in the same table.\r\n            if ($(editor.$el.find(`${tag_name}.fr-selected-cell`).closest('table')).is($(cell).closest('table'))) {\r\n\r\n              // Select cells between.\r\n              selectCells(mouseDownCell, cell)\r\n\r\n              // Do nothing if cells are not in the same table.\r\n            }\r\n            else {\r\n\r\n              // Prevent Firefox selection.\r\n              _clearSelection()\r\n            }\r\n          }\r\n\r\n          else {\r\n\r\n            // Prevent Firefox selection for ctrl / cmd key.\r\n            // https://github.com/froala/wysiwyg-editor/issues/1323:\r\n            //  - we have more than one cell selected or\r\n            //  - selection is starting in another cell than the one we clicked on.\r\n            if ((editor.keys.ctrlKey(e) || e.shiftKey) && (selectedCells().length > 1 || ($(cell).find(editor.selection.element()).length === 0 && !$(cell).is(editor.selection.element())))) {\r\n              _clearSelection()\r\n            }\r\n\r\n            // Save cell where mouse has been clicked\r\n            mouseDownCell = cell\r\n\r\n            // Select cell.\r\n            if (editor.opts.tableEditButtons.length > 0) {\r\n              selectCells(mouseDownCell, mouseDownCell)\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // On right click stop table editing.\r\n      else if ((e.which == 3 || (e.which == 1 && editor.helpers.isMac() && e.ctrlKey)) && cell) {\r\n        _stopEdit()\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Notify that mouse is no longer pressed.\r\n   */\r\n  function _mouseUp(e) {\r\n\r\n    // Mouse down started in a popup and ends in the editor.\r\n    // https://github.com/froala/wysiwyg-editor/issues/3190\r\n    // Toolbar freezes with checkboxes inside table\r\n    // https://github.com/froala-labs/froala-editor-js-2/issues/1859\r\n    if (!editor.edit.isDisabled() && editor.popups.areVisible()) {\r\n      return true;\r\n    }\r\n\r\n    // User clicked somewhere else in the editor (except the toolbar).\r\n    // We need this because mouse down is not triggered outside the editor.\r\n    if (!mouseDownCellFlag && !editor.$tb.is(e.target) && !editor.$tb.is($(e.target).closest('.fr-toolbar'))) {\r\n      if (selectedCells().length > 0) {\r\n        editor.toolbar.enable()\r\n      }\r\n\r\n      _removeSelection()\r\n    }\r\n\r\n    // On left click.\r\n    if (e.which == 1 && !(e.which == 1 && editor.helpers.isMac() && e.ctrlKey)) {\r\n      mouseDownFlag = false\r\n\r\n      // Mouse down was in a table cell.\r\n      if (mouseDownCellFlag) {\r\n\r\n        // Left click is no longer pressed.\r\n        mouseDownCellFlag = false\r\n\r\n        const cell = _getCellUnder(e)\r\n\r\n        // If we have one selected cell and mouse is lifted somewhere else.\r\n        if (!cell && selectedCells().length == 1) {\r\n\r\n          // We have a text selection and not cell selection.\r\n          _removeSelection()\r\n        }\r\n\r\n        // If there are selected cells then show table edit popup.\r\n        else if (selectedCells().length > 0) {\r\n          if (editor.selection.isCollapsed()) {\r\n            _showEditPopup()\r\n          }\r\n\r\n          // No text selection.\r\n          else {\r\n            _removeSelection()\r\n            editor.edit.on();\r\n          }\r\n        }\r\n\r\n        // Enable editing if the mouse was clicked inside a cell but no cells selected.\r\n        else if (!selectedCells().length) {\r\n        // Allow text selection.\r\n          editor.$el.removeClass('fr-no-selection')\r\n          editor.edit.on()\r\n        }\r\n      }\r\n\r\n      // Resizing stops.\r\n      if (resizingFlag) {\r\n        resizingFlag = false\r\n\r\n        $resizer.removeClass('fr-moving')\r\n\r\n        // Allow text selection.\r\n        editor.$el.removeClass('fr-no-selection')\r\n        editor.edit.on()\r\n\r\n        // Set release Y coordinate.\r\n        let left = parseFloat($resizer.css('left')) + editor.opts.tableResizerOffset + editor.$wp.offset().left\r\n\r\n        if (editor.opts.iframe) {\r\n          left -= editor.$iframe.offset().left\r\n        }\r\n        $resizer.data('release-position', left)\r\n\r\n        // Clear resizing limits.\r\n        $resizer.removeData('max-left')\r\n        $resizer.removeData('max-right')\r\n\r\n        // Resize.\r\n        _resize(e)\r\n\r\n        // Hide resizer.\r\n        _hideResizer()\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * User drags mouse over multiple cells to select them.\r\n   */\r\n  function _mouseEnter(e) {\r\n\r\n    // Check if the mouse is moving inside the same cell only and return control as it cannot be considered as mouse enter.\r\n    if ($(e.currentTarget).is($(e.originalEvent.relatedTarget)) ||\r\n      e.currentTarget.contains(e.originalEvent.relatedTarget) ||\r\n      (e.originalEvent.relatedTarget && e.originalEvent.relatedTarget.contains(e.currentTarget))) {\r\n      return\r\n    }\r\n\r\n    // https://github.com/froala-labs/froala-editor-js-2/issues/1859\r\n    editor.events.$on($('input'), 'click',_inputOnClick)\r\n    if (mouseDownCellFlag === true && editor.opts.tableEditButtons.length > 0) {\r\n      const $cell = $(e.currentTarget)\r\n\r\n      // Cells should be in the same table.\r\n      if ($cell.closest('table').is(selectedTable())) {\r\n\r\n        // Don't select both ths and tds.\r\n        if (e.currentTarget.tagName == 'TD' && editor.$el.find('th.fr-selected-cell').length === 0) {\r\n\r\n          // Select cells between.\r\n          selectCells(mouseDownCell, e.currentTarget)\r\n\r\n          return\r\n        }\r\n\r\n        else if (e.currentTarget.tagName == 'TH' && editor.$el.find('td.fr-selected-cell').length === 0) {\r\n\r\n          // Select cells between.\r\n          selectCells(mouseDownCell, e.currentTarget)\r\n\r\n          return\r\n        }\r\n      }\r\n\r\n      // Prevent firefox selection.\r\n      _clearSelection()\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Move cursor in a nested table.\r\n   */\r\n  function _moveInNestedTable(cell, direction) {\r\n    let table = cell\r\n\r\n    // Get parent table (editor might be initialized inside cell).\r\n    while (table && table.tagName != 'TABLE' && table.parentNode != editor.el) {\r\n      table = table.parentNode\r\n    }\r\n\r\n    if (table && table.tagName == 'TABLE') {\r\n      const new_map = _tableMap($(table))\r\n\r\n      // Move up in the parent table.\r\n      if (direction == 'up') _moveUp(_cellOrigin(cell, new_map), table, new_map)\r\n      else if (direction == 'down') _moveDown(_cellOrigin(cell, new_map), table, new_map)\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Move cursor up or down outside table.\r\n   */\r\n  function _moveWithArrows(origin, table, map, direction) {\r\n    let up = table\r\n    let sibling\r\n\r\n    // Look up in DOM for the previous or next element.\r\n    while (up != editor.el) {\r\n\r\n      // Nested table.\r\n      if (up.tagName == 'TD' || up.tagName == 'TH') {\r\n        break\r\n      }\r\n\r\n      // The table has a sibling element.\r\n      if (direction == 'up') sibling = up.previousElementSibling\r\n      else if (direction == 'down') sibling = up.nextElementSibling\r\n\r\n      if (sibling) {\r\n        break\r\n      }\r\n\r\n      // Table might be in a block tag.\r\n      up = up.parentNode\r\n    }\r\n\r\n    // We have another table (nested).\r\n    if (up.tagName == 'TD' || up.tagName == 'TH') {\r\n      _moveInNestedTable(up, direction)\r\n    }\r\n\r\n    // Table has a sibling.\r\n    else if (sibling) {\r\n      if (direction == 'up') editor.selection.setAtEnd(sibling)\r\n\r\n      if (direction == 'down') editor.selection.setAtStart(sibling)\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Move cursor up while in table cell.\r\n   */\r\n  function _moveUp(origin, table, map) {\r\n    // If tribute container is opened, then cancel cursor movement on cells\r\n    if ($('.tribute-container').length > 0 && $('.tribute-container').css('display') != 'none'){\r\n      return\r\n    }\r\n\r\n    // Not the first line.\r\n    if (origin.row > 0) {\r\n      editor.selection.setAtEnd(map[origin.row - 1][origin.col])\r\n    }\r\n\r\n    // First line.\r\n    else {\r\n      _moveWithArrows(origin, table, map, 'up')\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Move cursor down while in table cell.\r\n   */\r\n  function _moveDown(origin, table, map) {\r\n    // If tribute container is opened, then cancel cursor movement on cells\r\n    if ($('.tribute-container').length > 0 && $('.tribute-container').css('display') != 'none'){\r\n      return\r\n    }\r\n\r\n    // Cell might have rowspan.\r\n    const row = parseInt(map[origin.row][origin.col].getAttribute('rowspan'), 10) || 1\r\n\r\n    // Not the last line.\r\n    if (origin.row < map.length - row) {\r\n      editor.selection.setAtStart(map[origin.row + row][origin.col])\r\n    }\r\n\r\n    // Last line.\r\n    else {\r\n      _moveWithArrows(origin, table, map, 'down')\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Using the arrow keys to move the cursor through the table will not select cells.\r\n   */\r\n  function _navigateWithArrows(e) {\r\n    const key_code = e.which\r\n\r\n    // Get current selection.\r\n    let sel = editor.selection.blocks()\r\n\r\n    if (sel.length) {\r\n      sel = sel[0]\r\n\r\n      // Selection should be in a table cell.\r\n      if (sel.tagName == 'TD' || sel.tagName == 'TH') {\r\n        let table = sel\r\n\r\n        // Get parent table (editor might be initialized inside cell).\r\n        while (table && table.tagName != 'TABLE' && table.parentNode != editor.el) {\r\n          table = table.parentNode\r\n        }\r\n\r\n        if (table && table.tagName == 'TABLE') {\r\n          if (FE.KEYCODE.ARROW_LEFT == key_code || FE.KEYCODE.ARROW_UP == key_code || FE.KEYCODE.ARROW_RIGHT == key_code || FE.KEYCODE.ARROW_DOWN == key_code) {\r\n            if (selectedCells().length > 0) {\r\n              _stopEdit()\r\n            }\r\n\r\n            // Up and down in Webkit.\r\n            if (editor.browser.webkit && (FE.KEYCODE.ARROW_UP == key_code || FE.KEYCODE.ARROW_DOWN == key_code)) {\r\n              const node = editor.selection.ranges(0).startContainer\r\n\r\n              if (node.nodeType == Node.TEXT_NODE &&\r\n                ((FE.KEYCODE.ARROW_UP == key_code && ((node.previousSibling && node.previousSibling.tagName !== 'BR') || (node.previousSibling && node.previousSibling.tagName === 'BR' && node.previousSibling.previousSibling)) ||\r\n                (FE.KEYCODE.ARROW_DOWN == key_code && ((node.nextSibling && node.nextSibling.tagName !== 'BR') || (node.nextSibling && node.nextSibling.tagName === 'BR' && node.nextSibling.nextSibling))\r\n                )))) {\r\n                return\r\n              }\r\n\r\n              e.preventDefault()\r\n              e.stopPropagation()\r\n\r\n              // Table map.\r\n              const map = _tableMap($(table))\r\n\r\n              // Current cell map coordinates.\r\n              const origin = _cellOrigin(sel, map)\r\n\r\n              // Arrow up\r\n              if (FE.KEYCODE.ARROW_UP == key_code) {\r\n                _moveUp(origin, table, map)\r\n              }\r\n\r\n              // Arrow down\r\n              else if (FE.KEYCODE.ARROW_DOWN == key_code) {\r\n                _moveDown(origin, table, map)\r\n              }\r\n\r\n              // Update cursor position.\r\n              editor.selection.restore()\r\n\r\n              return false\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Initilize table resizer.\r\n   */\r\n  function _initResizer() {\r\n\r\n    // Append resizer HTML to editor wrapper.\r\n    if (!editor.shared.$table_resizer) editor.shared.$table_resizer = $(document.createElement('div')).attr('class', 'fr-table-resizer').html('<div></div>')\r\n    $resizer = editor.shared.$table_resizer\r\n\r\n    // Resize table. Mousedown.\r\n    editor.events.$on($resizer, 'mousedown', function (e) {\r\n      if (!editor.core.sameInstance($resizer)) return true\r\n\r\n      // Stop table editing.\r\n      if (selectedCells().length > 0) {\r\n        _stopEdit()\r\n      }\r\n\r\n      // Resize table only using left click.\r\n      if (e.which == 1) {\r\n\r\n        // Save selection so that we can put cursor back at the end.\r\n        editor.selection.save()\r\n\r\n        resizingFlag = true\r\n\r\n        $resizer.addClass('fr-moving')\r\n\r\n        // Prevent text selection while dragging the table resizer.\r\n        _clearSelection()\r\n\r\n        // Turn editor toolbar off while resizing.\r\n        editor.edit.off()\r\n\r\n        // Show resizer.\r\n        $resizer.find('div').css('opacity', 1)\r\n\r\n        // Prevent selecting text when doing resize.\r\n        return false\r\n      }\r\n    })\r\n\r\n    // Mousemove on table resizer.\r\n    editor.events.$on($resizer, 'mousemove', function (e) {\r\n      if (!editor.core.sameInstance($resizer)) return true\r\n\r\n      if (resizingFlag) {\r\n        if (editor.opts.iframe) {\r\n          e.pageX -= editor.$iframe.offset().left\r\n        }\r\n\r\n        _mouseMove(e)\r\n      }\r\n    })\r\n\r\n    // Editor destroy.\r\n    editor.events.on('shared.destroy', function () {\r\n      $resizer.html('').removeData().remove()\r\n      $resizer = null\r\n    }, true)\r\n\r\n    editor.events.on('destroy', function () {\r\n      editor.$el.find('.fr-selected-cell').removeClass('fr-selected-cell')\r\n      $('body').first().append($resizer.hide())\r\n    }, true)\r\n  }\r\n\r\n  /*\r\n   * Also clears top and left values, so it doesn't interfer with the insert helper.\r\n   */\r\n  function _hideResizer() {\r\n    if ($resizer) {\r\n      $resizer.find('div').css('opacity', 0)\r\n      $resizer.css('top', 0)\r\n      $resizer.css('left', 0)\r\n      $resizer.css('height', 0)\r\n      $resizer.find('div').css('height', 0)\r\n      $resizer.hide()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Hide the insert helper.\r\n   */\r\n  function _hideInsertHelper() {\r\n    if ($insert_helper) $insert_helper.removeClass('fr-visible').css('left', '-9999px')\r\n  }\r\n\r\n  /*\r\n   * Place the table resizer between the columns where the mouse is.\r\n   */\r\n  function _placeResizer(e, tag_under) {\r\n    let $tag_under = $(tag_under)\r\n    const $table = $tag_under.closest('table')\r\n    const $table_parent = $table.parent()\r\n\r\n    // We might have another tag inside the table cell.\r\n    if (tag_under && (tag_under.tagName != 'TD' && tag_under.tagName != 'TH')) {\r\n      if ($tag_under.closest('td').length > 0) {\r\n        tag_under = $tag_under.closest('td')\r\n      }\r\n      else if ($tag_under.closest('th').length > 0) {\r\n        tag_under = $tag_under.closest('th')\r\n      }\r\n    }\r\n\r\n    // The tag should be a table cell (TD or TH).\r\n    if (tag_under && (tag_under.tagName == 'TD' || tag_under.tagName == 'TH')) {\r\n      $tag_under = $(tag_under)\r\n\r\n      // https://github.com/froala/wysiwyg-editor/issues/786.\r\n      if (editor.$el.find($tag_under).length === 0) return false\r\n\r\n      // Tag's left and right coordinate.\r\n      const tag_left = $tag_under.offset().left - 1\r\n      const tag_right = tag_left + $tag_under.outerWidth()\r\n\r\n      // Only if the mouse is close enough to the left or right edges.\r\n      if (Math.abs(e.pageX - tag_left) <= editor.opts.tableResizerOffset ||\r\n        Math.abs(tag_right - e.pageX) <= editor.opts.tableResizerOffset) {\r\n\r\n        // Create a table map.\r\n        const map = _tableMap($table)\r\n        const tag_origin = _cellOrigin(tag_under, map)\r\n\r\n        const tag_end = _cellEnds(tag_origin.row, tag_origin.col, map)\r\n\r\n        // The column numbers from the map that have to be resized.\r\n        let first\r\n        let second\r\n\r\n        // Table resizer position and height.\r\n        const resizer_top = $table.offset().top\r\n        const resizer_height = $table.outerHeight() - 1\r\n        let resizer_left\r\n\r\n        // The left and right limits between which the resizer can be moved.\r\n        let max_left\r\n        let max_right\r\n\r\n        if (editor.opts.direction != 'rtl') {\r\n\r\n          // Mouse is near the cells's left margin.\r\n          if (e.pageX - tag_left <= editor.opts.tableResizerOffset) {\r\n\r\n            // Table resizer's left position.\r\n            resizer_left = tag_left\r\n\r\n            // Resize cells.\r\n            if (tag_origin.col > 0) {\r\n\r\n              // Left limit.\r\n              max_left = tag_left - _columnWidth(tag_origin.col - 1, map) + editor.opts.tableResizingLimit\r\n\r\n              // Right limit.\r\n              max_right = tag_left + _columnWidth(tag_origin.col, map) - editor.opts.tableResizingLimit\r\n\r\n              // Columns to resize.\r\n              first = tag_origin.col - 1\r\n              second = tag_origin.col\r\n            }\r\n\r\n            // Resize table.\r\n            else {\r\n\r\n              // Columns to resize.\r\n              first = null\r\n              second = 0\r\n\r\n              // Resizer limits.\r\n              max_left = $table.offset().left - 1 - parseInt($table.css('margin-left'), 10)\r\n              max_right = $table.offset().left - 1 + $table.width() - map[0].length * editor.opts.tableResizingLimit\r\n            }\r\n          }\r\n\r\n          // Mouse is near the cell's right margin.\r\n          else if (tag_right - e.pageX <= editor.opts.tableResizerOffset) {\r\n\r\n            // Table resizer's left possition.\r\n            resizer_left = tag_right\r\n\r\n            // Check for next td.\r\n            if (tag_end.col < map[tag_end.row].length && map[tag_end.row][tag_end.col + 1]) {\r\n\r\n              // Left limit.\r\n              max_left = tag_right - _columnWidth(tag_end.col, map) + editor.opts.tableResizingLimit\r\n\r\n              // Right limit.\r\n              max_right = tag_right + _columnWidth(tag_end.col + 1, map) - editor.opts.tableResizingLimit\r\n\r\n              // Columns to resize.\r\n              first = tag_end.col\r\n              second = tag_end.col + 1\r\n            }\r\n\r\n            // Resize table.\r\n            else {\r\n\r\n              // Columns to resize.\r\n              first = tag_end.col\r\n              second = null\r\n\r\n              // Resizer limits.\r\n              max_left = $table.offset().left - 1 + map[0].length * editor.opts.tableResizingLimit\r\n              max_right = $table_parent.offset().left - 1 + $table_parent.width() + parseFloat($table_parent.css('padding-left'))\r\n            }\r\n          }\r\n        }\r\n\r\n        // RTL\r\n        else {\r\n\r\n          // Mouse is near the cell's right margin.\r\n          if (tag_right - e.pageX <= editor.opts.tableResizerOffset) {\r\n\r\n            // Table resizer's left position.\r\n            resizer_left = tag_right\r\n\r\n            // Resize cells.\r\n            if (tag_origin.col > 0) {\r\n\r\n              // Left limit.\r\n              max_left = tag_right - _columnWidth(tag_origin.col, map) + editor.opts.tableResizingLimit\r\n\r\n              // Right limit.\r\n              max_right = tag_right + _columnWidth(tag_origin.col - 1, map) - editor.opts.tableResizingLimit\r\n\r\n              // Columns to resize.\r\n              first = tag_origin.col\r\n              second = tag_origin.col - 1\r\n            }\r\n\r\n            // Resize table.\r\n            else {\r\n              first = null\r\n              second = 0\r\n\r\n              // Resizer limits.\r\n              max_left = $table.offset().left + map[0].length * editor.opts.tableResizingLimit\r\n              max_right = $table_parent.offset().left - 1 + $table_parent.width() + parseFloat($table_parent.css('padding-left'))\r\n            }\r\n          }\r\n\r\n          // Mouse is near the cell's left margin.\r\n          else if (e.pageX - tag_left <= editor.opts.tableResizerOffset) {\r\n\r\n            // Table resizer's left position.\r\n            resizer_left = tag_left\r\n\r\n            // Check for next td.\r\n            if (tag_end.col < map[tag_end.row].length && map[tag_end.row][tag_end.col + 1]) {\r\n\r\n              // Left limit.\r\n              max_left = tag_left - _columnWidth(tag_end.col + 1, map) + editor.opts.tableResizingLimit\r\n\r\n              // Right limit.\r\n              max_right = tag_left + _columnWidth(tag_end.col, map) - editor.opts.tableResizingLimit\r\n\r\n              // Columns to resize.\r\n              first = tag_end.col + 1\r\n              second = tag_end.col\r\n            }\r\n\r\n            // Resize table.\r\n            else {\r\n\r\n              // Columns to resize.\r\n              first = tag_end.col\r\n              second = null\r\n\r\n              // Resizer limits.\r\n              max_left = $table_parent.offset().left + parseFloat($table_parent.css('padding-left'))\r\n              max_right = $table.offset().left - 1 + $table.width() - map[0].length * editor.opts.tableResizingLimit\r\n            }\r\n          }\r\n        }\r\n\r\n        if (!$resizer) _initResizer()\r\n\r\n        // Save table.\r\n        $resizer.data('table', $table)\r\n\r\n        // Save columns to resize.\r\n        $resizer.data('first', first)\r\n        $resizer.data('second', second)\r\n\r\n        $resizer.data('instance', editor)\r\n        editor.$wp.append($resizer)\r\n\r\n        let left = resizer_left - editor.win.pageXOffset - editor.opts.tableResizerOffset - editor.$wp.offset().left\r\n        let top = resizer_top - editor.$wp.offset().top + editor.$wp.scrollTop()\r\n\r\n        if (editor.opts.iframe) {\r\n          const iframePaddingTop = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-top'))\r\n          const iframePaddingLeft = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-left'))\r\n          left += editor.$iframe.offset().left + iframePaddingLeft\r\n          top += editor.$iframe.offset().top + iframePaddingTop\r\n\r\n          max_left += editor.$iframe.offset().left\r\n          max_right += editor.$iframe.offset().left\r\n        }\r\n\r\n        // Set resizing limits.\r\n        $resizer.data('max-left', max_left)\r\n        $resizer.data('max-right', max_right)\r\n\r\n        // Initial position of the resizer\r\n        $resizer.data('origin', resizer_left - editor.win.pageXOffset)\r\n\r\n        // Set table resizer's top, left and height.\r\n        $resizer.css('top', top)\r\n        $resizer.css('left', left)\r\n        $resizer.css('height', resizer_height)\r\n        $resizer.find('div').css('height', resizer_height)\r\n\r\n        // Set padding according to tableResizerOffset.\r\n        $resizer.css('padding-left', editor.opts.tableResizerOffset)\r\n        $resizer.css('padding-right', editor.opts.tableResizerOffset)\r\n\r\n        // Show table resizer.\r\n        $resizer.show()\r\n      }\r\n\r\n      // Hide resizer when the mouse moves away from the cell's border.\r\n      else {\r\n        if (editor.core.sameInstance($resizer)) _hideResizer()\r\n      }\r\n    }\r\n\r\n    // Hide resizer if mouse is no longer over it.\r\n    else if ($resizer && $tag_under.get(0) != $resizer.get(0) && $tag_under.parent().get(0) != $resizer.get(0)) {\r\n      if (editor.core.sameInstance($resizer)) _hideResizer()\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Show the insert column helper button.\r\n   */\r\n  function _showInsertColHelper(e, table) {\r\n    if (editor.$box.find('.fr-line-breaker').isVisible()) return false\r\n\r\n    // Insert Helper.\r\n    if (!$insert_helper) _initInsertHelper()\r\n\r\n    editor.$box.append($insert_helper)\r\n    $insert_helper.data('instance', editor)\r\n    const $table = $(table)\r\n    const $row = $table.find('tr').first()\r\n    const mouseX = e.pageX\r\n    let left = 0\r\n    let top = 0\r\n    \r\n    if (editor.opts.iframe) {\r\n      const iframePaddingTop = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-top'))\r\n      const iframePaddingLeft = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-left'))\r\n      left += editor.$iframe.offset().left - editor.helpers.scrollLeft() + iframePaddingLeft\r\n      top += editor.$iframe.offset().top - editor.helpers.scrollTop() + iframePaddingTop\r\n    }\r\n\r\n    // Check where the column should be inserted.\r\n    let btn_width\r\n\r\n    $row.find('th, td').each(function () {\r\n      const $td = $(this)\r\n\r\n      // Insert before this td.\r\n      if ($td.offset().left <= mouseX && mouseX < $td.offset().left + $td.outerWidth() / 2) {\r\n        btn_width = parseInt($insert_helper.find('a').css('width'), 10)\r\n        $insert_helper.css('top', top + $td.offset().top - editor.$box.offset().top - btn_width - 5)\r\n        $insert_helper.css('left', left + $td.offset().left - editor.$box.offset().left - btn_width / 2)\r\n        $insert_helper.data('selected-cell', $td)\r\n        $insert_helper.data('position', 'before')\r\n        $insert_helper.addClass('fr-visible')\r\n\r\n        return false\r\n\r\n        // Insert after this td.\r\n      }\r\n      else if ($td.offset().left + $td.outerWidth() / 2 <= mouseX && mouseX < $td.offset().left + $td.outerWidth()) {\r\n        btn_width = parseInt($insert_helper.find('a').css('width'), 10)\r\n\r\n        $insert_helper.css('top', top + $td.offset().top - editor.$box.offset().top - btn_width - 5)\r\n        $insert_helper.css('left', left + $td.offset().left - editor.$box.offset().left + $td.outerWidth() - btn_width / 2)\r\n        $insert_helper.data('selected-cell', $td)\r\n        $insert_helper.data('position', 'after')\r\n        $insert_helper.addClass('fr-visible')\r\n\r\n        return false\r\n      }\r\n    })\r\n  }\r\n\r\n  /*\r\n   * Show the insert row helper button.\r\n   */\r\n  function _showInsertRowHelper(e, table) {\r\n    if (editor.$box.find('.fr-line-breaker').isVisible()) return false\r\n\r\n    if (!$insert_helper) _initInsertHelper()\r\n\r\n    editor.$box.append($insert_helper)\r\n    $insert_helper.data('instance', editor)\r\n    const $table = $(table)\r\n    const mouseY = e.pageY\r\n    let left = 0\r\n    let top = 0\r\n\r\n    if (editor.opts.iframe) {\r\n      const iframePaddingTop = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-top'))\r\n      const iframePaddingLeft = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-left'))\r\n      left += editor.$iframe.offset().left - editor.helpers.scrollLeft() + iframePaddingLeft\r\n      top += editor.$iframe.offset().top - editor.helpers.scrollTop() + iframePaddingTop\r\n    }\r\n\r\n    // Check where the row should be inserted.\r\n    let btn_width\r\n\r\n    $table.find('tr').each(function () {\r\n      const $tr = $(this)\r\n\r\n      // Insert above this tr.\r\n      if ($tr.offset().top <= mouseY && mouseY < $tr.offset().top + $tr.outerHeight() / 2) {\r\n        btn_width = parseInt($insert_helper.find('a').css('width'), 10)\r\n\r\n        $insert_helper.css('top', top + $tr.offset().top - editor.$box.offset().top - btn_width / 2)\r\n        $insert_helper.css('left', left + $tr.offset().left - editor.$box.offset().left - btn_width - 5)\r\n        $insert_helper.data('selected-cell', $tr.find('td').first())\r\n        $insert_helper.data('position', 'above')\r\n        $insert_helper.addClass('fr-visible')\r\n\r\n        return false\r\n\r\n        // Insert below this tr.\r\n      }\r\n      else if ($tr.offset().top + $tr.outerHeight() / 2 <= mouseY && mouseY < $tr.offset().top + $tr.outerHeight()) {\r\n        btn_width = parseInt($insert_helper.find('a').css('width'), 10)\r\n\r\n        $insert_helper.css('top', top + $tr.offset().top - editor.$box.offset().top + $tr.outerHeight() - btn_width / 2)\r\n        $insert_helper.css('left', left + $tr.offset().left - editor.$box.offset().left - btn_width - 5)\r\n        $insert_helper.data('selected-cell', $tr.find('td').first())\r\n        $insert_helper.data('position', 'below')\r\n        $insert_helper.addClass('fr-visible')\r\n\r\n        return false\r\n      }\r\n    })\r\n  }\r\n\r\n  /*\r\n   * Check if should show the insert column / row helper button.\r\n   */\r\n  function _insertHelper(e, tag_under) {\r\n\r\n    // Don't show the insert helper if there are table cells selected.\r\n    if (selectedCells().length === 0) {\r\n      let i\r\n      let tag_below\r\n      let tag_right\r\n\r\n      // Tag is the editor element or body (inline toolbar). Look for closest tag bellow and at the right.\r\n      if (tag_under && (tag_under.tagName == 'HTML' || tag_under.tagName == 'BODY' || editor.node.isElement(tag_under))) {\r\n\r\n        // Look 1px down until a table tag is found or the insert helper offset is reached.\r\n        for (i = 1; i <= editor.opts.tableInsertHelperOffset; i++) {\r\n\r\n          // Look for tag below.\r\n          tag_below = editor.doc.elementFromPoint(e.pageX - editor.win.pageXOffset, e.pageY - editor.win.pageYOffset + i)\r\n\r\n          // We're on tooltip.\r\n          if ($(tag_below).hasClass('fr-tooltip')) return true\r\n\r\n          // We found a tag bellow.\r\n          // https://github.com/froala-labs/froala-editor-js-2/issues/1571\r\n          // Condition added to avoid showing insert helper when the table has contenteditable:false\r\n          if (tag_below && ((tag_below.tagName == 'TH' || tag_below.tagName == 'TD' || tag_below.tagName == 'TABLE') && ($(tag_below).parents('.fr-wrapper').length || editor.opts.iframe) && $(tag_below).closest('table').attr('contenteditable') != 'false')) {\r\n\r\n            // Show the insert column helper button.\r\n            _showInsertColHelper(e, $(tag_below).closest('table'))\r\n\r\n            return true\r\n          }\r\n\r\n          // Look for tag at the right.\r\n          tag_right = editor.doc.elementFromPoint(e.pageX - editor.win.pageXOffset + i, e.pageY - editor.win.pageYOffset)\r\n\r\n          // We're on tooltip.\r\n          if ($(tag_right).hasClass('fr-tooltip')) return true\r\n\r\n          // We found a tag at the right.\r\n          // https://github.com/froala-labs/froala-editor-js-2/issues/1571\r\n          // Condition added to avoid showing insert helper when the table has contenteditable:false\r\n          if (tag_right && ((tag_right.tagName == 'TH' || tag_right.tagName == 'TD' || tag_right.tagName == 'TABLE') && ($(tag_right).parents('.fr-wrapper').length || editor.opts.iframe)) && $(tag_right).closest('table').attr('contenteditable') != 'false') {\r\n\r\n            // Show the insert row helper button.\r\n            _showInsertRowHelper(e, $(tag_right).closest('table'))\r\n\r\n            return true\r\n          }\r\n        }\r\n      }\r\n\r\n      // Hide insert helper.\r\n      if (editor.core.sameInstance($insert_helper)) {\r\n        _hideInsertHelper()\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Check tag under the mouse on mouse move.\r\n   */\r\n  function _tagUnder(e) {\r\n    mouseMoveTimer = null\r\n\r\n    // The tag under the mouse cursor.\r\n    const tag_under = editor.doc.elementFromPoint(e.pageX - editor.win.pageXOffset, e.pageY - editor.win.pageYOffset)\r\n\r\n    // Place table resizer if necessary.\r\n    if (editor.opts.tableResizer && (!editor.popups.areVisible() || (editor.popups.areVisible() && editor.popups.isVisible('table.edit')))) {\r\n      _placeResizer(e, tag_under)\r\n    }\r\n\r\n    // Show the insert column / row helper button.\r\n    if (editor.opts.tableInsertHelper && !editor.popups.areVisible() && !(editor.$tb.hasClass('fr-inline') && editor.$tb.isVisible())) {\r\n      _insertHelper(e, tag_under)\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Repositon the resizer if the user scrolls while resizing.\r\n   */\r\n  function _repositionResizer() {\r\n    if (resizingFlag) {\r\n      const $table = $resizer.data('table')\r\n      let top = $table.offset().top - editor.win.pageYOffset\r\n\r\n      if (editor.opts.iframe) {\r\n        const iframePaddingTop = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-top'))\r\n        top += editor.$iframe.offset().top - editor.helpers.scrollTop() + iframePaddingTop\r\n      }\r\n\r\n      $resizer.css('top', top)\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Resize table method.\r\n   */\r\n  function _resize() {\r\n\r\n    // Resizer initial position.\r\n    const initial_positon = $resizer.data('origin')\r\n\r\n    // Resizer release position.\r\n    const release_position = $resizer.data('release-position')\r\n\r\n    // Do resize only if the resizer's position has changed.\r\n    if (initial_positon !== release_position) {\r\n\r\n      // Columns that have to be resized.\r\n      const first = $resizer.data('first')\r\n      const second = $resizer.data('second')\r\n\r\n      const $table = $resizer.data('table')\r\n      const table_width = $table.outerWidth()\r\n\r\n      if (!editor.undo.canDo()) editor.undo.saveStep()\r\n\r\n      // Resize columns and not the table.\r\n      if (first != null && second != null) {\r\n\r\n        // Create a table map.\r\n        const map = _tableMap($table)\r\n\r\n        // Got through all cells on these columns and get their initial width.\r\n        const first_widths = []\r\n        const first_percentages = []\r\n        const second_widths = []\r\n        const second_percentages = []\r\n        let i\r\n        let $first_cell\r\n        let $second_cell\r\n\r\n        // We must do this before updating widths.\r\n        for (i = 0; i < map.length; i++) {\r\n          $first_cell = $(map[i][first])\r\n          $second_cell = $(map[i][second])\r\n\r\n          // Widths in px.\r\n          first_widths[i] = $first_cell.outerWidth()\r\n          second_widths[i] = $second_cell.outerWidth()\r\n\r\n          // Widths in percentages.\r\n          first_percentages[i] = first_widths[i] / table_width * 100\r\n          second_percentages[i] = second_widths[i] / table_width * 100\r\n        }\r\n\r\n        // Got through all cells on these columns and update their widths.\r\n        for (i = 0; i < map.length; i++) {\r\n          $first_cell = $(map[i][first])\r\n          $second_cell = $(map[i][second])\r\n\r\n          // There is a colspan.\r\n          if (map[i][first] != map[i][second]) {\r\n            // New percentage for the first cell.\r\n            const first_cell_percentage = (first_percentages[i] * (first_widths[i] + release_position - initial_positon) / first_widths[i]).toFixed(4)\r\n\r\n            $first_cell.css('width', first_cell_percentage + '%')\r\n            $second_cell.css('width', (first_percentages[i] + second_percentages[i] - first_cell_percentage).toFixed(4) + '%')\r\n          }\r\n        }\r\n      }\r\n\r\n      // Resize the table.\r\n      else {\r\n        const $table_parent = $table.parent()\r\n        const table_percentage = table_width / $table_parent.width() * 100\r\n        const left_margin = (parseInt($table.css('margin-left'), 10) || 0) / $table_parent.width() * 100\r\n        const right_margin = (parseInt($table.css('margin-right'), 10) || 0) / $table_parent.width() * 100\r\n        let width\r\n\r\n        // Right border RTL or LTR.\r\n        if ((editor.opts.direction == 'rtl' && second === 0) || (editor.opts.direction != 'rtl' && second !== 0)) {\r\n          width = (table_width + release_position - initial_positon) / table_width * table_percentage\r\n          $table.css('margin-right', `calc(100% - ${Math.round(width).toFixed(4)}% - ${Math.round(left_margin).toFixed(4)}%)`)\r\n        }\r\n\r\n        // Left border RTL or LTR.\r\n        else if ((editor.opts.direction == 'rtl' && second !== 0) || (editor.opts.direction != 'rtl' && second === 0)) {\r\n          width = (table_width - release_position + initial_positon) / table_width * table_percentage\r\n          $table.css('margin-left', `calc(100% - ${Math.round(width).toFixed(4)}% - ${Math.round(right_margin).toFixed(4)}%)`)\r\n        }\r\n\r\n        // Update table width.\r\n        $table.css('width', `${Math.round(width).toFixed(4)}%`)\r\n      }\r\n\r\n      editor.selection.restore()\r\n      editor.undo.saveStep()\r\n\r\n      editor.events.trigger('table.resized', [$table.get(0)])\r\n    }\r\n\r\n    // Clear resizer data.\r\n    $resizer.removeData('origin')\r\n    $resizer.removeData('release-position')\r\n    $resizer.removeData('first')\r\n    $resizer.removeData('second')\r\n    $resizer.removeData('table')\r\n  }\r\n\r\n  /*\r\n   * Get the width of the column. (columns may have colspan)\r\n   */\r\n  function _columnWidth(col, map) {\r\n    let i\r\n    let width = $(map[0][col]).outerWidth()\r\n\r\n    for (i = 1; i < map.length; i++) {\r\n      width = Math.min(width, $(map[i][col]).outerWidth())\r\n    }\r\n\r\n    return width\r\n  }\r\n\r\n  /*\r\n   * Get the width of the columns between specified indexes.\r\n   */\r\n  function _columnsWidth(col1, col2, map) {\r\n    let i\r\n    let width = 0\r\n\r\n    // Sum all columns widths.\r\n    for (i = col1; i <= col2; i++) {\r\n      width += _columnWidth(i, map)\r\n    }\r\n\r\n    return width\r\n  }\r\n\r\n  /*\r\n   * Set mouse timer to improve performance.\r\n   */\r\n  function _mouseMove(e) {\r\n\r\n    // Prevent selecting text when we have cells selected.\r\n    if (selectedCells().length > 1 && mouseDownFlag) {\r\n      _clearSelection()\r\n    }\r\n\r\n    // Reset or set timer.\r\n    if (mouseDownFlag === false && mouseDownCellFlag === false && resizingFlag === false) {\r\n      if (mouseMoveTimer) {\r\n        clearTimeout(mouseMoveTimer)\r\n      }\r\n\r\n      // Only resize table if the editor is not disabled by user.\r\n      if (!editor.edit.isDisabled() || editor.popups.isVisible('table.edit')) {\r\n\r\n        // Check tag under in order to place the table resizer or insert helper button.\r\n        mouseMoveTimer = setTimeout(_tagUnder, 30, e)\r\n      }\r\n\r\n      // Move table resizer.\r\n    }\r\n    else if (resizingFlag) {\r\n\r\n      // Cursor position.\r\n      let pos = e.pageX - editor.win.pageXOffset\r\n\r\n      if (editor.opts.iframe) {\r\n        pos += editor.$iframe.offset().left\r\n      }\r\n\r\n      // Left and right limits.\r\n      const left_limit = $resizer.data('max-left')\r\n      const right_limit = $resizer.data('max-right')\r\n\r\n      // Cursor is between the left and right limits.\r\n      if (pos >= left_limit && pos <= right_limit) {\r\n        $resizer.css('left', pos - editor.opts.tableResizerOffset - editor.$wp.offset().left)\r\n\r\n        // Cursor has exceeded the left limit. Don't update if it already has the correct value.\r\n      }\r\n      else if (pos < left_limit && parseFloat($resizer.css('left'), 10) > left_limit - editor.opts.tableResizerOffset) {\r\n        $resizer.css('left', left_limit - editor.opts.tableResizerOffset - editor.$wp.offset().left)\r\n\r\n        // Cursor has exceeded the right limit. Don't update if it already has the correct value.\r\n      }\r\n      else if (pos > right_limit && parseFloat($resizer.css('left'), 10) < right_limit - editor.opts.tableResizerOffset) {\r\n        $resizer.css('left', right_limit - editor.opts.tableResizerOffset - editor.$wp.offset().left)\r\n      }\r\n    }\r\n    else if (mouseDownFlag) {\r\n      _hideInsertHelper()\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Place selection markers in a table cell.\r\n   */\r\n  function _addMarkersInCell($cell) {\r\n    if (editor.node.isEmpty($cell.get(0))) {\r\n      $cell.prepend(FE.MARKERS)\r\n    }\r\n    else {\r\n      $cell.prepend(FE.START_MARKER).append(FE.END_MARKER)\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Use TAB key to navigate through cells.\r\n   */\r\n  function _useTab(e) {\r\n    const key_code = e.which\r\n\r\n    if (key_code == FE.KEYCODE.TAB) {\r\n\r\n      // Get starting cell.\r\n      let $cell\r\n\r\n      if (selectedCells().length > 0) {\r\n        $cell = editor.$el.find('.fr-selected-cell').last()\r\n      }\r\n      else {\r\n        const cell = editor.selection.element()\r\n\r\n        if (cell.tagName == 'TD' || cell.tagName == 'TH') {\r\n          $cell = $(cell)\r\n        }\r\n        else if (cell != editor.el) {\r\n          if ($(cell).parentsUntil(editor.$el, 'td').length > 0) {\r\n            $cell = $(cell).parents('td').first()\r\n          }\r\n          else if ($(cell).parentsUntil(editor.$el, 'th').length > 0) {\r\n            $cell = $(cell).parents('th').first()\r\n          }\r\n        }\r\n      }\r\n\r\n      if ($cell) {\r\n        e.preventDefault()\r\n        let currentSelection =  editor.selection.get()\r\n\r\n        if (currentSelection.focusOffset === 0 && $(editor.selection.element()).parentsUntil(editor.$el, 'ol, ul').length > 0 && ($(editor.selection.element()).closest('li').prev().length > 0 || ($(editor.selection.element()).is('li') && $(editor.selection.element()).prev().length > 0))) {\r\n\r\n          return true\r\n        }\r\n\r\n        _stopEdit()\r\n\r\n        // Go backwards.\r\n        if (e.shiftKey) {\r\n\r\n          // Go to previous cell.\r\n          if ($cell.prev().length > 0) {\r\n            _addMarkersInCell($cell.prev())\r\n          }\r\n\r\n          // Go to prev row, last cell.\r\n          else if ($cell.closest('tr').length > 0 && $cell.closest('tr').prev().length > 0) {\r\n            _addMarkersInCell($cell.closest('tr').prev().find('td').last())\r\n          }\r\n\r\n          // Go in THEAD, last cell.\r\n          else if ($cell.closest('tbody').length > 0 && $cell.closest('table').find('thead tr').length > 0) {\r\n            _addMarkersInCell($cell.closest('table').find('thead tr th').last())\r\n          }\r\n        }\r\n\r\n        // Go forward.\r\n        else {\r\n\r\n          // Go to next cell.\r\n          if ($cell.next().length > 0) {\r\n            _addMarkersInCell($cell.next())\r\n          }\r\n\r\n          // Go to next row, first cell.\r\n          else if ($cell.closest('tr').length > 0 && $cell.closest('tr').next().length > 0) {\r\n            _addMarkersInCell($cell.closest('tr').next().find('td').first())\r\n          }\r\n\r\n          // Cursor is in THEAD. Go to next row in TBODY\r\n          else if ($cell.closest('thead').length > 0 && $cell.closest('table').find('tbody tr').length > 0) {\r\n            _addMarkersInCell($cell.closest('table').find('tbody tr td').first())\r\n          }\r\n\r\n          // Add new row.\r\n          else {\r\n            $cell.addClass('fr-selected-cell')\r\n            insertRow('below')\r\n            _removeSelection()\r\n            _addMarkersInCell($cell.closest('tr').next().find('td').first())\r\n          }\r\n        }\r\n\r\n        // Update cursor position.\r\n        editor.selection.restore()\r\n\r\n        // Prevent event propagation.\r\n        return false\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Initilize insert helper.\r\n   */\r\n  function _initInsertHelper() {\r\n\r\n    // Append insert helper HTML to editor wrapper.\r\n    if (!editor.shared.$ti_helper) {\r\n      editor.shared.$ti_helper = $(document.createElement('div')).attr('class', 'fr-insert-helper').html(`<a class=\"fr-floating-btn\" role=\"button\" tabIndex=\"-1\" title=\"${editor.language.translate('Insert')}\"><svg viewBox=\"0 0 32 32\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M22,16.75 L16.75,16.75 L16.75,22 L15.25,22.000 L15.25,16.75 L10,16.75 L10,15.25 L15.25,15.25 L15.25,10 L16.75,10 L16.75,15.25 L22,15.25 L22,16.75 Z\"/></svg></a>`)\r\n\r\n      // Click on insert helper.\r\n      editor.events.bindClick(editor.shared.$ti_helper, 'a', function () {\r\n        const $td = $insert_helper.data('selected-cell')\r\n        const position = $insert_helper.data('position')\r\n        const inst = $insert_helper.data('instance') || editor\r\n\r\n        if (position == 'before') {\r\n          editor.undo.saveStep()\r\n\r\n          $td.addClass('fr-selected-cell')\r\n          inst.table.insertColumn(position)\r\n          $td.removeClass('fr-selected-cell')\r\n\r\n          editor.undo.saveStep()\r\n        }\r\n        else if (position == 'after') {\r\n          editor.undo.saveStep()\r\n\r\n          $td.addClass('fr-selected-cell')\r\n          inst.table.insertColumn(position)\r\n          $td.removeClass('fr-selected-cell')\r\n\r\n          editor.undo.saveStep()\r\n        }\r\n        else if (position == 'above') {\r\n          editor.undo.saveStep()\r\n\r\n          $td.addClass('fr-selected-cell')\r\n          inst.table.insertRow(position)\r\n          $td.removeClass('fr-selected-cell')\r\n\r\n          editor.undo.saveStep()\r\n        }\r\n        else if (position == 'below') {\r\n          editor.undo.saveStep()\r\n\r\n          $td.addClass('fr-selected-cell')\r\n          inst.table.insertRow(position)\r\n          $td.removeClass('fr-selected-cell')\r\n\r\n          editor.undo.saveStep()\r\n        }\r\n\r\n        // Hide the insert helper so it will reposition.\r\n        _hideInsertHelper()\r\n      })\r\n\r\n      // Editor destroy.\r\n      editor.events.on('shared.destroy', function () {\r\n        editor.shared.$ti_helper.html('').removeData().remove()\r\n        editor.shared.$ti_helper = null\r\n      }, true)\r\n\r\n      // Prevent the insert helper hide when mouse is over it.\r\n      editor.events.$on(editor.shared.$ti_helper, 'mousemove', function (e) {\r\n        e.stopPropagation()\r\n      }, true)\r\n\r\n      // Hide the insert helper if the page is scrolled.\r\n      editor.events.$on($(editor.o_win), 'scroll', function () {\r\n        _hideInsertHelper()\r\n      }, true)\r\n\r\n      editor.events.$on(editor.$wp, 'scroll', function () {\r\n        _hideInsertHelper()\r\n      }, true)\r\n    }\r\n\r\n    $insert_helper = editor.shared.$ti_helper\r\n\r\n    editor.events.on('destroy', function () {\r\n      $insert_helper = null\r\n    })\r\n\r\n    // Table insert helper tooltip.\r\n    editor.tooltip.bind(editor.$box, '.fr-insert-helper > a.fr-floating-btn')\r\n  }\r\n\r\n  /**\r\n   * Destroy\r\n   */\r\n  function _destroy() {\r\n    mouseDownCell = null\r\n    clearTimeout(mouseMoveTimer)\r\n  }\r\n\r\n  /*\r\n   * Go back to the table edit popup.\r\n   */\r\n  function back() {\r\n    if (selectedCells().length > 0) {\r\n      _showEditPopup()\r\n    }\r\n    else {\r\n      editor.popups.hide('table.insert')\r\n      editor.toolbar.showInline()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return selected cells.\r\n   */\r\n  function selectedCells() {\r\n    return editor.el.querySelectorAll('.fr-selected-cell')\r\n  }\r\n\r\n  /**\r\n   * Return selected table.\r\n   */\r\n  function selectedTable() {\r\n    const cells = selectedCells()\r\n\r\n    if (cells.length) {\r\n      let cell = cells[0]\r\n\r\n      while (cell && cell.parentNode != editor.el) {\r\n        cell = cell.parentNode\r\n      }\r\n\r\n      if (cell && cell.tagName == 'TABLE') return $(cell)\r\n\r\n      return $([])\r\n    }\r\n\r\n    return $([])\r\n  }\r\n\r\n  /**\r\n   * Select table cell with alt + space.\r\n   */\r\n  function _selectCellWithKeyboard(e) {\r\n\r\n    // Alt+space was hit. Try to select cell.\r\n    if (e.altKey && e.which == FE.KEYCODE.SPACE) {\r\n      let cell\r\n      const el = editor.selection.element()\r\n\r\n      // Get cell where cursor is.\r\n      if (el.tagName == 'TD' || el.tagName == 'TH') {\r\n        cell = el\r\n      }\r\n      else if ($(el).closest('td').length > 0) {\r\n        cell = $(el).closest('td').get(0)\r\n      }\r\n      else if ($(el).closest('th').length > 0) {\r\n        cell = $(el).closest('th').get(0)\r\n      }\r\n\r\n      // Select this cell.\r\n      if (cell) {\r\n        e.preventDefault()\r\n        selectCells(cell, cell)\r\n        _showEditPopup()\r\n\r\n        return false\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Select table cells using arrows.\r\n   */\r\n  function selectCellsWithKeyboard(e) {\r\n    const selection = selectedCells()\r\n\r\n    // Return if no selected cell\r\n    if(selection == null) {\r\n      return\r\n    }\r\n\r\n    // There are some selected cells.\r\n    if (selection.length > 0) {\r\n      const map = _tableMap()\r\n      const key_code = e.which\r\n      let fixedCell\r\n      let handlerCell\r\n\r\n      // Only one cell is selected.\r\n      if (selection.length == 1) {\r\n        fixedCell = selection[0]\r\n        handlerCell = fixedCell\r\n      }\r\n\r\n      else {\r\n        fixedCell = editor.el.querySelector('.fr-cell-fixed')\r\n        handlerCell = editor.el.querySelector('.fr-cell-handler')\r\n      }\r\n\r\n      const handlerOrigin = _cellOrigin(handlerCell, map)\r\n\r\n      // Select column at the right.\r\n      if (FE.KEYCODE.ARROW_RIGHT == key_code) {\r\n        if (handlerOrigin.col < map[0].length - 1) {\r\n          selectCells(fixedCell, map[handlerOrigin.row][handlerOrigin.col + 1])\r\n\r\n          return false\r\n        }\r\n      }\r\n\r\n      // Select row below.\r\n      else if (FE.KEYCODE.ARROW_DOWN == key_code) {\r\n        if (handlerOrigin.row < map.length - 1) {\r\n          selectCells(fixedCell, map[handlerOrigin.row + 1][handlerOrigin.col])\r\n\r\n          return false\r\n        }\r\n      }\r\n\r\n      // Select column at the left.\r\n      else if (FE.KEYCODE.ARROW_LEFT == key_code) {\r\n        if (handlerOrigin.col > 0) {\r\n          selectCells(fixedCell, map[handlerOrigin.row][handlerOrigin.col - 1])\r\n\r\n          return false\r\n        }\r\n      }\r\n\r\n      // Select row above.\r\n      else if (FE.KEYCODE.ARROW_UP == key_code) {\r\n        if (handlerOrigin.row > 0) {\r\n          selectCells(fixedCell, map[handlerOrigin.row - 1][handlerOrigin.col])\r\n\r\n          return false\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n  *  Clicking inside an input element\r\n     https://github.com/froala-labs/froala-editor-js-2/issues/1859\r\n  */ \r\n function _inputOnClick(e){\r\n    mouseDownCellFlag = false;\r\n  }\r\n\r\n  /*\r\n   * Init table.\r\n   */\r\n  function _init() {\r\n    if (!editor.$wp) return false\r\n\r\n    // Do cell selection only on desktops (no touch devices)\r\n    if (!editor.helpers.isMobile()) {\r\n\r\n      // Remember if mouse is clicked.\r\n      mouseDownFlag = false\r\n      mouseDownCellFlag = false\r\n      resizingFlag = false\r\n\r\n      // Mouse is down in a table cell.\r\n      editor.events.$on(editor.$el, 'mousedown', _mouseDown)\r\n\r\n      // Deselect table cells when user clicks on an image.\r\n      editor.popups.onShow('image.edit', function () {\r\n        _removeSelection()\r\n        mouseDownFlag = false\r\n        mouseDownCellFlag = false\r\n      })\r\n\r\n      // Deselect table cells when user clicks on a link.\r\n      editor.popups.onShow('link.edit', function () {\r\n        _removeSelection()\r\n        mouseDownFlag = false\r\n        mouseDownCellFlag = false\r\n      })\r\n\r\n      // Deselect table cells when a command is run.\r\n      editor.events.on('commands.mousedown', function ($btn) {\r\n        if ($btn.parents('.fr-toolbar').length > 0) {\r\n          _removeSelection()\r\n        }\r\n      })\r\n\r\n      // Mouse enter's a table cell.\r\n      editor.events.$on(editor.$el, 'mouseover', 'th, td', _mouseEnter)\r\n\r\n      // Mouse is no longer pressed.\r\n      editor.events.$on(editor.$win, 'mouseup', _mouseUp)\r\n\r\n      // Iframe mouseup.\r\n      if (editor.opts.iframe) {\r\n        editor.events.$on($(editor.o_win), 'mouseup', _mouseUp)\r\n      }\r\n\r\n      // Check tags under the mouse to see if the resizer needs to be shown.\r\n      editor.events.$on(editor.$win, 'mousemove', _mouseMove)\r\n\r\n      // Update resizer's position on scroll.\r\n      editor.events.$on($(editor.o_win), 'scroll', _repositionResizer)\r\n\r\n      // Reposition table edit popup when table cell content changes.\r\n      editor.events.on('contentChanged', function () {\r\n        if (selectedCells().length > 0) {\r\n          _showEditPopup()\r\n\r\n          // Make sure we reposition on image load.\r\n          editor.$el.find('img').on('load.selected-cells', function () {\r\n            $(this).off('load.selected-cells')\r\n\r\n            if (selectedCells().length > 0) {\r\n              _showEditPopup()\r\n            }\r\n          })\r\n        }\r\n      })\r\n\r\n      // Reposition table edit popup on window resize.\r\n      editor.events.$on($(editor.o_win), 'resize', function () {\r\n        _removeSelection()\r\n      })\r\n\r\n      editor.events.on('toolbar.esc', function () {\r\n        if (selectedCells().length > 0) {\r\n          editor.events.disableBlur()\r\n          editor.events.focus()\r\n\r\n          return false\r\n        }\r\n      }, true)\r\n\r\n      // Allow keyboard while selecting table cells.\r\n      // https://github.com/froala/wysiwyg-editor/issues/2256\r\n      editor.events.$on($(editor.o_win), 'keydown', function () {\r\n        if (mouseDownFlag && mouseDownCellFlag) {\r\n          mouseDownFlag = false\r\n          mouseDownCellFlag = false\r\n\r\n          // Allow text selection.\r\n          editor.$el.removeClass('fr-no-selection')\r\n          editor.edit.on()\r\n\r\n          editor.selection.setAtEnd(editor.$el.find('.fr-selected-cell').last().get(0))\r\n          editor.selection.restore()\r\n\r\n          // Remove selected cells.\r\n          _removeSelection()\r\n        }\r\n      })\r\n\r\n      // Selecting cells with keyboard or moving cursor with arrow keys.\r\n      editor.events.$on(editor.$el, 'keydown', function (e) {\r\n        if (e.shiftKey) {\r\n          if (selectCellsWithKeyboard(e) === false) {\r\n\r\n            // Timeout needed due to clearSelection timeout.\r\n            setTimeout(function () {\r\n              _showEditPopup()\r\n            }, 0)\r\n          }\r\n        }\r\n        else {\r\n          _navigateWithArrows(e)\r\n        }\r\n      })\r\n\r\n      // Prevent backspace from doing browser back.\r\n      editor.events.on('keydown', function (e) {\r\n\r\n        // Tab in cell.\r\n        if (_useTab(e) === false) return false\r\n\r\n        let selected_cells = selectedCells()\r\n\r\n        if (selected_cells.length > 0) {\r\n\r\n          // CMD + A clear table cell selection and allow propagation.\r\n          if (selected_cells.length > 0 && editor.keys.ctrlKey(e) && e.which == FE.KEYCODE.A) {\r\n            _removeSelection()\r\n\r\n            if (editor.popups.isVisible('table.edit')) {\r\n              editor.popups.hide('table.edit')\r\n            }\r\n            selected_cells = []\r\n\r\n            return true\r\n          }\r\n\r\n          // ESC clear table cell selection.\r\n          if (e.which == FE.KEYCODE.ESC) {\r\n            if (editor.popups.isVisible('table.edit')) {\r\n              _removeSelection()\r\n              editor.popups.hide('table.edit')\r\n              e.preventDefault()\r\n              e.stopPropagation()\r\n              e.stopImmediatePropagation()\r\n              selected_cells = []\r\n\r\n              return false\r\n            }\r\n          }\r\n\r\n          // Backspace clears selected cells content.\r\n          if (selected_cells.length > 1 && (e.which == FE.KEYCODE.BACKSPACE || e.which == FE.KEYCODE.DELETE)) {\r\n            editor.undo.saveStep()\r\n\r\n            for (let i = 0; i < selected_cells.length; i++) {\r\n              $(selected_cells[i]).html('<br>')\r\n\r\n              if (i == selected_cells.length - 1) {\r\n                $(selected_cells[i]).prepend(FE.MARKERS)\r\n              }\r\n            }\r\n\r\n            editor.selection.restore()\r\n            editor.undo.saveStep()\r\n            selected_cells = []\r\n\r\n            return false\r\n          }\r\n\r\n          // Prevent typing if cells are selected. (Allow browser refresh using keyboard)\r\n          if (selected_cells.length > 1 && e.which != FE.KEYCODE.F10 && !editor.keys.isBrowserAction(e)) {\r\n            e.preventDefault()\r\n            selected_cells = []\r\n\r\n            return false\r\n          }\r\n        }\r\n\r\n        // We may want to select a cell with keyboard.\r\n        else {\r\n\r\n          // Garbage collector.\r\n          selected_cells = []\r\n\r\n          if (_selectCellWithKeyboard(e) === false) return false\r\n        }\r\n      }, true)\r\n\r\n      // Clean selected cells.\r\n      let c_selected_cells = []\r\n      editor.events.on('html.beforeGet', function () {\r\n        c_selected_cells = selectedCells()\r\n\r\n        for (let i = 0; i < c_selected_cells.length; i++) {\r\n          c_selected_cells[i].className = (c_selected_cells[i].className || '').replace(/fr-selected-cell/g, '')\r\n        }\r\n      })\r\n\r\n      editor.events.on('html.afterGet', function () {\r\n        for (let i = 0; i < c_selected_cells.length; i++) {\r\n          c_selected_cells[i].className = (c_selected_cells[i].className ? c_selected_cells[i].className.trim() + ' ' : '') + 'fr-selected-cell'\r\n        }\r\n        c_selected_cells = []\r\n      })\r\n\r\n      _initInsertPopup(true)\r\n      _initEditPopup(true)\r\n    }\r\n\r\n    editor.events.on('destroy', _destroy)\r\n  }\r\n\r\n  return {\r\n    _init: _init,\r\n    insert: insert,\r\n    remove: remove,\r\n    insertRow: insertRow,\r\n    deleteRow: deleteRow,\r\n    insertColumn: insertColumn,\r\n    deleteColumn: deleteColumn,\r\n    mergeCells: mergeCells,\r\n    splitCellVertically: splitCellVertically,\r\n    splitCellHorizontally: splitCellHorizontally,\r\n    addHeader: addHeader,\r\n    removeHeader: removeHeader,\r\n    setBackground: setBackground,\r\n    showInsertPopup: _showInsertPopup,\r\n    showEditPopup: _showEditPopup,\r\n    showColorsPopup: _showColorsPopup,\r\n    back: back,\r\n    verticalAlign: verticalAlign,\r\n    horizontalAlign: horizontalAlign,\r\n    applyStyle: applyStyle,\r\n    selectedTable: selectedTable,\r\n    selectedCells: selectedCells,\r\n    customColor: customColor,\r\n    selectCells: selectCells\r\n  }\r\n}\r\n\r\n// Insert table button.\r\nFE.DefineIcon('insertTable', { NAME: 'table', SVG_KEY: 'insertTable' })\r\nFE.RegisterCommand('insertTable', {\r\n  title: 'Insert Table',\r\n  undo: false,\r\n  focus: true,\r\n  refreshOnCallback: false,\r\n  popup: true,\r\n  callback: function () {\r\n    if (!this.popups.isVisible('table.insert')) {\r\n      this.table.showInsertPopup()\r\n    }\r\n    else {\r\n      if (this.$el.find('.fr-marker').length) {\r\n        this.events.disableBlur()\r\n        this.selection.restore()\r\n      }\r\n      this.popups.hide('table.insert')\r\n    }\r\n  },\r\n  plugin: 'table'\r\n})\r\n\r\nFE.RegisterCommand('tableInsert', {\r\n  callback: function (cmd, rows, cols) {\r\n    this.table.insert(rows, cols)\r\n    this.popups.hide('table.insert')\r\n  }\r\n})\r\n\r\n// Table header button.\r\nFE.DefineIcon('tableHeader', {\r\n  NAME: 'header',\r\n  FA5NAME: 'heading',\r\n  SVG_KEY: 'tableHeader'\r\n})\r\nFE.RegisterCommand('tableHeader', {\r\n  title: 'Table Header',\r\n  focus: false,\r\n  toggle: true,\r\n  callback: function () {\r\n    const $btn = this.popups.get('table.edit').find('.fr-command[data-cmd=\"tableHeader\"]')\r\n\r\n    // If button is active the table has a header,\r\n    if ($btn.hasClass('fr-active')) {\r\n      this.table.removeHeader()\r\n    }\r\n\r\n    // Add table header.\r\n    else {\r\n      this.table.addHeader()\r\n    }\r\n  },\r\n  refresh: function ($btn) {\r\n    const $table = this.table.selectedTable()\r\n\r\n    if ($table.length > 0) {\r\n\r\n      // If table doesn't have a header.\r\n      if ($table.find('th').length === 0) {\r\n        $btn.removeClass('fr-active').attr('aria-pressed', false)\r\n      }\r\n\r\n      // Header button is active if table has header.\r\n      else {\r\n        $btn.addClass('fr-active').attr('aria-pressed', true)\r\n      }\r\n    }\r\n  }\r\n})\r\n\r\n// Table rows action dropdown.\r\nFE.DefineIcon('tableRows', { NAME: 'bars', SVG_KEY: 'row' })\r\nFE.RegisterCommand('tableRows', {\r\n  type: 'dropdown',\r\n  focus: false,\r\n  title: 'Row',\r\n  options: {\r\n    above: 'Insert row above',\r\n    below: 'Insert row below',\r\n    'delete': 'Delete row'\r\n  },\r\n  html: function () {\r\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\r\n    const options = FE.COMMANDS.tableRows.options\r\n\r\n    for (const val in options) {\r\n      if (options.hasOwnProperty(val)) {\r\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableRows\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.language.translate(options[val]) + '</a></li>'\r\n      }\r\n    }\r\n    c += '</ul>'\r\n\r\n    return c\r\n  },\r\n  callback: function (cmd, val) {\r\n    if (val == 'above' || val == 'below') {\r\n      this.table.insertRow(val)\r\n    }\r\n    else {\r\n      this.table.deleteRow()\r\n    }\r\n  }\r\n})\r\n\r\n// Table columns action dropdown.\r\nFE.DefineIcon('tableColumns', { NAME: 'bars fa-rotate-90', SVG_KEY: 'columns' })\r\nFE.RegisterCommand('tableColumns', {\r\n  type: 'dropdown',\r\n  focus: false,\r\n  title: 'Column',\r\n  options: {\r\n    before: 'Insert column before',\r\n    after: 'Insert column after',\r\n    'delete': 'Delete column'\r\n  },\r\n  html: function () {\r\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\r\n    const options = FE.COMMANDS.tableColumns.options\r\n\r\n    for (const val in options) {\r\n      if (options.hasOwnProperty(val)) {\r\n        c += `<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableColumns\" data-param1=\"${val}\" title=\"${this.language.translate(options[val])}\">${this.language.translate(options[val])}</a></li>`\r\n      }\r\n    }\r\n    c += '</ul>'\r\n\r\n    return c\r\n  },\r\n  callback: function (cmd, val) {\r\n    if (val == 'before' || val == 'after') {\r\n      this.table.insertColumn(val)\r\n    }\r\n    else {\r\n      this.table.deleteColumn()\r\n    }\r\n  }\r\n})\r\n\r\n// Table cells action dropdown.\r\nFE.DefineIcon('tableCells', {\r\n  NAME: 'square-o',\r\n  FA5NAME: 'square',\r\n  SVG_KEY: 'cellOptions'\r\n})\r\nFE.RegisterCommand('tableCells', {\r\n  type: 'dropdown',\r\n  focus: false,\r\n  title: 'Cell',\r\n  options: {\r\n    merge: 'Merge cells',\r\n    'vertical-split': 'Vertical split',\r\n    'horizontal-split': 'Horizontal split'\r\n  },\r\n  html: function () {\r\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\r\n    const options = FE.COMMANDS.tableCells.options\r\n\r\n    for (const val in options) {\r\n      if (options.hasOwnProperty(val)) {\r\n        c += `<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableCells\" data-param1=\"${val}\" title=\"${this.language.translate(options[val])}\">${this.language.translate(options[val])}</a></li>`\r\n      }\r\n    }\r\n    c += '</ul>'\r\n\r\n    return c\r\n  },\r\n  callback: function (cmd, val) {\r\n    if (val == 'merge') {\r\n      this.table.mergeCells()\r\n    }\r\n    else if (val == 'vertical-split') {\r\n      this.table.splitCellVertically()\r\n    }\r\n\r\n    // 'horizontal-split'\r\n    else {\r\n      this.table.splitCellHorizontally()\r\n    }\r\n  },\r\n  refreshOnShow: function ($btn, $dropdown) {\r\n\r\n    // More than one cell selected.\r\n    if (this.$el.find('.fr-selected-cell').length > 1) {\r\n      $dropdown.find('a[data-param1=\"vertical-split\"]').addClass('fr-disabled').attr('aria-disabled', true)\r\n      $dropdown.find('a[data-param1=\"horizontal-split\"]').addClass('fr-disabled').attr('aria-disabled', true)\r\n      $dropdown.find('a[data-param1=\"merge\"]').removeClass('fr-disabled').attr('aria-disabled', false)\r\n    }\r\n\r\n    // Only one selected cell.\r\n    else {\r\n      $dropdown.find('a[data-param1=\"merge\"]').addClass('fr-disabled').attr('aria-disabled', true)\r\n      $dropdown.find('a[data-param1=\"vertical-split\"]').removeClass('fr-disabled').attr('aria-disabled', false)\r\n      $dropdown.find('a[data-param1=\"horizontal-split\"]').removeClass('fr-disabled').attr('aria-disabled', false)\r\n    }\r\n  }\r\n})\r\n\r\n// Remove table button.\r\nFE.DefineIcon('tableRemove', { NAME: 'trash', SVG_KEY: 'removeTable' })\r\nFE.RegisterCommand('tableRemove', {\r\n  title: 'Remove Table',\r\n  focus: false,\r\n  callback: function () {\r\n    this.table.remove()\r\n  }\r\n})\r\n\r\n// Table styles.\r\nFE.DefineIcon('tableStyle', { NAME: 'paint-brush', SVG_KEY: 'tableStyle' })\r\nFE.RegisterCommand('tableStyle', {\r\n  title: 'Table Style',\r\n  type: 'dropdown',\r\n  focus: false,\r\n  html: function () {\r\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\r\n    const options = this.opts.tableStyles\r\n\r\n    for (const val in options) {\r\n      if (options.hasOwnProperty(val)) {\r\n        c += `<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableStyle\" data-param1=\"${val}\" title=\"${this.language.translate(options[val])}\">${this.language.translate(options[val])}</a></li>`\r\n      }\r\n    }\r\n    c += '</ul>'\r\n\r\n    return c\r\n  },\r\n  callback: function (cmd, val) {\r\n    this.table.applyStyle(val, this.$el.find('.fr-selected-cell').closest('table'), this.opts.tableMultipleStyles, this.opts.tableStyles)\r\n  },\r\n  refreshOnShow: function ($btn, $dropdown) {\r\n    const $ = this.$\r\n    const $table = this.$el.find('.fr-selected-cell').closest('table')\r\n\r\n    if ($table) {\r\n      $dropdown.find('.fr-command').each(function () {\r\n        const cls = $(this).data('param1')\r\n        const active = $table.hasClass(cls)\r\n        $(this).toggleClass('fr-active', active).attr('aria-selected', active)\r\n      })\r\n    }\r\n  }\r\n})\r\n\r\n// Table cell background color button.\r\nFE.DefineIcon('tableCellBackground', { NAME: 'tint', SVG_KEY: 'cellBackground' })\r\nFE.RegisterCommand('tableCellBackground', {\r\n  title: 'Cell Background',\r\n  focus: false,\r\n  popup: true,\r\n  callback: function () {\r\n    this.table.showColorsPopup()\r\n  }\r\n})\r\n\r\n// Select table cell background color command.\r\nFE.RegisterCommand('tableCellBackgroundColor', {\r\n  undo: true,\r\n  focus: false,\r\n  callback: function (cmd, val) {\r\n    this.table.setBackground(val)\r\n  }\r\n})\r\n\r\n// Table back.\r\nFE.DefineIcon('tableBack', { NAME: 'arrow-left', SVG_KEY: 'back' })\r\nFE.RegisterCommand('tableBack', {\r\n  title: 'Back',\r\n  undo: false,\r\n  focus: false,\r\n  back: true,\r\n  callback: function () {\r\n    this.table.back()\r\n  },\r\n  refresh: function ($btn) {\r\n    if (this.table.selectedCells().length === 0 && !this.opts.toolbarInline) {\r\n      $btn.addClass('fr-hidden')\r\n      $btn.next('.fr-separator').addClass('fr-hidden')\r\n    }\r\n    else {\r\n      $btn.removeClass('fr-hidden')\r\n      $btn.next('.fr-separator').removeClass('fr-hidden')\r\n    }\r\n  }\r\n})\r\n\r\n// Table vertical align dropdown.\r\nFE.DefineIcon('tableCellVerticalAlign', {\r\n  NAME: 'arrows-v',\r\n  FA5NAME: 'arrows-alt-v',\r\n  SVG_KEY: 'verticalAlignMiddle'\r\n})\r\nFE.RegisterCommand('tableCellVerticalAlign', {\r\n  type: 'dropdown',\r\n  focus: false,\r\n  title: 'Vertical Align',\r\n  options: {\r\n    Top: 'Align Top',\r\n    Middle: 'Align Middle',\r\n    Bottom: 'Align Bottom'\r\n  },\r\n  html: function () {\r\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\r\n    const options = FE.COMMANDS.tableCellVerticalAlign.options\r\n\r\n    for (const val in options) {\r\n      if (options.hasOwnProperty(val)) {\r\n        c += `<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableCellVerticalAlign\" data-param1=\"${val.toLowerCase()}\" title=\"${this.language.translate(options[val])}\">${this.language.translate(val)}</a></li>`\r\n      }\r\n    }\r\n    c += '</ul>'\r\n\r\n    return c\r\n  },\r\n  callback: function (cmd, val) {\r\n    this.table.verticalAlign(val)\r\n  },\r\n  refreshOnShow: function ($btn, $dropdown) {\r\n    $dropdown.find('.fr-command[data-param1=\"' + this.$el.find('.fr-selected-cell').css('vertical-align') + '\"]').addClass('fr-active').attr('aria-selected', true)\r\n  }\r\n})\r\n\r\n// Table horizontal align dropdown.\r\nFE.DefineIcon('tableCellHorizontalAlign', { NAME: 'align-left', SVG_KEY: 'alignLeft' })\r\nFE.DefineIcon('align-left', { NAME: 'align-left', SVG_KEY: 'alignLeft' })\r\nFE.DefineIcon('align-right', { NAME: 'align-right', SVG_KEY: 'alignRight' })\r\nFE.DefineIcon('align-center', { NAME: 'align-center', SVG_KEY: 'alignCenter' })\r\nFE.DefineIcon('align-justify', { NAME: 'align-justify', SVG_KEY: 'alignJustify' })\r\nFE.RegisterCommand('tableCellHorizontalAlign', {\r\n  type: 'dropdown',\r\n  focus: false,\r\n  title: 'Horizontal Align',\r\n  options: {\r\n    left: 'Align Left',\r\n    center: 'Align Center',\r\n    right: 'Align Right',\r\n    justify: 'Align Justify'\r\n  },\r\n  html: function () {\r\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\r\n    const options = FE.COMMANDS.tableCellHorizontalAlign.options\r\n\r\n    for (const val in options) {\r\n      if (options.hasOwnProperty(val)) {\r\n        c += `<li role=\"presentation\"><a class=\"fr-command fr-title\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableCellHorizontalAlign\" data-param1=\"${val}\" title=\"${this.language.translate(options[val])}\">${this.icon.create(`align-${val}`)}<span class=\"fr-sr-only\">${this.language.translate(options[val])}</span></a></li>`\r\n      }\r\n    }\r\n    c += '</ul>'\r\n\r\n    return c\r\n  },\r\n  callback: function (cmd, val) {\r\n    this.table.horizontalAlign(val)\r\n  },\r\n  refresh: function ($btn) {\r\n    const selected_cells = this.table.selectedCells()\r\n    const $ = this.$\r\n    if (selected_cells.length) {\r\n      $btn.find('> *').first().replaceWith(this.icon.create(`align-${this.helpers.getAlignment($(selected_cells[0]))}`))\r\n    }\r\n  },\r\n  refreshOnShow: function ($btn, $dropdown) {\r\n    $dropdown.find('.fr-command[data-param1=\"' + this.helpers.getAlignment(this.$el.find('.fr-selected-cell').first()) + '\"]').addClass('fr-active').attr('aria-selected', true)\r\n  }\r\n})\r\n\r\n// Table cell styles.\r\nFE.DefineIcon('tableCellStyle', { NAME: 'magic', SVG_KEY: 'cellStyle' })\r\nFE.RegisterCommand('tableCellStyle', {\r\n  title: 'Cell Style',\r\n  type: 'dropdown',\r\n  focus: false,\r\n  html: function () {\r\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\r\n    const options = this.opts.tableCellStyles\r\n\r\n    for (const val in options) {\r\n      if (options.hasOwnProperty(val)) {\r\n        c += `<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableCellStyle\" data-param1=\"${val}\" title=\"${this.language.translate(options[val])}\">${this.language.translate(options[val])}</a></li>`\r\n      }\r\n    }\r\n    c += '</ul>'\r\n\r\n    return c\r\n  },\r\n  callback: function (cmd, val) {\r\n    this.table.applyStyle(val, this.$el.find('.fr-selected-cell'), this.opts.tableCellMultipleStyles, this.opts.tableCellStyles)\r\n  },\r\n  refreshOnShow: function ($btn, $dropdown) {\r\n\r\n    const $ = this.$\r\n    const $cell = this.$el.find('.fr-selected-cell').first()\r\n\r\n    if ($cell) {\r\n      $dropdown.find('.fr-command').each(function () {\r\n        const cls = $(this).data('param1')\r\n        const active = $cell.hasClass(cls)\r\n        $(this).toggleClass('fr-active', active).attr('aria-selected', active)\r\n      })\r\n    }\r\n  }\r\n})\r\n\r\nFE.RegisterCommand('tableCellBackgroundCustomColor', {\r\n  title: 'OK',\r\n  undo: true,\r\n  callback: function () {\r\n    this.table.customColor()\r\n  }\r\n})\r\n\r\nFE.DefineIcon('tableColorRemove', { NAME: 'eraser', SVG_KEY: 'remove' })\r\n"],"names":["Object","assign","FE","POPUP_TEMPLATES","DEFAULTS","tableInsertMaxSize","tableEditButtons","tableInsertButtons","tableResizer","tableDefaultWidth","tableResizerOffset","tableResizingLimit","tableColorsButtons","tableColors","tableColorsStep","tableCellStyles","tableStyles","tableCellMultipleStyles","tableMultipleStyles","tableInsertHelper","tableInsertHelperOffset","PLUGINS","table","editor","$","$resizer","$insert_helper","mouseDownCellFlag","mouseDownFlag","mouseDownCell","mouseMoveTimer","resizingFlag","_showInsertPopup","$btn","$tb","find","$popup","popups","get","_initInsertPopup","hasClass","refresh","setContainer","button","getPosition","left","top","show","outerHeight","_showEditPopup","map","_tableMap","_initEditPopup","$sc","offset","_selectionOffset","right","bottom","edit","isDisabled","selectedCells","length","toolbar","disable","$el","removeClass","on","bulkRefresh","selection","setAtEnd","last","restore","_showColorsPopup","_initColorsPopup","_refreshColor","_hideEditPopup","enable","delayed","onHide","trigger","table_buttons","opts","buildList","template","buttons","rows_columns","_insertTableHtml","create","events","$on","e","_hoverCell","currentTarget","_addAccessibility","$table_cell","row","data","parseInt","col","$select_size","parent","siblings","html","i","j","$cell","addClass","helpers","isMobile","css","display","cls","$focused_el","$focused_item","isVisible","is","key_code","which","status","KEYCODE","ARROW_UP","ARROW_DOWN","ARROW_LEFT","ARROW_RIGHT","$cells","index","columns","column","line","Math","floor","max","min","nextIndex","disableBlur","focus","ENTER","exec","preventDefault","stopPropagation","$wp","custom_color","colorsHEXInput","id","language","translate","colors","_colorsHTML","_addColorsAccessibility","colors_html","icon","customColor","$input","setBackground","val","TAB","accessibility","focusToolbar","shiftKey","$colors","colorsStep","lines","dimension","first","color","RGBToHex","insert","rows","cols","cell_width","toFixed","MARKERS","$table","remove","$current_table","selectedTable","setBefore","setAfter","hide","addHeader","thead","each","$td","attr","prepend","removeHeader","$table_header","td","insertRow","position","ref_row","$ref_row","_currentSelection","min_i","max_i","tr","$refCell","not","parentNode","insertAdjacentHTML","before","deleteRow","$row","rowspan","removeAttr","insertAdjacentElement","$row_parent","_updateCellSpan","insertColumn","ref_col","min_j","max_j","old_width","new_width","outerWidth","col_no","td_no","ref_td","$ref_td","colspan","removeData","append","deleteColumn","_columnWidth","prev","next","_updateColspan","k","first_span","span","decrease","getAttribute","_decreaseCellSpan","_updateRowspan","span_type","setAttribute","removeAttribute","mergeCells","_removeKeyboardSelectionHandlers","cells","$first_cell","$first_row","first_row_cells","closest","content","width","empty_trs","splitCellHorizontally","$selected_cell","$current_row","current_rowspan","cell_origin","_cellOrigin","$new_td","clone","new_rowspan","ceil","document","createElement","_removeSelection","splitCellVertically","current_colspan","parent_width","new_colspan","_columnsWidth","$selected_cells","HEXtoRGB","verticalAlign","horizontalAlign","applyStyle","obj","multiple_styles","styles","classes","keys","splice","indexOf","join","toggleClass","findVisible","$tr","c_index","cspan","rspan","_cellEnds","origin_i","origin_j","el","querySelector","classList","_clearSelection","clear","blur","enableBlur","cellOrigin","cellEnd","_selectionLimits","first_i","last_i","first_j","last_j","$tl","$bl","selectCells","firstCell","lastCell","off","firstCellOrigin","lastCellOrigin","limits","add","_getCellUnder","cell","$target","target","tagName","toString","search","_stopEdit","_mouseDown","parents","isMac","ctrlKey","tag_name","toLowerCase","element","_mouseUp","areVisible","isCollapsed","parseFloat","iframe","$iframe","_resize","_hideResizer","_mouseEnter","originalEvent","relatedTarget","contains","_inputOnClick","_moveInNestedTable","direction","new_map","_moveUp","_moveDown","_moveWithArrows","origin","up","sibling","previousElementSibling","nextElementSibling","setAtStart","_navigateWithArrows","sel","blocks","browser","webkit","node","ranges","startContainer","nodeType","Node","TEXT_NODE","previousSibling","nextSibling","_initResizer","shared","$table_resizer","core","sameInstance","save","pageX","_mouseMove","_hideInsertHelper","_placeResizer","tag_under","$tag_under","$table_parent","tag_left","tag_right","abs","tag_origin","tag_end","second","resizer_top","resizer_height","resizer_left","max_left","max_right","win","pageXOffset","scrollTop","iframePaddingTop","getPX","iframePaddingLeft","_showInsertColHelper","$box","_initInsertHelper","mouseX","scrollLeft","btn_width","_showInsertRowHelper","mouseY","pageY","_insertHelper","tag_below","isElement","doc","elementFromPoint","pageYOffset","_tagUnder","_repositionResizer","initial_positon","release_position","table_width","undo","canDo","saveStep","first_widths","first_percentages","second_widths","second_percentages","$second_cell","first_cell_percentage","table_percentage","left_margin","right_margin","round","col1","col2","clearTimeout","setTimeout","pos","left_limit","right_limit","_addMarkersInCell","isEmpty","START_MARKER","END_MARKER","_useTab","parentsUntil","currentSelection","focusOffset","$ti_helper","bindClick","inst","o_win","tooltip","bind","_destroy","back","showInline","querySelectorAll","_selectCellWithKeyboard","altKey","SPACE","selectCellsWithKeyboard","fixedCell","handlerCell","handlerOrigin","_init","onShow","$win","selected_cells","A","ESC","stopImmediatePropagation","BACKSPACE","DELETE","F10","isBrowserAction","c_selected_cells","className","replace","trim","showInsertPopup","showEditPopup","showColorsPopup","DefineIcon","NAME","SVG_KEY","RegisterCommand","title","refreshOnCallback","popup","callback","plugin","cmd","FA5NAME","toggle","type","options","above","below","c","COMMANDS","tableRows","hasOwnProperty","after","tableColumns","merge","tableCells","refreshOnShow","$dropdown","active","toolbarInline","Top","Middle","Bottom","tableCellVerticalAlign","center","justify","tableCellHorizontalAlign","replaceWith","getAlignment"],"mappings":"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"}