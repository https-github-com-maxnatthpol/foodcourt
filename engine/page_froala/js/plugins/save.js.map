/*!
 * froala_editor v3.2.6 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2021 Froala Labs
 */

{"version":3,"file":"save.js","sources":["../../../src/js/plugins/save.js"],"sourcesContent":["import FE from '../index.js'\r\n'use strict';\r\n\r\nObject.assign(FE.DEFAULTS, {\r\n  saveInterval: 10000,\r\n  saveURL: null,\r\n  saveParams: {},\r\n  saveParam: 'body',\r\n  saveMethod: 'POST'\r\n})\r\n\r\nFE.PLUGINS.save = function (editor) {\r\n  const { $ } = editor\r\n  let _timeout = null\r\n  let _last_html = null\r\n  let _force = false\r\n\r\n  const BAD_LINK = 1\r\n  const ERROR_ON_SERVER = 2\r\n\r\n  const error_messages = {}\r\n  error_messages[BAD_LINK] = 'Missing saveURL option.'\r\n  error_messages[ERROR_ON_SERVER] = 'Something went wrong during save.'\r\n\r\n  /**\r\n   * Throw an image error.\r\n   */\r\n  function _throwError(code, response) {\r\n    editor.events.trigger('save.error', [{\r\n      code: code,\r\n      message: error_messages[code]\r\n    }, response])\r\n  }\r\n\r\n  function save(html) {\r\n    if (typeof html == 'undefined') html = editor.html.get()\r\n\r\n    const original_html = html\r\n\r\n    // Trigger before save event.\r\n    const event_returned_value = editor.events.trigger('save.before', [html])\r\n\r\n    if (event_returned_value === false) return false\r\n    else if (typeof event_returned_value == 'string') html = event_returned_value\r\n\r\n    if (editor.opts.saveURL) {\r\n      const params = {}\r\n\r\n      for (const key in editor.opts.saveParams) {\r\n        if (editor.opts.saveParams.hasOwnProperty(key)) {\r\n          const param = editor.opts.saveParams[key]\r\n\r\n          if (typeof (param) == 'function') {\r\n            params[key] = param.call(this)\r\n          }\r\n          else {\r\n            params[key] = param\r\n          }\r\n        }\r\n      }\r\n\r\n      const dt = {}\r\n      dt[editor.opts.saveParam] = html\r\n\r\n      // Make request to save\r\n      $(this).ajax({\r\n        method: editor.opts.saveMethod,\r\n        url: editor.opts.saveURL,\r\n        data: Object.assign(dt, params),\r\n        crossDomain: editor.opts.requestWithCORS,\r\n        withCredentials: editor.opts.requestWithCredentials,\r\n        headers: editor.opts.requestHeaders,\r\n        done: function (data, status, xhr) {\r\n          _last_html = original_html\r\n\r\n          // data\r\n          editor.events.trigger('save.after', [data])\r\n        },\r\n        fail: function (xhr) {\r\n          // (error)\r\n          _throwError(ERROR_ON_SERVER, xhr.response || xhr.responseText)\r\n        }\r\n      })\r\n      \r\n    }\r\n    else {\r\n\r\n      // (error)\r\n      _throwError(BAD_LINK)\r\n    }\r\n  }\r\n\r\n  function _mightSave() {\r\n    clearTimeout(_timeout)\r\n\r\n    // Added 0 seconds as to get the timeoutid so that for if there is another request the previous pending request will get cleared out. \r\n    _timeout = setTimeout(function () {\r\n      const html = editor.html.get()\r\n\r\n      if (_last_html != html || _force) {\r\n        _last_html = html\r\n        _force = false\r\n\r\n        save(html)\r\n      }\r\n    }, 0)\r\n  }\r\n\r\n  /**\r\n   * Reset the saving interval.\r\n   */\r\n  function reset() {\r\n    _mightSave()\r\n    _force = false\r\n  }\r\n\r\n  /**\r\n   * Force saving at the end of the current interval.\r\n   */\r\n  function force() {\r\n    _force = true\r\n  }\r\n\r\n  /*\r\n   * Initialize.\r\n   */\r\n  function _init() {\r\n    if(editor.opts.letteringClass)\r\n    {\r\n      let selectionClass = editor.opts.letteringClass\r\n      let length = editor.$el.find(`.${selectionClass}`).length\r\n      for( let i = 0; i < length; i++){\r\n        editor.$el.find(`.${selectionClass}`)[i].innerHTML = editor.$el.find(`.${selectionClass}`)[i].innerText.replace(/([\\w'-]+|[?.\",])/g, `<span class = 'fr-word-select'>$1</span>`)\r\n      }\r\n    }\r\n    if (editor.opts.saveInterval) {\r\n      _last_html = editor.html.get()\r\n      editor.events.on('contentChanged', function () {\r\n        // Added timeinterval which user has entered else default will be 10000ms. \r\n        setTimeout(_mightSave, editor.opts.saveInterval)\r\n      })\r\n      editor.events.on('keydown destroy', function () {\r\n        clearTimeout(_timeout)\r\n      })\r\n    }\r\n  }\r\n\r\n  return {\r\n    _init: _init,\r\n    save: save,\r\n    reset: reset,\r\n    force: force\r\n  }\r\n}\r\n\r\nFE.DefineIcon('save', {\r\n  NAME: 'floppy-o',\r\n  FA5NAME: 'save'\r\n})\r\nFE.RegisterCommand('save', {\r\n  title: 'Save',\r\n  undo: false,\r\n  focus: false,\r\n  refreshAfterCallback: false,\r\n  callback: function () {\r\n    this.save.save()\r\n  },\r\n  plugin: 'save'\r\n}) \r\n"],"names":["Object","assign","FE","DEFAULTS","saveInterval","saveURL","saveParams","saveParam","saveMethod","PLUGINS","save","editor","$","_timeout","_last_html","_force","BAD_LINK","ERROR_ON_SERVER","error_messages","_throwError","code","response","events","trigger","message","html","get","original_html","event_returned_value","opts","params","key","hasOwnProperty","param","call","dt","ajax","method","url","data","crossDomain","requestWithCORS","withCredentials","requestWithCredentials","headers","requestHeaders","done","status","xhr","fail","responseText","_mightSave","clearTimeout","setTimeout","reset","force","_init","letteringClass","selectionClass","length","$el","find","i","innerHTML","innerText","replace","on","DefineIcon","NAME","FA5NAME","RegisterCommand","title","undo","focus","refreshAfterCallback","callback","plugin"],"mappings":"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"}