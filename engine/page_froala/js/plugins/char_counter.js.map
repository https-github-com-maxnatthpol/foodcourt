/*!
 * froala_editor v3.2.6 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2021 Froala Labs
 */

{"version":3,"file":"char_counter.js","sources":["../../../src/js/plugins/char_counter.js"],"sourcesContent":["import FE from '../index.js'\r\n'use strict';\r\n\r\n// Extend defaults.\r\nObject.assign(FE.DEFAULTS, {\r\n  charCounterMax: -1,\r\n  charCounterCount: true\r\n})\r\n\r\nFE.PLUGINS.charCounter = function (editor) {\r\n  const { $ } =  editor\r\n  let $counter\r\n\r\n  /**\r\n   * Get the char number.\r\n   */\r\n  const count = () => (editor.el.textContent || '').replace(/\\u200B/g, '').length\r\n\r\n  /**\r\n   * Check chars on typing.\r\n   */\r\n  function _checkCharNumber(e) {\r\n\r\n    // Continue if infinite characters.\r\n    if (editor.opts.charCounterMax < 0) return true\r\n\r\n    // Continue if enough characters.\r\n    if (count() < editor.opts.charCounterMax) return true\r\n\r\n    // Stop if the key will produce a new char.\r\n    const keyCode = e.which\r\n\r\n    if ((!editor.keys.ctrlKey(e) && editor.keys.isCharacter(keyCode)) || (keyCode === FE.KEYCODE.IME)) {\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n      editor.events.trigger('charCounter.exceeded')\r\n\r\n      return false\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * Check chars on paste.\r\n   */\r\n  function _checkCharNumberOnPaste(html) {\r\n    if (editor.opts.charCounterMax < 0) return html\r\n\r\n    const len = $('<div>').html(html).text().length\r\n\r\n    if (len + count() <= editor.opts.charCounterMax) return html\r\n\r\n    editor.events.trigger('charCounter.exceeded')\r\n\r\n    return ''\r\n  }\r\n\r\n  /**\r\n   * Update the char counter.\r\n   */\r\n  function _updateCharNumber() {\r\n    if (editor.opts.charCounterCount) {\r\n      const chars = count() + (editor.opts.charCounterMax > 0 ? '/' + editor.opts.charCounterMax : '')\r\n\r\n      $counter.text(`${editor.language.translate('Characters')} : ${chars}`)\r\n\r\n      if (editor.opts.toolbarBottom) {\r\n        $counter.css('margin-bottom', editor.$tb.outerHeight(true))\r\n      }\r\n\r\n      // Scroll size correction.\r\n      const scroll_size = editor.$wp.get(0).offsetWidth - editor.$wp.get(0).clientWidth\r\n\r\n      if (scroll_size >= 0) {\r\n        if (editor.opts.direction == 'rtl') {\r\n          $counter.css('margin-left', scroll_size)\r\n        }\r\n        else {\r\n          $counter.css('margin-right', scroll_size)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Initialize.\r\n   */\r\n  function _init() {\r\n    if (!editor.$wp) return false\r\n\r\n    if (!editor.opts.charCounterCount) return false\r\n\r\n    $counter = $(document.createElement('span')).attr('class', 'fr-counter')\r\n    $counter.css('bottom', editor.$wp.css('border-bottom-width'))\r\n\r\n    // Append char counter only if second toolbar exists\r\n    if (editor.$second_tb) {\r\n      editor.$second_tb.append($counter)\r\n    }\r\n\r\n    editor.events.on('keydown', _checkCharNumber, true)\r\n    editor.events.on('paste.afterCleanup', _checkCharNumberOnPaste)\r\n    editor.events.on('keyup contentChanged input', function () {\r\n      editor.events.trigger('charCounter.update')\r\n    })\r\n\r\n    editor.events.on('charCounter.update', _updateCharNumber)\r\n    editor.events.trigger('charCounter.update')\r\n\r\n    editor.events.on('destroy', function () {\r\n      $(editor.o_win).off(`resize.char${editor.id}`)\r\n      $counter.removeData().remove()\r\n      $counter = null\r\n    })\r\n  }\r\n\r\n  return {\r\n    _init: _init,\r\n    count: count\r\n  }\r\n}\r\n"],"names":["Object","assign","FE","DEFAULTS","charCounterMax","charCounterCount","PLUGINS","charCounter","editor","$","$counter","count","el","textContent","replace","length","_checkCharNumber","e","opts","keyCode","which","keys","ctrlKey","isCharacter","KEYCODE","IME","preventDefault","stopPropagation","events","trigger","_checkCharNumberOnPaste","html","len","text","_updateCharNumber","chars","language","translate","toolbarBottom","css","$tb","outerHeight","scroll_size","$wp","get","offsetWidth","clientWidth","direction","_init","document","createElement","attr","$second_tb","append","on","o_win","off","id","removeData","remove"],"mappings":";;;;;;;;EAIAA,MAAM,CAACC,MAAP,CAAcC,EAAE,CAACC,QAAjB,EAA2B;EACzBC,EAAAA,cAAc,EAAE,CAAC,CADQ;EAEzBC,EAAAA,gBAAgB,EAAE;EAFO,CAA3B;;EAKAH,EAAE,CAACI,OAAH,CAAWC,WAAX,GAAyB,UAAUC,MAAV,EAAkB;EAAA,MACjCC,CADiC,GAC1BD,MAD0B,CACjCC,CADiC;EAEzC,MAAIC,QAAJ;EAEA;EACF;EACA;;EACE,MAAMC,KAAK,GAAG,SAARA,KAAQ;EAAA,WAAM,CAACH,MAAM,CAACI,EAAP,CAAUC,WAAV,IAAyB,EAA1B,EAA8BC,OAA9B,CAAsC,SAAtC,EAAiD,EAAjD,EAAqDC,MAA3D;EAAA,GAAd;EAEA;EACF;EACA;;;EACE,WAASC,gBAAT,CAA0BC,CAA1B,EAA6B;EAE3B;EACA,QAAIT,MAAM,CAACU,IAAP,CAAYd,cAAZ,GAA6B,CAAjC,EAAoC,OAAO,IAAP,CAHT;;EAM3B,QAAIO,KAAK,KAAKH,MAAM,CAACU,IAAP,CAAYd,cAA1B,EAA0C,OAAO,IAAP,CANf;;EAS3B,QAAMe,OAAO,GAAGF,CAAC,CAACG,KAAlB;;EAEA,QAAK,CAACZ,MAAM,CAACa,IAAP,CAAYC,OAAZ,CAAoBL,CAApB,CAAD,IAA2BT,MAAM,CAACa,IAAP,CAAYE,WAAZ,CAAwBJ,OAAxB,CAA5B,IAAkEA,OAAO,KAAKjB,EAAE,CAACsB,OAAH,CAAWC,GAA7F,EAAmG;EACjGR,MAAAA,CAAC,CAACS,cAAF;EACAT,MAAAA,CAAC,CAACU,eAAF;EACAnB,MAAAA,MAAM,CAACoB,MAAP,CAAcC,OAAd,CAAsB,sBAAtB;EAEA,aAAO,KAAP;EACD;;EAED,WAAO,IAAP;EACD;EAED;EACF;EACA;;;EACE,WAASC,uBAAT,CAAiCC,IAAjC,EAAuC;EACrC,QAAIvB,MAAM,CAACU,IAAP,CAAYd,cAAZ,GAA6B,CAAjC,EAAoC,OAAO2B,IAAP;EAEpC,QAAMC,GAAG,GAAGvB,CAAC,CAAC,OAAD,CAAD,CAAWsB,IAAX,CAAgBA,IAAhB,EAAsBE,IAAtB,GAA6BlB,MAAzC;EAEA,QAAIiB,GAAG,GAAGrB,KAAK,EAAX,IAAiBH,MAAM,CAACU,IAAP,CAAYd,cAAjC,EAAiD,OAAO2B,IAAP;EAEjDvB,IAAAA,MAAM,CAACoB,MAAP,CAAcC,OAAd,CAAsB,sBAAtB;EAEA,WAAO,EAAP;EACD;EAED;EACF;EACA;;;EACE,WAASK,iBAAT,GAA6B;EAC3B,QAAI1B,MAAM,CAACU,IAAP,CAAYb,gBAAhB,EAAkC;EAChC,UAAM8B,KAAK,GAAGxB,KAAK,MAAMH,MAAM,CAACU,IAAP,CAAYd,cAAZ,GAA6B,CAA7B,GAAiC,MAAMI,MAAM,CAACU,IAAP,CAAYd,cAAnD,GAAoE,EAA1E,CAAnB;EAEAM,MAAAA,QAAQ,CAACuB,IAAT,WAAiBzB,MAAM,CAAC4B,QAAP,CAAgBC,SAAhB,CAA0B,YAA1B,CAAjB,gBAA8DF,KAA9D;;EAEA,UAAI3B,MAAM,CAACU,IAAP,CAAYoB,aAAhB,EAA+B;EAC7B5B,QAAAA,QAAQ,CAAC6B,GAAT,CAAa,eAAb,EAA8B/B,MAAM,CAACgC,GAAP,CAAWC,WAAX,CAAuB,IAAvB,CAA9B;EACD,OAP+B;;;EAUhC,UAAMC,WAAW,GAAGlC,MAAM,CAACmC,GAAP,CAAWC,GAAX,CAAe,CAAf,EAAkBC,WAAlB,GAAgCrC,MAAM,CAACmC,GAAP,CAAWC,GAAX,CAAe,CAAf,EAAkBE,WAAtE;;EAEA,UAAIJ,WAAW,IAAI,CAAnB,EAAsB;EACpB,YAAIlC,MAAM,CAACU,IAAP,CAAY6B,SAAZ,IAAyB,KAA7B,EAAoC;EAClCrC,UAAAA,QAAQ,CAAC6B,GAAT,CAAa,aAAb,EAA4BG,WAA5B;EACD,SAFD,MAGK;EACHhC,UAAAA,QAAQ,CAAC6B,GAAT,CAAa,cAAb,EAA6BG,WAA7B;EACD;EACF;EACF;EACF;EAED;EACF;EACA;;;EACE,WAASM,KAAT,GAAiB;EACf,QAAI,CAACxC,MAAM,CAACmC,GAAZ,EAAiB,OAAO,KAAP;EAEjB,QAAI,CAACnC,MAAM,CAACU,IAAP,CAAYb,gBAAjB,EAAmC,OAAO,KAAP;EAEnCK,IAAAA,QAAQ,GAAGD,CAAC,CAACwC,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAD,CAAD,CAAkCC,IAAlC,CAAuC,OAAvC,EAAgD,YAAhD,CAAX;EACAzC,IAAAA,QAAQ,CAAC6B,GAAT,CAAa,QAAb,EAAuB/B,MAAM,CAACmC,GAAP,CAAWJ,GAAX,CAAe,qBAAf,CAAvB,EANe;;EASf,QAAI/B,MAAM,CAAC4C,UAAX,EAAuB;EACrB5C,MAAAA,MAAM,CAAC4C,UAAP,CAAkBC,MAAlB,CAAyB3C,QAAzB;EACD;;EAEDF,IAAAA,MAAM,CAACoB,MAAP,CAAc0B,EAAd,CAAiB,SAAjB,EAA4BtC,gBAA5B,EAA8C,IAA9C;EACAR,IAAAA,MAAM,CAACoB,MAAP,CAAc0B,EAAd,CAAiB,oBAAjB,EAAuCxB,uBAAvC;EACAtB,IAAAA,MAAM,CAACoB,MAAP,CAAc0B,EAAd,CAAiB,4BAAjB,EAA+C,YAAY;EACzD9C,MAAAA,MAAM,CAACoB,MAAP,CAAcC,OAAd,CAAsB,oBAAtB;EACD,KAFD;EAIArB,IAAAA,MAAM,CAACoB,MAAP,CAAc0B,EAAd,CAAiB,oBAAjB,EAAuCpB,iBAAvC;EACA1B,IAAAA,MAAM,CAACoB,MAAP,CAAcC,OAAd,CAAsB,oBAAtB;EAEArB,IAAAA,MAAM,CAACoB,MAAP,CAAc0B,EAAd,CAAiB,SAAjB,EAA4B,YAAY;EACtC7C,MAAAA,CAAC,CAACD,MAAM,CAAC+C,KAAR,CAAD,CAAgBC,GAAhB,sBAAkChD,MAAM,CAACiD,EAAzC;EACA/C,MAAAA,QAAQ,CAACgD,UAAT,GAAsBC,MAAtB;EACAjD,MAAAA,QAAQ,GAAG,IAAX;EACD,KAJD;EAKD;;EAED,SAAO;EACLsC,IAAAA,KAAK,EAAEA,KADF;EAELrC,IAAAA,KAAK,EAAEA;EAFF,GAAP;EAID,CAhHD;;;;"}