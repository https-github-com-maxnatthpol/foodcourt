/*!
 * froala_editor v3.2.6 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2021 Froala Labs
 */

{"version":3,"file":"url.js","sources":["../../../src/js/plugins/url.js"],"sourcesContent":["import FE from '../index.js'\r\n'use strict';\r\n\r\nFE.URLRegEx = `(^| |\\\\u00A0)(${FE.LinkRegEx}|([a-z0-9+-_.]{1,}@[a-z0-9+-_.]{1,}\\\\.[a-z0-9+\\-_]{1,}))$`\r\n\r\nFE.PLUGINS.url = function (editor) {\r\n\r\n  const { $ } = editor\r\n  let rel = null \r\n\r\n  /*\r\n   * Transform string into a hyperlink.\r\n   */\r\n  function _linkReplaceHandler(match, p1, p2) {\r\n    let dots = '' \r\n\r\n    while (p2.length && p2[p2.length - 1] == '.') {\r\n      dots += '.' \r\n      p2 = p2.substring(0, p2.length - 1) \r\n    }\r\n\r\n    let link = p2 \r\n\r\n    // Convert email.\r\n    if (editor.opts.linkConvertEmailAddress) {\r\n      if (editor.helpers.isEmail(link) && !/^mailto:.*/i.test(link)) {\r\n        link = `mailto:${link}` \r\n      }\r\n    }\r\n    else if (editor.helpers.isEmail(link)) {\r\n      return p1 + p2 \r\n    }\r\n\r\n    if (!/^((http|https|ftp|ftps|mailto|tel|sms|notes|data)\\:)/i.test(link)) {\r\n      link = `//${link}` \r\n    }\r\n\r\n    return (p1 ? p1 : '') + `<a${(editor.opts.linkAlwaysBlank ? ' target=\"_blank\"' : '')}${(rel ? (` rel=\"${rel}\"`) : '')} data-fr-linked=\"true\" href=\"${link}\">${p2.replace(/&amp;/g, '&').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</a>${dots}`\r\n  }\r\n\r\n  const _getRegEx = () => new RegExp(FE.URLRegEx, 'gi')\r\n\r\n  /*\r\n   * Convert link paterns from html into hyperlinks.\r\n   */\r\n  function _convertToLink(html) {\r\n\r\n    if (editor.opts.linkAlwaysNoFollow) {\r\n      rel = 'nofollow' \r\n    }\r\n\r\n    // https://github.com/froala/wysiwyg-editor/issues/1576.\r\n    if (editor.opts.linkAlwaysBlank) {\r\n      if (editor.opts.linkNoOpener) {\r\n        if (!rel) rel = 'noopener' \r\n        else rel += ' noopener' \r\n      }\r\n\r\n      if (editor.opts.linkNoReferrer) {\r\n        if (!rel) rel = 'noreferrer' \r\n        else rel += ' noreferrer' \r\n      }\r\n    }\r\n\r\n    return html.replace(_getRegEx(), _linkReplaceHandler) \r\n  }\r\n\r\n  function _isA(node) {\r\n    if (!node) return false \r\n\r\n    if (node.tagName === 'A') return true \r\n\r\n    if (node.parentNode && node.parentNode != editor.el) return _isA(node.parentNode) \r\n\r\n    return false \r\n  }\r\n\r\n  function _lastPart(text) {\r\n    const splits = text.split(' ') \r\n\r\n    return splits[splits.length - 1] \r\n  }\r\n\r\n  function _inlineType() {\r\n    const range = editor.selection.ranges(0) \r\n    const { startContainer : node } = range \r\n\r\n    if (!node || node.nodeType !== Node.TEXT_NODE || range.startOffset !== (node.textContent || '').length) return false \r\n\r\n    if (_isA(node)) return false \r\n\r\n    if (_getRegEx().test(_lastPart(node.textContent))) {\r\n      $(node).before(_convertToLink(node.textContent)) \r\n\r\n      // Get linked link.\r\n      const $link = $(node.parentNode).find('a[data-fr-linked]') \r\n      $link.removeAttr('data-fr-linked') \r\n\r\n      node.parentNode.removeChild(node) \r\n\r\n      // Trigger link event.\r\n      editor.events.trigger('url.linked', [$link.get(0)]) \r\n    }\r\n    else if (node.textContent.split(' ').length <= 2 && node.previousSibling && node.previousSibling.tagName === 'A') {\r\n      const text = node.previousSibling.innerText + node.textContent \r\n\r\n      if (_getRegEx().test(_lastPart(text))) {\r\n        /**\r\n         * Using DOMParser to parse and get the nodes from string data and replacing respective nodes in existing DOM.\r\n         */\r\n        const domParser = new DOMParser()\r\n        const childNodes = domParser.parseFromString(_convertToLink(text), 'text/html').body.childNodes\r\n\r\n        node.parentNode.replaceChild(childNodes[0], node.previousSibling)\r\n\r\n        //replacechild will change reference to the node so checking for length\r\n        if (childNodes.length) {\r\n          $(node).before(childNodes[0])\r\n        }\r\n\r\n        node.parentNode.removeChild(node)\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Initialize.\r\n   */\r\n  function _init() {\r\n    // Handle special keys.\r\n    editor.events.on('keypress', function (e) {\r\n      if (editor.selection.isCollapsed() && (e.key == '.' || e.key == ')' || e.key == '(')) {\r\n        _inlineType() \r\n      }\r\n    }, true) \r\n\r\n    // Handle ENTER and SPACE.\r\n    editor.events.on('keydown', function (e) {\r\n      const { which : keycode } = e \r\n\r\n      if (editor.selection.isCollapsed() && (keycode == FE.KEYCODE.ENTER || keycode == FE.KEYCODE.SPACE)) {\r\n        _inlineType() \r\n      }\r\n    }, true) \r\n\r\n    // Handle pasting.\r\n    editor.events.on('paste.beforeCleanup', function (html) {\r\n      if (editor.helpers.isURL(html)) {\r\n        let rel_attr = null \r\n\r\n        if (editor.opts.linkAlwaysBlank) {\r\n          if (editor.opts.linkNoOpener) {\r\n            if (!rel_attr) rel_attr = 'noopener' \r\n            else rel_attr += ' noopener' \r\n          }\r\n\r\n          if (editor.opts.linkNoReferrer) {\r\n            if (!rel_attr) rel_attr = 'noreferrer' \r\n            else rel_attr += ' noreferrer' \r\n          }\r\n        }\r\n\r\n        return `<a${(editor.opts.linkAlwaysBlank ? ' target=\"_blank\"' : '')}${(rel_attr ? (` rel=\"${rel_attr}\"`) : '')} href=\"${html}\" >${html}</a>` \r\n      }\r\n    })\r\n  }\r\n\r\n  return {\r\n    _init: _init\r\n  }\r\n}\r\n"],"names":["FE","URLRegEx","LinkRegEx","PLUGINS","url","editor","$","rel","_linkReplaceHandler","match","p1","p2","dots","length","substring","link","opts","linkConvertEmailAddress","helpers","isEmail","test","linkAlwaysBlank","replace","_getRegEx","RegExp","_convertToLink","html","linkAlwaysNoFollow","linkNoOpener","linkNoReferrer","_isA","node","tagName","parentNode","el","_lastPart","text","splits","split","_inlineType","range","selection","ranges","startContainer","nodeType","Node","TEXT_NODE","startOffset","textContent","before","$link","find","removeAttr","removeChild","events","trigger","get","previousSibling","innerText","domParser","DOMParser","childNodes","parseFromString","body","replaceChild","_init","on","e","isCollapsed","key","keycode","which","KEYCODE","ENTER","SPACE","isURL","rel_attr"],"mappings":"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"}