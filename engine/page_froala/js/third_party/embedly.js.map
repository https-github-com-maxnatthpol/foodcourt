/*!
 * froala_editor v3.2.6 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2021 Froala Labs
 */

{"version":3,"file":"embedly.js","sources":["../../../src/js/third_party/embedly.js"],"sourcesContent":["import FE from '../index.js'\r\n\r\nObject.assign(FE.POPUP_TEMPLATES, {\r\n  'embedly.insert': '[_BUTTONS_][_URL_LAYER_]',\r\n  'embedly.edit': '[_BUTTONS_]'\r\n})\r\n\r\nObject.assign(FE.DEFAULTS, {\r\n  embedlyKey: null,\r\n  embedlyInsertButtons: ['embedlyBack', '|'],\r\n  embedlyEditButtons: ['embedlyRemove'],\r\n  embedlyScriptPath: 'https://cdn.embedly.com/widgets/platform.js'\r\n})\r\n\r\nFE.PLUGINS.embedly = function (editor) {\r\n  const $ = editor.$\r\n\r\n  function _doInit(embedlyInitialized) {\r\n    // Remove any fr-uploading / fr-error images.\r\n    editor.events.on('html.processGet', _cleanOnGet)\r\n\r\n    // https://github.com/froala-labs/froala-editor-js-2/issues/1994\r\n    // set html after it is formatted by _cleanOnget method\r\n    if(embedlyInitialized){\r\n      editor.html._setHtml(editor.$el,editor.html.get())\r\n    }\r\n\r\n    editor.events.$on(editor.$el, 'click touchend', 'div.fr-embedly', _edit)\r\n\r\n    editor.events.on('mousedown window.mousedown', _markExit)\r\n    editor.events.on('window.touchmove', _unmarkExit)\r\n    editor.events.on('mouseup window.mouseup', _exitEdit)\r\n\r\n    editor.events.on('commands.mousedown', function ($btn) {\r\n      if ($btn.parents('.fr-toolbar').length > 0) {\r\n        _exitEdit()\r\n      }\r\n    })\r\n\r\n    editor.events.on('blur video.hideResizer commands.undo commands.redo element.dropped', function () {\r\n      _exitEdit(true)\r\n    })\r\n\r\n    editor.events.on('element.beforeDrop', function ($el) {\r\n      if ($el.hasClass('fr-embedly')) {\r\n        $el.html($el.attr('data-original-embed'))\r\n        return $el\r\n      }\r\n    })\r\n\r\n    editor.events.on('keydown', function (e) {\r\n      const key_code = e.which\r\n\r\n      if ($current_embed && (key_code == FE.KEYCODE.BACKSPACE || key_code == FE.KEYCODE.DELETE)) {\r\n        e.preventDefault()\r\n        remove()\r\n\r\n        return false\r\n      }\r\n\r\n      if ($current_embed && key_code == FE.KEYCODE.ESC) {\r\n        _exitEdit(true)\r\n        e.preventDefault()\r\n\r\n        return false\r\n      }\r\n\r\n      if ($current_embed && key_code != FE.KEYCODE.F10 && !editor.keys.isBrowserAction(e)) {\r\n        e.preventDefault()\r\n\r\n        return false\r\n      }\r\n    }, true)\r\n\r\n    // ESC from accessibility.\r\n    editor.events.on('toolbar.esc', function () {\r\n      if ($current_embed) {\r\n        editor.events.disableBlur()\r\n        editor.events.focus()\r\n\r\n        return false\r\n      }\r\n    }, true)\r\n\r\n    // focusEditor from accessibility.\r\n    editor.events.on('toolbar.focusEditor', function () {\r\n      if ($current_embed) {\r\n\r\n        return false\r\n      }\r\n    }, true)\r\n\r\n    // Keep Embedly structure in undo stack.\r\n    editor.events.on('snapshot.after', function (snapshot) {\r\n      const div = editor.doc.createElement('div')\r\n      div.innerHTML = snapshot.html\r\n      _cleanOnGet(div)\r\n\r\n      snapshot.html = div.innerHTML\r\n    })\r\n\r\n    // Update card size.\r\n    if (editor.win.embedly) {\r\n      editor.win.embedly('on', 'card.rendered', function (iframe) {\r\n        _setEmbedlyCardsize(iframe)\r\n      })\r\n\r\n      editor.win.embedly('on', 'card.resize', function (iframe) {\r\n        _setEmbedlyCardsize(iframe)\r\n      })\r\n    }\r\n\r\n    _initInsertPopup(true)\r\n  }\r\n\r\n  function _init() {\r\n    if (!editor.$wp) return false\r\n\r\n    if (typeof embedly !== 'undefined') {\r\n      _doInit(true)\r\n    }\r\n    else {\r\n      if (!editor.shared.embedlyLoaded) {\r\n        editor.shared.embedlyLoaded = true\r\n        editor.shared.embedlyCallbacks = []\r\n        editor.shared.embedlyCallbacks.push(_doInit)\r\n\r\n        // Init SCAYT.\r\n        const script = editor.doc.createElement('script')\r\n        script.type = 'text/javascript'\r\n        script.src = editor.opts.embedlyScriptPath\r\n        script.innerText = ''\r\n        script.onload = function () {\r\n          /*global SCAYT */\r\n          if (editor.shared.embedlyCallbacks) {\r\n            for (let i = 0; i < editor.shared.embedlyCallbacks.length; i++) {\r\n              editor.shared.embedlyCallbacks[i]()\r\n            }\r\n          }\r\n        }\r\n\r\n        editor.doc.getElementsByTagName('head')[0].appendChild(script)\r\n      }\r\n      else {\r\n        editor.shared.embedlyCallbacks.push(_doInit)\r\n      }\r\n    }\r\n  }\r\n\r\n  function _setEmbedlyCardsize(iframe) {\r\n    const $card = $(iframe)\r\n    const $card_parent = $card.parents('.fr-embedly')\r\n\r\n    $card_parent\r\n      .attr('contenteditable', false)\r\n      .attr('draggable', true)\r\n      .addClass('fr-draggable')\r\n      .css('height', $card.height())\r\n      .addClass('fr-draggable')\r\n\r\n    if (editor.opts.iframe) {\r\n      editor.size.syncIframe()\r\n    }\r\n  }\r\n\r\n  let $current_embed\r\n  function _edit(e) {\r\n    $current_embed = $(this)\r\n\r\n    _repositionResizer()\r\n    _showEditPopup()\r\n  }\r\n\r\n  function _normalize() {\r\n    // Make it draggable.\r\n    const els = editor.el.querySelectorAll('.fr-embedly')\r\n    for (let i = 0; i < els.length; i++) {\r\n      if (!editor.node.hasClass(els[i], 'fr-draggable')) {\r\n        els[i].className += ' fr-draggable'\r\n      }\r\n      els[i].setAttribute('contenteditable', false)\r\n      els[i].setAttribute('draggable', true)\r\n    }\r\n  }\r\n\r\n  let $embedly_resizer\r\n  let $overlay\r\n\r\n  function _initEditPopup() {\r\n    // embedly buttons.\r\n    let embedly_buttons = ''\r\n\r\n    if (editor.opts.embedlyEditButtons.length > 0) {\r\n      embedly_buttons += `<div class=\"fr-buttons\">\r\n      ${editor.button.buildList(editor.opts.embedlyEditButtons)}\r\n      </div>`\r\n\r\n      const template = {\r\n        buttons: embedly_buttons\r\n      }\r\n\r\n      const $popup = editor.popups.create('embedly.edit', template)\r\n\r\n      editor.events.$on(editor.$wp, 'scroll.emebdly-edit', function () {\r\n        if ($current_embed && editor.popups.isVisible('embedly.edit')) {\r\n\r\n          editor.events.disableBlur()\r\n          _editEmbed($current_embed)\r\n        }\r\n      })\r\n\r\n      return $popup\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  function _editEmbed($embed) {\r\n    _edit.call($embed.get(0))\r\n  }\r\n\r\n  /**\r\n   * Show the embedly edit popup.\r\n   */\r\n  function _showEditPopup() {\r\n    let $popup = editor.popups.get('embedly.edit')\r\n\r\n    if (!$popup) $popup = _initEditPopup()\r\n\r\n    if ($popup) {\r\n      editor.popups.setContainer('embedly.edit', editor.$sc)\r\n      editor.popups.refresh('embedly.edit')\r\n\r\n      let left = $current_embed.offset().left + $current_embed.outerWidth() / 2\r\n      let top = $current_embed.offset().top + $current_embed.outerHeight()\r\n\r\n      editor.popups.show('embedly.edit', left, top, $current_embed.outerHeight())\r\n    }\r\n  }\r\n\r\n  function _initResizer() {\r\n    let doc\r\n\r\n    // No shared embedly resizer.\r\n    if (!editor.shared.$embedly_resizer) {\r\n\r\n      // Create shared embedly resizer.\r\n      editor.shared.$embedly_resizer = $(document.createElement('div')).attr('class', 'fr-embedly-resizer')\r\n      $embedly_resizer = editor.shared.$embedly_resizer\r\n\r\n      // Bind mousedown event shared.\r\n      editor.events.$on($embedly_resizer, 'mousedown', function (e) {\r\n        e.stopPropagation()\r\n      }, true)\r\n    }\r\n    else {\r\n      $embedly_resizer = editor.shared.$embedly_resizer\r\n      $overlay = editor.shared.$embedly_overlay\r\n\r\n      editor.events.on('destroy', function () {\r\n        $('body').first().append($embedly_resizer)\r\n      }, true)\r\n    }\r\n\r\n    // Shared destroy.\r\n    editor.events.on('shared.destroy', function () {\r\n      $embedly_resizer.html('').removeData().remove()\r\n      $embedly_resizer = null\r\n    }, true)\r\n  }\r\n\r\n  /**\r\n   * Reposition resizer.\r\n   */\r\n  function _repositionResizer() {\r\n    if (!$embedly_resizer) {\r\n      _initResizer()\r\n    }\r\n\r\n    (editor.$wp || editor.$sc).append($embedly_resizer)\r\n    $embedly_resizer.data('instance', editor)\r\n\r\n    let iframePaddingLeft = 0\r\n    let iframePaddingTop = 0\r\n    if (editor.opts.iframe) {\r\n      iframePaddingTop = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-top'))\r\n      iframePaddingLeft = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-left'))\r\n    }\r\n    \r\n    $embedly_resizer\r\n      .css('top', (editor.opts.iframe ? $current_embed.offset().top + iframePaddingTop - 1 + editor.$iframe.position().top : $current_embed.offset().top - editor.$wp.offset().top - 1) + editor.$wp.scrollTop())\r\n      .css('left', (editor.opts.iframe ? $current_embed.offset().left + iframePaddingLeft - 1 : $current_embed.offset().left - editor.$wp.offset().left - 1) + editor.$wp.scrollLeft())\r\n      .css('width', $current_embed.outerWidth())\r\n      .css('height', $current_embed.height())\r\n      .addClass('fr-active')\r\n  }\r\n\r\n  function _cleanOnGet(el) {\r\n    // Tag is image.\r\n    if (el && editor.node.hasClass(el, 'fr-embedly')) {\r\n      el.innerHTML = el.getAttribute('data-original-embed')\r\n      el.removeAttribute('draggable')\r\n      el.removeAttribute('contenteditable')\r\n      el.setAttribute('class', (el.getAttribute('class') || '').replace('fr-draggable', ''))\r\n    }\r\n\r\n    // Look for inner nodes that might be in a similar case.\r\n    else if (el && el.nodeType == Node.ELEMENT_NODE) {\r\n      const els = el.querySelectorAll('.fr-embedly')\r\n\r\n      for (let i = 0; i < els.length; i++) {\r\n        _cleanOnGet(els[i])\r\n      }\r\n    }\r\n  }\r\n\r\n  function _initInsertPopup(delayed) {\r\n    if (delayed) {\r\n      editor.popups.onRefresh('embedly.insert', _refreshInsertPopup)\r\n\r\n      return true\r\n    }\r\n\r\n    let buttons = ''\r\n\r\n    if (editor.opts.embedlyInsertButtons.length > 0) {\r\n      buttons += '<div class=\"fr-buttons fr-tabs\">'\r\n      buttons += editor.button.buildList(editor.opts.embedlyInsertButtons)\r\n      buttons += '</div>'\r\n    }\r\n\r\n    // Image by url layer.\r\n    let url_layer = ''\r\n    url_layer = '<div class=\"fr-embedly-layer fr-active fr-layer\" id=\"fr-embedly-layer-' + editor.id + '\"><div class=\"fr-input-line\"><input id=\"fr-embedly-layer-text-' + editor.id + '\" type=\"text\" placeholder=\"' + editor.language.translate('Paste in a URL to embed') + '\" tabIndex=\"1\" aria-required=\"true\"></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"embedlyInsert\" tabIndex=\"2\" role=\"button\">' + editor.language.translate('Insert') + '</button></div></div>'\r\n\r\n    const template = {\r\n      buttons: buttons,\r\n      url_layer: url_layer\r\n    }\r\n\r\n    // Set the template in the popup.\r\n    const $popup = editor.popups.create('embedly.insert', template)\r\n\r\n    return $popup\r\n  }\r\n\r\n  /**\r\n   * Refresh the video insert popup.\r\n   */\r\n  function _refreshInsertPopup() {\r\n    const $popup = editor.popups.get('embedly.insert')\r\n\r\n    const $url_input = $popup.find('.fr-embedly-layer input')\r\n    $url_input.val('').trigger('change')\r\n  }\r\n\r\n  function showInsertPopup() {\r\n    const $btn = editor.$tb.find('.fr-command[data-cmd=\"embedly\"]')\r\n\r\n    let $popup = editor.popups.get('embedly.insert')\r\n\r\n    if (!$popup) $popup = _initInsertPopup()\r\n\r\n    if (!$popup.hasClass('fr-active')) {\r\n      editor.popups.refresh('embedly.insert')\r\n      editor.popups.setContainer('embedly.insert', editor.$tb)\r\n\r\n      if ($btn.isVisible()) {\r\n        const { left, top } = editor.button.getPosition($btn)\r\n        editor.popups.show('embedly.insert', left, top, $btn.outerHeight())\r\n      }\r\n      else {\r\n        editor.position.forSelection($popup)\r\n        editor.popups.show('embedly.insert')\r\n      }\r\n    }\r\n  }\r\n\r\n  function insert() {\r\n    const $popup = editor.popups.get('embedly.insert')\r\n    const $input = $popup.find('.fr-embedly-layer input')\r\n\r\n    add($input.val())\r\n  }\r\n\r\n  function add(url) {\r\n    if (url.length) {\r\n      const embed = '<a href=\\'' + url + '\\' data-card-branding=\\'0\\' class=\\'embedly-card\\'' + (editor.opts.embedlyKey ? ' data-card-key=\\'' + editor.opts.embedlyKey + '\\'' : '') + '></a>'\r\n\r\n      editor.html.insert('<div class=\"fr-embedly fr-draggable\" draggable=\"true\" contenteditable=\"false\" data-original-embed=\"' + embed + '\">' + embed + '</div>')\r\n\r\n      editor.popups.hideAll()\r\n    }\r\n  }\r\n\r\n  function remove() {\r\n    if ($current_embed) {\r\n      if (editor.events.trigger('embedly.beforeRemove', [$current_embed]) !== false) {\r\n        const $embed = $current_embed\r\n        editor.popups.hideAll()\r\n\r\n        _exitEdit(true)\r\n\r\n        editor.selection.setBefore($embed.get(0)) || editor.selection.setAfter($embed.get(0))\r\n        $embed.remove()\r\n        editor.selection.restore()\r\n\r\n        editor.html.fillEmptyBlocks()\r\n\r\n        editor.undo.saveStep()\r\n\r\n        editor.events.trigger('video.removed', [$embed])\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Exit edit.\r\n   */\r\n  function _exitEdit(force_exit) {\r\n    if ($current_embed && (_canExit() || force_exit === true)) {\r\n      $embedly_resizer.removeClass('fr-active')\r\n\r\n      editor.toolbar.enable()\r\n\r\n      $current_embed.removeClass('fr-active')\r\n      $current_embed = null\r\n\r\n      _unmarkExit()\r\n    }\r\n  }\r\n\r\n  editor.shared.embedly_exit_flag = false\r\n\r\n  function _markExit() {\r\n    editor.shared.embedly_exit_flag = true\r\n  }\r\n\r\n  function _unmarkExit() {\r\n    editor.shared.embedly_exit_flag = false\r\n  }\r\n\r\n  function _canExit() {\r\n\r\n    return editor.shared.embedly_exit_flag\r\n  }\r\n\r\n  function get() {\r\n    return $current_embed\r\n  }\r\n\r\n  function back() {\r\n    if ($current_embed) {\r\n      editor.events.disableBlur()\r\n      $current_embed.trigger('click')\r\n    }\r\n    else {\r\n      editor.events.disableBlur()\r\n      editor.selection.restore()\r\n      editor.events.enableBlur()\r\n\r\n      editor.popups.hide('embedly.insert')\r\n      editor.toolbar.showInline()\r\n    }\r\n  }\r\n\r\n  return {\r\n    _init: _init,\r\n    showInsertPopup: showInsertPopup,\r\n    insert: insert,\r\n    remove: remove,\r\n    get: get,\r\n    add: add,\r\n    back: back\r\n  }\r\n}\r\n\r\nFE.DefineIcon('embedly', { NAME: 'share-alt', SVG_KEY: 'insertEmbed' })\r\nFE.RegisterCommand('embedly', {\r\n  undo: true,\r\n  focus: true,\r\n  title: 'Embed URL',\r\n  popup: true,\r\n  callback: function () {\r\n    if (!this.popups.isVisible('embedly.insert')) {\r\n      this.embedly.showInsertPopup()\r\n    }\r\n    else {\r\n      if (this.$el.find('.fr-marker').length) {\r\n        this.events.disableBlur()\r\n        this.selection.restore()\r\n      }\r\n      this.popups.hide('embedly.insert');\r\n    }\r\n  },\r\n  plugin: 'embedly'\r\n})\r\n\r\nFE.RegisterCommand('embedlyInsert', {\r\n  undo: true,\r\n  focus: true,\r\n  callback: function () {\r\n    this.embedly.insert()\r\n  }\r\n})\r\n\r\n// Video remove.\r\nFE.DefineIcon('embedlyRemove', { NAME: 'trash', SVG_KEY: 'remove' })\r\nFE.RegisterCommand('embedlyRemove', {\r\n  title: 'Remove',\r\n  undo: false,\r\n  callback: function () {\r\n    this.embedly.remove()\r\n  }\r\n})\r\n\r\n// Video back.\r\nFE.DefineIcon('embedlyBack', { NAME: 'arrow-left', SVG_KEY: 'back' })\r\nFE.RegisterCommand('embedlyBack', {\r\n  title: 'Back',\r\n  undo: false,\r\n  focus: false,\r\n  back: true,\r\n  callback: function () {\r\n    this.embedly.back()\r\n  },\r\n  refresh: function ($btn) {\r\n    const $current_emebed = this.embedly.get()\r\n\r\n    if (!$current_emebed && !this.opts.toolbarInline) {\r\n      $btn.addClass('fr-hidden')\r\n      $btn.next('.fr-separator').addClass('fr-hidden')\r\n    }\r\n    else {\r\n      $btn.removeClass('fr-hidden')\r\n      $btn.next('.fr-separator').removeClass('fr-hidden')\r\n    }\r\n  }\r\n})\r\n"],"names":["Object","assign","FE","POPUP_TEMPLATES","DEFAULTS","embedlyKey","embedlyInsertButtons","embedlyEditButtons","embedlyScriptPath","PLUGINS","embedly","editor","$","_doInit","embedlyInitialized","events","on","_cleanOnGet","html","_setHtml","$el","get","$on","_edit","_markExit","_unmarkExit","_exitEdit","$btn","parents","length","hasClass","attr","e","key_code","which","$current_embed","KEYCODE","BACKSPACE","DELETE","preventDefault","remove","ESC","F10","keys","isBrowserAction","disableBlur","focus","snapshot","div","doc","createElement","innerHTML","win","iframe","_setEmbedlyCardsize","_initInsertPopup","_init","$wp","shared","embedlyLoaded","embedlyCallbacks","push","script","type","src","opts","innerText","onload","i","getElementsByTagName","appendChild","$card","$card_parent","addClass","css","height","size","syncIframe","_repositionResizer","_showEditPopup","$embedly_resizer","$overlay","_initEditPopup","embedly_buttons","button","buildList","template","buttons","$popup","popups","create","isVisible","_editEmbed","$embed","call","setContainer","$sc","refresh","left","offset","outerWidth","top","outerHeight","show","_initResizer","document","stopPropagation","$embedly_overlay","first","append","removeData","data","iframePaddingLeft","iframePaddingTop","helpers","getPX","find","$iframe","position","scrollTop","scrollLeft","el","node","getAttribute","removeAttribute","setAttribute","replace","nodeType","Node","ELEMENT_NODE","els","querySelectorAll","delayed","onRefresh","_refreshInsertPopup","url_layer","id","language","translate","$url_input","val","trigger","showInsertPopup","$tb","getPosition","forSelection","insert","$input","add","url","embed","hideAll","selection","setBefore","setAfter","restore","fillEmptyBlocks","undo","saveStep","force_exit","_canExit","removeClass","toolbar","enable","embedly_exit_flag","back","enableBlur","hide","showInline","DefineIcon","NAME","SVG_KEY","RegisterCommand","title","popup","callback","plugin","$current_emebed","toolbarInline","next"],"mappings":"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"}